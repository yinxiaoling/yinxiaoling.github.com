<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Etcd 项目 | Hsiao Lin</title>
    <meta name="description" content="Programer &amp; WOWER">
    <link rel="icon" href="/pig32.png">
    
    <link rel="preload" href="/assets/css/0.styles.bd66f28f.css" as="style"><link rel="preload" href="/assets/js/app.365f7fea.js" as="script"><link rel="preload" href="/assets/js/43.e76fd56e.js" as="script"><link rel="prefetch" href="/assets/js/10.e8ab10a4.js"><link rel="prefetch" href="/assets/js/11.d1cb4148.js"><link rel="prefetch" href="/assets/js/12.cba34369.js"><link rel="prefetch" href="/assets/js/13.5145e463.js"><link rel="prefetch" href="/assets/js/14.6bdbabb2.js"><link rel="prefetch" href="/assets/js/15.2888418d.js"><link rel="prefetch" href="/assets/js/16.2489649d.js"><link rel="prefetch" href="/assets/js/17.cea64679.js"><link rel="prefetch" href="/assets/js/18.3245683f.js"><link rel="prefetch" href="/assets/js/19.c6e0b481.js"><link rel="prefetch" href="/assets/js/2.7d83e6da.js"><link rel="prefetch" href="/assets/js/20.bbf67aae.js"><link rel="prefetch" href="/assets/js/21.cbcd4f96.js"><link rel="prefetch" href="/assets/js/22.b98d076e.js"><link rel="prefetch" href="/assets/js/23.ee7c5e7e.js"><link rel="prefetch" href="/assets/js/24.dd380e87.js"><link rel="prefetch" href="/assets/js/25.5c721af1.js"><link rel="prefetch" href="/assets/js/26.efb21d01.js"><link rel="prefetch" href="/assets/js/27.0fe303e8.js"><link rel="prefetch" href="/assets/js/28.566b68de.js"><link rel="prefetch" href="/assets/js/29.7b36cb29.js"><link rel="prefetch" href="/assets/js/3.68587e58.js"><link rel="prefetch" href="/assets/js/30.de9fac57.js"><link rel="prefetch" href="/assets/js/31.ef52e435.js"><link rel="prefetch" href="/assets/js/32.e2eaaa49.js"><link rel="prefetch" href="/assets/js/33.192d3a03.js"><link rel="prefetch" href="/assets/js/34.6008ae4e.js"><link rel="prefetch" href="/assets/js/35.e8816b78.js"><link rel="prefetch" href="/assets/js/36.a5a28ad5.js"><link rel="prefetch" href="/assets/js/37.a3173678.js"><link rel="prefetch" href="/assets/js/38.c4732683.js"><link rel="prefetch" href="/assets/js/39.0c57fbbe.js"><link rel="prefetch" href="/assets/js/4.e5ec2def.js"><link rel="prefetch" href="/assets/js/40.025b70cc.js"><link rel="prefetch" href="/assets/js/41.6a7897c8.js"><link rel="prefetch" href="/assets/js/42.4303301b.js"><link rel="prefetch" href="/assets/js/44.bebdc742.js"><link rel="prefetch" href="/assets/js/45.3315f2c0.js"><link rel="prefetch" href="/assets/js/46.6247d916.js"><link rel="prefetch" href="/assets/js/47.07bba9f9.js"><link rel="prefetch" href="/assets/js/48.e2bf896e.js"><link rel="prefetch" href="/assets/js/49.00e40c2a.js"><link rel="prefetch" href="/assets/js/5.dd2f6f9c.js"><link rel="prefetch" href="/assets/js/50.281dd4e2.js"><link rel="prefetch" href="/assets/js/51.ae1cb580.js"><link rel="prefetch" href="/assets/js/52.e2522b14.js"><link rel="prefetch" href="/assets/js/6.b9d02d3e.js"><link rel="prefetch" href="/assets/js/7.dc6a90bf.js"><link rel="prefetch" href="/assets/js/8.ad98fdcd.js"><link rel="prefetch" href="/assets/js/9.84c920cc.js">
    <link rel="stylesheet" href="/assets/css/0.styles.bd66f28f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Hsiao Lin</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Java/Java/" class="nav-link">Java</a></li><li class="dropdown-item"><!----> <a href="/Java/Spring/" class="nav-link">Spring</a></li><li class="dropdown-item"><!----> <a href="/Java/SpringBoot/" class="nav-link">SpringBoot</a></li><li class="dropdown-item"><!----> <a href="/Java/SpringCloud/" class="nav-link">SpringCloud</a></li><li class="dropdown-item"><!----> <a href="/Java/MyBatis/" class="nav-link">MyBatis</a></li><li class="dropdown-item"><!----> <a href="/Java/algorithm/" class="nav-link">算法</a></li><li class="dropdown-item"><h4>架构</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Java/architect/OAuth2/" class="nav-link">OAuth2</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">JavaScript</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/JavaScript/JavaScript/" class="nav-link">JavaScript</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/TypeScript/" class="nav-link">TypeScript</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/Nodejs/" class="nav-link">Node.js</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/Vue/" class="nav-link">Vue</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/React/" class="nav-link">React</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/Angular/" class="nav-link">Angular</a></li></ul></div></div><div class="nav-item"><a href="/BigData/" class="nav-link">BigData</a></div><div class="nav-item"><a href="/AI/" class="nav-link">AI</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Cloud</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/cloud/Docker/" class="nav-link router-link-active">Docker</a></li><li class="dropdown-item"><!----> <a href="/cloud/Kubernetes/" class="nav-link">Kubernetes</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/yinxiaoling" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Java/Java/" class="nav-link">Java</a></li><li class="dropdown-item"><!----> <a href="/Java/Spring/" class="nav-link">Spring</a></li><li class="dropdown-item"><!----> <a href="/Java/SpringBoot/" class="nav-link">SpringBoot</a></li><li class="dropdown-item"><!----> <a href="/Java/SpringCloud/" class="nav-link">SpringCloud</a></li><li class="dropdown-item"><!----> <a href="/Java/MyBatis/" class="nav-link">MyBatis</a></li><li class="dropdown-item"><!----> <a href="/Java/algorithm/" class="nav-link">算法</a></li><li class="dropdown-item"><h4>架构</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Java/architect/OAuth2/" class="nav-link">OAuth2</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">JavaScript</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/JavaScript/JavaScript/" class="nav-link">JavaScript</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/TypeScript/" class="nav-link">TypeScript</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/Nodejs/" class="nav-link">Node.js</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/Vue/" class="nav-link">Vue</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/React/" class="nav-link">React</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/Angular/" class="nav-link">Angular</a></li></ul></div></div><div class="nav-item"><a href="/BigData/" class="nav-link">BigData</a></div><div class="nav-item"><a href="/AI/" class="nav-link">AI</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Cloud</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/cloud/Docker/" class="nav-link router-link-active">Docker</a></li><li class="dropdown-item"><!----> <a href="/cloud/Kubernetes/" class="nav-link">Kubernetes</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/yinxiaoling" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/cloud/Docker/BasicConcepts.html" class="sidebar-link">Docker基本概念</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/BasicConcepts.html#docker-镜像" class="sidebar-link">Docker 镜像</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/BasicConcepts.html#docker-容器" class="sidebar-link">Docker 容器</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/BasicConcepts.html#docker-registry" class="sidebar-link">Docker Registry</a></li></ul></li><li><a href="/cloud/Docker/Install.html" class="sidebar-link">安装 Docker</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/Install.html#centos-安装-docker-ce" class="sidebar-link">CentOS 安装 Docker CE</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Install.html#macos-安装-docker" class="sidebar-link">MacOS 安装 Docker</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Install.html#windows-10-pc-安装-docker-ce" class="sidebar-link">Windows 10 PC 安装 Docker CE</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Install.html#ubuntu-安装-docker-ce" class="sidebar-link">Ubuntu 安装 Docker CE</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Install.html#debian-安装-docker-ce" class="sidebar-link">Debian 安装 Docker CE</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Install.html#镜像加速器" class="sidebar-link">镜像加速器</a></li></ul></li><li><a href="/cloud/Docker/UseImage.html" class="sidebar-link">使用 Docker 镜像</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#获取镜像" class="sidebar-link">获取镜像</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#列出镜像" class="sidebar-link">列出镜像</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#删除本地镜像" class="sidebar-link">删除本地镜像</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#利用-commit-理解镜像构成" class="sidebar-link">利用 commit 理解镜像构成</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#使用-dockerfile-定制镜像" class="sidebar-link">使用 Dockerfile 定制镜像</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#dockerfile-指令详解" class="sidebar-link">Dockerfile 指令详解</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#多阶段构建" class="sidebar-link">多阶段构建</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#实战多阶段构建-laravel-镜像" class="sidebar-link">实战多阶段构建 Laravel 镜像</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#其它制作镜像的方式" class="sidebar-link">其它制作镜像的方式</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#镜像的实现原理" class="sidebar-link">镜像的实现原理</a></li></ul></li><li><a href="/cloud/Docker/UseContainer.html" class="sidebar-link">操作 Docker 容器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/UseContainer.html#启动容器" class="sidebar-link">启动容器</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseContainer.html#后台运行" class="sidebar-link">后台运行</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseContainer.html#终止容器" class="sidebar-link">终止容器</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseContainer.html#进入容器" class="sidebar-link">进入容器</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseContainer.html#导出和导入容器" class="sidebar-link">导出和导入容器</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseContainer.html#删除容器" class="sidebar-link">删除容器</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseContainer.html#清理所有处于终止状态的容器" class="sidebar-link">清理所有处于终止状态的容器</a></li></ul></li><li><a href="/cloud/Docker/InterviewRegistry.html" class="sidebar-link">访问仓库</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/InterviewRegistry.html#docker-hub" class="sidebar-link">Docker Hub</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/InterviewRegistry.html#私有仓库" class="sidebar-link">私有仓库</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/InterviewRegistry.html#私有仓库高级配置" class="sidebar-link">私有仓库高级配置</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/InterviewRegistry.html#nexus3-x-的私有仓库" class="sidebar-link">Nexus3.x 的私有仓库</a></li></ul></li><li><a href="/cloud/Docker/DataManager.html" class="sidebar-link">Docker 数据管理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/DataManager.html#数据卷" class="sidebar-link">数据卷</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/DataManager.html#挂载主机目录" class="sidebar-link">挂载主机目录</a></li></ul></li><li><a href="/cloud/Docker/Network.html" class="sidebar-link">Docker 中的网络功能介绍</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/Network.html#外部访问容器" class="sidebar-link">外部访问容器</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Network.html#容器互联" class="sidebar-link">容器互联</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Network.html#配置-dns" class="sidebar-link">配置 DNS</a></li></ul></li><li><a href="/cloud/Docker/AdvancedNetwork.html" class="sidebar-link">高级网络配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/AdvancedNetwork.html#快速配置指南" class="sidebar-link">快速配置指南</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/AdvancedNetwork.html#容器访问控制" class="sidebar-link">容器访问控制</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/AdvancedNetwork.html#映射容器端口到宿主主机的实现" class="sidebar-link">映射容器端口到宿主主机的实现</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/AdvancedNetwork.html#配置-docker0-网桥" class="sidebar-link">配置 docker0 网桥</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/AdvancedNetwork.html#自定义网桥" class="sidebar-link">自定义网桥</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/AdvancedNetwork.html#工具和示例" class="sidebar-link">工具和示例</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/AdvancedNetwork.html#编辑网络配置文件" class="sidebar-link">编辑网络配置文件</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/AdvancedNetwork.html#示例：创建一个点到点连接" class="sidebar-link">示例：创建一个点到点连接</a></li></ul></li><li><a href="/cloud/Docker/compose.html" class="sidebar-link">Docker 三剑客之 Docker Compose</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/compose.html#compose-简介" class="sidebar-link">Compose 简介</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/compose.html#安装与卸载" class="sidebar-link">安装与卸载</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/compose.html#使用" class="sidebar-link">使用</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/compose.html#compose-命令说明" class="sidebar-link">Compose 命令说明</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/compose.html#compose-模板文件" class="sidebar-link">Compose 模板文件</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/compose.html#使用-django" class="sidebar-link">使用 Django</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/compose.html#使用-rails" class="sidebar-link">使用 Rails</a></li></ul></li><li><a href="/cloud/Docker/machine.html" class="sidebar-link">Docker 三剑客之 Docker Machine</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/machine.html#安装" class="sidebar-link">安装</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/machine.html#使用" class="sidebar-link">使用</a></li></ul></li><li><a href="/cloud/Docker/swarm.html" class="sidebar-link">Docker 三剑客之 Docker Swarm</a></li><li><a href="/cloud/Docker/swarm_mode.html" class="sidebar-link">Swarm mode</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/swarm_mode.html#基本概念" class="sidebar-link">基本概念</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/swarm_mode.html#创建-swarm-集群" class="sidebar-link">创建 Swarm 集群</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/swarm_mode.html#部署服务" class="sidebar-link">部署服务</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/swarm_mode.html#在-swarm-集群中使用-compose-文件" class="sidebar-link">在 Swarm 集群中使用 compose 文件</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/swarm_mode.html#在-swarm-集群中管理敏感数据" class="sidebar-link">在 Swarm 集群中管理敏感数据</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/swarm_mode.html#在-swarm-集群中管理配置数据" class="sidebar-link">在 Swarm 集群中管理配置数据</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/swarm_mode.html#swarm-mode-与滚动升级" class="sidebar-link">SWarm mode 与滚动升级</a></li></ul></li><li><a href="/cloud/Docker/Security.html" class="sidebar-link">安全</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/Security.html#内核命名空间" class="sidebar-link">内核命名空间</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Security.html#控制组" class="sidebar-link">控制组</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Security.html#docker服务端的防护" class="sidebar-link">Docker服务端的防护</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Security.html#内核能力机制" class="sidebar-link">内核能力机制</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Security.html#其它安全特性" class="sidebar-link">其它安全特性</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Security.html#总结" class="sidebar-link">总结</a></li></ul></li><li><a href="/cloud/Docker/underly.html" class="sidebar-link">底层实现</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/underly.html#基本架构" class="sidebar-link">基本架构</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/underly.html#命名空间" class="sidebar-link">命名空间</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/underly.html#控制组" class="sidebar-link">控制组</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/underly.html#联合文件系统" class="sidebar-link">联合文件系统</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/underly.html#容器格式" class="sidebar-link">容器格式</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/underly.html#docker-网络实现" class="sidebar-link">Docker 网络实现</a></li></ul></li><li><a href="/cloud/Docker/etcd.html" class="active sidebar-link">Etcd 项目</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/etcd.html#什么是-etcd" class="sidebar-link">什么是 etcd</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/etcd.html#安装" class="sidebar-link">安装</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/etcd.html#etcd-集群" class="sidebar-link">etcd 集群</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/etcd.html#使用-etcdctl" class="sidebar-link">使用 etcdctl</a></li></ul></li><li><a href="/cloud/Docker/coreos.html" class="sidebar-link">CoreOS 项目</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/coreos.html#coreos-介绍" class="sidebar-link">CoreOS 介绍</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/coreos.html#coreos-特性" class="sidebar-link">CoreOS 特性</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/coreos.html#coreos-工具介绍" class="sidebar-link">CoreOS 工具介绍</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/coreos.html#快速搭建-coreos-集群" class="sidebar-link">快速搭建 CoreOS 集群</a></li></ul></li><li><a href="/cloud/Docker/kubernetes.html" class="sidebar-link">Kubernetes</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/kubernetes.html#项目简介" class="sidebar-link">项目简介</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/kubernetes.html#快速上手" class="sidebar-link">快速上手</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/kubernetes.html#基本概念" class="sidebar-link">基本概念</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/kubernetes.html#kubectl-使用" class="sidebar-link">kubectl 使用</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/kubernetes.html#基本架构" class="sidebar-link">基本架构</a></li></ul></li><li><a href="/cloud/Docker/mesos.html" class="sidebar-link">Mesos - 优秀的集群资源调度平台</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/mesos.html#简介" class="sidebar-link">简介</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/mesos.html#mesos-安装与使用" class="sidebar-link">Mesos 安装与使用</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/mesos.html#原理与架构" class="sidebar-link">原理与架构</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/mesos.html#mesos-配置项解析" class="sidebar-link">Mesos 配置项解析</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/mesos.html#日志与监控" class="sidebar-link">日志与监控</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/mesos.html#常见应用框架" class="sidebar-link">常见应用框架</a></li></ul></li><li><a href="/cloud/Docker/cases_os.html" class="sidebar-link">实战-操作系统</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/cases_os.html#busybox" class="sidebar-link">Busybox</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/cases_os.html#alpine" class="sidebar-link">Alpine</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/cases_os.html#debian-ubuntu" class="sidebar-link">Debian/Ubuntu</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/cases_os.html#centos-fedora" class="sidebar-link">CentOS/Fedora</a></li></ul></li><li><a href="/cloud/Docker/cases_cicd.html" class="sidebar-link">实战-CI/CD</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/cases_cicd.html#drone" class="sidebar-link">Drone</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/cases_cicd.html#参考链接" class="sidebar-link">参考链接</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/cases_cicd.html#在-travis-ci-中使用-docker" class="sidebar-link">在 Travis CI 中使用 Docker</a></li></ul></li><li><a href="/cloud/Docker/opensource.html" class="sidebar-link">Docker 开源项目</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/opensource.html#linuxkit" class="sidebar-link">LinuxKit</a></li></ul></li><li><a href="/cloud/Docker/appendix.1.html" class="sidebar-link">附录一：常见问题总结</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.1.html#镜像相关" class="sidebar-link">镜像相关</a></li></ul></li><li><a href="/cloud/Docker/appendix.2.html" class="sidebar-link">附录二：热门镜像介绍</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.2.html#ubuntu" class="sidebar-link">Ubuntu</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.2.html#centos" class="sidebar-link">CentOS</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.2.html#nginx" class="sidebar-link">Nginx</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.2.html#mysql" class="sidebar-link">MySQL</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.2.html#mongodb" class="sidebar-link">MongoDB</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.2.html#redis" class="sidebar-link">Redis</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.2.html#node-js" class="sidebar-link">Node.js</a></li></ul></li><li><a href="/cloud/Docker/appendix.3.html" class="sidebar-link">附录三：Docker 命令查询</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.3.html#基本语法" class="sidebar-link">基本语法</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.3.html#客户端命令选项" class="sidebar-link">客户端命令选项</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.3.html#dockerd-命令选项" class="sidebar-link">dockerd 命令选项</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.3.html#客户端命令" class="sidebar-link">客户端命令</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.3.html#一张图总结-docker-的命令" class="sidebar-link">一张图总结 Docker 的命令</a></li></ul></li><li><a href="/cloud/Docker/appendix.4.html" class="sidebar-link">附录四：Dockerfile 最佳实践</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.4.html#一般性的指南和建议" class="sidebar-link">一般性的指南和建议</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.4.html#dockerfile-指令" class="sidebar-link">Dockerfile 指令</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.4.html#官方镜像示例" class="sidebar-link">官方镜像示例</a></li></ul></li><li><a href="/cloud/Docker/appendix.5.html" class="sidebar-link">附录五：如何调试 Docker</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.5.html#开启-debug-模式" class="sidebar-link">开启 Debug 模式</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.5.html#检查内核日志" class="sidebar-link">检查内核日志</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.5.html#docker-不响应时处理" class="sidebar-link">Docker 不响应时处理</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.5.html#重置-docker-本地数据" class="sidebar-link">重置 Docker 本地数据</a></li></ul></li><li><a href="/cloud/Docker/appendix.6.html" class="sidebar-link">附录六：资源链接</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.6.html#官方网站" class="sidebar-link">官方网站</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.6.html#实践参考" class="sidebar-link">实践参考</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.6.html#技术交流" class="sidebar-link">技术交流</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.6.html#其它" class="sidebar-link">其它</a></li></ul></li></ul> </div> <div class="page"> <div class="content"><h1 id="etcd-项目"><a href="#etcd-项目" aria-hidden="true" class="header-anchor">#</a> Etcd 项目</h1> <p><code>etcd</code> 是 <code>CoreOS</code> 团队发起的一个管理配置信息和服务发现（<code>Service Discovery</code>）的项目，在这一章里面，我们将基于 <code>etcd 3.x</code> 版本介绍该项目的目标，安装和使用，以及实现的技术。</p> <h2 id="什么是-etcd"><a href="#什么是-etcd" aria-hidden="true" class="header-anchor">#</a> 什么是 etcd</h2> <p><img src="https://yeasy.gitbooks.io/docker_practice/etcd/_images/etcd_logo.png" alt="img"></p> <p><code>etcd</code> 是 <code>CoreOS</code> 团队于 2013 年 6 月发起的开源项目，它的目标是构建一个高可用的分布式键值（<code>key-value</code>）数据库，基于 <code>Go</code> 语言实现。我们知道，在分布式系统中，各种服务的配置信息的管理分享，服务的发现是一个很基本同时也是很重要的问题。<code>CoreOS</code> 项目就希望基于 <code>etcd</code> 来解决这一问题。</p> <p><code>etcd</code> 目前在 <a href="https://github.com/coreos/etcd" target="_blank" rel="noopener noreferrer">github.com/coreos/etcd<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 进行维护。</p> <p>受到 <a href="https://zookeeper.apache.org/" target="_blank" rel="noopener noreferrer">Apache ZooKeeper<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 项目和 <a href="https://github.com/ha/doozerd" target="_blank" rel="noopener noreferrer">doozer<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 项目的启发，<code>etcd</code> 在设计的时候重点考虑了下面四个要素：</p> <ul><li><p>简单：具有定义良好、面向用户的 <code>API</code> (<a href="https://github.com/grpc/grpc" target="_blank" rel="noopener noreferrer">gRPC<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>)</p></li> <li><p>安全：支持 <code>HTTPS</code> 方式的访问</p></li> <li><p>快速：支持并发 <code>10 k/s</code> 的写操作</p></li> <li><p>可靠：支持分布式结构，基于 <code>Raft</code> 的一致性算法</p></li></ul> <p><em>Apache ZooKeeper 是一套知名的分布式系统中进行同步和一致性管理的工具。</em></p> <p><em>doozer 是一个一致性分布式数据库。</em></p> <p><em><a href="https://raft.github.io/" target="_blank" rel="noopener noreferrer">Raft<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 是一套通过选举主节点来实现分布式系统一致性的算法，相比于大名鼎鼎的 Paxos 算法，它的过程更容易被人理解，由 Stanford 大学的 Diego Ongaro 和 John Ousterhout 提出。更多细节可以参考 <a href="http://raftconsensus.github.io" target="_blank" rel="noopener noreferrer">raftconsensus.github.io<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</em></p> <p>一般情况下，用户使用 <code>etcd</code> 可以在多个节点上启动多个实例，并添加它们为一个集群。同一个集群中的 <code>etcd</code> 实例将会保持彼此信息的一致性。</p> <h2 id="安装"><a href="#安装" aria-hidden="true" class="header-anchor">#</a> 安装</h2> <p><code>etcd</code> 基于 <code>Go</code> 语言实现，因此，用户可以从 <a href="https://github.com/coreos/etcd" target="_blank" rel="noopener noreferrer">项目主页<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 下载源代码自行编译，也可以下载编译好的二进制文件，甚至直接使用制作好的 <code>Docker</code> 镜像文件来体验。</p> <blockquote><p>注意：本章节内容基于 etcd <code>3.x</code> 版本</p></blockquote> <h3 id="二进制文件方式下载"><a href="#二进制文件方式下载" aria-hidden="true" class="header-anchor">#</a> 二进制文件方式下载</h3> <p>编译好的二进制文件都在 <a href="https://github.com/coreos/etcd/releases/" target="_blank" rel="noopener noreferrer">github.com/coreos/etcd/releases<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 页面，用户可以选择需要的版本，或通过下载工具下载。</p> <p>例如，使用 <code>curl</code> 工具下载压缩包，并解压。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">curl</span> -L  https://github.com/coreos/etcd/releases/download/v3.2.10/etcd-v3.2.10-linux-amd64.tar.gz -o etcd-v3.2.10-linux-amd64.tar.gz
$ <span class="token function">tar</span> xzvf etcd-v3.2.10-linux-amd64.tar.gz
$ <span class="token function">cd</span> etcd-v3.2.10-linux-amd64
</code></pre></div><p>解压后，可以看到文件包括</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">ls</span>
Documentation README-etcdctl.md README.md READMEv2-etcdctl.md etcd etcdctl
</code></pre></div><p>其中 <code>etcd</code> 是服务主文件，<code>etcdctl</code> 是提供给用户的命令客户端，其他文件是支持文档。</p> <p>下面将 <code>etcd</code> <code>etcdctl</code> 文件放到系统可执行目录（例如 <code>/usr/local/bin/</code>）。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">sudo</span> <span class="token function">cp</span> etcd* /usr/local/bin/
</code></pre></div><p>默认 <code>2379</code> 端口处理客户端的请求，<code>2380</code> 端口用于集群各成员间的通信。启动 <code>etcd</code> 显示类似如下的信息：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ etcd
2017-12-03 11:18:34.406082 I <span class="token operator">|</span> etcdmain: etcd Version: 3.2.10
2017-12-03 11:18:34.406226 I <span class="token operator">|</span> etcdmain: Git SHA: GitNotFound
2017-12-03 11:18:34.406235 I <span class="token operator">|</span> etcdmain: Go Version: go1.9.2
2017-12-03 11:18:34.406242 I <span class="token operator">|</span> etcdmain: Go OS/Arch: darwin/amd64
2017-12-03 11:18:34.406250 I <span class="token operator">|</span> etcdmain: setting maximum number of CPUs to 4, total number of available CPUs is 4
2017-12-03 11:18:34.406265 N <span class="token operator">|</span> etcdmain: failed to detect default host <span class="token punctuation">(</span>default host not supported on darwin_amd64<span class="token punctuation">)</span>
2017-12-03 11:18:34.406279 W <span class="token operator">|</span> etcdmain: no data-dir provided, using default data-dir ./default.etcd
2017-12-03 11:18:34.406457 N <span class="token operator">|</span> etcdmain: the server is already initialized as member before, starting as etcd member<span class="token punctuation">..</span>.
2017-12-03 11:18:34.411579 I <span class="token operator">|</span> embed: listening <span class="token keyword">for</span> peers on http://localhost:2380
2017-12-03 11:18:34.411938 I <span class="token operator">|</span> embed: listening <span class="token keyword">for</span> client requests on localhost:2379
</code></pre></div><p>此时，可以使用 <code>etcdctl</code> 命令进行测试，设置和获取键值 <code>testkey: &quot;hello world&quot;</code>，检查 <code>etcd</code> 服务是否启动成功：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ ETCDCTL_API<span class="token operator">=</span>3 etcdctl member list
8e9e05c52164694d, started, default, http://localhost:2380, http://localhost:2379

$ ETCDCTL_API<span class="token operator">=</span>3 etcdctl put testkey <span class="token string">&quot;hello world&quot;</span>
OK

$ etcdctl get testkey
testkey
hello world
</code></pre></div><p>说明 etcd 服务已经成功启动了。</p> <h3 id="docker-镜像方式运行"><a href="#docker-镜像方式运行" aria-hidden="true" class="header-anchor">#</a> Docker 镜像方式运行</h3> <p>镜像名称为 <code>quay.io/coreos/etcd</code>，可以通过下面的命令启动 <code>etcd</code> 服务监听到 <code>2379</code> 和 <code>2380</code> 端口。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">export</span> NODE1<span class="token operator">=</span>192.168.1.21

$ docker run --name etcd \
    -p 2379:2379 \
    -p 2380:2380 \
    --volume<span class="token operator">=</span>etcd-data:/etcd-data \
    quay.io/coreos/etcd:latest \
    /usr/local/bin/etcd \
    --data-dir<span class="token operator">=</span>/etcd-data --name node1 \
    --initial-advertise-peer-urls http://<span class="token variable">${NODE1}</span>:2380 --listen-peer-urls http://0.0.0.0:2380 \
    --advertise-client-urls http://<span class="token variable">${NODE1}</span>:2379 --listen-client-urls http://0.0.0.0:2379 \
    --initial-cluster node1<span class="token operator">=</span>http://<span class="token variable">${NODE1}</span>:2380
</code></pre></div><blockquote><p>注意：etcd 官方标注 <code>quay.io/coreos/etcd</code> 即将废弃，启用新的 <code>gcr.io/etcd-development/etcd</code> 镜像，但后者由于网络原因，国内不能下载到该镜像，这里仍然使用前者作为演示。</p></blockquote> <p>打开新的终端按照上一步的方法测试 <code>etcd</code> 是否成功启动。</p> <h3 id="macos-中运行"><a href="#macos-中运行" aria-hidden="true" class="header-anchor">#</a> macOS 中运行</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>$ brew <span class="token function">install</span> etcd

$ etcd

$ etcdctl member list
</code></pre></div><h2 id="etcd-集群"><a href="#etcd-集群" aria-hidden="true" class="header-anchor">#</a> etcd 集群</h2> <p>下面我们使用 Docker Compose 模拟启动一个 3 节点的 <code>etcd</code> 集群。</p> <p>编辑 <code>docker-compose.yml</code> 文件</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&quot;3.6&quot;</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>

  <span class="token key atrule">node1</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> quay.io/coreos/etcd
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> node1<span class="token punctuation">-</span>data<span class="token punctuation">:</span>/etcd<span class="token punctuation">-</span>data
    <span class="token key atrule">expose</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token number">2379</span>
      <span class="token punctuation">-</span> <span class="token number">2380      </span>
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token key atrule">cluster_net</span><span class="token punctuation">:</span>
        <span class="token key atrule">ipv4_address</span><span class="token punctuation">:</span> 172.16.238.100
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ETCDCTL_API=3
    <span class="token key atrule">command</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> /usr/local/bin/etcd
      <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>data<span class="token punctuation">-</span>dir=/etcd<span class="token punctuation">-</span>data
      <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>name
      <span class="token punctuation">-</span> node1
      <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>initial<span class="token punctuation">-</span>advertise<span class="token punctuation">-</span>peer<span class="token punctuation">-</span>urls
      <span class="token punctuation">-</span> http<span class="token punctuation">:</span>//172.16.238.100<span class="token punctuation">:</span><span class="token number">2380</span>
      <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>listen<span class="token punctuation">-</span>peer<span class="token punctuation">-</span>urls
      <span class="token punctuation">-</span> http<span class="token punctuation">:</span>//0.0.0.0<span class="token punctuation">:</span><span class="token number">2380</span>
      <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>advertise<span class="token punctuation">-</span>client<span class="token punctuation">-</span>urls
      <span class="token punctuation">-</span> http<span class="token punctuation">:</span>//172.16.238.100<span class="token punctuation">:</span><span class="token number">2379</span>
      <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>listen<span class="token punctuation">-</span>client<span class="token punctuation">-</span>urls
      <span class="token punctuation">-</span> http<span class="token punctuation">:</span>//0.0.0.0<span class="token punctuation">:</span><span class="token number">2379</span>
      <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>initial<span class="token punctuation">-</span>cluster
      <span class="token punctuation">-</span> node1=http<span class="token punctuation">:</span>//172.16.238.100<span class="token punctuation">:</span><span class="token number">2380</span><span class="token punctuation">,</span>node2=http<span class="token punctuation">:</span>//172.16.238.101<span class="token punctuation">:</span><span class="token number">2380</span><span class="token punctuation">,</span>node3=http<span class="token punctuation">:</span>//172.16.238.102<span class="token punctuation">:</span><span class="token number">2380</span>
      <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>initial<span class="token punctuation">-</span>cluster<span class="token punctuation">-</span>state
      <span class="token punctuation">-</span> new
      <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>initial<span class="token punctuation">-</span>cluster<span class="token punctuation">-</span>token
      <span class="token punctuation">-</span> docker<span class="token punctuation">-</span>etcd

  <span class="token key atrule">node2</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> quay.io/coreos/etcd
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> node2<span class="token punctuation">-</span>data<span class="token punctuation">:</span>/etcd<span class="token punctuation">-</span>data
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token key atrule">cluster_net</span><span class="token punctuation">:</span>
        <span class="token key atrule">ipv4_address</span><span class="token punctuation">:</span> 172.16.238.101
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ETCDCTL_API=3
    <span class="token key atrule">expose</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token number">2379</span>
      <span class="token punctuation">-</span> <span class="token number">2380</span>
    <span class="token key atrule">command</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> /usr/local/bin/etcd
      <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>data<span class="token punctuation">-</span>dir=/etcd<span class="token punctuation">-</span>data
      <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>name
      <span class="token punctuation">-</span> node2
      <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>initial<span class="token punctuation">-</span>advertise<span class="token punctuation">-</span>peer<span class="token punctuation">-</span>urls
      <span class="token punctuation">-</span> http<span class="token punctuation">:</span>//172.16.238.101<span class="token punctuation">:</span><span class="token number">2380</span>
      <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>listen<span class="token punctuation">-</span>peer<span class="token punctuation">-</span>urls
      <span class="token punctuation">-</span> http<span class="token punctuation">:</span>//0.0.0.0<span class="token punctuation">:</span><span class="token number">2380</span>
      <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>advertise<span class="token punctuation">-</span>client<span class="token punctuation">-</span>urls
      <span class="token punctuation">-</span> http<span class="token punctuation">:</span>//172.16.238.101<span class="token punctuation">:</span><span class="token number">2379</span>
      <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>listen<span class="token punctuation">-</span>client<span class="token punctuation">-</span>urls
      <span class="token punctuation">-</span> http<span class="token punctuation">:</span>//0.0.0.0<span class="token punctuation">:</span><span class="token number">2379</span>
      <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>initial<span class="token punctuation">-</span>cluster
      <span class="token punctuation">-</span> node1=http<span class="token punctuation">:</span>//172.16.238.100<span class="token punctuation">:</span><span class="token number">2380</span><span class="token punctuation">,</span>node2=http<span class="token punctuation">:</span>//172.16.238.101<span class="token punctuation">:</span><span class="token number">2380</span><span class="token punctuation">,</span>node3=http<span class="token punctuation">:</span>//172.16.238.102<span class="token punctuation">:</span><span class="token number">2380</span>
      <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>initial<span class="token punctuation">-</span>cluster<span class="token punctuation">-</span>state
      <span class="token punctuation">-</span> new
      <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>initial<span class="token punctuation">-</span>cluster<span class="token punctuation">-</span>token
      <span class="token punctuation">-</span> docker<span class="token punctuation">-</span>etcd

  <span class="token key atrule">node3</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> quay.io/coreos/etcd
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> node3<span class="token punctuation">-</span>data<span class="token punctuation">:</span>/etcd<span class="token punctuation">-</span>data
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token key atrule">cluster_net</span><span class="token punctuation">:</span>
        <span class="token key atrule">ipv4_address</span><span class="token punctuation">:</span> 172.16.238.102
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ETCDCTL_API=3
    <span class="token key atrule">expose</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token number">2379</span>
      <span class="token punctuation">-</span> <span class="token number">2380</span>
    <span class="token key atrule">command</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> /usr/local/bin/etcd
      <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>data<span class="token punctuation">-</span>dir=/etcd<span class="token punctuation">-</span>data
      <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>name
      <span class="token punctuation">-</span> node3
      <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>initial<span class="token punctuation">-</span>advertise<span class="token punctuation">-</span>peer<span class="token punctuation">-</span>urls
      <span class="token punctuation">-</span> http<span class="token punctuation">:</span>//172.16.238.102<span class="token punctuation">:</span><span class="token number">2380</span>
      <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>listen<span class="token punctuation">-</span>peer<span class="token punctuation">-</span>urls
      <span class="token punctuation">-</span> http<span class="token punctuation">:</span>//0.0.0.0<span class="token punctuation">:</span><span class="token number">2380</span>
      <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>advertise<span class="token punctuation">-</span>client<span class="token punctuation">-</span>urls
      <span class="token punctuation">-</span> http<span class="token punctuation">:</span>//172.16.238.102<span class="token punctuation">:</span><span class="token number">2379</span>
      <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>listen<span class="token punctuation">-</span>client<span class="token punctuation">-</span>urls
      <span class="token punctuation">-</span> http<span class="token punctuation">:</span>//0.0.0.0<span class="token punctuation">:</span><span class="token number">2379</span>
      <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>initial<span class="token punctuation">-</span>cluster
      <span class="token punctuation">-</span> node1=http<span class="token punctuation">:</span>//172.16.238.100<span class="token punctuation">:</span><span class="token number">2380</span><span class="token punctuation">,</span>node2=http<span class="token punctuation">:</span>//172.16.238.101<span class="token punctuation">:</span><span class="token number">2380</span><span class="token punctuation">,</span>node3=http<span class="token punctuation">:</span>//172.16.238.102<span class="token punctuation">:</span><span class="token number">2380</span>
      <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>initial<span class="token punctuation">-</span>cluster<span class="token punctuation">-</span>state
      <span class="token punctuation">-</span> new
      <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>initial<span class="token punctuation">-</span>cluster<span class="token punctuation">-</span>token
      <span class="token punctuation">-</span> docker<span class="token punctuation">-</span>etcd

<span class="token key atrule">volumes</span><span class="token punctuation">:</span>
  <span class="token key atrule">node1-data</span><span class="token punctuation">:</span>
  <span class="token key atrule">node2-data</span><span class="token punctuation">:</span>
  <span class="token key atrule">node3-data</span><span class="token punctuation">:</span>

<span class="token key atrule">networks</span><span class="token punctuation">:</span>
  <span class="token key atrule">cluster_net</span><span class="token punctuation">:</span>
    <span class="token key atrule">driver</span><span class="token punctuation">:</span> bridge
    <span class="token key atrule">ipam</span><span class="token punctuation">:</span>
      <span class="token key atrule">driver</span><span class="token punctuation">:</span> default
      <span class="token key atrule">config</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span>
        <span class="token key atrule">subnet</span><span class="token punctuation">:</span> 172.16.238.0/24
</code></pre></div><p>使用 <code>docker-compose up</code> 启动集群之后使用 <code>docker exec</code> 命令登录到任一节点测试 <code>etcd</code> 集群。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>/ <span class="token comment"># etcdctl member list</span>
daf3fd52e3583ff, started, node3, http://172.16.238.102:2380, http://172.16.238.102:2379
422a74f03b622fef, started, node1, http://172.16.238.100:2380, http://172.16.238.100:2379
ed635d2a2dbef43d, started, node2, http://172.16.238.101:2380, http://172.16.238.101:2379
</code></pre></div><h2 id="使用-etcdctl"><a href="#使用-etcdctl" aria-hidden="true" class="header-anchor">#</a> 使用 etcdctl</h2> <p><code>etcdctl</code> 是一个命令行客户端，它能提供一些简洁的命令，供用户直接跟 <code>etcd</code> 服务打交道，而无需基于 <code>HTTP API</code> 方式。这在某些情况下将很方便，例如用户对服务进行测试或者手动修改数据库内容。我们也推荐在刚接触 <code>etcd</code> 时通过 <code>etcdctl</code> 命令来熟悉相关的操作，这些操作跟 <code>HTTP API</code> 实际上是对应的。</p> <p><code>etcd</code> 项目二进制发行包中已经包含了 <code>etcdctl</code> 工具，没有的话，可以从 <a href="https://github.com/coreos/etcd/releases" target="_blank" rel="noopener noreferrer">github.com/coreos/etcd/releases<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 下载。</p> <p><code>etcdctl</code> 支持如下的命令，大体上分为数据库操作和非数据库操作两类，后面将分别进行解释。</p> <div class="language- extra-class"><pre class="language-text"><code>NAME:
	etcdctl - A simple command line client for etcd3.

USAGE:
	etcdctl

VERSION:
	3.2.10

API VERSION:
	3.2


COMMANDS:
	get			Gets the key or a range of keys
	put			Puts the given key into the store
	del			Removes the specified key or range of keys [key, range_end)
	txn			Txn processes all the requests in one transaction
	compaction		Compacts the event history in etcd
	alarm disarm		Disarms all alarms
	alarm list		Lists all alarms
	defrag			Defragments the storage of the etcd members with given endpoints
	endpoint health		Checks the healthiness of endpoints specified in `--endpoints` flag
	endpoint status		Prints out the status of endpoints specified in `--endpoints` flag
	watch			Watches events stream on keys or prefixes
	version			Prints the version of etcdctl
	lease grant		Creates leases
	lease revoke		Revokes leases
	lease timetolive	Get lease information
	lease keep-alive	Keeps leases alive (renew)
	member add		Adds a member into the cluster
	member remove		Removes a member from the cluster
	member update		Updates a member in the cluster
	member list		Lists all members in the cluster
	snapshot save		Stores an etcd node backend snapshot to a given file
	snapshot restore	Restores an etcd member snapshot to an etcd directory
	snapshot status		Gets backend snapshot status of a given file
	make-mirror		Makes a mirror at the destination etcd cluster
	migrate			Migrates keys in a v2 store to a mvcc store
	lock			Acquires a named lock
	elect			Observes and participates in leader election
	auth enable		Enables authentication
	auth disable		Disables authentication
	user add		Adds a new user
	user delete		Deletes a user
	user get		Gets detailed information of a user
	user list		Lists all users
	user passwd		Changes password of user
	user grant-role		Grants a role to a user
	user revoke-role	Revokes a role from a user
	role add		Adds a new role
	role delete		Deletes a role
	role get		Gets detailed information of a role
	role list		Lists all roles
	role grant-permission	Grants a key to a role
	role revoke-permission	Revokes a key from a role
	check perf		Check the performance of the etcd cluster
	help			Help about any command

OPTIONS:
      --cacert=&quot;&quot;				verify certificates of TLS-enabled secure servers using this CA bundle
      --cert=&quot;&quot;					identify secure client using this TLS certificate file
      --command-timeout=5s			timeout for short running command (excluding dial timeout)
      --debug[=false]				enable client-side debug logging
      --dial-timeout=2s				dial timeout for client connections
      --endpoints=[127.0.0.1:2379]		gRPC endpoints
      --hex[=false]				print byte strings as hex encoded strings
      --insecure-skip-tls-verify[=false]	skip server certificate verification
      --insecure-transport[=true]		disable transport security for client connections
      --key=&quot;&quot;					identify secure client using this TLS key file
      --user=&quot;&quot;					username[:password] for authentication (prompt if password is not supplied)
  -w, --write-out=&quot;simple&quot;			set the output format (fields, json, protobuf, simple, table)
</code></pre></div><h3 id="数据库操作"><a href="#数据库操作" aria-hidden="true" class="header-anchor">#</a> 数据库操作</h3> <p>数据库操作围绕对键值和目录的 CRUD （符合 REST 风格的一套操作：Create）完整生命周期的管理。</p> <p>etcd 在键的组织上采用了层次化的空间结构（类似于文件系统中目录的概念），用户指定的键可以为单独的名字，如 <code>testkey</code>，此时实际上放在根目录 <code>/</code> 下面，也可以为指定目录结构，如 <code>cluster1/node2/testkey</code>，则将创建相应的目录结构。</p> <blockquote><p>注：CRUD 即 Create, Read, Update, Delete，是符合 REST 风格的一套 API 操作。</p></blockquote> <h4 id="put"><a href="#put" aria-hidden="true" class="header-anchor">#</a> put</h4> <div class="language-bash extra-class"><pre class="language-bash"><code>$ etcdctl put /testdir/testkey <span class="token string">&quot;Hello world&quot;</span>
OK
</code></pre></div><h4 id="get"><a href="#get" aria-hidden="true" class="header-anchor">#</a> get</h4> <p>获取指定键的值。例如</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ etcdctl put testkey hello
OK
$ etcdctl get testkey
testkey
hello
</code></pre></div><p>支持的选项为</p> <p><code>--sort</code>	对结果进行排序</p> <p><code>--consistent</code> 将请求发给主节点，保证获取内容的一致性</p> <h4 id="del"><a href="#del" aria-hidden="true" class="header-anchor">#</a> del</h4> <p>删除某个键值。例如</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ etcdctl del testkey
1
</code></pre></div><h3 id="非数据库操作"><a href="#非数据库操作" aria-hidden="true" class="header-anchor">#</a> 非数据库操作</h3> <h4 id="watch"><a href="#watch" aria-hidden="true" class="header-anchor">#</a> watch</h4> <p>监测一个键值的变化，一旦键值发生更新，就会输出最新的值。</p> <p>例如，用户更新 <code>testkey</code> 键值为 <code>Hello world</code>。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ etcdctl <span class="token function">watch</span> testkey
PUT
testkey
2
</code></pre></div><h4 id="member"><a href="#member" aria-hidden="true" class="header-anchor">#</a> member</h4> <p>通过 <code>list</code>、<code>add</code>、<code>update</code>、<code>remove</code> 命令列出、添加、更新、删除 etcd 实例到 etcd 集群中。</p> <p>例如本地启动一个 <code>etcd</code> 服务实例后，可以用如下命令进行查看。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ etcdctl member list
422a74f03b622fef, started, node1, http://172.16.238.100:2380, http://172.16.238.100:23
</code></pre></div></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/cloud/Docker/underly.html" class="prev">
          底层实现
        </a></span> <span class="next"><a href="/cloud/Docker/coreos.html">
          CoreOS 项目
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/app.365f7fea.js" defer></script><script src="/assets/js/43.e76fd56e.js" defer></script>
  </body>
</html>
