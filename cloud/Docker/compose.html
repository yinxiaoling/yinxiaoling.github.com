<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Docker 三剑客之 Docker Compose | Hsiao Lin</title>
    <meta name="description" content="Programer &amp; WOWER">
    <link rel="icon" href="/pig32.png">
    
    <link rel="preload" href="/assets/css/0.styles.bd66f28f.css" as="style"><link rel="preload" href="/assets/js/app.1a189f9b.js" as="script"><link rel="preload" href="/assets/js/49.9746f461.js" as="script"><link rel="prefetch" href="/assets/js/10.a8ef3ac2.js"><link rel="prefetch" href="/assets/js/11.379bda39.js"><link rel="prefetch" href="/assets/js/12.106a9a6b.js"><link rel="prefetch" href="/assets/js/13.4fb277f1.js"><link rel="prefetch" href="/assets/js/14.f2978933.js"><link rel="prefetch" href="/assets/js/15.be1594c7.js"><link rel="prefetch" href="/assets/js/16.b6b9634a.js"><link rel="prefetch" href="/assets/js/17.78e3b59b.js"><link rel="prefetch" href="/assets/js/18.bb68b1a8.js"><link rel="prefetch" href="/assets/js/19.1e4150a2.js"><link rel="prefetch" href="/assets/js/2.7d83e6da.js"><link rel="prefetch" href="/assets/js/20.13a27359.js"><link rel="prefetch" href="/assets/js/21.c8f030ae.js"><link rel="prefetch" href="/assets/js/22.9e3d700f.js"><link rel="prefetch" href="/assets/js/23.712927c5.js"><link rel="prefetch" href="/assets/js/24.33909c0e.js"><link rel="prefetch" href="/assets/js/25.6f73f685.js"><link rel="prefetch" href="/assets/js/26.96cd572a.js"><link rel="prefetch" href="/assets/js/27.91bca9f3.js"><link rel="prefetch" href="/assets/js/28.9ca57cdb.js"><link rel="prefetch" href="/assets/js/29.d32c4c18.js"><link rel="prefetch" href="/assets/js/3.68587e58.js"><link rel="prefetch" href="/assets/js/30.ead369ef.js"><link rel="prefetch" href="/assets/js/31.9d24fd8c.js"><link rel="prefetch" href="/assets/js/32.6a5772eb.js"><link rel="prefetch" href="/assets/js/33.1b27e831.js"><link rel="prefetch" href="/assets/js/34.bb883bcb.js"><link rel="prefetch" href="/assets/js/35.21686f54.js"><link rel="prefetch" href="/assets/js/36.8db83cfd.js"><link rel="prefetch" href="/assets/js/37.53cac4bd.js"><link rel="prefetch" href="/assets/js/38.9f22b544.js"><link rel="prefetch" href="/assets/js/39.dbd3a14b.js"><link rel="prefetch" href="/assets/js/4.e5ec2def.js"><link rel="prefetch" href="/assets/js/40.adf441c5.js"><link rel="prefetch" href="/assets/js/41.901a511e.js"><link rel="prefetch" href="/assets/js/42.0b2440cf.js"><link rel="prefetch" href="/assets/js/43.cf739133.js"><link rel="prefetch" href="/assets/js/44.49b04312.js"><link rel="prefetch" href="/assets/js/45.e3b1a882.js"><link rel="prefetch" href="/assets/js/46.be2fb679.js"><link rel="prefetch" href="/assets/js/47.c02f4fd1.js"><link rel="prefetch" href="/assets/js/48.ceb59c23.js"><link rel="prefetch" href="/assets/js/5.dd2f6f9c.js"><link rel="prefetch" href="/assets/js/50.fc1cb19d.js"><link rel="prefetch" href="/assets/js/51.acd881e2.js"><link rel="prefetch" href="/assets/js/52.19b3f7f1.js"><link rel="prefetch" href="/assets/js/53.17e3e6c1.js"><link rel="prefetch" href="/assets/js/54.8d473c1a.js"><link rel="prefetch" href="/assets/js/55.a84e2e7c.js"><link rel="prefetch" href="/assets/js/56.e4acdc1e.js"><link rel="prefetch" href="/assets/js/57.73533e06.js"><link rel="prefetch" href="/assets/js/58.c78f8f9d.js"><link rel="prefetch" href="/assets/js/59.0971af8c.js"><link rel="prefetch" href="/assets/js/6.b9d02d3e.js"><link rel="prefetch" href="/assets/js/60.1ea806f9.js"><link rel="prefetch" href="/assets/js/7.1aa9d725.js"><link rel="prefetch" href="/assets/js/8.5b7b0524.js"><link rel="prefetch" href="/assets/js/9.811fba5c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.bd66f28f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Hsiao Lin</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Architect</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/architect/OAuth2/" class="nav-link">OAuth2</a></li><li class="dropdown-item"><!----> <a href="/architect/ELK/" class="nav-link">ELK</a></li></ul></div></div><div class="nav-item"><a href="/algorithm/" class="nav-link">Algorithm</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Java/Java/" class="nav-link">Java</a></li><li class="dropdown-item"><!----> <a href="/Java/Spring/" class="nav-link">Spring</a></li><li class="dropdown-item"><!----> <a href="/Java/SpringBoot/" class="nav-link">SpringBoot</a></li><li class="dropdown-item"><!----> <a href="/Java/SpringCloud/" class="nav-link">SpringCloud</a></li><li class="dropdown-item"><!----> <a href="/Java/MyBatis/" class="nav-link">MyBatis</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">JavaScript</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/JavaScript/Vue/" class="nav-link">Vue</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/React/" class="nav-link">React</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/Angular/" class="nav-link">Angular</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/Nodejs/" class="nav-link">Node.js</a></li><li class="dropdown-item"><h4>JavaScript</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/JavaScript/JavaScript/ES5/" class="nav-link">ES5</a></li><li class="dropdown-subitem"><a href="/JavaScript/JavaScript/ES6/" class="nav-link">ES6</a></li></ul></li><li class="dropdown-item"><!----> <a href="/JavaScript/TypeScript/" class="nav-link">TypeScript</a></li></ul></div></div><div class="nav-item"><a href="/BigData/" class="nav-link">BigData</a></div><div class="nav-item"><a href="/AI/" class="nav-link">AI</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Cloud</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/cloud/Docker/" class="nav-link router-link-active">Docker</a></li><li class="dropdown-item"><!----> <a href="/cloud/Kubernetes/" class="nav-link">Kubernetes</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Cosmosource</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Cosmosource/fwp/" class="nav-link">自由网页</a></li><li class="dropdown-item"><!----> <a href="/Cosmosource/bpm/" class="nav-link">业务协同</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/yinxiaoling" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Architect</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/architect/OAuth2/" class="nav-link">OAuth2</a></li><li class="dropdown-item"><!----> <a href="/architect/ELK/" class="nav-link">ELK</a></li></ul></div></div><div class="nav-item"><a href="/algorithm/" class="nav-link">Algorithm</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Java/Java/" class="nav-link">Java</a></li><li class="dropdown-item"><!----> <a href="/Java/Spring/" class="nav-link">Spring</a></li><li class="dropdown-item"><!----> <a href="/Java/SpringBoot/" class="nav-link">SpringBoot</a></li><li class="dropdown-item"><!----> <a href="/Java/SpringCloud/" class="nav-link">SpringCloud</a></li><li class="dropdown-item"><!----> <a href="/Java/MyBatis/" class="nav-link">MyBatis</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">JavaScript</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/JavaScript/Vue/" class="nav-link">Vue</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/React/" class="nav-link">React</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/Angular/" class="nav-link">Angular</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/Nodejs/" class="nav-link">Node.js</a></li><li class="dropdown-item"><h4>JavaScript</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/JavaScript/JavaScript/ES5/" class="nav-link">ES5</a></li><li class="dropdown-subitem"><a href="/JavaScript/JavaScript/ES6/" class="nav-link">ES6</a></li></ul></li><li class="dropdown-item"><!----> <a href="/JavaScript/TypeScript/" class="nav-link">TypeScript</a></li></ul></div></div><div class="nav-item"><a href="/BigData/" class="nav-link">BigData</a></div><div class="nav-item"><a href="/AI/" class="nav-link">AI</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Cloud</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/cloud/Docker/" class="nav-link router-link-active">Docker</a></li><li class="dropdown-item"><!----> <a href="/cloud/Kubernetes/" class="nav-link">Kubernetes</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Cosmosource</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Cosmosource/fwp/" class="nav-link">自由网页</a></li><li class="dropdown-item"><!----> <a href="/Cosmosource/bpm/" class="nav-link">业务协同</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/yinxiaoling" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/cloud/Docker/BasicConcepts.html" class="sidebar-link">Docker基本概念</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/BasicConcepts.html#docker-镜像" class="sidebar-link">Docker 镜像</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/BasicConcepts.html#分层存储" class="sidebar-link">分层存储</a></li></ul></li><li class="sidebar-sub-header"><a href="/cloud/Docker/BasicConcepts.html#docker-容器" class="sidebar-link">Docker 容器</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/BasicConcepts.html#docker-registry" class="sidebar-link">Docker Registry</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/BasicConcepts.html#docker-registry-公开服务" class="sidebar-link">Docker Registry 公开服务</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/BasicConcepts.html#私有-docker-registry" class="sidebar-link">私有 Docker Registry</a></li></ul></li></ul></li><li><a href="/cloud/Docker/Install.html" class="sidebar-link">安装 Docker</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/Install.html#centos-安装-docker-ce" class="sidebar-link">CentOS 安装 Docker CE</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/Install.html#准备工作" class="sidebar-link">准备工作</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Install.html#使用-yum-安装" class="sidebar-link">使用 yum 安装</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Install.html#使用脚本自动安装" class="sidebar-link">使用脚本自动安装</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Install.html#启动-docker-ce" class="sidebar-link">启动 Docker CE</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Install.html#建立-docker-用户组" class="sidebar-link">建立 docker 用户组</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Install.html#测试-docker-是否安装正确" class="sidebar-link">测试 Docker 是否安装正确</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Install.html#镜像加速" class="sidebar-link">镜像加速</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Install.html#添加内核参数" class="sidebar-link">添加内核参数</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Install.html#参考文档" class="sidebar-link">参考文档</a></li></ul></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Install.html#macos-安装-docker" class="sidebar-link">MacOS 安装 Docker</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/Install.html#系统要求-2" class="sidebar-link">系统要求</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Install.html#安装" class="sidebar-link">安装</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Install.html#运行" class="sidebar-link">运行</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Install.html#镜像加速-2" class="sidebar-link">镜像加速</a></li></ul></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Install.html#windows-10-pc-安装-docker-ce" class="sidebar-link">Windows 10 PC 安装 Docker CE</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/Install.html#系统要求-3" class="sidebar-link">系统要求</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Install.html#安装-2" class="sidebar-link">安装</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Install.html#运行-2" class="sidebar-link">运行</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Install.html#镜像加速-3" class="sidebar-link">镜像加速</a></li></ul></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Install.html#ubuntu-安装-docker-ce" class="sidebar-link">Ubuntu 安装 Docker CE</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/Install.html#准备工作-2" class="sidebar-link">准备工作</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Install.html#使用-apt-安装" class="sidebar-link">使用 APT 安装</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Install.html#使用脚本自动安装-2" class="sidebar-link">使用脚本自动安装</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Install.html#启动-docker-ce-2" class="sidebar-link">启动 Docker CE</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Install.html#建立-docker-用户组-2" class="sidebar-link">建立 docker 用户组</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Install.html#测试-docker-是否安装正确-2" class="sidebar-link">测试 Docker 是否安装正确</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Install.html#镜像加速-4" class="sidebar-link">镜像加速</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Install.html#参考文档-2" class="sidebar-link">参考文档</a></li></ul></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Install.html#debian-安装-docker-ce" class="sidebar-link">Debian 安装 Docker CE</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/Install.html#准备工作-3" class="sidebar-link">准备工作</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Install.html#使用-apt-安装-2" class="sidebar-link">使用 APT 安装</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Install.html#使用脚本自动安装-3" class="sidebar-link">使用脚本自动安装</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Install.html#启动-docker-ce-3" class="sidebar-link">启动 Docker CE</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Install.html#建立-docker-用户组-3" class="sidebar-link">建立 docker 用户组</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Install.html#测试-docker-是否安装正确-3" class="sidebar-link">测试 Docker 是否安装正确</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Install.html#镜像加速-5" class="sidebar-link">镜像加速</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Install.html#参考文档-3" class="sidebar-link">参考文档</a></li></ul></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Install.html#镜像加速器" class="sidebar-link">镜像加速器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/Install.html#ubuntu-14-04、debian-7-wheezy" class="sidebar-link">Ubuntu 14.04、Debian 7 Wheezy</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Install.html#ubuntu-16-04-、debian-8-、centos-7" class="sidebar-link">Ubuntu 16.04+、Debian 8+、CentOS 7</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Install.html#windows-10" class="sidebar-link">Windows 10</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Install.html#macos" class="sidebar-link">macOS</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Install.html#检查加速器是否生效" class="sidebar-link">检查加速器是否生效</a></li></ul></li></ul></li><li><a href="/cloud/Docker/UseImage.html" class="sidebar-link">使用 Docker 镜像</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#获取镜像" class="sidebar-link">获取镜像</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#运行" class="sidebar-link">运行</a></li></ul></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#列出镜像" class="sidebar-link">列出镜像</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#镜像体积" class="sidebar-link">镜像体积</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#虚悬镜像" class="sidebar-link">虚悬镜像</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#中间层镜像" class="sidebar-link">中间层镜像</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#列出部分镜像" class="sidebar-link">列出部分镜像</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#以特定格式显示" class="sidebar-link">以特定格式显示</a></li></ul></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#删除本地镜像" class="sidebar-link">删除本地镜像</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#用-id、镜像名、摘要删除镜像" class="sidebar-link">用 ID、镜像名、摘要删除镜像</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#untagged-和-deleted" class="sidebar-link">Untagged 和 Deleted</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#用-docker-image-ls-命令来配合" class="sidebar-link">用 docker image ls 命令来配合</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#centos-rhel-的用户需要注意的事项" class="sidebar-link">CentOS/RHEL 的用户需要注意的事项</a></li></ul></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#利用-commit-理解镜像构成" class="sidebar-link">利用 commit 理解镜像构成</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#慎用-docker-commit" class="sidebar-link">慎用 docker commit</a></li></ul></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#使用-dockerfile-定制镜像" class="sidebar-link">使用 Dockerfile 定制镜像</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#from-指定基础镜像" class="sidebar-link">FROM 指定基础镜像</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#run-执行命令" class="sidebar-link">RUN 执行命令</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#构建镜像" class="sidebar-link">构建镜像</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#镜像构建上下文（context）" class="sidebar-link">镜像构建上下文（Context）</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#其它-docker-build-的用法" class="sidebar-link">其它 docker build 的用法</a></li></ul></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#dockerfile-指令详解" class="sidebar-link">Dockerfile 指令详解</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#copy-复制文件" class="sidebar-link">COPY 复制文件</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#add-更高级的复制文件" class="sidebar-link">ADD 更高级的复制文件</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#cmd-容器启动命令" class="sidebar-link">CMD 容器启动命令</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#entrypoint-入口点" class="sidebar-link">ENTRYPOINT 入口点</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#env-设置环境变量" class="sidebar-link">ENV 设置环境变量</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#arg-构建参数" class="sidebar-link">ARG 构建参数</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#volume-定义匿名卷" class="sidebar-link">VOLUME 定义匿名卷</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#expose-声明端口" class="sidebar-link">EXPOSE 声明端口</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#workdir-指定工作目录" class="sidebar-link">WORKDIR 指定工作目录</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#user-指定当前用户" class="sidebar-link">USER 指定当前用户</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#healthcheck-健康检查" class="sidebar-link">HEALTHCHECK 健康检查</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#onbuild-为他人做嫁衣裳" class="sidebar-link">ONBUILD 为他人做嫁衣裳</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#参考文档" class="sidebar-link">参考文档</a></li></ul></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#多阶段构建" class="sidebar-link">多阶段构建</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#之前的做法" class="sidebar-link">之前的做法</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#使用多阶段构建" class="sidebar-link">使用多阶段构建</a></li></ul></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#实战多阶段构建-laravel-镜像" class="sidebar-link">实战多阶段构建 Laravel 镜像</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#准备" class="sidebar-link">准备</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#前端构建" class="sidebar-link">前端构建</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#安装-composer-依赖" class="sidebar-link">安装 Composer 依赖</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#整合以上阶段所生成的文件" class="sidebar-link">整合以上阶段所生成的文件</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#最后一个阶段构建-nginx-镜像" class="sidebar-link">最后一个阶段构建 NGINX 镜像</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#构建-laravel-及-nginx-镜像" class="sidebar-link">构建 Laravel 及 Nginx 镜像</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#启动容器并测试" class="sidebar-link">启动容器并测试</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#生产环境优化" class="sidebar-link">生产环境优化</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#附录" class="sidebar-link">附录</a></li></ul></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#其它制作镜像的方式" class="sidebar-link">其它制作镜像的方式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#从-rootfs-压缩包导入" class="sidebar-link">从 rootfs 压缩包导入</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#docker-save-和-docker-load" class="sidebar-link">docker save 和 docker load</a></li></ul></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#镜像的实现原理" class="sidebar-link">镜像的实现原理</a></li></ul></li><li><a href="/cloud/Docker/UseContainer.html" class="sidebar-link">操作 Docker 容器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/UseContainer.html#启动容器" class="sidebar-link">启动容器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/UseContainer.html#新建并启动" class="sidebar-link">新建并启动</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseContainer.html#启动已终止容器" class="sidebar-link">启动已终止容器</a></li></ul></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseContainer.html#后台运行" class="sidebar-link">后台运行</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseContainer.html#终止容器" class="sidebar-link">终止容器</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseContainer.html#进入容器" class="sidebar-link">进入容器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/UseContainer.html#attach-命令" class="sidebar-link">attach 命令</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseContainer.html#exec-命令" class="sidebar-link">exec 命令</a></li></ul></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseContainer.html#导出和导入容器" class="sidebar-link">导出和导入容器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/UseContainer.html#导出容器" class="sidebar-link">导出容器</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseContainer.html#导入容器快照" class="sidebar-link">导入容器快照</a></li></ul></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseContainer.html#删除容器" class="sidebar-link">删除容器</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseContainer.html#清理所有处于终止状态的容器" class="sidebar-link">清理所有处于终止状态的容器</a></li></ul></li><li><a href="/cloud/Docker/InterviewRegistry.html" class="sidebar-link">访问仓库</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/InterviewRegistry.html#docker-hub" class="sidebar-link">Docker Hub</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/InterviewRegistry.html#注册" class="sidebar-link">注册</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/InterviewRegistry.html#登录" class="sidebar-link">登录</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/InterviewRegistry.html#拉取镜像" class="sidebar-link">拉取镜像</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/InterviewRegistry.html#推送镜像" class="sidebar-link">推送镜像</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/InterviewRegistry.html#自动创建" class="sidebar-link">自动创建</a></li></ul></li><li class="sidebar-sub-header"><a href="/cloud/Docker/InterviewRegistry.html#私有仓库" class="sidebar-link">私有仓库</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/InterviewRegistry.html#安装运行-docker-registry" class="sidebar-link">安装运行 docker-registry</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/InterviewRegistry.html#在私有仓库上传、搜索、下载镜像" class="sidebar-link">在私有仓库上传、搜索、下载镜像</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/InterviewRegistry.html#注意事项" class="sidebar-link">注意事项</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/InterviewRegistry.html#其他" class="sidebar-link">其他</a></li></ul></li><li class="sidebar-sub-header"><a href="/cloud/Docker/InterviewRegistry.html#私有仓库高级配置" class="sidebar-link">私有仓库高级配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/InterviewRegistry.html#准备站点证书" class="sidebar-link">准备站点证书</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/InterviewRegistry.html#配置私有仓库" class="sidebar-link">配置私有仓库</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/InterviewRegistry.html#生成-http-认证文件" class="sidebar-link">生成 http 认证文件</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/InterviewRegistry.html#编辑-docker-compose-yml" class="sidebar-link">编辑 docker-compose.yml</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/InterviewRegistry.html#修改-hosts" class="sidebar-link">修改 hosts</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/InterviewRegistry.html#启动" class="sidebar-link">启动</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/InterviewRegistry.html#测试私有仓库功能" class="sidebar-link">测试私有仓库功能</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/InterviewRegistry.html#注意事项-2" class="sidebar-link">注意事项</a></li></ul></li><li class="sidebar-sub-header"><a href="/cloud/Docker/InterviewRegistry.html#nexus3-x-的私有仓库" class="sidebar-link">Nexus3.x 的私有仓库</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/InterviewRegistry.html#启动-nexus-容器" class="sidebar-link">启动 Nexus 容器</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/InterviewRegistry.html#创建仓库" class="sidebar-link">创建仓库</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/InterviewRegistry.html#添加访问权限" class="sidebar-link">添加访问权限</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/InterviewRegistry.html#nginx-加密代理" class="sidebar-link">NGINX 加密代理</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/InterviewRegistry.html#docker-主机访问镜像仓库" class="sidebar-link">Docker 主机访问镜像仓库</a></li></ul></li></ul></li><li><a href="/cloud/Docker/DataManager.html" class="sidebar-link">Docker 数据管理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/DataManager.html#数据卷" class="sidebar-link">数据卷</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/DataManager.html#创建一个数据卷" class="sidebar-link">创建一个数据卷</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/DataManager.html#启动一个挂载数据卷的容器" class="sidebar-link">启动一个挂载数据卷的容器</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/DataManager.html#查看数据卷的具体信息" class="sidebar-link">查看数据卷的具体信息</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/DataManager.html#删除数据卷" class="sidebar-link">删除数据卷</a></li></ul></li><li class="sidebar-sub-header"><a href="/cloud/Docker/DataManager.html#挂载主机目录" class="sidebar-link">挂载主机目录</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/DataManager.html#挂载一个主机目录作为数据卷" class="sidebar-link">挂载一个主机目录作为数据卷</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/DataManager.html#查看数据卷的具体信息-2" class="sidebar-link">查看数据卷的具体信息</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/DataManager.html#挂载一个本地主机文件作为数据卷" class="sidebar-link">挂载一个本地主机文件作为数据卷</a></li></ul></li></ul></li><li><a href="/cloud/Docker/Network.html" class="sidebar-link">Docker 中的网络功能介绍</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/Network.html#外部访问容器" class="sidebar-link">外部访问容器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/Network.html#映射所有接口地址" class="sidebar-link">映射所有接口地址</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Network.html#映射到指定地址的指定端口" class="sidebar-link">映射到指定地址的指定端口</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Network.html#映射到指定地址的任意端口" class="sidebar-link">映射到指定地址的任意端口</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Network.html#查看映射端口配置" class="sidebar-link">查看映射端口配置</a></li></ul></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Network.html#容器互联" class="sidebar-link">容器互联</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/Network.html#新建网络" class="sidebar-link">新建网络</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Network.html#连接容器" class="sidebar-link">连接容器</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Network.html#docker-compose" class="sidebar-link">Docker Compose</a></li></ul></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Network.html#配置-dns" class="sidebar-link">配置 DNS</a></li></ul></li><li><a href="/cloud/Docker/AdvancedNetwork.html" class="sidebar-link">高级网络配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/AdvancedNetwork.html#快速配置指南" class="sidebar-link">快速配置指南</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/AdvancedNetwork.html#容器访问控制" class="sidebar-link">容器访问控制</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/AdvancedNetwork.html#容器访问外部网络" class="sidebar-link">容器访问外部网络</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/AdvancedNetwork.html#容器之间访问" class="sidebar-link">容器之间访问</a></li></ul></li><li class="sidebar-sub-header"><a href="/cloud/Docker/AdvancedNetwork.html#映射容器端口到宿主主机的实现" class="sidebar-link">映射容器端口到宿主主机的实现</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/AdvancedNetwork.html#容器访问外部实现" class="sidebar-link">容器访问外部实现</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/AdvancedNetwork.html#外部访问容器实现" class="sidebar-link">外部访问容器实现</a></li></ul></li><li class="sidebar-sub-header"><a href="/cloud/Docker/AdvancedNetwork.html#配置-docker0-网桥" class="sidebar-link">配置 docker0 网桥</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/AdvancedNetwork.html#自定义网桥" class="sidebar-link">自定义网桥</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/AdvancedNetwork.html#工具和示例" class="sidebar-link">工具和示例</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/AdvancedNetwork.html#pipework" class="sidebar-link">pipework</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/AdvancedNetwork.html#playground" class="sidebar-link">playground</a></li></ul></li><li class="sidebar-sub-header"><a href="/cloud/Docker/AdvancedNetwork.html#编辑网络配置文件" class="sidebar-link">编辑网络配置文件</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/AdvancedNetwork.html#示例：创建一个点到点连接" class="sidebar-link">示例：创建一个点到点连接</a></li></ul></li><li><a href="/cloud/Docker/compose.html" class="active sidebar-link">Docker 三剑客之 Docker Compose</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/compose.html#compose-简介" class="sidebar-link">Compose 简介</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/compose.html#安装与卸载" class="sidebar-link">安装与卸载</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/compose.html#二进制包" class="sidebar-link">二进制包</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/compose.html#pip-安装" class="sidebar-link">PIP 安装</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/compose.html#bash-补全命令" class="sidebar-link">bash 补全命令</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/compose.html#容器中执行" class="sidebar-link">容器中执行</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/compose.html#卸载" class="sidebar-link">卸载</a></li></ul></li><li class="sidebar-sub-header"><a href="/cloud/Docker/compose.html#使用" class="sidebar-link">使用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/compose.html#术语" class="sidebar-link">术语</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/compose.html#场景" class="sidebar-link">场景</a></li></ul></li><li class="sidebar-sub-header"><a href="/cloud/Docker/compose.html#compose-命令说明" class="sidebar-link">Compose 命令说明</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/compose.html#命令对象与格式" class="sidebar-link">命令对象与格式</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/compose.html#命令选项" class="sidebar-link">命令选项</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/compose.html#命令使用说明" class="sidebar-link">命令使用说明</a></li></ul></li><li class="sidebar-sub-header"><a href="/cloud/Docker/compose.html#compose-模板文件" class="sidebar-link">Compose 模板文件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/compose.html#build-2" class="sidebar-link">build</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/compose.html#cap-add-cap-drop" class="sidebar-link">cap_add, cap_drop</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/compose.html#command" class="sidebar-link">command</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/compose.html#configs" class="sidebar-link">configs</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/compose.html#cgroup-parent" class="sidebar-link">cgroup_parent</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/compose.html#container-name" class="sidebar-link">container_name</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/compose.html#deploy" class="sidebar-link">deploy</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/compose.html#devices" class="sidebar-link">devices</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/compose.html#depends-on" class="sidebar-link">depends_on</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/compose.html#dns" class="sidebar-link">dns</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/compose.html#dns-search" class="sidebar-link">dns_search</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/compose.html#tmpfs" class="sidebar-link">tmpfs</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/compose.html#env-file" class="sidebar-link">env_file</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/compose.html#environment" class="sidebar-link">environment</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/compose.html#expose" class="sidebar-link">expose</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/compose.html#external-links" class="sidebar-link">external_links</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/compose.html#extra-hosts" class="sidebar-link">extra_hosts</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/compose.html#healthcheck" class="sidebar-link">healthcheck</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/compose.html#image" class="sidebar-link">image</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/compose.html#labels" class="sidebar-link">labels</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/compose.html#links" class="sidebar-link">links</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/compose.html#logging" class="sidebar-link">logging</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/compose.html#network-mode" class="sidebar-link">network_mode</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/compose.html#networks" class="sidebar-link">networks</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/compose.html#pid" class="sidebar-link">pid</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/compose.html#ports" class="sidebar-link">ports</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/compose.html#secrets" class="sidebar-link">secrets</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/compose.html#security-opt" class="sidebar-link">security_opt</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/compose.html#stop-signal" class="sidebar-link">stop_signal</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/compose.html#sysctls" class="sidebar-link">sysctls</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/compose.html#ulimits" class="sidebar-link">ulimits</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/compose.html#volumes" class="sidebar-link">volumes</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/compose.html#其它指令" class="sidebar-link">其它指令</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/compose.html#读取变量" class="sidebar-link">读取变量</a></li></ul></li><li class="sidebar-sub-header"><a href="/cloud/Docker/compose.html#使用-django" class="sidebar-link">使用 Django</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/compose.html#使用-rails" class="sidebar-link">使用 Rails</a></li></ul></li><li><a href="/cloud/Docker/machine.html" class="sidebar-link">Docker 三剑客之 Docker Machine</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/machine.html#安装" class="sidebar-link">安装</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/machine.html#macos、windows" class="sidebar-link">macOS、Windows</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/machine.html#linux" class="sidebar-link">Linux</a></li></ul></li><li class="sidebar-sub-header"><a href="/cloud/Docker/machine.html#使用" class="sidebar-link">使用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/machine.html#创建本地主机实例" class="sidebar-link">创建本地主机实例</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/machine.html#使用介绍" class="sidebar-link">使用介绍</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/machine.html#官方支持驱动" class="sidebar-link">官方支持驱动</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/machine.html#第三方驱动" class="sidebar-link">第三方驱动</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/machine.html#操作命令" class="sidebar-link">操作命令</a></li></ul></li></ul></li><li><a href="/cloud/Docker/swarm.html" class="sidebar-link">Docker 三剑客之 Docker Swarm</a></li><li><a href="/cloud/Docker/swarm_mode.html" class="sidebar-link">Swarm mode</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/swarm_mode.html#基本概念" class="sidebar-link">基本概念</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/swarm_mode.html#节点" class="sidebar-link">节点</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/swarm_mode.html#服务和任务" class="sidebar-link">服务和任务</a></li></ul></li><li class="sidebar-sub-header"><a href="/cloud/Docker/swarm_mode.html#创建-swarm-集群" class="sidebar-link">创建 Swarm 集群</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/swarm_mode.html#初始化集群" class="sidebar-link">初始化集群</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/swarm_mode.html#增加工作节点" class="sidebar-link">增加工作节点</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/swarm_mode.html#查看集群" class="sidebar-link">查看集群</a></li></ul></li><li class="sidebar-sub-header"><a href="/cloud/Docker/swarm_mode.html#部署服务" class="sidebar-link">部署服务</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/swarm_mode.html#新建服务" class="sidebar-link">新建服务</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/swarm_mode.html#查看服务" class="sidebar-link">查看服务</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/swarm_mode.html#服务伸缩" class="sidebar-link">服务伸缩</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/swarm_mode.html#删除服务" class="sidebar-link">删除服务</a></li></ul></li><li class="sidebar-sub-header"><a href="/cloud/Docker/swarm_mode.html#在-swarm-集群中使用-compose-文件" class="sidebar-link">在 Swarm 集群中使用 compose 文件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/swarm_mode.html#部署服务-2" class="sidebar-link">部署服务</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/swarm_mode.html#查看服务-2" class="sidebar-link">查看服务</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/swarm_mode.html#移除服务" class="sidebar-link">移除服务</a></li></ul></li><li class="sidebar-sub-header"><a href="/cloud/Docker/swarm_mode.html#在-swarm-集群中管理敏感数据" class="sidebar-link">在 Swarm 集群中管理敏感数据</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/swarm_mode.html#创建-secret" class="sidebar-link">创建 secret</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/swarm_mode.html#查看-secret" class="sidebar-link">查看 secret</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/swarm_mode.html#创建-mysql-服务" class="sidebar-link">创建 MySQL 服务</a></li></ul></li><li class="sidebar-sub-header"><a href="/cloud/Docker/swarm_mode.html#在-swarm-集群中管理配置数据" class="sidebar-link">在 Swarm 集群中管理配置数据</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/swarm_mode.html#创建-config" class="sidebar-link">创建 config</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/swarm_mode.html#查看-config" class="sidebar-link">查看 config</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/swarm_mode.html#创建-redis-服务" class="sidebar-link">创建 redis 服务</a></li></ul></li><li class="sidebar-sub-header"><a href="/cloud/Docker/swarm_mode.html#swarm-mode-与滚动升级" class="sidebar-link">SWarm mode 与滚动升级</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/swarm_mode.html#服务回退" class="sidebar-link">服务回退</a></li></ul></li></ul></li><li><a href="/cloud/Docker/Security.html" class="sidebar-link">安全</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/Security.html#内核命名空间" class="sidebar-link">内核命名空间</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Security.html#控制组" class="sidebar-link">控制组</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Security.html#docker服务端的防护" class="sidebar-link">Docker服务端的防护</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Security.html#内核能力机制" class="sidebar-link">内核能力机制</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Security.html#其它安全特性" class="sidebar-link">其它安全特性</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Security.html#总结" class="sidebar-link">总结</a></li></ul></li><li><a href="/cloud/Docker/underly.html" class="sidebar-link">底层实现</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/underly.html#基本架构" class="sidebar-link">基本架构</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/underly.html#命名空间" class="sidebar-link">命名空间</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/underly.html#pid-命名空间" class="sidebar-link">pid 命名空间</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/underly.html#net-命名空间" class="sidebar-link">net 命名空间</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/underly.html#ipc-命名空间" class="sidebar-link">ipc 命名空间</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/underly.html#mnt-命名空间" class="sidebar-link">mnt 命名空间</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/underly.html#uts-命名空间" class="sidebar-link">uts 命名空间</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/underly.html#user-命名空间" class="sidebar-link">user 命名空间</a></li></ul></li><li class="sidebar-sub-header"><a href="/cloud/Docker/underly.html#控制组" class="sidebar-link">控制组</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/underly.html#联合文件系统" class="sidebar-link">联合文件系统</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/underly.html#容器格式" class="sidebar-link">容器格式</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/underly.html#docker-网络实现" class="sidebar-link">Docker 网络实现</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/underly.html#基本原理" class="sidebar-link">基本原理</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/underly.html#创建网络参数" class="sidebar-link">创建网络参数</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/underly.html#网络配置细节" class="sidebar-link">网络配置细节</a></li></ul></li></ul></li><li><a href="/cloud/Docker/etcd.html" class="sidebar-link">Etcd 项目</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/etcd.html#什么是-etcd" class="sidebar-link">什么是 etcd</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/etcd.html#安装" class="sidebar-link">安装</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/etcd.html#二进制文件方式下载" class="sidebar-link">二进制文件方式下载</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/etcd.html#docker-镜像方式运行" class="sidebar-link">Docker 镜像方式运行</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/etcd.html#macos-中运行" class="sidebar-link">macOS 中运行</a></li></ul></li><li class="sidebar-sub-header"><a href="/cloud/Docker/etcd.html#etcd-集群" class="sidebar-link">etcd 集群</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/etcd.html#使用-etcdctl" class="sidebar-link">使用 etcdctl</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/etcd.html#数据库操作" class="sidebar-link">数据库操作</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/etcd.html#非数据库操作" class="sidebar-link">非数据库操作</a></li></ul></li></ul></li><li><a href="/cloud/Docker/coreos.html" class="sidebar-link">CoreOS 项目</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/coreos.html#coreos-介绍" class="sidebar-link">CoreOS 介绍</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/coreos.html#coreos-特性" class="sidebar-link">CoreOS 特性</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/coreos.html#一个最小化操作系统" class="sidebar-link">一个最小化操作系统</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/coreos.html#无痛更新" class="sidebar-link">无痛更新</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/coreos.html#docker-容器" class="sidebar-link">Docker 容器</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/coreos.html#支持集群" class="sidebar-link">支持集群</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/coreos.html#分布式系统工具" class="sidebar-link">分布式系统工具</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/coreos.html#服务发现" class="sidebar-link">服务发现</a></li></ul></li><li class="sidebar-sub-header"><a href="/cloud/Docker/coreos.html#coreos-工具介绍" class="sidebar-link">CoreOS 工具介绍</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/coreos.html#服务发现-2" class="sidebar-link">服务发现</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/coreos.html#容器管理" class="sidebar-link">容器管理</a></li></ul></li><li class="sidebar-sub-header"><a href="/cloud/Docker/coreos.html#快速搭建-coreos-集群" class="sidebar-link">快速搭建 CoreOS 集群</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/coreos.html#准备工作" class="sidebar-link">准备工作</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/coreos.html#配置工作" class="sidebar-link">配置工作</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/coreos.html#启动集群" class="sidebar-link">启动集群</a></li></ul></li></ul></li><li><a href="/cloud/Docker/kubernetes.html" class="sidebar-link">Kubernetes</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/kubernetes.html#项目简介" class="sidebar-link">项目简介</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/kubernetes.html#kubernetes-能够运行在任何地方！" class="sidebar-link">Kubernetes 能够运行在任何地方！</a></li></ul></li><li class="sidebar-sub-header"><a href="/cloud/Docker/kubernetes.html#快速上手" class="sidebar-link">快速上手</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/kubernetes.html#启动-etcd-服务。" class="sidebar-link">启动 Etcd 服务。</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/kubernetes.html#启动主节点" class="sidebar-link">启动主节点</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/kubernetes.html#启动服务代理" class="sidebar-link">启动服务代理</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/kubernetes.html#测试状态" class="sidebar-link">测试状态</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/kubernetes.html#查看服务" class="sidebar-link">查看服务</a></li></ul></li><li class="sidebar-sub-header"><a href="/cloud/Docker/kubernetes.html#基本概念" class="sidebar-link">基本概念</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/kubernetes.html#节点" class="sidebar-link">节点</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/kubernetes.html#容器组" class="sidebar-link">容器组</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/kubernetes.html#replication-controllers" class="sidebar-link">Replication Controllers</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/kubernetes.html#服务" class="sidebar-link">服务</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/kubernetes.html#卷" class="sidebar-link">卷</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/kubernetes.html#标签" class="sidebar-link">标签</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/kubernetes.html#接口权限" class="sidebar-link">接口权限</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/kubernetes.html#web界面" class="sidebar-link">web界面</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/kubernetes.html#命令行操作" class="sidebar-link">命令行操作</a></li></ul></li><li class="sidebar-sub-header"><a href="/cloud/Docker/kubernetes.html#kubectl-使用" class="sidebar-link">kubectl 使用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/kubernetes.html#get" class="sidebar-link">get</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/kubernetes.html#describe" class="sidebar-link">describe</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/kubernetes.html#create" class="sidebar-link">create</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/kubernetes.html#update" class="sidebar-link">update</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/kubernetes.html#delete" class="sidebar-link">delete</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/kubernetes.html#log" class="sidebar-link">log</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/kubernetes.html#rolling-update" class="sidebar-link">rolling-update</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/kubernetes.html#exec" class="sidebar-link">exec</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/kubernetes.html#port-forward" class="sidebar-link">port-forward</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/kubernetes.html#proxy" class="sidebar-link">proxy</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/kubernetes.html#run" class="sidebar-link">run</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/kubernetes.html#expose" class="sidebar-link">expose</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/kubernetes.html#label" class="sidebar-link">label</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/kubernetes.html#config" class="sidebar-link">config</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/kubernetes.html#cluster-info" class="sidebar-link">cluster-info</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/kubernetes.html#api-versions" class="sidebar-link">api-versions</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/kubernetes.html#version" class="sidebar-link">version</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/kubernetes.html#help" class="sidebar-link">help</a></li></ul></li><li class="sidebar-sub-header"><a href="/cloud/Docker/kubernetes.html#基本架构" class="sidebar-link">基本架构</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/kubernetes.html#基本考虑" class="sidebar-link">基本考虑</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/kubernetes.html#运行原理" class="sidebar-link">运行原理</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/kubernetes.html#控制平面" class="sidebar-link">控制平面</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/kubernetes.html#工作节点" class="sidebar-link">工作节点</a></li></ul></li></ul></li><li><a href="/cloud/Docker/mesos.html" class="sidebar-link">Mesos - 优秀的集群资源调度平台</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/mesos.html#简介" class="sidebar-link">简介</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/mesos.html#mesos-安装与使用" class="sidebar-link">Mesos 安装与使用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/mesos.html#安装" class="sidebar-link">安装</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/mesos.html#配置说明" class="sidebar-link">配置说明</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/mesos.html#访问-mesos-图形界面" class="sidebar-link">访问 Mesos 图形界面</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/mesos.html#访问-marathon-图形界面" class="sidebar-link">访问 Marathon 图形界面</a></li></ul></li><li class="sidebar-sub-header"><a href="/cloud/Docker/mesos.html#原理与架构" class="sidebar-link">原理与架构</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/mesos.html#架构" class="sidebar-link">架构</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/mesos.html#基本单元" class="sidebar-link">基本单元</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/mesos.html#调度" class="sidebar-link">调度</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/mesos.html#ha" class="sidebar-link">HA</a></li></ul></li><li class="sidebar-sub-header"><a href="/cloud/Docker/mesos.html#mesos-配置项解析" class="sidebar-link">Mesos 配置项解析</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/mesos.html#通用项" class="sidebar-link">通用项</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/mesos.html#master-专属配置项" class="sidebar-link">master 专属配置项</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/mesos.html#slave-专属配置项" class="sidebar-link">slave 专属配置项</a></li></ul></li><li class="sidebar-sub-header"><a href="/cloud/Docker/mesos.html#日志与监控" class="sidebar-link">日志与监控</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/mesos.html#日志配置" class="sidebar-link">日志配置</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/mesos.html#监控" class="sidebar-link">监控</a></li></ul></li><li class="sidebar-sub-header"><a href="/cloud/Docker/mesos.html#常见应用框架" class="sidebar-link">常见应用框架</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/mesos.html#长期运行的服务" class="sidebar-link">长期运行的服务</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/mesos.html#大数据处理" class="sidebar-link">大数据处理</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/mesos.html#批量调度" class="sidebar-link">批量调度</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/mesos.html#数据存储" class="sidebar-link">数据存储</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/mesos.html#本章小结" class="sidebar-link">本章小结</a></li></ul></li></ul></li><li><a href="/cloud/Docker/cases_os.html" class="sidebar-link">实战-操作系统</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/cases_os.html#busybox" class="sidebar-link">Busybox</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/cases_os.html#简介" class="sidebar-link">简介</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/cases_os.html#获取官方镜像" class="sidebar-link">获取官方镜像</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/cases_os.html#运行-busybox" class="sidebar-link">运行 busybox</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/cases_os.html#相关资源" class="sidebar-link">相关资源</a></li></ul></li><li class="sidebar-sub-header"><a href="/cloud/Docker/cases_os.html#alpine" class="sidebar-link">Alpine</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/cases_os.html#简介-2" class="sidebar-link">简介</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/cases_os.html#获取并使用官方镜像" class="sidebar-link">获取并使用官方镜像</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/cases_os.html#迁移至-alpine-基础镜像" class="sidebar-link">迁移至 Alpine 基础镜像</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/cases_os.html#相关资源-2" class="sidebar-link">相关资源</a></li></ul></li><li class="sidebar-sub-header"><a href="/cloud/Docker/cases_os.html#debian-ubuntu" class="sidebar-link">Debian/Ubuntu</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/cases_os.html#debian-系统简介" class="sidebar-link">Debian 系统简介</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/cases_os.html#ubuntu-系统简介" class="sidebar-link">Ubuntu 系统简介</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/cases_os.html#相关资源-3" class="sidebar-link">相关资源</a></li></ul></li><li class="sidebar-sub-header"><a href="/cloud/Docker/cases_os.html#centos-fedora" class="sidebar-link">CentOS/Fedora</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/cases_os.html#centos-系统简介" class="sidebar-link">CentOS 系统简介</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/cases_os.html#fedora-系统简介" class="sidebar-link">Fedora 系统简介</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/cases_os.html#相关资源-4" class="sidebar-link">相关资源</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/cases_os.html#本章小结" class="sidebar-link">本章小结</a></li></ul></li></ul></li><li><a href="/cloud/Docker/cases_cicd.html" class="sidebar-link">实战-CI/CD</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/cases_cicd.html#drone" class="sidebar-link">Drone</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/cases_cicd.html#要求" class="sidebar-link">要求</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/cases_cicd.html#新建-github-应用" class="sidebar-link">新建 GitHub 应用</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/cases_cicd.html#配置-drone" class="sidebar-link">配置 Drone</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/cases_cicd.html#drone-关联项目" class="sidebar-link">Drone 关联项目</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/cases_cicd.html#编写项目源代码" class="sidebar-link">编写项目源代码</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/cases_cicd.html#推送项目源代码到-github" class="sidebar-link">推送项目源代码到 GitHub</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/cases_cicd.html#查看项目构建过程及结果" class="sidebar-link">查看项目构建过程及结果</a></li></ul></li><li class="sidebar-sub-header"><a href="/cloud/Docker/cases_cicd.html#参考链接" class="sidebar-link">参考链接</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/cases_cicd.html#在-travis-ci-中使用-docker" class="sidebar-link">在 Travis CI 中使用 Docker</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/cases_cicd.html#准备" class="sidebar-link">准备</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/cases_cicd.html#查看结果" class="sidebar-link">查看结果</a></li></ul></li></ul></li><li><a href="/cloud/Docker/opensource.html" class="sidebar-link">Docker 开源项目</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/opensource.html#linuxkit" class="sidebar-link">LinuxKit</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/opensource.html#安装-linuxkit" class="sidebar-link">安装 Linuxkit</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/opensource.html#克隆源代码" class="sidebar-link">克隆源代码</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/opensource.html#编译-linux-系统" class="sidebar-link">编译 Linux 系统</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/opensource.html#启动-linux-系统" class="sidebar-link">启动 Linux 系统</a></li></ul></li></ul></li><li><a href="/cloud/Docker/appendix.1.html" class="sidebar-link">附录一：常见问题总结</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.1.html#镜像相关" class="sidebar-link">镜像相关</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.1.html#如何批量清理临时镜像文件？" class="sidebar-link">如何批量清理临时镜像文件？</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.1.html#如何查看镜像支持的环境变量？" class="sidebar-link">如何查看镜像支持的环境变量？</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.1.html#本地的镜像文件都存放在哪里？" class="sidebar-link">本地的镜像文件都存放在哪里？</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.1.html#构建-docker-镜像应该遵循哪些原则？" class="sidebar-link">构建 Docker 镜像应该遵循哪些原则？</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.1.html#碰到网络问题，无法-pull-镜像，命令行指定-http-proxy-无效？" class="sidebar-link">碰到网络问题，无法 pull 镜像，命令行指定 http_proxy 无效？</a></li></ul></li></ul></li><li><a href="/cloud/Docker/appendix.2.html" class="sidebar-link">附录二：热门镜像介绍</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.2.html#ubuntu" class="sidebar-link">Ubuntu</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.2.html#基本信息" class="sidebar-link">基本信息</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.2.html#使用方法" class="sidebar-link">使用方法</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.2.html#dockerfile" class="sidebar-link">Dockerfile</a></li></ul></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.2.html#centos" class="sidebar-link">CentOS</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.2.html#基本信息-2" class="sidebar-link">基本信息</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.2.html#使用方法-2" class="sidebar-link">使用方法</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.2.html#dockerfile-2" class="sidebar-link">Dockerfile</a></li></ul></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.2.html#nginx" class="sidebar-link">Nginx</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.2.html#基本信息-3" class="sidebar-link">基本信息</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.2.html#使用方法-3" class="sidebar-link">使用方法</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.2.html#dockerfile-3" class="sidebar-link">Dockerfile</a></li></ul></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.2.html#mysql" class="sidebar-link">MySQL</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.2.html#基本信息-4" class="sidebar-link">基本信息</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.2.html#使用方法-4" class="sidebar-link">使用方法</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.2.html#dockerfile-4" class="sidebar-link">Dockerfile</a></li></ul></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.2.html#mongodb" class="sidebar-link">MongoDB</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.2.html#基本信息-5" class="sidebar-link">基本信息</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.2.html#使用方法-5" class="sidebar-link">使用方法</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.2.html#dockerfile-5" class="sidebar-link">Dockerfile</a></li></ul></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.2.html#redis" class="sidebar-link">Redis</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.2.html#基本信息-6" class="sidebar-link">基本信息</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.2.html#使用方法-6" class="sidebar-link">使用方法</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.2.html#dockerfile-6" class="sidebar-link">Dockerfile</a></li></ul></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.2.html#node-js" class="sidebar-link">Node.js</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.2.html#基本信息-7" class="sidebar-link">基本信息</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.2.html#使用方法-7" class="sidebar-link">使用方法</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.2.html#dockerfile-7" class="sidebar-link">Dockerfile</a></li></ul></li></ul></li><li><a href="/cloud/Docker/appendix.3.html" class="sidebar-link">附录三：Docker 命令查询</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.3.html#基本语法" class="sidebar-link">基本语法</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.3.html#客户端命令选项" class="sidebar-link">客户端命令选项</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.3.html#dockerd-命令选项" class="sidebar-link">dockerd 命令选项</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.3.html#客户端命令" class="sidebar-link">客户端命令</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.3.html#一张图总结-docker-的命令" class="sidebar-link">一张图总结 Docker 的命令</a></li></ul></li><li><a href="/cloud/Docker/appendix.4.html" class="sidebar-link">附录四：Dockerfile 最佳实践</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.4.html#一般性的指南和建议" class="sidebar-link">一般性的指南和建议</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.4.html#容器应该是短暂的" class="sidebar-link">容器应该是短暂的</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.4.html#使用-dockerignore-文件" class="sidebar-link">使用 .dockerignore 文件</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.4.html#使用多阶段构建" class="sidebar-link">使用多阶段构建</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.4.html#避免安装不必要的包" class="sidebar-link">避免安装不必要的包</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.4.html#一个容器只运行一个进程" class="sidebar-link">一个容器只运行一个进程</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.4.html#镜像层数尽可能少" class="sidebar-link">镜像层数尽可能少</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.4.html#将多行参数排序" class="sidebar-link">将多行参数排序</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.4.html#构建缓存" class="sidebar-link">构建缓存</a></li></ul></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.4.html#dockerfile-指令" class="sidebar-link">Dockerfile 指令</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.4.html#from" class="sidebar-link">FROM</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.4.html#label" class="sidebar-link">LABEL</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.4.html#run" class="sidebar-link">RUN</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.4.html#cmd" class="sidebar-link">CMD</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.4.html#expose" class="sidebar-link">EXPOSE</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.4.html#env" class="sidebar-link">ENV</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.4.html#add-和-copy" class="sidebar-link">ADD 和 COPY</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.4.html#entrypoint" class="sidebar-link">ENTRYPOINT</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.4.html#volume" class="sidebar-link">VOLUME</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.4.html#user" class="sidebar-link">USER</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.4.html#workdir" class="sidebar-link">WORKDIR</a></li></ul></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.4.html#官方镜像示例" class="sidebar-link">官方镜像示例</a></li></ul></li><li><a href="/cloud/Docker/appendix.5.html" class="sidebar-link">附录五：如何调试 Docker</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.5.html#开启-debug-模式" class="sidebar-link">开启 Debug 模式</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.5.html#检查内核日志" class="sidebar-link">检查内核日志</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.5.html#docker-不响应时处理" class="sidebar-link">Docker 不响应时处理</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.5.html#重置-docker-本地数据" class="sidebar-link">重置 Docker 本地数据</a></li></ul></li><li><a href="/cloud/Docker/appendix.6.html" class="sidebar-link">附录六：资源链接</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.6.html#官方网站" class="sidebar-link">官方网站</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.6.html#实践参考" class="sidebar-link">实践参考</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.6.html#技术交流" class="sidebar-link">技术交流</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.6.html#其它" class="sidebar-link">其它</a></li></ul></li></ul> </div> <div class="page"> <div class="content"><h1 id="docker-三剑客之-docker-compose"><a href="#docker-三剑客之-docker-compose" aria-hidden="true" class="header-anchor">#</a> Docker 三剑客之 Docker Compose</h1> <p><code>Docker Compose</code> 是 Docker 官方编排（Orchestration）项目之一，负责快速的部署分布式应用。</p> <p>本章将介绍 <code>Compose</code> 项目情况以及安装和使用。</p> <h2 id="compose-简介"><a href="#compose-简介" aria-hidden="true" class="header-anchor">#</a> Compose 简介</h2> <p><code>Compose</code> 项目是 Docker 官方的开源项目，负责实现对 Docker 容器集群的快速编排。从功能上看，跟 <code>OpenStack</code> 中的 <code>Heat</code> 十分类似。</p> <p>其代码目前在 <a href="https://github.com/docker/compose" target="_blank" rel="noopener noreferrer">https://github.com/docker/compose<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 上开源。</p> <p><code>Compose</code> 定位是 「定义和运行多个 Docker 容器的应用（Defining and running multi-container Docker applications）」，其前身是开源项目 Fig。</p> <p>通过第一部分中的介绍，我们知道使用一个 <code>Dockerfile</code> 模板文件，可以让用户很方便的定义一个单独的应用容器。然而，在日常工作中，经常会碰到需要多个容器相互配合来完成某项任务的情况。例如要实现一个 Web 项目，除了 Web 服务容器本身，往往还需要再加上后端的数据库服务容器，甚至还包括负载均衡容器等。</p> <p><code>Compose</code> 恰好满足了这样的需求。它允许用户通过一个单独的 <code>docker-compose.yml</code> 模板文件（YAML 格式）来定义一组相关联的应用容器为一个项目（project）。</p> <p><code>Compose</code> 中有两个重要的概念：</p> <ul><li>服务 (<code>service</code>)：一个应用的容器，实际上可以包括若干运行相同镜像的容器实例。</li> <li>项目 (<code>project</code>)：由一组关联的应用容器组成的一个完整业务单元，在 <code>docker-compose.yml</code> 文件中定义。</li></ul> <p><code>Compose</code> 的默认管理对象是项目，通过子命令对项目中的一组容器进行便捷地生命周期管理。</p> <p><code>Compose</code> 项目由 Python 编写，实现上调用了 Docker 服务提供的 API 来对容器进行管理。因此，只要所操作的平台支持 Docker API，就可以在其上利用 <code>Compose</code> 来进行编排管理。</p> <h2 id="安装与卸载"><a href="#安装与卸载" aria-hidden="true" class="header-anchor">#</a> 安装与卸载</h2> <p><code>Compose</code> 支持 Linux、macOS、Windows 10 三大平台。</p> <p><code>Compose</code> 可以通过 Python 的包管理工具 <code>pip</code> 进行安装，也可以直接下载编译好的二进制文件使用，甚至能够直接在 Docker 容器中运行。</p> <p>前两种方式是传统方式，适合本地环境下安装使用；最后一种方式则不破坏系统环境，更适合云计算场景。</p> <p><code>Docker for Mac</code> 、<code>Docker for Windows</code> 自带 <code>docker-compose</code> 二进制文件，安装 Docker 之后可以直接使用。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ docker-compose --version

docker-compose version 1.17.1, build 6d101fb
</code></pre></div><p>Linux 系统请使用以下介绍的方法安装。</p> <h3 id="二进制包"><a href="#二进制包" aria-hidden="true" class="header-anchor">#</a> 二进制包</h3> <p>在 Linux 上的也安装十分简单，从 <a href="https://github.com/docker/compose/releases" target="_blank" rel="noopener noreferrer">官方 GitHub Release<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 处直接下载编译好的二进制文件即可。</p> <p>例如，在 Linux 64 位系统上直接下载对应的二进制包。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">sudo</span> <span class="token function">curl</span> -L https://github.com/docker/compose/releases/download/1.17.1/docker-compose-<span class="token variable"><span class="token variable">`</span><span class="token function">uname</span> -s<span class="token variable">`</span></span>-<span class="token variable"><span class="token variable">`</span><span class="token function">uname</span> -m<span class="token variable">`</span></span> <span class="token operator">&gt;</span> /usr/local/bin/docker-compose
$ <span class="token function">sudo</span> <span class="token function">chmod</span> +x /usr/local/bin/docker-compose
</code></pre></div><h3 id="pip-安装"><a href="#pip-安装" aria-hidden="true" class="header-anchor">#</a> PIP 安装</h3> <p><em>注：</em> <code>x86_64</code> 架构的 Linux 建议按照上边的方法下载二进制包进行安装，如果您计算机的架构是 <code>ARM</code> (例如，树莓派)，再使用 <code>pip</code> 安装。</p> <p>这种方式是将 Compose 当作一个 Python 应用来从 pip 源中安装。</p> <p>执行安装命令：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">sudo</span> pip <span class="token function">install</span> -U docker-compose
</code></pre></div><p>可以看到类似如下输出，说明安装成功。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>Collecting docker-compose
  Downloading docker-compose-1.17.1.tar.gz <span class="token punctuation">(</span>149kB<span class="token punctuation">)</span>: 149kB downloaded
<span class="token punctuation">..</span>.
Successfully installed docker-compose cached-property requests texttable websocket-client docker-py dockerpty six enum34 backports.ssl-match-hostname ipaddress
</code></pre></div><h3 id="bash-补全命令"><a href="#bash-补全命令" aria-hidden="true" class="header-anchor">#</a> bash 补全命令</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">curl</span> -L https://raw.githubusercontent.com/docker/compose/1.8.0/contrib/completion/bash/docker-compose <span class="token operator">&gt;</span> /etc/bash_completion.d/docker-compose
</code></pre></div><h3 id="容器中执行"><a href="#容器中执行" aria-hidden="true" class="header-anchor">#</a> 容器中执行</h3> <p>Compose 既然是一个 Python 应用，自然也可以直接用容器来执行它。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">curl</span> -L https://github.com/docker/compose/releases/download/1.8.0/run.sh <span class="token operator">&gt;</span> /usr/local/bin/docker-compose
$ <span class="token function">chmod</span> +x /usr/local/bin/docker-compose
</code></pre></div><p>实际上，查看下载的 <code>run.sh</code> 脚本内容，如下</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token keyword">set</span> -e

VERSION<span class="token operator">=</span><span class="token string">&quot;1.8.0&quot;</span>
IMAGE<span class="token operator">=</span><span class="token string">&quot;docker/compose:<span class="token variable">$VERSION</span>&quot;</span>


<span class="token comment"># Setup options for connecting to docker host</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> -z <span class="token string">&quot;<span class="token variable">$DOCKER_HOST</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    DOCKER_HOST<span class="token operator">=</span><span class="token string">&quot;/var/run/docker.sock&quot;</span>
<span class="token keyword">fi</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> -S <span class="token string">&quot;<span class="token variable">$DOCKER_HOST</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    DOCKER_ADDR<span class="token operator">=</span><span class="token string">&quot;-v <span class="token variable">$DOCKER_HOST</span>:<span class="token variable">$DOCKER_HOST</span> -e DOCKER_HOST&quot;</span>
<span class="token keyword">else</span>
    DOCKER_ADDR<span class="token operator">=</span><span class="token string">&quot;-e DOCKER_HOST -e DOCKER_TLS_VERIFY -e DOCKER_CERT_PATH&quot;</span>
<span class="token keyword">fi</span>


<span class="token comment"># Setup volume mounts for compose config and context</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span><span class="token function">pwd</span><span class="token variable">)</span></span>&quot;</span> <span class="token operator">!=</span> <span class="token string">'/'</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    VOLUMES<span class="token operator">=</span><span class="token string">&quot;-v <span class="token variable"><span class="token variable">$(</span><span class="token function">pwd</span><span class="token variable">)</span></span>:<span class="token variable"><span class="token variable">$(</span><span class="token function">pwd</span><span class="token variable">)</span></span>&quot;</span>
<span class="token keyword">fi</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> -n <span class="token string">&quot;<span class="token variable">$COMPOSE_FILE</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    compose_dir<span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">dirname</span> $COMPOSE_FILE<span class="token variable">)</span></span>
<span class="token keyword">fi</span>
<span class="token comment"># TODO: also check --file argument</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> -n <span class="token string">&quot;<span class="token variable">$compose_dir</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    VOLUMES<span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$VOLUMES</span> -v <span class="token variable">$compose_dir</span>:<span class="token variable">$compose_dir</span>&quot;</span>
<span class="token keyword">fi</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> -n <span class="token string">&quot;<span class="token variable">$HOME</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    VOLUMES<span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$VOLUMES</span> -v <span class="token variable">$HOME</span>:<span class="token variable">$HOME</span> -v <span class="token variable">$HOME</span>:/root&quot;</span> <span class="token comment"># mount $HOME in /root to share docker.config</span>
<span class="token keyword">fi</span>

<span class="token comment"># Only allocate tty if we detect one</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> -t 1 <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    DOCKER_RUN_OPTIONS<span class="token operator">=</span><span class="token string">&quot;-t&quot;</span>
<span class="token keyword">fi</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> -t 0 <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    DOCKER_RUN_OPTIONS<span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$DOCKER_RUN_OPTIONS</span> -i&quot;</span>
<span class="token keyword">fi</span>

<span class="token function">exec</span> docker run --rm <span class="token variable">$DOCKER_RUN_OPTIONS</span> <span class="token variable">$DOCKER_ADDR</span> <span class="token variable">$COMPOSE_OPTIONS</span> <span class="token variable">$VOLUMES</span> -w <span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span><span class="token function">pwd</span><span class="token variable">)</span></span>&quot;</span> <span class="token variable">$IMAGE</span> <span class="token string">&quot;<span class="token variable">$@</span>&quot;</span>
</code></pre></div><p>可以看到，它其实是下载了 <code>docker/compose</code> 镜像并运行。</p> <h3 id="卸载"><a href="#卸载" aria-hidden="true" class="header-anchor">#</a> 卸载</h3> <p>如果是二进制包方式安装的，删除二进制文件即可。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">sudo</span> <span class="token function">rm</span> /usr/local/bin/docker-compose
</code></pre></div><p>如果是通过 <code>pip</code> 安装的，则执行如下命令即可删除。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">sudo</span> pip uninstall docker-compose
</code></pre></div><h2 id="使用"><a href="#使用" aria-hidden="true" class="header-anchor">#</a> 使用</h2> <h3 id="术语"><a href="#术语" aria-hidden="true" class="header-anchor">#</a> 术语</h3> <p>首先介绍几个术语。</p> <ul><li>服务 (<code>service</code>)：一个应用容器，实际上可以运行多个相同镜像的实例。</li> <li>项目 (<code>project</code>)：由一组关联的应用容器组成的一个完整业务单元。</li></ul> <p>可见，一个项目可以由多个服务（容器）关联而成，<code>Compose</code> 面向项目进行管理。</p> <h3 id="场景"><a href="#场景" aria-hidden="true" class="header-anchor">#</a> 场景</h3> <p>最常见的项目是 web 网站，该项目应该包含 web 应用和缓存。</p> <p>下面我们用 <code>Python</code> 来建立一个能够记录页面访问次数的 web 网站。</p> <h4 id="web-应用"><a href="#web-应用" aria-hidden="true" class="header-anchor">#</a> web 应用</h4> <p>新建文件夹，在该目录中编写 <code>app.py</code> 文件</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask
<span class="token keyword">from</span> redis <span class="token keyword">import</span> Redis

app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>
redis <span class="token operator">=</span> Redis<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'redis'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">6379</span><span class="token punctuation">)</span>

@app<span class="token punctuation">.</span>route<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    count <span class="token operator">=</span> redis<span class="token punctuation">.</span>incr<span class="token punctuation">(</span><span class="token string">'hits'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token string">'Hello World! 该页面已被访问 {} 次。\n'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">&quot;0.0.0.0&quot;</span><span class="token punctuation">,</span> debug<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="dockerfile"><a href="#dockerfile" aria-hidden="true" class="header-anchor">#</a> Dockerfile</h4> <p>编写 <code>Dockerfile</code> 文件，内容为</p> <div class="language-dockerfile extra-class"><pre class="language-text"><code>FROM python:3.6-alpine
ADD . /code
WORKDIR /code
RUN pip install redis flask
CMD [&quot;python&quot;, &quot;app.py&quot;]
</code></pre></div><h4 id="docker-compose-yml"><a href="#docker-compose-yml" aria-hidden="true" class="header-anchor">#</a> docker-compose.yml</h4> <p>编写 <code>docker-compose.yml</code> 文件，这个是 Compose 使用的主模板文件。</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3'</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>

  <span class="token key atrule">web</span><span class="token punctuation">:</span>
    <span class="token key atrule">build</span><span class="token punctuation">:</span> .
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
     <span class="token punctuation">-</span> <span class="token string">&quot;5000:5000&quot;</span>

  <span class="token key atrule">redis</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> <span class="token string">&quot;redis:alpine&quot;</span>
</code></pre></div><h4 id="运行-compose-项目"><a href="#运行-compose-项目" aria-hidden="true" class="header-anchor">#</a> 运行 compose 项目</h4> <div class="language-bash extra-class"><pre class="language-bash"><code>$ docker-compose up
</code></pre></div><p>此时访问本地 <code>5000</code> 端口，每次刷新页面，计数就会加 1。</p> <h2 id="compose-命令说明"><a href="#compose-命令说明" aria-hidden="true" class="header-anchor">#</a> Compose 命令说明</h2> <h3 id="命令对象与格式"><a href="#命令对象与格式" aria-hidden="true" class="header-anchor">#</a> 命令对象与格式</h3> <p>对于 Compose 来说，大部分命令的对象既可以是项目本身，也可以指定为项目中的服务或者容器。如果没有特别的说明，命令对象将是项目，这意味着项目中所有的服务都会受到命令影响。</p> <p>执行 <code>docker-compose [COMMAND] --help</code> 或者 <code>docker-compose help [COMMAND]</code> 可以查看具体某个命令的使用格式。</p> <p><code>docker-compose</code> 命令的基本的使用格式是</p> <div class="language-bash extra-class"><pre class="language-bash"><code>docker-compose <span class="token punctuation">[</span>-f<span class="token operator">=</span><span class="token operator">&lt;</span>arg<span class="token operator">&gt;</span><span class="token punctuation">..</span>.<span class="token punctuation">]</span> <span class="token punctuation">[</span>options<span class="token punctuation">]</span> <span class="token punctuation">[</span>COMMAND<span class="token punctuation">]</span> <span class="token punctuation">[</span>ARGS<span class="token punctuation">..</span>.<span class="token punctuation">]</span>
</code></pre></div><h3 id="命令选项"><a href="#命令选项" aria-hidden="true" class="header-anchor">#</a> 命令选项</h3> <ul><li><code>-f, --file FILE</code> 指定使用的 Compose 模板文件，默认为 <code>docker-compose.yml</code>，可以多次指定。</li> <li><code>-p, --project-name NAME</code> 指定项目名称，默认将使用所在目录名称作为项目名。</li> <li><code>--x-networking</code> 使用 Docker 的可拔插网络后端特性</li> <li><code>--x-network-driver DRIVER</code> 指定网络后端的驱动，默认为 <code>bridge</code></li> <li><code>--verbose</code> 输出更多调试信息。</li> <li><code>-v, --version</code> 打印版本并退出。</li></ul> <h3 id="命令使用说明"><a href="#命令使用说明" aria-hidden="true" class="header-anchor">#</a> 命令使用说明</h3> <h4 id="build"><a href="#build" aria-hidden="true" class="header-anchor">#</a> <code>build</code></h4> <p>格式为 <code>docker-compose build [options] [SERVICE...]</code>。</p> <p>构建（重新构建）项目中的服务容器。</p> <p>服务容器一旦构建后，将会带上一个标记名，例如对于 web 项目中的一个 db 容器，可能是 web_db。</p> <p>可以随时在项目目录下运行 <code>docker-compose build</code> 来重新构建服务。</p> <p>选项包括：</p> <ul><li><code>--force-rm</code> 删除构建过程中的临时容器。</li> <li><code>--no-cache</code> 构建镜像过程中不使用 cache（这将加长构建过程）。</li> <li><code>--pull</code> 始终尝试通过 pull 来获取更新版本的镜像。</li></ul> <h4 id="config"><a href="#config" aria-hidden="true" class="header-anchor">#</a> <code>config</code></h4> <p>验证 Compose 文件格式是否正确，若正确则显示配置，若格式错误显示错误原因。</p> <h4 id="down"><a href="#down" aria-hidden="true" class="header-anchor">#</a> <code>down</code></h4> <p>此命令将会停止 <code>up</code> 命令所启动的容器，并移除网络</p> <h4 id="exec"><a href="#exec" aria-hidden="true" class="header-anchor">#</a> <code>exec</code></h4> <p>进入指定的容器。</p> <h4 id="help"><a href="#help" aria-hidden="true" class="header-anchor">#</a> <code>help</code></h4> <p>获得一个命令的帮助。</p> <h4 id="images"><a href="#images" aria-hidden="true" class="header-anchor">#</a> <code>images</code></h4> <p>列出 Compose 文件中包含的镜像。</p> <h4 id="kill"><a href="#kill" aria-hidden="true" class="header-anchor">#</a> <code>kill</code></h4> <p>格式为 <code>docker-compose kill [options] [SERVICE...]</code>。</p> <p>通过发送 <code>SIGKILL</code> 信号来强制停止服务容器。</p> <p>支持通过 <code>-s</code> 参数来指定发送的信号，例如通过如下指令发送 <code>SIGINT</code> 信号。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ docker-compose <span class="token function">kill</span> -s SIGINT
</code></pre></div><h4 id="logs"><a href="#logs" aria-hidden="true" class="header-anchor">#</a> <code>logs</code></h4> <p>格式为 <code>docker-compose logs [options] [SERVICE...]</code>。</p> <p>查看服务容器的输出。默认情况下，docker-compose 将对不同的服务输出使用不同的颜色来区分。可以通过 <code>--no-color</code> 来关闭颜色。</p> <p>该命令在调试问题的时候十分有用。</p> <h4 id="pause"><a href="#pause" aria-hidden="true" class="header-anchor">#</a> <code>pause</code></h4> <p>格式为 <code>docker-compose pause [SERVICE...]</code>。</p> <p>暂停一个服务容器。</p> <h4 id="port"><a href="#port" aria-hidden="true" class="header-anchor">#</a> <code>port</code></h4> <p>格式为 <code>docker-compose port [options] SERVICE PRIVATE_PORT</code>。</p> <p>打印某个容器端口所映射的公共端口。</p> <p>选项：</p> <ul><li><code>--protocol=proto</code> 指定端口协议，tcp（默认值）或者 udp。</li> <li><code>--index=index</code> 如果同一服务存在多个容器，指定命令对象容器的序号（默认为 1）。</li></ul> <h4 id="ps"><a href="#ps" aria-hidden="true" class="header-anchor">#</a> <code>ps</code></h4> <p>格式为 <code>docker-compose ps [options] [SERVICE...]</code>。</p> <p>列出项目中目前的所有容器。</p> <p>选项：</p> <ul><li><code>-q</code> 只打印容器的 ID 信息。</li></ul> <h4 id="pull"><a href="#pull" aria-hidden="true" class="header-anchor">#</a> <code>pull</code></h4> <p>格式为 <code>docker-compose pull [options] [SERVICE...]</code>。</p> <p>拉取服务依赖的镜像。</p> <p>选项：</p> <ul><li><code>--ignore-pull-failures</code> 忽略拉取镜像过程中的错误。</li></ul> <h4 id="push"><a href="#push" aria-hidden="true" class="header-anchor">#</a> <code>push</code></h4> <p>推送服务依赖的镜像到 Docker 镜像仓库。</p> <h4 id="restart"><a href="#restart" aria-hidden="true" class="header-anchor">#</a> <code>restart</code></h4> <p>格式为 <code>docker-compose restart [options] [SERVICE...]</code>。</p> <p>重启项目中的服务。</p> <p>选项：</p> <ul><li><code>-t, --timeout TIMEOUT</code> 指定重启前停止容器的超时（默认为 10 秒）。</li></ul> <h4 id="rm"><a href="#rm" aria-hidden="true" class="header-anchor">#</a> <code>rm</code></h4> <p>格式为 <code>docker-compose rm [options] [SERVICE...]</code>。</p> <p>删除所有（停止状态的）服务容器。推荐先执行 <code>docker-compose stop</code> 命令来停止容器。</p> <p>选项：</p> <ul><li><code>-f, --force</code> 强制直接删除，包括非停止状态的容器。一般尽量不要使用该选项。</li> <li><code>-v</code> 删除容器所挂载的数据卷。</li></ul> <h4 id="run"><a href="#run" aria-hidden="true" class="header-anchor">#</a> <code>run</code></h4> <p>格式为 <code>docker-compose run [options] [-p PORT...] [-e KEY=VAL...] SERVICE [COMMAND] [ARGS...]</code>。</p> <p>在指定服务上执行一个命令。</p> <p>例如：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ docker-compose run ubuntu <span class="token function">ping</span> docker.com
</code></pre></div><p>将会启动一个 ubuntu 服务容器，并执行 <code>ping docker.com</code> 命令。</p> <p>默认情况下，如果存在关联，则所有关联的服务将会自动被启动，除非这些服务已经在运行中。</p> <p>该命令类似启动容器后运行指定的命令，相关卷、链接等等都将会按照配置自动创建。</p> <p>两个不同点：</p> <ul><li>给定命令将会覆盖原有的自动运行命令；</li> <li>不会自动创建端口，以避免冲突。</li></ul> <p>如果不希望自动启动关联的容器，可以使用 <code>--no-deps</code> 选项，例如</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ docker-compose run --no-deps web python manage.py shell
</code></pre></div><p>将不会启动 web 容器所关联的其它容器。</p> <p>选项：</p> <ul><li><code>-d</code> 后台运行容器。</li> <li><code>--name NAME</code> 为容器指定一个名字。</li> <li><code>--entrypoint CMD</code> 覆盖默认的容器启动指令。</li> <li><code>-e KEY=VAL</code> 设置环境变量值，可多次使用选项来设置多个环境变量。</li> <li><code>-u, --user=&quot;&quot;</code> 指定运行容器的用户名或者 uid。</li> <li><code>--no-deps</code> 不自动启动关联的服务容器。</li> <li><code>--rm</code> 运行命令后自动删除容器，<code>d</code> 模式下将忽略。</li> <li><code>-p, --publish=[]</code> 映射容器端口到本地主机。</li> <li><code>--service-ports</code> 配置服务端口并映射到本地主机。</li> <li><code>-T</code> 不分配伪 tty，意味着依赖 tty 的指令将无法运行。</li></ul> <h4 id="scale"><a href="#scale" aria-hidden="true" class="header-anchor">#</a> <code>scale</code></h4> <p>格式为 <code>docker-compose scale [options] [SERVICE=NUM...]</code>。</p> <p>设置指定服务运行的容器个数。</p> <p>通过 <code>service=num</code> 的参数来设置数量。例如：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ docker-compose scale web<span class="token operator">=</span>3 db<span class="token operator">=</span>2
</code></pre></div><p>将启动 3 个容器运行 web 服务，2 个容器运行 db 服务。</p> <p>一般的，当指定数目多于该服务当前实际运行容器，将新创建并启动容器；反之，将停止容器。</p> <p>选项：</p> <ul><li><code>-t, --timeout TIMEOUT</code> 停止容器时候的超时（默认为 10 秒）。</li></ul> <h4 id="start"><a href="#start" aria-hidden="true" class="header-anchor">#</a> <code>start</code></h4> <p>格式为 <code>docker-compose start [SERVICE...]</code>。</p> <p>启动已经存在的服务容器。</p> <h4 id="stop"><a href="#stop" aria-hidden="true" class="header-anchor">#</a> <code>stop</code></h4> <p>格式为 <code>docker-compose stop [options] [SERVICE...]</code>。</p> <p>停止已经处于运行状态的容器，但不删除它。通过 <code>docker-compose start</code> 可以再次启动这些容器。</p> <p>选项：</p> <ul><li><code>-t, --timeout TIMEOUT</code> 停止容器时候的超时（默认为 10 秒）。</li></ul> <h4 id="top"><a href="#top" aria-hidden="true" class="header-anchor">#</a> <code>top</code></h4> <p>查看各个服务容器内运行的进程。</p> <h4 id="unpause"><a href="#unpause" aria-hidden="true" class="header-anchor">#</a> <code>unpause</code></h4> <p>格式为 <code>docker-compose unpause [SERVICE...]</code>。</p> <p>恢复处于暂停状态中的服务。</p> <h4 id="up"><a href="#up" aria-hidden="true" class="header-anchor">#</a> <code>up</code></h4> <p>格式为 <code>docker-compose up [options] [SERVICE...]</code>。</p> <p>该命令十分强大，它将尝试自动完成包括构建镜像，（重新）创建服务，启动服务，并关联服务相关容器的一系列操作。</p> <p>链接的服务都将会被自动启动，除非已经处于运行状态。</p> <p>可以说，大部分时候都可以直接通过该命令来启动一个项目。</p> <p>默认情况，<code>docker-compose up</code> 启动的容器都在前台，控制台将会同时打印所有容器的输出信息，可以很方便进行调试。</p> <p>当通过 <code>Ctrl-C</code> 停止命令时，所有容器将会停止。</p> <p>如果使用 <code>docker-compose up -d</code>，将会在后台启动并运行所有的容器。一般推荐生产环境下使用该选项。</p> <p>默认情况，如果服务容器已经存在，<code>docker-compose up</code> 将会尝试停止容器，然后重新创建（保持使用 <code>volumes-from</code> 挂载的卷），以保证新启动的服务匹配 <code>docker-compose.yml</code> 文件的最新内容。如果用户不希望容器被停止并重新创建，可以使用 <code>docker-compose up --no-recreate</code>。这样将只会启动处于停止状态的容器，而忽略已经运行的服务。如果用户只想重新部署某个服务，可以使用 <code>docker-compose up --no-deps -d &lt;SERVICE_NAME&gt;</code> 来重新创建服务并后台停止旧服务，启动新服务，并不会影响到其所依赖的服务。</p> <p>选项：</p> <ul><li><code>-d</code> 在后台运行服务容器。</li> <li><code>--no-color</code> 不使用颜色来区分不同的服务的控制台输出。</li> <li><code>--no-deps</code> 不启动服务所链接的容器。</li> <li><code>--force-recreate</code> 强制重新创建容器，不能与 <code>--no-recreate</code> 同时使用。</li> <li><code>--no-recreate</code> 如果容器已经存在了，则不重新创建，不能与 <code>--force-recreate</code> 同时使用。</li> <li><code>--no-build</code> 不自动构建缺失的服务镜像。</li> <li><code>-t, --timeout TIMEOUT</code> 停止容器时候的超时（默认为 10 秒）。</li></ul> <h4 id="version"><a href="#version" aria-hidden="true" class="header-anchor">#</a> <code>version</code></h4> <p>格式为 <code>docker-compose version</code>。</p> <p>打印版本信息。</p> <h2 id="compose-模板文件"><a href="#compose-模板文件" aria-hidden="true" class="header-anchor">#</a> Compose 模板文件</h2> <p>模板文件是使用 <code>Compose</code> 的核心，涉及到的指令关键字也比较多。但大家不用担心，这里面大部分指令跟 <code>docker run</code> 相关参数的含义都是类似的。</p> <p>默认的模板文件名称为 <code>docker-compose.yml</code>，格式为 YAML 格式。</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&quot;3&quot;</span>

<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">webapp</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> examples/web
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;80:80&quot;</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;/data&quot;</span>
</code></pre></div><p>注意每个服务都必须通过 <code>image</code> 指令指定镜像或 <code>build</code> 指令（需要 Dockerfile）等来自动构建生成镜像。</p> <p>如果使用 <code>build</code> 指令，在 <code>Dockerfile</code> 中设置的选项(例如：<code>CMD</code>, <code>EXPOSE</code>, <code>VOLUME</code>, <code>ENV</code> 等) 将会自动被获取，无需在 <code>docker-compose.yml</code> 中再次设置。</p> <p>下面分别介绍各个指令的用法。</p> <h3 id="build-2"><a href="#build-2" aria-hidden="true" class="header-anchor">#</a> <code>build</code></h3> <p>指定 <code>Dockerfile</code> 所在文件夹的路径（可以是绝对路径，或者相对 docker-compose.yml 文件的路径）。 <code>Compose</code> 将会利用它自动构建这个镜像，然后使用这个镜像。</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3'</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>

  <span class="token key atrule">webapp</span><span class="token punctuation">:</span>
    <span class="token key atrule">build</span><span class="token punctuation">:</span> ./dir
</code></pre></div><p>你也可以使用 <code>context</code> 指令指定 <code>Dockerfile</code> 所在文件夹的路径。</p> <p>使用 <code>dockerfile</code> 指令指定 <code>Dockerfile</code> 文件名。</p> <p>使用 <code>arg</code> 指令指定构建镜像时的变量。</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3'</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>

  <span class="token key atrule">webapp</span><span class="token punctuation">:</span>
    <span class="token key atrule">build</span><span class="token punctuation">:</span>
      <span class="token key atrule">context</span><span class="token punctuation">:</span> ./dir
      <span class="token key atrule">dockerfile</span><span class="token punctuation">:</span> Dockerfile<span class="token punctuation">-</span>alternate
      <span class="token key atrule">args</span><span class="token punctuation">:</span>
        <span class="token key atrule">buildno</span><span class="token punctuation">:</span> <span class="token number">1</span>
</code></pre></div><p>使用 <code>cache_from</code> 指定构建镜像的缓存</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">build</span><span class="token punctuation">:</span>
  <span class="token key atrule">context</span><span class="token punctuation">:</span> .
  <span class="token key atrule">cache_from</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> alpine<span class="token punctuation">:</span>latest
    <span class="token punctuation">-</span> corp/web_app<span class="token punctuation">:</span><span class="token number">3.14</span>
</code></pre></div><h3 id="cap-add-cap-drop"><a href="#cap-add-cap-drop" aria-hidden="true" class="header-anchor">#</a> <code>cap_add, cap_drop</code></h3> <p>指定容器的内核能力（capacity）分配。</p> <p>例如，让容器拥有所有能力可以指定为：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">cap_add</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> ALL
</code></pre></div><p>去掉 NET_ADMIN 能力可以指定为：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">cap_drop</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> NET_ADMIN
</code></pre></div><h3 id="command"><a href="#command" aria-hidden="true" class="header-anchor">#</a> <code>command</code></h3> <p>覆盖容器启动后默认执行的命令。</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">command</span><span class="token punctuation">:</span> echo &quot;hello world&quot;
</code></pre></div><h3 id="configs"><a href="#configs" aria-hidden="true" class="header-anchor">#</a> <code>configs</code></h3> <p>仅用于 <code>Swarm mode</code>，详细内容请查看 <a href="https://yeasy.gitbooks.io/docker_practice/swarm_mode" target="_blank" rel="noopener noreferrer"><code>Swarm mode</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 一节。</p> <h3 id="cgroup-parent"><a href="#cgroup-parent" aria-hidden="true" class="header-anchor">#</a> <code>cgroup_parent</code></h3> <p>指定父 <code>cgroup</code> 组，意味着将继承该组的资源限制。</p> <p>例如，创建了一个 cgroup 组名称为 <code>cgroups_1</code>。</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">cgroup_parent</span><span class="token punctuation">:</span> cgroups_1
</code></pre></div><h3 id="container-name"><a href="#container-name" aria-hidden="true" class="header-anchor">#</a> <code>container_name</code></h3> <p>指定容器名称。默认将会使用 <code>项目名称_服务名称_序号</code> 这样的格式。</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">container_name</span><span class="token punctuation">:</span> docker<span class="token punctuation">-</span>web<span class="token punctuation">-</span>container
</code></pre></div><blockquote><p>注意: 指定容器名称后，该服务将无法进行扩展（scale），因为 Docker 不允许多个容器具有相同的名称。</p></blockquote> <h3 id="deploy"><a href="#deploy" aria-hidden="true" class="header-anchor">#</a> <code>deploy</code></h3> <p>仅用于 <code>Swarm mode</code>，详细内容请查看 <a href="https://yeasy.gitbooks.io/docker_practice/swarm_mode" target="_blank" rel="noopener noreferrer"><code>Swarm mode</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 一节</p> <h3 id="devices"><a href="#devices" aria-hidden="true" class="header-anchor">#</a> <code>devices</code></h3> <p>指定设备映射关系。</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">devices</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token string">&quot;/dev/ttyUSB1:/dev/ttyUSB0&quot;</span>
</code></pre></div><h3 id="depends-on"><a href="#depends-on" aria-hidden="true" class="header-anchor">#</a> <code>depends_on</code></h3> <p>解决容器的依赖、启动先后的问题。以下例子中会先启动 <code>redis</code> <code>db</code> 再启动 <code>web</code></p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3'</span>

<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">web</span><span class="token punctuation">:</span>
    <span class="token key atrule">build</span><span class="token punctuation">:</span> .
    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> db
      <span class="token punctuation">-</span> redis

  <span class="token key atrule">redis</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> redis

  <span class="token key atrule">db</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> postgres
</code></pre></div><blockquote><p>注意：<code>web</code> 服务不会等待 <code>redis</code> <code>db</code> 「完全启动」之后才启动。</p></blockquote> <h3 id="dns"><a href="#dns" aria-hidden="true" class="header-anchor">#</a> <code>dns</code></h3> <p>自定义 <code>DNS</code> 服务器。可以是一个值，也可以是一个列表。</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">dns</span><span class="token punctuation">:</span> 8.8.8.8

<span class="token key atrule">dns</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> 8.8.8.8
  <span class="token punctuation">-</span> 114.114.114.114
</code></pre></div><h3 id="dns-search"><a href="#dns-search" aria-hidden="true" class="header-anchor">#</a> <code>dns_search</code></h3> <p>配置 <code>DNS</code> 搜索域。可以是一个值，也可以是一个列表。</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">dns_search</span><span class="token punctuation">:</span> example.com

<span class="token key atrule">dns_search</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> domain1.example.com
  <span class="token punctuation">-</span> domain2.example.com
</code></pre></div><h3 id="tmpfs"><a href="#tmpfs" aria-hidden="true" class="header-anchor">#</a> <code>tmpfs</code></h3> <p>挂载一个 tmpfs 文件系统到容器。</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">tmpfs</span><span class="token punctuation">:</span> /run
<span class="token key atrule">tmpfs</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> /run
  <span class="token punctuation">-</span> /tmp
</code></pre></div><h3 id="env-file"><a href="#env-file" aria-hidden="true" class="header-anchor">#</a> <code>env_file</code></h3> <p>从文件中获取环境变量，可以为单独的文件路径或列表。</p> <p>如果通过 <code>docker-compose -f FILE</code> 方式来指定 Compose 模板文件，则 <code>env_file</code> 中变量的路径会基于模板文件路径。</p> <p>如果有变量名称与 <code>environment</code> 指令冲突，则按照惯例，以后者为准。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>env_file: .env

env_file:
  - ./common.env
  - ./apps/web.env
  - /opt/secrets.env
</code></pre></div><p>环境变量文件中每一行必须符合格式，支持 <code>#</code> 开头的注释行。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># common.env: Set development environment</span>
PROG_ENV<span class="token operator">=</span>development
</code></pre></div><h3 id="environment"><a href="#environment" aria-hidden="true" class="header-anchor">#</a> <code>environment</code></h3> <p>设置环境变量。你可以使用数组或字典两种格式。</p> <p>只给定名称的变量会自动获取运行 Compose 主机上对应变量的值，可以用来防止泄露不必要的数据。</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">environment</span><span class="token punctuation">:</span>
  <span class="token key atrule">RACK_ENV</span><span class="token punctuation">:</span> development
  <span class="token key atrule">SESSION_SECRET</span><span class="token punctuation">:</span>

<span class="token key atrule">environment</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> RACK_ENV=development
  <span class="token punctuation">-</span> SESSION_SECRET
</code></pre></div><p>如果变量名称或者值中用到 <code>true|false，yes|no</code> 等表达 <a href="https://yaml.org/type/bool.html" target="_blank" rel="noopener noreferrer">布尔<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 含义的词汇，最好放到引号里，避免 YAML 自动解析某些内容为对应的布尔语义。这些特定词汇，包括</p> <div class="language-bash extra-class"><pre class="language-bash"><code>y<span class="token operator">|</span>Y<span class="token operator">|</span><span class="token function">yes</span><span class="token operator">|</span>Yes<span class="token operator">|</span>YES<span class="token operator">|</span>n<span class="token operator">|</span>N<span class="token operator">|</span>no<span class="token operator">|</span>No<span class="token operator">|</span>NO<span class="token operator">|</span><span class="token boolean">true</span><span class="token operator">|</span>True<span class="token operator">|</span>TRUE<span class="token operator">|</span><span class="token boolean">false</span><span class="token operator">|</span>False<span class="token operator">|</span>FALSE<span class="token operator">|</span>on<span class="token operator">|</span>On<span class="token operator">|</span>ON<span class="token operator">|</span>off<span class="token operator">|</span>Off<span class="token operator">|</span>OFF
</code></pre></div><h3 id="expose"><a href="#expose" aria-hidden="true" class="header-anchor">#</a> <code>expose</code></h3> <p>暴露端口，但不映射到宿主机，只被连接的服务访问。</p> <p>仅可以指定内部端口为参数</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">expose</span><span class="token punctuation">:</span>
 <span class="token punctuation">-</span> <span class="token string">&quot;3000&quot;</span>
 <span class="token punctuation">-</span> <span class="token string">&quot;8000&quot;</span>
</code></pre></div><h3 id="external-links"><a href="#external-links" aria-hidden="true" class="header-anchor">#</a> <code>external_links</code></h3> <blockquote><p>注意：不建议使用该指令。</p></blockquote> <p>链接到 <code>docker-compose.yml</code> 外部的容器，甚至并非 <code>Compose</code> 管理的外部容器。</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">external_links</span><span class="token punctuation">:</span>
 <span class="token punctuation">-</span> redis_1
 <span class="token punctuation">-</span> project_db_1<span class="token punctuation">:</span>mysql
 <span class="token punctuation">-</span> project_db_1<span class="token punctuation">:</span>postgresql
</code></pre></div><h3 id="extra-hosts"><a href="#extra-hosts" aria-hidden="true" class="header-anchor">#</a> <code>extra_hosts</code></h3> <p>类似 Docker 中的 <code>--add-host</code> 参数，指定额外的 host 名称映射信息。</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">extra_hosts</span><span class="token punctuation">:</span>
 <span class="token punctuation">-</span> <span class="token string">&quot;googledns:8.8.8.8&quot;</span>
 <span class="token punctuation">-</span> <span class="token string">&quot;dockerhub:52.1.157.61&quot;</span>
</code></pre></div><p>会在启动后的服务容器中 <code>/etc/hosts</code> 文件中添加如下两条条目。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>8.8.8.8 googledns
52.1.157.61 dockerhub
</code></pre></div><h3 id="healthcheck"><a href="#healthcheck" aria-hidden="true" class="header-anchor">#</a> <code>healthcheck</code></h3> <p>通过命令检查容器是否健康运行。</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">healthcheck</span><span class="token punctuation">:</span>
  <span class="token key atrule">test</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;CMD&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;curl&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-f&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;http://localhost&quot;</span><span class="token punctuation">]</span>
  <span class="token key atrule">interval</span><span class="token punctuation">:</span> 1m30s
  <span class="token key atrule">timeout</span><span class="token punctuation">:</span> 10s
  <span class="token key atrule">retries</span><span class="token punctuation">:</span> <span class="token number">3</span>
</code></pre></div><h3 id="image"><a href="#image" aria-hidden="true" class="header-anchor">#</a> <code>image</code></h3> <p>指定为镜像名称或镜像 ID。如果镜像在本地不存在，<code>Compose</code> 将会尝试拉取这个镜像。</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">image</span><span class="token punctuation">:</span> ubuntu
<span class="token key atrule">image</span><span class="token punctuation">:</span> orchardup/postgresql
<span class="token key atrule">image</span><span class="token punctuation">:</span> a4bc65fd
</code></pre></div><h3 id="labels"><a href="#labels" aria-hidden="true" class="header-anchor">#</a> <code>labels</code></h3> <p>为容器添加 Docker 元数据（metadata）信息。例如可以为容器添加辅助说明信息。</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">labels</span><span class="token punctuation">:</span>
  <span class="token key atrule">com.startupteam.description</span><span class="token punctuation">:</span> <span class="token string">&quot;webapp for a startup team&quot;</span>
  <span class="token key atrule">com.startupteam.department</span><span class="token punctuation">:</span> <span class="token string">&quot;devops department&quot;</span>
  <span class="token key atrule">com.startupteam.release</span><span class="token punctuation">:</span> <span class="token string">&quot;rc3 for v1.0&quot;</span>
</code></pre></div><h3 id="links"><a href="#links" aria-hidden="true" class="header-anchor">#</a> <code>links</code></h3> <blockquote><p>注意：不推荐使用该指令。</p></blockquote> <h3 id="logging"><a href="#logging" aria-hidden="true" class="header-anchor">#</a> <code>logging</code></h3> <p>配置日志选项。</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">logging</span><span class="token punctuation">:</span>
  <span class="token key atrule">driver</span><span class="token punctuation">:</span> syslog
  <span class="token key atrule">options</span><span class="token punctuation">:</span>
    <span class="token key atrule">syslog-address</span><span class="token punctuation">:</span> <span class="token string">&quot;tcp://192.168.0.42:123&quot;</span>
</code></pre></div><p>目前支持三种日志驱动类型。</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">driver</span><span class="token punctuation">:</span> <span class="token string">&quot;json-file&quot;</span>
<span class="token key atrule">driver</span><span class="token punctuation">:</span> <span class="token string">&quot;syslog&quot;</span>
<span class="token key atrule">driver</span><span class="token punctuation">:</span> <span class="token string">&quot;none&quot;</span>
</code></pre></div><p><code>options</code> 配置日志驱动的相关参数。</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">options</span><span class="token punctuation">:</span>
  <span class="token key atrule">max-size</span><span class="token punctuation">:</span> <span class="token string">&quot;200k&quot;</span>
  <span class="token key atrule">max-file</span><span class="token punctuation">:</span> <span class="token string">&quot;10&quot;</span>
</code></pre></div><h3 id="network-mode"><a href="#network-mode" aria-hidden="true" class="header-anchor">#</a> <code>network_mode</code></h3> <p>设置网络模式。使用和 <code>docker run</code> 的 <code>--network</code> 参数一样的值。</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">network_mode</span><span class="token punctuation">:</span> <span class="token string">&quot;bridge&quot;</span>
<span class="token key atrule">network_mode</span><span class="token punctuation">:</span> <span class="token string">&quot;host&quot;</span>
<span class="token key atrule">network_mode</span><span class="token punctuation">:</span> <span class="token string">&quot;none&quot;</span>
<span class="token key atrule">network_mode</span><span class="token punctuation">:</span> <span class="token string">&quot;service:[service name]&quot;</span>
<span class="token key atrule">network_mode</span><span class="token punctuation">:</span> <span class="token string">&quot;container:[container name/id]&quot;</span>
</code></pre></div><h3 id="networks"><a href="#networks" aria-hidden="true" class="header-anchor">#</a> <code>networks</code></h3> <p>配置容器连接的网络。</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&quot;3&quot;</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>

  <span class="token key atrule">some-service</span><span class="token punctuation">:</span>
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
     <span class="token punctuation">-</span> some<span class="token punctuation">-</span>network
     <span class="token punctuation">-</span> other<span class="token punctuation">-</span>network

<span class="token key atrule">networks</span><span class="token punctuation">:</span>
  <span class="token key atrule">some-network</span><span class="token punctuation">:</span>
  <span class="token key atrule">other-network</span><span class="token punctuation">:</span>
</code></pre></div><h3 id="pid"><a href="#pid" aria-hidden="true" class="header-anchor">#</a> <code>pid</code></h3> <p>跟主机系统共享进程命名空间。打开该选项的容器之间，以及容器和宿主机系统之间可以通过进程 ID 来相互访问和操作。</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">pid</span><span class="token punctuation">:</span> <span class="token string">&quot;host&quot;</span>
</code></pre></div><h3 id="ports"><a href="#ports" aria-hidden="true" class="header-anchor">#</a> <code>ports</code></h3> <p>暴露端口信息。</p> <p>使用宿主端口：容器端口 <code>(HOST:CONTAINER)</code> 格式，或者仅仅指定容器的端口（宿主将会随机选择端口）都可以。</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">ports</span><span class="token punctuation">:</span>
 <span class="token punctuation">-</span> <span class="token string">&quot;3000&quot;</span>
 <span class="token punctuation">-</span> <span class="token string">&quot;8000:8000&quot;</span>
 <span class="token punctuation">-</span> <span class="token string">&quot;49100:22&quot;</span>
 <span class="token punctuation">-</span> <span class="token string">&quot;127.0.0.1:8001:8001&quot;</span>
</code></pre></div><p><em>注意：当使用 HOST:CONTAINER 格式来映射端口时，如果你使用的容器端口小于 60 并且没放到引号里，可能会得到错误结果，因为 YAML 会自动解析 xx:yy 这种数字格式为 60 进制。为避免出现这种问题，建议数字串都采用引号包括起来的字符串格式。</em></p> <h3 id="secrets"><a href="#secrets" aria-hidden="true" class="header-anchor">#</a> <code>secrets</code></h3> <p>存储敏感数据，例如 <code>mysql</code> 服务密码。</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&quot;3.1&quot;</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>

<span class="token key atrule">mysql</span><span class="token punctuation">:</span>
  <span class="token key atrule">image</span><span class="token punctuation">:</span> mysql
  <span class="token key atrule">environment</span><span class="token punctuation">:</span>
    <span class="token key atrule">MYSQL_ROOT_PASSWORD_FILE</span><span class="token punctuation">:</span> /run/secrets/db_root_password
  <span class="token key atrule">secrets</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> db_root_password
    <span class="token punctuation">-</span> my_other_secret

<span class="token key atrule">secrets</span><span class="token punctuation">:</span>
  <span class="token key atrule">my_secret</span><span class="token punctuation">:</span>
    <span class="token key atrule">file</span><span class="token punctuation">:</span> ./my_secret.txt
  <span class="token key atrule">my_other_secret</span><span class="token punctuation">:</span>
    <span class="token key atrule">external</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre></div><h3 id="security-opt"><a href="#security-opt" aria-hidden="true" class="header-anchor">#</a> <code>security_opt</code></h3> <p>指定容器模板标签（label）机制的默认属性（用户、角色、类型、级别等）。例如配置标签的用户名和角色名。</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">security_opt</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> label<span class="token punctuation">:</span>user<span class="token punctuation">:</span>USER
    <span class="token punctuation">-</span> label<span class="token punctuation">:</span>role<span class="token punctuation">:</span>ROLE
</code></pre></div><h3 id="stop-signal"><a href="#stop-signal" aria-hidden="true" class="header-anchor">#</a> <code>stop_signal</code></h3> <p>设置另一个信号来停止容器。在默认情况下使用的是 SIGTERM 停止容器。</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">stop_signal</span><span class="token punctuation">:</span> SIGUSR1
</code></pre></div><h3 id="sysctls"><a href="#sysctls" aria-hidden="true" class="header-anchor">#</a> <code>sysctls</code></h3> <p>配置容器内核参数。</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">sysctls</span><span class="token punctuation">:</span>
  <span class="token key atrule">net.core.somaxconn</span><span class="token punctuation">:</span> <span class="token number">1024</span>
  <span class="token key atrule">net.ipv4.tcp_syncookies</span><span class="token punctuation">:</span> <span class="token number">0</span>

<span class="token key atrule">sysctls</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> net.core.somaxconn=1024
  <span class="token punctuation">-</span> net.ipv4.tcp_syncookies=0
</code></pre></div><h3 id="ulimits"><a href="#ulimits" aria-hidden="true" class="header-anchor">#</a> <code>ulimits</code></h3> <p>指定容器的 ulimits 限制值。</p> <p>例如，指定最大进程数为 65535，指定文件句柄数为 20000（软限制，应用可以随时修改，不能超过硬限制） 和 40000（系统硬限制，只能 root 用户提高）。</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code>  <span class="token key atrule">ulimits</span><span class="token punctuation">:</span>
    <span class="token key atrule">nproc</span><span class="token punctuation">:</span> <span class="token number">65535</span>
    <span class="token key atrule">nofile</span><span class="token punctuation">:</span>
      <span class="token key atrule">soft</span><span class="token punctuation">:</span> <span class="token number">20000</span>
      <span class="token key atrule">hard</span><span class="token punctuation">:</span> <span class="token number">40000</span>
</code></pre></div><h3 id="volumes"><a href="#volumes" aria-hidden="true" class="header-anchor">#</a> <code>volumes</code></h3> <p>数据卷所挂载路径设置。可以设置宿主机路径 （<code>HOST:CONTAINER</code>） 或加上访问模式 （<code>HOST:CONTAINER:ro</code>）。</p> <p>该指令中路径支持相对路径。</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">volumes</span><span class="token punctuation">:</span>
 <span class="token punctuation">-</span> /var/lib/mysql
 <span class="token punctuation">-</span> cache/<span class="token punctuation">:</span>/tmp/cache
 <span class="token punctuation">-</span> ~/configs<span class="token punctuation">:</span>/etc/configs/<span class="token punctuation">:</span>ro
</code></pre></div><h3 id="其它指令"><a href="#其它指令" aria-hidden="true" class="header-anchor">#</a> 其它指令</h3> <p>此外，还有包括 <code>domainname, entrypoint, hostname, ipc, mac_address, privileged, read_only, shm_size, restart, stdin_open, tty, user, working_dir</code> 等指令，基本跟 <code>docker run</code> 中对应参数的功能一致。</p> <p>指定服务容器启动后执行的入口文件。</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">entrypoint</span><span class="token punctuation">:</span> /code/entrypoint.sh
</code></pre></div><p>指定容器中运行应用的用户名。</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">user</span><span class="token punctuation">:</span> nginx
</code></pre></div><p>指定容器中工作目录。</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">working_dir</span><span class="token punctuation">:</span> /code
</code></pre></div><p>指定容器中搜索域名、主机名、mac 地址等。</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">domainname</span><span class="token punctuation">:</span> your_website.com
<span class="token key atrule">hostname</span><span class="token punctuation">:</span> test
<span class="token key atrule">mac_address</span><span class="token punctuation">:</span> 08<span class="token punctuation">-</span>00<span class="token punctuation">-</span>27<span class="token punctuation">-</span>00<span class="token punctuation">-</span>0C<span class="token punctuation">-</span>0A
</code></pre></div><p>允许容器中运行一些特权命令。</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">privileged</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre></div><p>指定容器退出后的重启策略为始终重启。该命令对保持服务始终运行十分有效，在生产环境中推荐配置为 <code>always</code> 或者 <code>unless-stopped</code>。</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">restart</span><span class="token punctuation">:</span> always
</code></pre></div><p>以只读模式挂载容器的 root 文件系统，意味着不能对容器内容进行修改。</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">read_only</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre></div><p>打开标准输入，可以接受外部输入。</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">stdin_open</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre></div><p>模拟一个伪终端。</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">tty</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre></div><h3 id="读取变量"><a href="#读取变量" aria-hidden="true" class="header-anchor">#</a> 读取变量</h3> <p>Compose 模板文件支持动态读取主机的系统环境变量和当前目录下的 <code>.env</code> 文件中的变量。</p> <p>例如，下面的 Compose 文件将从运行它的环境中读取变量 <code>${MONGO_VERSION}</code> 的值，并写入执行的指令中。</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&quot;3&quot;</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>

<span class="token key atrule">db</span><span class="token punctuation">:</span>
  <span class="token key atrule">image</span><span class="token punctuation">:</span> <span class="token string">&quot;mongo:${MONGO_VERSION}&quot;</span>
</code></pre></div><p>如果执行 <code>MONGO_VERSION=3.2 docker-compose up</code> 则会启动一个 <code>mongo:3.2</code> 镜像的容器；如果执行 <code>MONGO_VERSION=2.8 docker-compose up</code> 则会启动一个 <code>mongo:2.8</code> 镜像的容器。</p> <p>若当前目录存在 <code>.env</code> 文件，执行 <code>docker-compose</code> 命令时将从该文件中读取变量。</p> <p>在当前目录新建 <code>.env</code> 文件并写入以下内容。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 支持 # 号注释</span>
MONGO_VERSION<span class="token operator">=</span>3.6
</code></pre></div><p>执行 <code>docker-compose up</code> 则会启动一个 <code>mongo:3.6</code> 镜像的容器。</p> <h2 id="使用-django"><a href="#使用-django" aria-hidden="true" class="header-anchor">#</a> 使用 Django</h2> <p>本小节内容适合 <code>Python</code> 开发人员阅读。</p> <p>我们现在将使用 <code>Docker Compose</code> 配置并运行一个 <code>Django/PostgreSQL</code> 应用。</p> <p>在一切工作开始前，需要先编辑好三个必要的文件。</p> <p>第一步，因为应用将要运行在一个满足所有环境依赖的 Docker 容器里面，那么我们可以通过编辑 <code>Dockerfile</code> 文件来指定 Docker 容器要安装内容。内容如下：</p> <div class="language-dockerfile extra-class"><pre class="language-text"><code>FROM python:3
ENV PYTHONUNBUFFERED 1
RUN mkdir /code
WORKDIR /code
ADD requirements.txt /code/
RUN pip install -r requirements.txt
ADD . /code/
</code></pre></div><p>以上内容指定应用将使用安装了 Python 以及必要依赖包的镜像。更多关于如何编写 <code>Dockerfile</code> 文件的信息可以查看 <a href="https://yeasy.gitbooks.io/docker_practice/image/create.md#%E5%88%A9%E7%94%A8%20Dockerfile%20%E6%9D%A5%E5%88%9B%E5%BB%BA%E9%95%9C%E5%83%8F" target="_blank" rel="noopener noreferrer">镜像创建<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 和 <a href="https://yeasy.gitbooks.io/docker_practice/dockerfile/README.md" target="_blank" rel="noopener noreferrer">Dockerfile 使用<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <p>第二步，在 <code>requirements.txt</code> 文件里面写明需要安装的具体依赖包名。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>Django<span class="token operator">&gt;=</span>1.8,<span class="token operator">&lt;</span>2.0
psycopg2
</code></pre></div><p>第三步，<code>docker-compose.yml</code> 文件将把所有的东西关联起来。它描述了应用的构成（一个 web 服务和一个数据库）、使用的 Docker 镜像、镜像之间的连接、挂载到容器的卷，以及服务开放的端口。</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&quot;3&quot;</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>

  <span class="token key atrule">db</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> postgres

  <span class="token key atrule">web</span><span class="token punctuation">:</span>
    <span class="token key atrule">build</span><span class="token punctuation">:</span> .
    <span class="token key atrule">command</span><span class="token punctuation">:</span> python3 manage.py runserver 0.0.0.0<span class="token punctuation">:</span><span class="token number">8000</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> .<span class="token punctuation">:</span>/code
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;8000:8000&quot;</span>
    <span class="token key atrule">links</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> db
</code></pre></div><p>查看 <a href="https://yeasy.gitbooks.io/docker_practice/compose/yml_ref.md" target="_blank" rel="noopener noreferrer"><code>docker-compose.yml</code> 章节<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 了解更多详细的工作机制。</p> <p>现在我们就可以使用 <code>docker-compose run</code> 命令启动一个 <code>Django</code> 应用了。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ docker-compose run web django-admin.py startproject django_example <span class="token keyword">.</span>
</code></pre></div><p>Compose 会先使用 <code>Dockerfile</code> 为 web 服务创建一个镜像，接着使用这个镜像在容器里运行 <code>django-admin.py startproject django_example</code> 指令。</p> <p>这将在当前目录生成一个 <code>Django</code> 应用。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">ls</span>
Dockerfile       docker-compose.yml          django_example       manage.py       requirements.txt
</code></pre></div><p>如果你的系统是 Linux,记得更改文件权限。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">chown</span> -R <span class="token variable">$USER</span><span class="token keyword">:</span><span class="token variable">$USER</span> <span class="token keyword">.</span>
</code></pre></div><p>首先，我们要为应用设置好数据库的连接信息。用以下内容替换 <code>django_example/settings.py</code> 文件中 <code>DATABASES = ...</code> 定义的节点内容。</p> <div class="language-python extra-class"><pre class="language-python"><code>DATABASES <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'default'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">'ENGINE'</span><span class="token punctuation">:</span> <span class="token string">'django.db.backends.postgresql'</span><span class="token punctuation">,</span>
        <span class="token string">'NAME'</span><span class="token punctuation">:</span> <span class="token string">'postgres'</span><span class="token punctuation">,</span>
        <span class="token string">'USER'</span><span class="token punctuation">:</span> <span class="token string">'postgres'</span><span class="token punctuation">,</span>
        <span class="token string">'HOST'</span><span class="token punctuation">:</span> <span class="token string">'db'</span><span class="token punctuation">,</span>
        <span class="token string">'PORT'</span><span class="token punctuation">:</span> <span class="token number">5432</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这些信息是在 <a href="https://hub.docker.com/_/postgres/" target="_blank" rel="noopener noreferrer">postgres<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 镜像固定设置好的。然后，运行 <code>docker-compose up</code> ：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ docker-compose up

django_db_1 is up-to-date
Creating django_web_1 <span class="token punctuation">..</span>.
Creating django_web_1 <span class="token punctuation">..</span>. <span class="token keyword">done</span>
Attaching to django_db_1, django_web_1
db_1   <span class="token operator">|</span> The files belonging to this database system will be owned by user <span class="token string">&quot;postgres&quot;</span><span class="token keyword">.</span>
db_1   <span class="token operator">|</span> This user must also own the server process.
db_1   <span class="token operator">|</span>
db_1   <span class="token operator">|</span> The database cluster will be initialized with locale <span class="token string">&quot;en_US.utf8&quot;</span><span class="token keyword">.</span>
db_1   <span class="token operator">|</span> The default database encoding has accordingly been <span class="token keyword">set</span> to <span class="token string">&quot;UTF8&quot;</span><span class="token keyword">.</span>
db_1   <span class="token operator">|</span> The default text search configuration will be <span class="token keyword">set</span> to <span class="token string">&quot;english&quot;</span><span class="token keyword">.</span>

web_1  <span class="token operator">|</span> Performing system checks<span class="token punctuation">..</span>.
web_1  <span class="token operator">|</span>
web_1  <span class="token operator">|</span> System check identified no issues <span class="token punctuation">(</span>0 silenced<span class="token punctuation">)</span>.
web_1  <span class="token operator">|</span>
web_1  <span class="token operator">|</span> November 23, 2017 - 06:21:19
web_1  <span class="token operator">|</span> Django version 1.11.7, using settings <span class="token string">'django_example.settings'</span>
web_1  <span class="token operator">|</span> Starting development server at http://0.0.0.0:8000/
web_1  <span class="token operator">|</span> Quit the server with CONTROL-C.
</code></pre></div><p>这个 <code>Django</code> 应用已经开始在你的 Docker 守护进程里监听着 <code>8000</code> 端口了。打开 <code>127.0.0.1:8000</code> 即可看到 <code>Django</code> 欢迎页面。</p> <p>你还可以在 Docker 上运行其它的管理命令，例如对于同步数据库结构这种事，在运行完 <code>docker-compose up</code> 后，在另外一个终端进入文件夹运行以下命令即可：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ docker-compose run web python manage.py syncdb
</code></pre></div><h2 id="使用-rails"><a href="#使用-rails" aria-hidden="true" class="header-anchor">#</a> 使用 Rails</h2> <p>本小节内容适合 <code>Ruby</code> 开发人员阅读。</p> <p>我们现在将使用 <code>Compose</code> 配置并运行一个 <code>Rails/PostgreSQL</code> 应用。</p> <p>在一切工作开始前，需要先设置好三个必要的文件。</p> <p>首先，因为应用将要运行在一个满足所有环境依赖的 Docker 容器里面，那么我们可以通过编辑 <code>Dockerfile</code> 文件来指定 Docker 容器要安装内容。内容如下：</p> <div class="language-dockerfile extra-class"><pre class="language-text"><code>FROM ruby
RUN apt-get update -qq &amp;&amp; apt-get install -y build-essential libpq-dev
RUN mkdir /myapp
WORKDIR /myapp
ADD Gemfile /myapp/Gemfile
RUN bundle install
ADD . /myapp
</code></pre></div><p>以上内容指定应用将使用安装了 Ruby、Bundler 以及其依赖件的镜像。更多关于如何编写 Dockerfile 文件的信息可以查看 <a href="https://yeasy.gitbooks.io/docker_practice/image/create.md#%E5%88%A9%E7%94%A8%20Dockerfile%20%E6%9D%A5%E5%88%9B%E5%BB%BA%E9%95%9C%E5%83%8F" target="_blank" rel="noopener noreferrer">镜像创建<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 和 <a href="https://yeasy.gitbooks.io/docker_practice/dockerfile/README.md" target="_blank" rel="noopener noreferrer">Dockerfile 使用<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。 下一步，我们需要一个引导加载 Rails 的文件 <code>Gemfile</code> 。 等一会儿它还会被 <code>rails new</code> 命令覆盖重写。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">source</span> <span class="token string">'https://rubygems.org'</span>
gem <span class="token string">'rails'</span>, <span class="token string">'4.0.2'</span>
</code></pre></div><p>最后，<code>docker-compose.yml</code> 文件才是最神奇的地方。 <code>docker-compose.yml</code> 文件将把所有的东西关联起来。它描述了应用的构成（一个 web 服务和一个数据库）、每个镜像的来源（数据库运行在使用预定义的 PostgreSQL 镜像，web 应用侧将从本地目录创建）、镜像之间的连接，以及服务开放的端口。</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&quot;3&quot;</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>

  <span class="token key atrule">db</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> postgres
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;5432&quot;</span>

  <span class="token key atrule">web</span><span class="token punctuation">:</span>
    <span class="token key atrule">build</span><span class="token punctuation">:</span> .
    <span class="token key atrule">command</span><span class="token punctuation">:</span> bundle exec rackup <span class="token punctuation">-</span>p 3000
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> .<span class="token punctuation">:</span>/myapp
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;3000:3000&quot;</span>
    <span class="token key atrule">links</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> db
</code></pre></div><p>所有文件就绪后，我们就可以通过使用 <code>docker-compose run</code> 命令生成应用的骨架了。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ docker-compose run web rails new <span class="token keyword">.</span> --force --database<span class="token operator">=</span>postgresql --skip-bundle
</code></pre></div><p><code>Compose</code> 会先使用 <code>Dockerfile</code> 为 web 服务创建一个镜像，接着使用这个镜像在容器里运行 <code>rails new</code>和它之后的命令。一旦这个命令运行完后，应该就可以看一个崭新的应用已经生成了。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">ls</span>
Dockerfile   app          docker-compose.yml      tmp
Gemfile      bin          lib          vendor
Gemfile.lock condocker-compose       log
README.rdoc  condocker-compose.ru    public
Rakefile     db           <span class="token function">test</span>
</code></pre></div><p>在新的 <code>Gemfile</code> 文件去掉加载 <code>therubyracer</code> 的行的注释，这样我们便可以使用 Javascript 运行环境：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>gem <span class="token string">'therubyracer'</span>, platforms: :ruby
</code></pre></div><p>现在我们已经有一个新的 <code>Gemfile</code> 文件，需要再重新创建镜像。（这个会步骤会改变 Dockerfile 文件本身，所以需要重建一次）。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ docker-compose build
</code></pre></div><p>应用现在就可以启动了，但配置还未完成。Rails 默认读取的数据库目标是 <code>localhost</code> ，我们需要手动指定容器的 <code>db</code> 。同样的，还需要把用户名修改成和 postgres 镜像预定的一致。 打开最新生成的 <code>database.yml</code> 文件。用以下内容替换：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>development: <span class="token operator">&amp;</span>default
  adapter: postgresql
  encoding: unicode
  database: postgres
  pool: 5
  username: postgres
  password:
  host: db

test:
  <span class="token operator">&lt;&lt;</span>: *default
  database: myapp_test
</code></pre></div><p>现在就可以启动应用了。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ docker-compose up
</code></pre></div><p>如果一切正常，你应该可以看到 PostgreSQL 的输出，几秒后可以看到这样的重复信息：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>myapp_web_1 <span class="token operator">|</span> <span class="token punctuation">[</span>2014-01-17 17:16:29<span class="token punctuation">]</span> INFO  WEBrick 1.3.1
myapp_web_1 <span class="token operator">|</span> <span class="token punctuation">[</span>2014-01-17 17:16:29<span class="token punctuation">]</span> INFO  ruby 2.0.0 <span class="token punctuation">(</span>2013-11-22<span class="token punctuation">)</span> <span class="token punctuation">[</span>x86_64-linux-gnu<span class="token punctuation">]</span>
myapp_web_1 <span class="token operator">|</span> <span class="token punctuation">[</span>2014-01-17 17:16:29<span class="token punctuation">]</span> INFO  WEBrick::HTTPServer<span class="token comment">#start: pid=1 port=3000</span>
</code></pre></div><p>最后， 我们需要做的是创建数据库，打开另一个终端，运行：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ docker-compose run web rake db:create
</code></pre></div><p>这个 web 应用已经开始在你的 docker 守护进程里面监听着 3000 端口了。</p></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新：: </span> <span class="time">1/14/2019, 7:10:06 PM</span></div></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/cloud/Docker/AdvancedNetwork.html" class="prev">
          高级网络配置
        </a></span> <span class="next"><a href="/cloud/Docker/machine.html">
          Docker 三剑客之 Docker Machine
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/app.1a189f9b.js" defer></script><script src="/assets/js/49.9746f461.js" defer></script>
  </body>
</html>
