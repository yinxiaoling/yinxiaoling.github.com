<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Kubernetes | Hsiao Lin</title>
    <meta name="description" content="Programer &amp; WOWER">
    <link rel="icon" href="/pig32.png">
    
    <link rel="preload" href="/assets/css/0.styles.bd66f28f.css" as="style"><link rel="preload" href="/assets/js/app.2fb9186c.js" as="script"><link rel="preload" href="/assets/js/46.08775f3f.js" as="script"><link rel="prefetch" href="/assets/js/10.e27fdfac.js"><link rel="prefetch" href="/assets/js/11.3ea00440.js"><link rel="prefetch" href="/assets/js/12.62932613.js"><link rel="prefetch" href="/assets/js/13.5145e463.js"><link rel="prefetch" href="/assets/js/14.6bdbabb2.js"><link rel="prefetch" href="/assets/js/15.2888418d.js"><link rel="prefetch" href="/assets/js/16.2489649d.js"><link rel="prefetch" href="/assets/js/17.cea64679.js"><link rel="prefetch" href="/assets/js/18.19498227.js"><link rel="prefetch" href="/assets/js/19.680cf6b0.js"><link rel="prefetch" href="/assets/js/2.7d83e6da.js"><link rel="prefetch" href="/assets/js/20.b95ae87c.js"><link rel="prefetch" href="/assets/js/21.41418a87.js"><link rel="prefetch" href="/assets/js/22.2ba13446.js"><link rel="prefetch" href="/assets/js/23.b943d91c.js"><link rel="prefetch" href="/assets/js/24.163fa2e8.js"><link rel="prefetch" href="/assets/js/25.3d56a82a.js"><link rel="prefetch" href="/assets/js/26.9a784c2a.js"><link rel="prefetch" href="/assets/js/27.affb8e55.js"><link rel="prefetch" href="/assets/js/28.d00ead39.js"><link rel="prefetch" href="/assets/js/29.18e49042.js"><link rel="prefetch" href="/assets/js/3.68587e58.js"><link rel="prefetch" href="/assets/js/30.21761cf8.js"><link rel="prefetch" href="/assets/js/31.f33beaa5.js"><link rel="prefetch" href="/assets/js/32.b8dfc397.js"><link rel="prefetch" href="/assets/js/33.c0b63ed5.js"><link rel="prefetch" href="/assets/js/34.6796c93f.js"><link rel="prefetch" href="/assets/js/35.780d5aa6.js"><link rel="prefetch" href="/assets/js/36.4e8e1132.js"><link rel="prefetch" href="/assets/js/37.2955f7d4.js"><link rel="prefetch" href="/assets/js/38.bb2ed940.js"><link rel="prefetch" href="/assets/js/39.3f4252e0.js"><link rel="prefetch" href="/assets/js/4.e5ec2def.js"><link rel="prefetch" href="/assets/js/40.150a1ee6.js"><link rel="prefetch" href="/assets/js/41.0cf7c325.js"><link rel="prefetch" href="/assets/js/42.a0fd4f1f.js"><link rel="prefetch" href="/assets/js/43.603f182c.js"><link rel="prefetch" href="/assets/js/44.5c5b88d4.js"><link rel="prefetch" href="/assets/js/45.5da15ab7.js"><link rel="prefetch" href="/assets/js/47.4110f0e4.js"><link rel="prefetch" href="/assets/js/48.6cfa5161.js"><link rel="prefetch" href="/assets/js/49.983714b6.js"><link rel="prefetch" href="/assets/js/5.dd2f6f9c.js"><link rel="prefetch" href="/assets/js/50.44555e8e.js"><link rel="prefetch" href="/assets/js/51.3cb4ef82.js"><link rel="prefetch" href="/assets/js/52.0343de1c.js"><link rel="prefetch" href="/assets/js/53.9006fa70.js"><link rel="prefetch" href="/assets/js/54.f5febb10.js"><link rel="prefetch" href="/assets/js/6.b9d02d3e.js"><link rel="prefetch" href="/assets/js/7.714e5d46.js"><link rel="prefetch" href="/assets/js/8.ee5067e0.js"><link rel="prefetch" href="/assets/js/9.30d87c06.js">
    <link rel="stylesheet" href="/assets/css/0.styles.bd66f28f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Hsiao Lin</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">架构</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/architect/OAuth2/" class="nav-link">OAuth2</a></li><li class="dropdown-item"><!----> <a href="/architect/ELK/" class="nav-link">ELK</a></li></ul></div></div><div class="nav-item"><a href="/algorithm/" class="nav-link">算法</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Java/Java/" class="nav-link">Java</a></li><li class="dropdown-item"><!----> <a href="/Java/Spring/" class="nav-link">Spring</a></li><li class="dropdown-item"><!----> <a href="/Java/SpringBoot/" class="nav-link">SpringBoot</a></li><li class="dropdown-item"><!----> <a href="/Java/SpringCloud/" class="nav-link">SpringCloud</a></li><li class="dropdown-item"><!----> <a href="/Java/MyBatis/" class="nav-link">MyBatis</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">JavaScript</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/JavaScript/JavaScript/" class="nav-link">JavaScript</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/TypeScript/" class="nav-link">TypeScript</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/Nodejs/" class="nav-link">Node.js</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/Vue/" class="nav-link">Vue</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/React/" class="nav-link">React</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/Angular/" class="nav-link">Angular</a></li></ul></div></div><div class="nav-item"><a href="/BigData/" class="nav-link">BigData</a></div><div class="nav-item"><a href="/AI/" class="nav-link">AI</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Cloud</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/cloud/Docker/" class="nav-link router-link-active">Docker</a></li><li class="dropdown-item"><!----> <a href="/cloud/Kubernetes/" class="nav-link">Kubernetes</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/yinxiaoling" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">架构</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/architect/OAuth2/" class="nav-link">OAuth2</a></li><li class="dropdown-item"><!----> <a href="/architect/ELK/" class="nav-link">ELK</a></li></ul></div></div><div class="nav-item"><a href="/algorithm/" class="nav-link">算法</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Java/Java/" class="nav-link">Java</a></li><li class="dropdown-item"><!----> <a href="/Java/Spring/" class="nav-link">Spring</a></li><li class="dropdown-item"><!----> <a href="/Java/SpringBoot/" class="nav-link">SpringBoot</a></li><li class="dropdown-item"><!----> <a href="/Java/SpringCloud/" class="nav-link">SpringCloud</a></li><li class="dropdown-item"><!----> <a href="/Java/MyBatis/" class="nav-link">MyBatis</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">JavaScript</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/JavaScript/JavaScript/" class="nav-link">JavaScript</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/TypeScript/" class="nav-link">TypeScript</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/Nodejs/" class="nav-link">Node.js</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/Vue/" class="nav-link">Vue</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/React/" class="nav-link">React</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/Angular/" class="nav-link">Angular</a></li></ul></div></div><div class="nav-item"><a href="/BigData/" class="nav-link">BigData</a></div><div class="nav-item"><a href="/AI/" class="nav-link">AI</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Cloud</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/cloud/Docker/" class="nav-link router-link-active">Docker</a></li><li class="dropdown-item"><!----> <a href="/cloud/Kubernetes/" class="nav-link">Kubernetes</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/yinxiaoling" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/cloud/Docker/BasicConcepts.html" class="sidebar-link">Docker基本概念</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/BasicConcepts.html#docker-镜像" class="sidebar-link">Docker 镜像</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/BasicConcepts.html#docker-容器" class="sidebar-link">Docker 容器</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/BasicConcepts.html#docker-registry" class="sidebar-link">Docker Registry</a></li></ul></li><li><a href="/cloud/Docker/Install.html" class="sidebar-link">安装 Docker</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/Install.html#centos-安装-docker-ce" class="sidebar-link">CentOS 安装 Docker CE</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Install.html#macos-安装-docker" class="sidebar-link">MacOS 安装 Docker</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Install.html#windows-10-pc-安装-docker-ce" class="sidebar-link">Windows 10 PC 安装 Docker CE</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Install.html#ubuntu-安装-docker-ce" class="sidebar-link">Ubuntu 安装 Docker CE</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Install.html#debian-安装-docker-ce" class="sidebar-link">Debian 安装 Docker CE</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Install.html#镜像加速器" class="sidebar-link">镜像加速器</a></li></ul></li><li><a href="/cloud/Docker/UseImage.html" class="sidebar-link">使用 Docker 镜像</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#获取镜像" class="sidebar-link">获取镜像</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#列出镜像" class="sidebar-link">列出镜像</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#删除本地镜像" class="sidebar-link">删除本地镜像</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#利用-commit-理解镜像构成" class="sidebar-link">利用 commit 理解镜像构成</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#使用-dockerfile-定制镜像" class="sidebar-link">使用 Dockerfile 定制镜像</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#dockerfile-指令详解" class="sidebar-link">Dockerfile 指令详解</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#多阶段构建" class="sidebar-link">多阶段构建</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#实战多阶段构建-laravel-镜像" class="sidebar-link">实战多阶段构建 Laravel 镜像</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#其它制作镜像的方式" class="sidebar-link">其它制作镜像的方式</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#镜像的实现原理" class="sidebar-link">镜像的实现原理</a></li></ul></li><li><a href="/cloud/Docker/UseContainer.html" class="sidebar-link">操作 Docker 容器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/UseContainer.html#启动容器" class="sidebar-link">启动容器</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseContainer.html#后台运行" class="sidebar-link">后台运行</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseContainer.html#终止容器" class="sidebar-link">终止容器</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseContainer.html#进入容器" class="sidebar-link">进入容器</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseContainer.html#导出和导入容器" class="sidebar-link">导出和导入容器</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseContainer.html#删除容器" class="sidebar-link">删除容器</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseContainer.html#清理所有处于终止状态的容器" class="sidebar-link">清理所有处于终止状态的容器</a></li></ul></li><li><a href="/cloud/Docker/InterviewRegistry.html" class="sidebar-link">访问仓库</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/InterviewRegistry.html#docker-hub" class="sidebar-link">Docker Hub</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/InterviewRegistry.html#私有仓库" class="sidebar-link">私有仓库</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/InterviewRegistry.html#私有仓库高级配置" class="sidebar-link">私有仓库高级配置</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/InterviewRegistry.html#nexus3-x-的私有仓库" class="sidebar-link">Nexus3.x 的私有仓库</a></li></ul></li><li><a href="/cloud/Docker/DataManager.html" class="sidebar-link">Docker 数据管理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/DataManager.html#数据卷" class="sidebar-link">数据卷</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/DataManager.html#挂载主机目录" class="sidebar-link">挂载主机目录</a></li></ul></li><li><a href="/cloud/Docker/Network.html" class="sidebar-link">Docker 中的网络功能介绍</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/Network.html#外部访问容器" class="sidebar-link">外部访问容器</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Network.html#容器互联" class="sidebar-link">容器互联</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Network.html#配置-dns" class="sidebar-link">配置 DNS</a></li></ul></li><li><a href="/cloud/Docker/AdvancedNetwork.html" class="sidebar-link">高级网络配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/AdvancedNetwork.html#快速配置指南" class="sidebar-link">快速配置指南</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/AdvancedNetwork.html#容器访问控制" class="sidebar-link">容器访问控制</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/AdvancedNetwork.html#映射容器端口到宿主主机的实现" class="sidebar-link">映射容器端口到宿主主机的实现</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/AdvancedNetwork.html#配置-docker0-网桥" class="sidebar-link">配置 docker0 网桥</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/AdvancedNetwork.html#自定义网桥" class="sidebar-link">自定义网桥</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/AdvancedNetwork.html#工具和示例" class="sidebar-link">工具和示例</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/AdvancedNetwork.html#编辑网络配置文件" class="sidebar-link">编辑网络配置文件</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/AdvancedNetwork.html#示例：创建一个点到点连接" class="sidebar-link">示例：创建一个点到点连接</a></li></ul></li><li><a href="/cloud/Docker/compose.html" class="sidebar-link">Docker 三剑客之 Docker Compose</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/compose.html#compose-简介" class="sidebar-link">Compose 简介</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/compose.html#安装与卸载" class="sidebar-link">安装与卸载</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/compose.html#使用" class="sidebar-link">使用</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/compose.html#compose-命令说明" class="sidebar-link">Compose 命令说明</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/compose.html#compose-模板文件" class="sidebar-link">Compose 模板文件</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/compose.html#使用-django" class="sidebar-link">使用 Django</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/compose.html#使用-rails" class="sidebar-link">使用 Rails</a></li></ul></li><li><a href="/cloud/Docker/machine.html" class="sidebar-link">Docker 三剑客之 Docker Machine</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/machine.html#安装" class="sidebar-link">安装</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/machine.html#使用" class="sidebar-link">使用</a></li></ul></li><li><a href="/cloud/Docker/swarm.html" class="sidebar-link">Docker 三剑客之 Docker Swarm</a></li><li><a href="/cloud/Docker/swarm_mode.html" class="sidebar-link">Swarm mode</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/swarm_mode.html#基本概念" class="sidebar-link">基本概念</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/swarm_mode.html#创建-swarm-集群" class="sidebar-link">创建 Swarm 集群</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/swarm_mode.html#部署服务" class="sidebar-link">部署服务</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/swarm_mode.html#在-swarm-集群中使用-compose-文件" class="sidebar-link">在 Swarm 集群中使用 compose 文件</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/swarm_mode.html#在-swarm-集群中管理敏感数据" class="sidebar-link">在 Swarm 集群中管理敏感数据</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/swarm_mode.html#在-swarm-集群中管理配置数据" class="sidebar-link">在 Swarm 集群中管理配置数据</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/swarm_mode.html#swarm-mode-与滚动升级" class="sidebar-link">SWarm mode 与滚动升级</a></li></ul></li><li><a href="/cloud/Docker/Security.html" class="sidebar-link">安全</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/Security.html#内核命名空间" class="sidebar-link">内核命名空间</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Security.html#控制组" class="sidebar-link">控制组</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Security.html#docker服务端的防护" class="sidebar-link">Docker服务端的防护</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Security.html#内核能力机制" class="sidebar-link">内核能力机制</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Security.html#其它安全特性" class="sidebar-link">其它安全特性</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Security.html#总结" class="sidebar-link">总结</a></li></ul></li><li><a href="/cloud/Docker/underly.html" class="sidebar-link">底层实现</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/underly.html#基本架构" class="sidebar-link">基本架构</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/underly.html#命名空间" class="sidebar-link">命名空间</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/underly.html#控制组" class="sidebar-link">控制组</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/underly.html#联合文件系统" class="sidebar-link">联合文件系统</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/underly.html#容器格式" class="sidebar-link">容器格式</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/underly.html#docker-网络实现" class="sidebar-link">Docker 网络实现</a></li></ul></li><li><a href="/cloud/Docker/etcd.html" class="sidebar-link">Etcd 项目</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/etcd.html#什么是-etcd" class="sidebar-link">什么是 etcd</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/etcd.html#安装" class="sidebar-link">安装</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/etcd.html#etcd-集群" class="sidebar-link">etcd 集群</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/etcd.html#使用-etcdctl" class="sidebar-link">使用 etcdctl</a></li></ul></li><li><a href="/cloud/Docker/coreos.html" class="sidebar-link">CoreOS 项目</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/coreos.html#coreos-介绍" class="sidebar-link">CoreOS 介绍</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/coreos.html#coreos-特性" class="sidebar-link">CoreOS 特性</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/coreos.html#coreos-工具介绍" class="sidebar-link">CoreOS 工具介绍</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/coreos.html#快速搭建-coreos-集群" class="sidebar-link">快速搭建 CoreOS 集群</a></li></ul></li><li><a href="/cloud/Docker/kubernetes.html" class="active sidebar-link">Kubernetes</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/kubernetes.html#项目简介" class="sidebar-link">项目简介</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/kubernetes.html#快速上手" class="sidebar-link">快速上手</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/kubernetes.html#基本概念" class="sidebar-link">基本概念</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/kubernetes.html#kubectl-使用" class="sidebar-link">kubectl 使用</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/kubernetes.html#基本架构" class="sidebar-link">基本架构</a></li></ul></li><li><a href="/cloud/Docker/mesos.html" class="sidebar-link">Mesos - 优秀的集群资源调度平台</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/mesos.html#简介" class="sidebar-link">简介</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/mesos.html#mesos-安装与使用" class="sidebar-link">Mesos 安装与使用</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/mesos.html#原理与架构" class="sidebar-link">原理与架构</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/mesos.html#mesos-配置项解析" class="sidebar-link">Mesos 配置项解析</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/mesos.html#日志与监控" class="sidebar-link">日志与监控</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/mesos.html#常见应用框架" class="sidebar-link">常见应用框架</a></li></ul></li><li><a href="/cloud/Docker/cases_os.html" class="sidebar-link">实战-操作系统</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/cases_os.html#busybox" class="sidebar-link">Busybox</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/cases_os.html#alpine" class="sidebar-link">Alpine</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/cases_os.html#debian-ubuntu" class="sidebar-link">Debian/Ubuntu</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/cases_os.html#centos-fedora" class="sidebar-link">CentOS/Fedora</a></li></ul></li><li><a href="/cloud/Docker/cases_cicd.html" class="sidebar-link">实战-CI/CD</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/cases_cicd.html#drone" class="sidebar-link">Drone</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/cases_cicd.html#参考链接" class="sidebar-link">参考链接</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/cases_cicd.html#在-travis-ci-中使用-docker" class="sidebar-link">在 Travis CI 中使用 Docker</a></li></ul></li><li><a href="/cloud/Docker/opensource.html" class="sidebar-link">Docker 开源项目</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/opensource.html#linuxkit" class="sidebar-link">LinuxKit</a></li></ul></li><li><a href="/cloud/Docker/appendix.1.html" class="sidebar-link">附录一：常见问题总结</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.1.html#镜像相关" class="sidebar-link">镜像相关</a></li></ul></li><li><a href="/cloud/Docker/appendix.2.html" class="sidebar-link">附录二：热门镜像介绍</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.2.html#ubuntu" class="sidebar-link">Ubuntu</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.2.html#centos" class="sidebar-link">CentOS</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.2.html#nginx" class="sidebar-link">Nginx</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.2.html#mysql" class="sidebar-link">MySQL</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.2.html#mongodb" class="sidebar-link">MongoDB</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.2.html#redis" class="sidebar-link">Redis</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.2.html#node-js" class="sidebar-link">Node.js</a></li></ul></li><li><a href="/cloud/Docker/appendix.3.html" class="sidebar-link">附录三：Docker 命令查询</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.3.html#基本语法" class="sidebar-link">基本语法</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.3.html#客户端命令选项" class="sidebar-link">客户端命令选项</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.3.html#dockerd-命令选项" class="sidebar-link">dockerd 命令选项</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.3.html#客户端命令" class="sidebar-link">客户端命令</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.3.html#一张图总结-docker-的命令" class="sidebar-link">一张图总结 Docker 的命令</a></li></ul></li><li><a href="/cloud/Docker/appendix.4.html" class="sidebar-link">附录四：Dockerfile 最佳实践</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.4.html#一般性的指南和建议" class="sidebar-link">一般性的指南和建议</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.4.html#dockerfile-指令" class="sidebar-link">Dockerfile 指令</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.4.html#官方镜像示例" class="sidebar-link">官方镜像示例</a></li></ul></li><li><a href="/cloud/Docker/appendix.5.html" class="sidebar-link">附录五：如何调试 Docker</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.5.html#开启-debug-模式" class="sidebar-link">开启 Debug 模式</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.5.html#检查内核日志" class="sidebar-link">检查内核日志</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.5.html#docker-不响应时处理" class="sidebar-link">Docker 不响应时处理</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.5.html#重置-docker-本地数据" class="sidebar-link">重置 Docker 本地数据</a></li></ul></li><li><a href="/cloud/Docker/appendix.6.html" class="sidebar-link">附录六：资源链接</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.6.html#官方网站" class="sidebar-link">官方网站</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.6.html#实践参考" class="sidebar-link">实践参考</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.6.html#技术交流" class="sidebar-link">技术交流</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.6.html#其它" class="sidebar-link">其它</a></li></ul></li></ul> </div> <div class="page"> <div class="content"><h1 id="kubernetes"><a href="#kubernetes" aria-hidden="true" class="header-anchor">#</a> Kubernetes</h1> <p><code>Kubernetes</code> 是 Google 团队发起并维护的基于 Docker 的开源容器集群管理系统，它不仅支持常见的云平台，而且支持内部数据中心。</p> <p>建于 Docker 之上的 <code>Kubernetes</code> 可以构建一个容器的调度服务，其目的是让用户透过 <code>Kubernetes</code> 集群来进行云端容器集群的管理，而无需用户进行复杂的设置工作。系统会自动选取合适的工作节点来执行具体的容器集群调度处理工作。其核心概念是 <code>Container Pod</code>。一个 <code>Pod</code> 由一组工作于同一物理工作节点的容器构成。这些组容器拥有相同的网络命名空间、IP以及存储配额，也可以根据实际情况对每一个 <code>Pod</code> 进行端口映射。此外，<code>Kubernetes</code> 工作节点会由主系统进行管理，节点包含了能够运行 Docker 容器所用到的服务。</p> <p>本章将分为 5 节介绍 <code>Kubernetes</code>，包括</p> <ul><li>项目简介</li> <li>快速入门</li> <li>基本概念</li> <li>实践例子</li> <li>架构分析等高级话题</li></ul> <h2 id="项目简介"><a href="#项目简介" aria-hidden="true" class="header-anchor">#</a> 项目简介</h2> <p><img src="https://yeasy.gitbooks.io/docker_practice/kubernetes/_images/kubernetes_logo.png" alt="img"></p> <p>Kubernetes 是 Google 团队发起的开源项目，它的目标是管理跨多个主机的容器，提供基本的部署，维护以及运用伸缩，主要实现语言为 Go 语言。Kubernetes 是：</p> <ul><li>易学：轻量级，简单，容易理解</li> <li>便携：支持公有云，私有云，混合云，以及多种云平台</li> <li>可拓展：模块化，可插拔，支持钩子，可任意组合</li> <li>自修复：自动重调度，自动重启，自动复制</li></ul> <p>Kubernetes 构建于 Google 数十年经验，一大半来源于 Google 生产环境规模的经验。结合了社区最佳的想法和实践。</p> <p>在分布式系统中，部署，调度，伸缩一直是最为重要的也最为基础的功能。Kubernetes 就是希望解决这一序列问题的。</p> <p>Kubernetes 目前在<a href="https://github.com/kubernetes/kubernetes" target="_blank" rel="noopener noreferrer">GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>进行维护。</p> <h3 id="kubernetes-能够运行在任何地方！"><a href="#kubernetes-能够运行在任何地方！" aria-hidden="true" class="header-anchor">#</a> Kubernetes 能够运行在任何地方！</h3> <p>虽然 Kubernetes 最初是为 GCE 定制的，但是在后续版本中陆续增加了其他云平台的支持，以及本地数据中心的支持。</p> <h2 id="快速上手"><a href="#快速上手" aria-hidden="true" class="header-anchor">#</a> 快速上手</h2> <p>目前，Kubernetes 支持在多种环境下的安装，包括本地主机（Fedora）、云服务（Google GAE、AWS 等）。然而最快速体验 Kubernetes 的方式显然是本地通过 Docker 的方式来启动相关进程。</p> <p>下图展示了在单节点使用 Docker 快速部署一套 Kubernetes 的拓扑。</p> <p><img src="https://yeasy.gitbooks.io/docker_practice/kubernetes/_images/k8s-singlenode-docker.png" alt="在 Docker 中启动 Kubernetes">图 1.21.2.1 - 在 Docker 中启动 Kubernetes</p> <p>Kubernetes 依赖 Etcd 服务来维护所有主节点的状态。</p> <h3 id="启动-etcd-服务。"><a href="#启动-etcd-服务。" aria-hidden="true" class="header-anchor">#</a> 启动 Etcd 服务。</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>docker run --net<span class="token operator">=</span>host -d gcr.io/google_containers/etcd:2.0.9 /usr/local/bin/etcd --addr<span class="token operator">=</span>127.0.0.1:4001 --bind-addr<span class="token operator">=</span>0.0.0.0:4001 --data-dir<span class="token operator">=</span>/var/etcd/data
</code></pre></div><h3 id="启动主节点"><a href="#启动主节点" aria-hidden="true" class="header-anchor">#</a> 启动主节点</h3> <p>启动 kubelet。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>docker run --net<span class="token operator">=</span>host -d -v /var/run/docker.sock:/var/run/docker.sock  gcr.io/google_containers/hyperkube:v0.17.0 /hyperkube kubelet --api_servers<span class="token operator">=</span>http://localhost:8080 --v<span class="token operator">=</span>2 --address<span class="token operator">=</span>0.0.0.0 --enable_server --hostname_override<span class="token operator">=</span>127.0.0.1 --config<span class="token operator">=</span>/etc/kubernetes/manifests
</code></pre></div><h3 id="启动服务代理"><a href="#启动服务代理" aria-hidden="true" class="header-anchor">#</a> 启动服务代理</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>docker run -d --net<span class="token operator">=</span>host --privileged gcr.io/google_containers/hyperkube:v0.17.0 /hyperkube proxy --master<span class="token operator">=</span>http://127.0.0.1:8080 --v<span class="token operator">=</span>2
</code></pre></div><h3 id="测试状态"><a href="#测试状态" aria-hidden="true" class="header-anchor">#</a> 测试状态</h3> <p>在本地访问 <code>8080</code> 端口，可以获取到如下的结果：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">curl</span> 127.0.0.1:8080
<span class="token punctuation">{</span>
  <span class="token string">&quot;paths&quot;</span><span class="token keyword">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;/api&quot;</span>,
    <span class="token string">&quot;/api/v1beta1&quot;</span>,
    <span class="token string">&quot;/api/v1beta2&quot;</span>,
    <span class="token string">&quot;/api/v1beta3&quot;</span>,
    <span class="token string">&quot;/healthz&quot;</span>,
    <span class="token string">&quot;/healthz/ping&quot;</span>,
    <span class="token string">&quot;/logs/&quot;</span>,
    <span class="token string">&quot;/metrics&quot;</span>,
    <span class="token string">&quot;/static/&quot;</span>,
    <span class="token string">&quot;/swagger-ui/&quot;</span>,
    <span class="token string">&quot;/swaggerapi/&quot;</span>,
    <span class="token string">&quot;/validate&quot;</span>,
    <span class="token string">&quot;/version&quot;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="查看服务"><a href="#查看服务" aria-hidden="true" class="header-anchor">#</a> 查看服务</h3> <p>所有服务启动后，查看本地实际运行的 Docker 容器，有如下几个。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>CONTAINER ID        IMAGE                                        COMMAND                CREATED             STATUS              PORTS               NAMES
ee054db2516c        gcr.io/google_containers/hyperkube:v0.17.0   <span class="token string">&quot;/hyperkube schedule   2 days ago          Up 1 days                               k8s_scheduler.509f29c9_k8s-master-127.0.0.1_default_9941e5170b4365bd4aa91f122ba0c061_e97037f5
3b0f28de07a2        gcr.io/google_containers/hyperkube:v0.17.0   &quot;</span>/hyperkube apiserve   2 days ago          Up 1 days                               k8s_apiserver.245e44fa_k8s-master-127.0.0.1_default_9941e5170b4365bd4aa91f122ba0c061_6ab5c23d
2eaa44ecdd8e        gcr.io/google_containers/hyperkube:v0.17.0   <span class="token string">&quot;/hyperkube controll   2 days ago          Up 1 days                               k8s_controller-manager.33f83d43_k8s-master-127.0.0.1_default_9941e5170b4365bd4aa91f122ba0c061_1a60106f
30aa7163cbef        gcr.io/google_containers/hyperkube:v0.17.0   &quot;</span>/hyperkube proxy --   2 days ago          Up 1 days                               jolly_davinci
a2f282976d91        gcr.io/google_containers/pause:0.8.0         <span class="token string">&quot;/pause&quot;</span>               2 days ago          Up 2 days                               k8s_POD.e4cc795_k8s-master-127.0.0.1_default_9941e5170b4365bd4aa91f122ba0c061_e8085b1f
c060c52acc36        gcr.io/google_containers/hyperkube:v0.17.0   <span class="token string">&quot;/hyperkube kubelet    2 days ago          Up 1 days                               serene_nobel
cc3cd263c581        gcr.io/google_containers/etcd:2.0.9          &quot;</span>/usr/local/bin/etcd   2 days ago          Up 1 days                               happy_turing
</code></pre></div><p>这些服务大概分为三类：主节点服务、工作节点服务和其它服务。</p> <h4 id="主节点服务"><a href="#主节点服务" aria-hidden="true" class="header-anchor">#</a> 主节点服务</h4> <ul><li><code>apiserver</code> 是整个系统的对外接口，提供 RESTful 方式供客户端和其它组件调用；</li> <li><code>scheduler</code> 负责对资源进行调度，分配某个 pod 到某个节点上；</li> <li><code>controller-manager</code> 负责管理控制器，包括 endpoint-controller（刷新服务和 pod 的关联信息）和 replication-controller（维护某个 pod 的复制为配置的数值）。</li></ul> <h4 id="工作节点服务"><a href="#工作节点服务" aria-hidden="true" class="header-anchor">#</a> 工作节点服务</h4> <ul><li><code>kubelet</code> 是工作节点执行操作的 agent，负责具体的容器生命周期管理，根据从数据库中获取的信息来管理容器，并上报 pod 运行状态等；</li> <li><code>proxy</code> 为 pod 上的服务提供访问的代理。</li></ul> <h4 id="其它服务"><a href="#其它服务" aria-hidden="true" class="header-anchor">#</a> 其它服务</h4> <ul><li>Etcd 是所有状态的存储数据库；</li> <li><code>gcr.io/google_containers/pause:0.8.0</code> 是 Kubernetes 启动后自动 pull 下来的测试镜像。</li></ul> <h2 id="基本概念"><a href="#基本概念" aria-hidden="true" class="header-anchor">#</a> 基本概念</h2> <p><img src="https://yeasy.gitbooks.io/docker_practice/kubernetes/_images/kubernetes_design.jpg" alt="img"></p> <ul><li>节点（<code>Node</code>）：一个节点是一个运行 Kubernetes 中的主机。</li> <li>容器组（<code>Pod</code>）：一个 Pod 对应于由若干容器组成的一个容器组，同个组内的容器共享一个存储卷(volume)。</li> <li>容器组生命周期（<code>pos-states</code>）：包含所有容器状态集合，包括容器组状态类型，容器组生命周期，事件，重启策略，以及 replication controllers。</li> <li>Replication Controllers：主要负责指定数量的 pod 在同一时间一起运行。</li> <li>服务（<code>services</code>）：一个 Kubernetes 服务是容器组逻辑的高级抽象，同时也对外提供访问容器组的策略。</li> <li>卷（<code>volumes</code>）：一个卷就是一个目录，容器对其有访问权限。</li> <li>标签（<code>labels</code>）：标签是用来连接一组对象的，比如容器组。标签可以被用来组织和选择子对象。</li> <li>接口权限（<code>accessing_the_api</code>）：端口，IP 地址和代理的防火墙规则。</li> <li>web 界面（<code>ux</code>）：用户可以通过 web 界面操作 Kubernetes。</li> <li>命令行操作（<code>cli</code>）：<code>kubecfg</code>命令。</li></ul> <h3 id="节点"><a href="#节点" aria-hidden="true" class="header-anchor">#</a> 节点</h3> <p>在 <code>Kubernetes</code> 中，节点是实际工作的点，节点可以是虚拟机或者物理机器，依赖于一个集群环境。每个节点都有一些必要的服务以运行容器组，并且它们都可以通过主节点来管理。必要服务包括 Docker，kubelet 和代理服务。</p> <h4 id="容器状态"><a href="#容器状态" aria-hidden="true" class="header-anchor">#</a> 容器状态</h4> <p>容器状态用来描述节点的当前状态。现在，其中包含三个信息：</p> <h5 id="主机ip"><a href="#主机ip" aria-hidden="true" class="header-anchor">#</a> 主机IP</h5> <p>主机 IP 需要云平台来查询，<code>Kubernetes</code> 把它作为状态的一部分来保存。如果 <code>Kubernetes</code> 没有运行在云平台上，节点 ID 就是必需的。IP 地址可以变化，并且可以包含多种类型的 IP 地址，如公共 IP，私有 IP，动态 IP，ipv6 等等。</p> <h5 id="节点周期"><a href="#节点周期" aria-hidden="true" class="header-anchor">#</a> 节点周期</h5> <p>通常来说节点有 <code>Pending</code>，<code>Running</code>，<code>Terminated</code> 三个周期，如果 Kubernetes 发现了一个节点并且其可用，那么 Kubernetes 就把它标记为 <code>Pending</code>。然后在某个时刻，Kubernetes 将会标记其为 <code>Running</code>。节点的结束周期称为 <code>Terminated</code>。一个已经 <code>Terminated</code> 的节点不会接受和调度任何请求，并且已经在其上运行的容器组也会删除。</p> <h5 id="节点状态"><a href="#节点状态" aria-hidden="true" class="header-anchor">#</a> 节点状态</h5> <p>节点的状态主要是用来描述处于 <code>Running</code> 的节点。当前可用的有 <code>NodeReachable</code> 和 <code>NodeReady</code>。以后可能会增加其他状态。<code>NodeReachable</code> 表示集群可达。<code>NodeReady</code> 表示 kubelet 返回 Status Ok 并且 HTTP 状态检查健康。</p> <h4 id="节点管理"><a href="#节点管理" aria-hidden="true" class="header-anchor">#</a> 节点管理</h4> <p>节点并非 Kubernetes 创建，而是由云平台创建，或者就是物理机器、虚拟机。在 Kubernetes 中，节点仅仅是一条记录，节点创建之后，Kubernetes 会检查其是否可用。在 Kubernetes 中，节点用如下结构保存：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;10.1.2.3&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;kind&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Minion&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;apiVersion&quot;</span><span class="token operator">:</span> <span class="token string">&quot;v1beta1&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;resources&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;capacity&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;cpu&quot;</span><span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span>
      <span class="token property">&quot;memory&quot;</span><span class="token operator">:</span> <span class="token number">1073741824</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;labels&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;my-first-k8s-node&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Kubernetes 校验节点可用依赖于 ID。在当前的版本中，有两个接口可以用来管理节点：节点控制和 Kube 管理。</p> <h4 id="节点控制"><a href="#节点控制" aria-hidden="true" class="header-anchor">#</a> 节点控制</h4> <p>在 Kubernetes 主节点中，节点控制器是用来管理节点的组件。主要包含：</p> <ul><li>集群范围内节点同步</li> <li>单节点生命周期管理</li></ul> <p>节点控制有一个同步轮寻，主要监听所有云平台的虚拟实例，会根据节点状态创建和删除。可以通过 <code>--node_sync_period</code>标志来控制该轮寻。如果一个实例已经创建，节点控制将会为其创建一个结构。同样的，如果一个节点被删除，节点控制也会删除该结构。在 Kubernetes 启动时可用通过 <code>--machines</code>标记来显示指定节点。同样可以使用 <code>kubectl</code> 来一条一条的添加节点，两者是相同的。通过设置 <code>--sync_nodes=false</code>标记来禁止集群之间的节点同步，你也可以使用 api/kubectl 命令行来增删节点。</p> <h3 id="容器组"><a href="#容器组" aria-hidden="true" class="header-anchor">#</a> 容器组</h3> <p>在 Kubernetes 中，使用的最小单位是容器组，容器组是创建，调度，管理的最小单位。 一个容器组使用相同的 Docker 容器并共享卷（挂载点）。一个容器组是一个特定应用的打包集合，包含一个或多个容器。</p> <p>和运行的容器类似，一个容器组被认为只有很短的运行周期。容器组被调度到一组节点运行，直到容器的生命周期结束或者其被删除。如果节点死掉，运行在其上的容器组将会被删除而不是重新调度。（也许在将来的版本中会添加容器组的移动）。</p> <h4 id="容器组设计的初衷"><a href="#容器组设计的初衷" aria-hidden="true" class="header-anchor">#</a> 容器组设计的初衷</h4> <h4 id="资源共享和通信"><a href="#资源共享和通信" aria-hidden="true" class="header-anchor">#</a> 资源共享和通信</h4> <p>容器组主要是为了数据共享和它们之间的通信。</p> <p>在一个容器组中，容器都使用相同的网络地址和端口，可以通过本地网络来相互通信。每个容器组都有独立的 IP，可用通过网络来和其他物理主机或者容器通信。</p> <p>容器组有一组存储卷（挂载点），主要是为了让容器在重启之后可以不丢失数据。</p> <h4 id="容器组管理"><a href="#容器组管理" aria-hidden="true" class="header-anchor">#</a> 容器组管理</h4> <p>容器组是一个运用管理和部署的高层次抽象，同时也是一组容器的接口。容器组是部署、水平放缩的最小单位。</p> <h4 id="容器组的使用"><a href="#容器组的使用" aria-hidden="true" class="header-anchor">#</a> 容器组的使用</h4> <p>容器组可以通过组合来构建复杂的运用，其本来的意义包含：</p> <ul><li>内容管理，文件和数据加载以及本地缓存管理等。</li> <li>日志和检查点备份，压缩，快照等。</li> <li>监听数据变化，跟踪日志，日志和监控代理，消息发布等。</li> <li>代理，网桥</li> <li>控制器，管理，配置以及更新</li></ul> <h4 id="替代方案"><a href="#替代方案" aria-hidden="true" class="header-anchor">#</a> 替代方案</h4> <p>为什么不在一个单一的容器里运行多个程序？</p> <ul><li>1.透明化。为了使容器组中的容器保持一致的基础设施和服务，比如进程管理和资源监控。这样设计是为了用户的便利性。</li> <li>2.解偶软件之间的依赖。每个容器都可能重新构建和发布，Kubernetes 必须支持热发布和热更新（将来）。</li> <li>3.方便使用。用户不必运行独立的程序管理，也不用担心每个运用程序的退出状态。</li> <li>4.高效。考虑到基础设施有更多的职责，容器必须要轻量化。</li></ul> <h4 id="容器组的生命状态"><a href="#容器组的生命状态" aria-hidden="true" class="header-anchor">#</a> 容器组的生命状态</h4> <p>包括若干状态值：<code>pending</code>、<code>running</code>、<code>succeeded</code>、<code>failed</code>。</p> <h5 id="pending"><a href="#pending" aria-hidden="true" class="header-anchor">#</a> pending</h5> <p>容器组已经被节点接受，但有一个或多个容器还没有运行起来。这将包含某些节点正在下载镜像的时间，这种情形会依赖于网络情况。</p> <h5 id="running"><a href="#running" aria-hidden="true" class="header-anchor">#</a> running</h5> <p>容器组已经被调度到节点，并且所有的容器都已经启动。至少有一个容器处于运行状态（或者处于重启状态）。</p> <h5 id="succeeded"><a href="#succeeded" aria-hidden="true" class="header-anchor">#</a> succeeded</h5> <p>所有的容器都正常退出。</p> <h5 id="failed"><a href="#failed" aria-hidden="true" class="header-anchor">#</a> failed</h5> <p>容器组中所有容器都意外中断了。</p> <h4 id="容器组生命周期"><a href="#容器组生命周期" aria-hidden="true" class="header-anchor">#</a> 容器组生命周期</h4> <p>通常来说，如果容器组被创建了就不会自动销毁，除非被某种行为触发，而触发此种情况可能是人为，或者复制控制器所为。唯一例外的是容器组由 succeeded 状态成功退出，或者在一定时间内重试多次依然失败。</p> <p>如果某个节点死掉或者不能连接，那么节点控制器将会标记其上的容器组的状态为 <code>failed</code>。</p> <p>举例如下。</p> <ul><li><p>容器组状态</p> <div class="language- extra-class"><pre class="language-text"><code>running
</code></pre></div><p>，有 1 容器，容器正常退出</p> <ul><li>记录完成事件</li> <li>如果重启策略为：
<ul><li>始终：重启容器，容器组保持 <code>running</code></li> <li>失败时：容器组变为 <code>succeeded</code></li> <li>从不：容器组变为 <code>succeeded</code></li></ul></li></ul></li> <li><p>容器组状态</p> <div class="language- extra-class"><pre class="language-text"><code>running
</code></pre></div><p>，有1容器，容器异常退出</p> <ul><li>记录失败事件</li> <li>如果重启策略为：
<ul><li>始终：重启容器，容器组保持 <code>running</code></li> <li>失败时：重启容器，容器组保持 <code>running</code></li> <li>从不：容器组变为 <code>failed</code></li></ul></li></ul></li> <li><p>容器组状态</p> <div class="language- extra-class"><pre class="language-text"><code>running
</code></pre></div><p>，有2容器，有1容器异常退出</p> <ul><li><p>记录失败事件</p></li> <li><p>如果重启策略为：</p> <ul><li><p>始终：重启容器，容器组保持 <code>running</code></p></li> <li><p>失败时：重启容器，容器组保持 <code>running</code></p></li> <li><p>从不：容器组保持</p> <div class="language- extra-class"><pre class="language-text"><code>running
</code></pre></div><ul><li>当有2容器退出</li></ul></li> <li><p>记录失败事件</p></li> <li><p>如果重启策略为：</p> <ul><li>始终：重启容器，容器组保持 <code>running</code></li> <li>失败时：重启容器，容器组保持 <code>running</code></li> <li>从不：容器组变为 <code>failed</code></li></ul></li></ul></li></ul></li> <li><p>容器组状态</p> <div class="language- extra-class"><pre class="language-text"><code>running
</code></pre></div><p>，容器内存不足</p> <ul><li>标记容器错误中断</li> <li>记录内存不足事件</li> <li>如果重启策略为：
<ul><li>始终：重启容器，容器组保持 <code>running</code></li> <li>失败时：重启容器，容器组保持 <code>running</code></li> <li>从不：记录错误事件，容器组变为 <code>failed</code></li></ul></li></ul></li> <li><p>容器组状态</p> <div class="language- extra-class"><pre class="language-text"><code>running
</code></pre></div><p>，一块磁盘死掉</p> <ul><li>杀死所有容器</li> <li>记录事件</li> <li>容器组变为 <code>failed</code></li> <li>如果容器组运行在一个控制器下，容器组将会在其他地方重新创建</li></ul></li> <li><p>容器组状态</p> <div class="language- extra-class"><pre class="language-text"><code>running
</code></pre></div><p>，对应的节点段溢出</p> <ul><li>节点控制器等到超时</li> <li>节点控制器标记容器组 <code>failed</code></li> <li>如果容器组运行在一个控制器下，容器组将会在其他地方重新创建</li></ul></li></ul> <h3 id="replication-controllers"><a href="#replication-controllers" aria-hidden="true" class="header-anchor">#</a> Replication Controllers</h3> <h3 id="服务"><a href="#服务" aria-hidden="true" class="header-anchor">#</a> 服务</h3> <h3 id="卷"><a href="#卷" aria-hidden="true" class="header-anchor">#</a> 卷</h3> <h3 id="标签"><a href="#标签" aria-hidden="true" class="header-anchor">#</a> 标签</h3> <h3 id="接口权限"><a href="#接口权限" aria-hidden="true" class="header-anchor">#</a> 接口权限</h3> <h3 id="web界面"><a href="#web界面" aria-hidden="true" class="header-anchor">#</a> web界面</h3> <h3 id="命令行操作"><a href="#命令行操作" aria-hidden="true" class="header-anchor">#</a> 命令行操作</h3> <h2 id="kubectl-使用"><a href="#kubectl-使用" aria-hidden="true" class="header-anchor">#</a> kubectl 使用</h2> <p><a href="https://github.com/kubernetes/kubernetes" target="_blank" rel="noopener noreferrer">kubectl<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 是 Kubernetes 自带的客户端，可以用它来直接操作 Kubernetes。</p> <p>使用格式有两种：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>kubectl <span class="token punctuation">[</span>flags<span class="token punctuation">]</span>
kubectl <span class="token punctuation">[</span>command<span class="token punctuation">]</span>
</code></pre></div><h3 id="get"><a href="#get" aria-hidden="true" class="header-anchor">#</a> get</h3> <p>显示一个或多个资源</p> <h3 id="describe"><a href="#describe" aria-hidden="true" class="header-anchor">#</a> describe</h3> <p>显示资源详情</p> <h3 id="create"><a href="#create" aria-hidden="true" class="header-anchor">#</a> create</h3> <p>从文件或标准输入创建资源</p> <h3 id="update"><a href="#update" aria-hidden="true" class="header-anchor">#</a> update</h3> <p>从文件或标准输入更新资源</p> <h3 id="delete"><a href="#delete" aria-hidden="true" class="header-anchor">#</a> delete</h3> <p>通过文件名、标准输入、资源名或者 label selector 删除资源</p> <h3 id="log"><a href="#log" aria-hidden="true" class="header-anchor">#</a> log</h3> <p>输出 pod 中一个容器的日志</p> <h3 id="rolling-update"><a href="#rolling-update" aria-hidden="true" class="header-anchor">#</a> rolling-update</h3> <p>对指定的 replication controller 执行滚动升级</p> <h3 id="exec"><a href="#exec" aria-hidden="true" class="header-anchor">#</a> exec</h3> <p>在容器内部执行命令</p> <h3 id="port-forward"><a href="#port-forward" aria-hidden="true" class="header-anchor">#</a> port-forward</h3> <p>将本地端口转发到Pod</p> <h3 id="proxy"><a href="#proxy" aria-hidden="true" class="header-anchor">#</a> proxy</h3> <p>为 Kubernetes API server 启动代理服务器</p> <h3 id="run"><a href="#run" aria-hidden="true" class="header-anchor">#</a> run</h3> <p>在集群中使用指定镜像启动容器</p> <h3 id="expose"><a href="#expose" aria-hidden="true" class="header-anchor">#</a> expose</h3> <p>将 replication controller service 或 pod 暴露为新的 kubernetes service</p> <h3 id="label"><a href="#label" aria-hidden="true" class="header-anchor">#</a> label</h3> <p>更新资源的 label</p> <h3 id="config"><a href="#config" aria-hidden="true" class="header-anchor">#</a> config</h3> <p>修改 kubernetes 配置文件</p> <h3 id="cluster-info"><a href="#cluster-info" aria-hidden="true" class="header-anchor">#</a> cluster-info</h3> <p>显示集群信息</p> <h3 id="api-versions"><a href="#api-versions" aria-hidden="true" class="header-anchor">#</a> api-versions</h3> <p>以 &quot;组/版本&quot; 的格式输出服务端支持的 API 版本</p> <h3 id="version"><a href="#version" aria-hidden="true" class="header-anchor">#</a> version</h3> <p>输出服务端和客户端的版本信息</p> <h3 id="help"><a href="#help" aria-hidden="true" class="header-anchor">#</a> help</h3> <p>显示各个命令的帮助信息</p> <h2 id="基本架构"><a href="#基本架构" aria-hidden="true" class="header-anchor">#</a> 基本架构</h2> <p>任何优秀的项目都离不开优秀的架构设计。本小节将介绍 Kubernetes 在架构方面的设计考虑。</p> <h3 id="基本考虑"><a href="#基本考虑" aria-hidden="true" class="header-anchor">#</a> 基本考虑</h3> <p>如果让我们自己从头设计一套容器管理平台，有如下几个方面是很容易想到的：</p> <ul><li>分布式架构，保证扩展性；</li> <li>逻辑集中式的控制平面 + 物理分布式的运行平面；</li> <li>一套资源调度系统，管理哪个容器该分配到哪个节点上；</li> <li>一套对容器内服务进行抽象和 HA 的系统。</li></ul> <h3 id="运行原理"><a href="#运行原理" aria-hidden="true" class="header-anchor">#</a> 运行原理</h3> <p>下面这张图完整展示了 Kubernetes 的运行原理。</p> <p><img src="https://yeasy.gitbooks.io/docker_practice/kubernetes/_images/k8s_architecture.png" alt="Kubernetes 架构">图 1.21.5.1 - Kubernetes 架构</p> <p>可见，Kubernetes 首先是一套分布式系统，由多个节点组成，节点分为两类：一类是属于管理平面的主节点/控制节点（Master Node）；一类是属于运行平面的工作节点（Worker Node）。</p> <p>显然，复杂的工作肯定都交给控制节点去做了，工作节点负责提供稳定的操作接口和能力抽象即可。</p> <p>从这张图上，我们没有能发现 Kubernetes 中对于控制平面的分布式实现，但是由于数据后端自身就是一套分布式的数据库 Etcd，因此可以很容易扩展到分布式实现。</p> <h3 id="控制平面"><a href="#控制平面" aria-hidden="true" class="header-anchor">#</a> 控制平面</h3> <h4 id="主节点服务-2"><a href="#主节点服务-2" aria-hidden="true" class="header-anchor">#</a> 主节点服务</h4> <p>主节点上需要提供如下的管理服务：</p> <ul><li><code>apiserver</code> 是整个系统的对外接口，提供一套 RESTful 的 <a href="https://github.com/kubernetes/kubernetes/tree/master/docs/api-reference" target="_blank" rel="noopener noreferrer">Kubernetes API<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，供客户端和其它组件调用；</li> <li><code>scheduler</code> 负责对资源进行调度，分配某个 pod 到某个节点上。是 pluggable 的，意味着很容易选择其它实现方式；</li> <li><code>controller-manager</code> 负责管理控制器，包括 endpoint-controller（刷新服务和 pod 的关联信息）和 replication-controller（维护某个 pod 的复制为配置的数值）。</li></ul> <h4 id="etcd"><a href="#etcd" aria-hidden="true" class="header-anchor">#</a> Etcd</h4> <p>这里 Etcd 即作为数据后端，又作为消息中间件。</p> <p>通过 Etcd 来存储所有的主节点上的状态信息，很容易实现主节点的分布式扩展。</p> <p>组件可以自动的去侦测 Etcd 中的数值变化来获得通知，并且获得更新后的数据来执行相应的操作。</p> <h3 id="工作节点"><a href="#工作节点" aria-hidden="true" class="header-anchor">#</a> 工作节点</h3> <ul><li>kubelet 是工作节点执行操作的 agent，负责具体的容器生命周期管理，根据从数据库中获取的信息来管理容器，并上报 pod 运行状态等；</li> <li>kube-proxy 是一个简单的网络访问代理，同时也是一个 Load Balancer。它负责将访问到某个服务的请求具体分配给工作节点上的 Pod（同一类标签）。</li></ul> <p><img src="https://yeasy.gitbooks.io/docker_practice/kubernetes/_images/kube-proxy.png" alt="Proxy 代理对服务的请求">图 1.21.5.2 - Proxy 代理对服务的请求</p></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新：: </span> <span class="time">1/14/2019, 7:10:06 PM</span></div></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/cloud/Docker/coreos.html" class="prev">
          CoreOS 项目
        </a></span> <span class="next"><a href="/cloud/Docker/mesos.html">
          Mesos - 优秀的集群资源调度平台
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/app.2fb9186c.js" defer></script><script src="/assets/js/46.08775f3f.js" defer></script>
  </body>
</html>
