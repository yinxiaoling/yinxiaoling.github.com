<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>高级网络配置 | Hsiao Lin</title>
    <meta name="description" content="Programer &amp; WOWER">
    <link rel="icon" href="/pig32.png">
    
    <link rel="preload" href="/assets/css/0.styles.bd66f28f.css" as="style"><link rel="preload" href="/assets/js/app.365f7fea.js" as="script"><link rel="preload" href="/assets/js/23.ee7c5e7e.js" as="script"><link rel="prefetch" href="/assets/js/10.e8ab10a4.js"><link rel="prefetch" href="/assets/js/11.d1cb4148.js"><link rel="prefetch" href="/assets/js/12.cba34369.js"><link rel="prefetch" href="/assets/js/13.5145e463.js"><link rel="prefetch" href="/assets/js/14.6bdbabb2.js"><link rel="prefetch" href="/assets/js/15.2888418d.js"><link rel="prefetch" href="/assets/js/16.2489649d.js"><link rel="prefetch" href="/assets/js/17.cea64679.js"><link rel="prefetch" href="/assets/js/18.3245683f.js"><link rel="prefetch" href="/assets/js/19.c6e0b481.js"><link rel="prefetch" href="/assets/js/2.7d83e6da.js"><link rel="prefetch" href="/assets/js/20.bbf67aae.js"><link rel="prefetch" href="/assets/js/21.cbcd4f96.js"><link rel="prefetch" href="/assets/js/22.b98d076e.js"><link rel="prefetch" href="/assets/js/24.dd380e87.js"><link rel="prefetch" href="/assets/js/25.5c721af1.js"><link rel="prefetch" href="/assets/js/26.efb21d01.js"><link rel="prefetch" href="/assets/js/27.0fe303e8.js"><link rel="prefetch" href="/assets/js/28.566b68de.js"><link rel="prefetch" href="/assets/js/29.7b36cb29.js"><link rel="prefetch" href="/assets/js/3.68587e58.js"><link rel="prefetch" href="/assets/js/30.de9fac57.js"><link rel="prefetch" href="/assets/js/31.ef52e435.js"><link rel="prefetch" href="/assets/js/32.e2eaaa49.js"><link rel="prefetch" href="/assets/js/33.192d3a03.js"><link rel="prefetch" href="/assets/js/34.6008ae4e.js"><link rel="prefetch" href="/assets/js/35.e8816b78.js"><link rel="prefetch" href="/assets/js/36.a5a28ad5.js"><link rel="prefetch" href="/assets/js/37.a3173678.js"><link rel="prefetch" href="/assets/js/38.c4732683.js"><link rel="prefetch" href="/assets/js/39.0c57fbbe.js"><link rel="prefetch" href="/assets/js/4.e5ec2def.js"><link rel="prefetch" href="/assets/js/40.025b70cc.js"><link rel="prefetch" href="/assets/js/41.6a7897c8.js"><link rel="prefetch" href="/assets/js/42.4303301b.js"><link rel="prefetch" href="/assets/js/43.e76fd56e.js"><link rel="prefetch" href="/assets/js/44.bebdc742.js"><link rel="prefetch" href="/assets/js/45.3315f2c0.js"><link rel="prefetch" href="/assets/js/46.6247d916.js"><link rel="prefetch" href="/assets/js/47.07bba9f9.js"><link rel="prefetch" href="/assets/js/48.e2bf896e.js"><link rel="prefetch" href="/assets/js/49.00e40c2a.js"><link rel="prefetch" href="/assets/js/5.dd2f6f9c.js"><link rel="prefetch" href="/assets/js/50.281dd4e2.js"><link rel="prefetch" href="/assets/js/51.ae1cb580.js"><link rel="prefetch" href="/assets/js/52.e2522b14.js"><link rel="prefetch" href="/assets/js/6.b9d02d3e.js"><link rel="prefetch" href="/assets/js/7.dc6a90bf.js"><link rel="prefetch" href="/assets/js/8.ad98fdcd.js"><link rel="prefetch" href="/assets/js/9.84c920cc.js">
    <link rel="stylesheet" href="/assets/css/0.styles.bd66f28f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Hsiao Lin</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Java/Java/" class="nav-link">Java</a></li><li class="dropdown-item"><!----> <a href="/Java/Spring/" class="nav-link">Spring</a></li><li class="dropdown-item"><!----> <a href="/Java/SpringBoot/" class="nav-link">SpringBoot</a></li><li class="dropdown-item"><!----> <a href="/Java/SpringCloud/" class="nav-link">SpringCloud</a></li><li class="dropdown-item"><!----> <a href="/Java/MyBatis/" class="nav-link">MyBatis</a></li><li class="dropdown-item"><!----> <a href="/Java/algorithm/" class="nav-link">算法</a></li><li class="dropdown-item"><h4>架构</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Java/architect/OAuth2/" class="nav-link">OAuth2</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">JavaScript</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/JavaScript/JavaScript/" class="nav-link">JavaScript</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/TypeScript/" class="nav-link">TypeScript</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/Nodejs/" class="nav-link">Node.js</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/Vue/" class="nav-link">Vue</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/React/" class="nav-link">React</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/Angular/" class="nav-link">Angular</a></li></ul></div></div><div class="nav-item"><a href="/BigData/" class="nav-link">BigData</a></div><div class="nav-item"><a href="/AI/" class="nav-link">AI</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Cloud</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/cloud/Docker/" class="nav-link router-link-active">Docker</a></li><li class="dropdown-item"><!----> <a href="/cloud/Kubernetes/" class="nav-link">Kubernetes</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/yinxiaoling" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Java/Java/" class="nav-link">Java</a></li><li class="dropdown-item"><!----> <a href="/Java/Spring/" class="nav-link">Spring</a></li><li class="dropdown-item"><!----> <a href="/Java/SpringBoot/" class="nav-link">SpringBoot</a></li><li class="dropdown-item"><!----> <a href="/Java/SpringCloud/" class="nav-link">SpringCloud</a></li><li class="dropdown-item"><!----> <a href="/Java/MyBatis/" class="nav-link">MyBatis</a></li><li class="dropdown-item"><!----> <a href="/Java/algorithm/" class="nav-link">算法</a></li><li class="dropdown-item"><h4>架构</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Java/architect/OAuth2/" class="nav-link">OAuth2</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">JavaScript</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/JavaScript/JavaScript/" class="nav-link">JavaScript</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/TypeScript/" class="nav-link">TypeScript</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/Nodejs/" class="nav-link">Node.js</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/Vue/" class="nav-link">Vue</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/React/" class="nav-link">React</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/Angular/" class="nav-link">Angular</a></li></ul></div></div><div class="nav-item"><a href="/BigData/" class="nav-link">BigData</a></div><div class="nav-item"><a href="/AI/" class="nav-link">AI</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Cloud</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/cloud/Docker/" class="nav-link router-link-active">Docker</a></li><li class="dropdown-item"><!----> <a href="/cloud/Kubernetes/" class="nav-link">Kubernetes</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/yinxiaoling" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/cloud/Docker/BasicConcepts.html" class="sidebar-link">Docker基本概念</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/BasicConcepts.html#docker-镜像" class="sidebar-link">Docker 镜像</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/BasicConcepts.html#docker-容器" class="sidebar-link">Docker 容器</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/BasicConcepts.html#docker-registry" class="sidebar-link">Docker Registry</a></li></ul></li><li><a href="/cloud/Docker/Install.html" class="sidebar-link">安装 Docker</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/Install.html#centos-安装-docker-ce" class="sidebar-link">CentOS 安装 Docker CE</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Install.html#macos-安装-docker" class="sidebar-link">MacOS 安装 Docker</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Install.html#windows-10-pc-安装-docker-ce" class="sidebar-link">Windows 10 PC 安装 Docker CE</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Install.html#ubuntu-安装-docker-ce" class="sidebar-link">Ubuntu 安装 Docker CE</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Install.html#debian-安装-docker-ce" class="sidebar-link">Debian 安装 Docker CE</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Install.html#镜像加速器" class="sidebar-link">镜像加速器</a></li></ul></li><li><a href="/cloud/Docker/UseImage.html" class="sidebar-link">使用 Docker 镜像</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#获取镜像" class="sidebar-link">获取镜像</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#列出镜像" class="sidebar-link">列出镜像</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#删除本地镜像" class="sidebar-link">删除本地镜像</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#利用-commit-理解镜像构成" class="sidebar-link">利用 commit 理解镜像构成</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#使用-dockerfile-定制镜像" class="sidebar-link">使用 Dockerfile 定制镜像</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#dockerfile-指令详解" class="sidebar-link">Dockerfile 指令详解</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#多阶段构建" class="sidebar-link">多阶段构建</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#实战多阶段构建-laravel-镜像" class="sidebar-link">实战多阶段构建 Laravel 镜像</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#其它制作镜像的方式" class="sidebar-link">其它制作镜像的方式</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseImage.html#镜像的实现原理" class="sidebar-link">镜像的实现原理</a></li></ul></li><li><a href="/cloud/Docker/UseContainer.html" class="sidebar-link">操作 Docker 容器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/UseContainer.html#启动容器" class="sidebar-link">启动容器</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseContainer.html#后台运行" class="sidebar-link">后台运行</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseContainer.html#终止容器" class="sidebar-link">终止容器</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseContainer.html#进入容器" class="sidebar-link">进入容器</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseContainer.html#导出和导入容器" class="sidebar-link">导出和导入容器</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseContainer.html#删除容器" class="sidebar-link">删除容器</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/UseContainer.html#清理所有处于终止状态的容器" class="sidebar-link">清理所有处于终止状态的容器</a></li></ul></li><li><a href="/cloud/Docker/InterviewRegistry.html" class="sidebar-link">访问仓库</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/InterviewRegistry.html#docker-hub" class="sidebar-link">Docker Hub</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/InterviewRegistry.html#私有仓库" class="sidebar-link">私有仓库</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/InterviewRegistry.html#私有仓库高级配置" class="sidebar-link">私有仓库高级配置</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/InterviewRegistry.html#nexus3-x-的私有仓库" class="sidebar-link">Nexus3.x 的私有仓库</a></li></ul></li><li><a href="/cloud/Docker/DataManager.html" class="sidebar-link">Docker 数据管理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/DataManager.html#数据卷" class="sidebar-link">数据卷</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/DataManager.html#挂载主机目录" class="sidebar-link">挂载主机目录</a></li></ul></li><li><a href="/cloud/Docker/Network.html" class="sidebar-link">Docker 中的网络功能介绍</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/Network.html#外部访问容器" class="sidebar-link">外部访问容器</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Network.html#容器互联" class="sidebar-link">容器互联</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Network.html#配置-dns" class="sidebar-link">配置 DNS</a></li></ul></li><li><a href="/cloud/Docker/AdvancedNetwork.html" class="active sidebar-link">高级网络配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/AdvancedNetwork.html#快速配置指南" class="sidebar-link">快速配置指南</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/AdvancedNetwork.html#容器访问控制" class="sidebar-link">容器访问控制</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/AdvancedNetwork.html#映射容器端口到宿主主机的实现" class="sidebar-link">映射容器端口到宿主主机的实现</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/AdvancedNetwork.html#配置-docker0-网桥" class="sidebar-link">配置 docker0 网桥</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/AdvancedNetwork.html#自定义网桥" class="sidebar-link">自定义网桥</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/AdvancedNetwork.html#工具和示例" class="sidebar-link">工具和示例</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/AdvancedNetwork.html#编辑网络配置文件" class="sidebar-link">编辑网络配置文件</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/AdvancedNetwork.html#示例：创建一个点到点连接" class="sidebar-link">示例：创建一个点到点连接</a></li></ul></li><li><a href="/cloud/Docker/compose.html" class="sidebar-link">Docker 三剑客之 Docker Compose</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/compose.html#compose-简介" class="sidebar-link">Compose 简介</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/compose.html#安装与卸载" class="sidebar-link">安装与卸载</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/compose.html#使用" class="sidebar-link">使用</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/compose.html#compose-命令说明" class="sidebar-link">Compose 命令说明</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/compose.html#compose-模板文件" class="sidebar-link">Compose 模板文件</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/compose.html#使用-django" class="sidebar-link">使用 Django</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/compose.html#使用-rails" class="sidebar-link">使用 Rails</a></li></ul></li><li><a href="/cloud/Docker/machine.html" class="sidebar-link">Docker 三剑客之 Docker Machine</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/machine.html#安装" class="sidebar-link">安装</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/machine.html#使用" class="sidebar-link">使用</a></li></ul></li><li><a href="/cloud/Docker/swarm.html" class="sidebar-link">Docker 三剑客之 Docker Swarm</a></li><li><a href="/cloud/Docker/swarm_mode.html" class="sidebar-link">Swarm mode</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/swarm_mode.html#基本概念" class="sidebar-link">基本概念</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/swarm_mode.html#创建-swarm-集群" class="sidebar-link">创建 Swarm 集群</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/swarm_mode.html#部署服务" class="sidebar-link">部署服务</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/swarm_mode.html#在-swarm-集群中使用-compose-文件" class="sidebar-link">在 Swarm 集群中使用 compose 文件</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/swarm_mode.html#在-swarm-集群中管理敏感数据" class="sidebar-link">在 Swarm 集群中管理敏感数据</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/swarm_mode.html#在-swarm-集群中管理配置数据" class="sidebar-link">在 Swarm 集群中管理配置数据</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/swarm_mode.html#swarm-mode-与滚动升级" class="sidebar-link">SWarm mode 与滚动升级</a></li></ul></li><li><a href="/cloud/Docker/Security.html" class="sidebar-link">安全</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/Security.html#内核命名空间" class="sidebar-link">内核命名空间</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Security.html#控制组" class="sidebar-link">控制组</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Security.html#docker服务端的防护" class="sidebar-link">Docker服务端的防护</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Security.html#内核能力机制" class="sidebar-link">内核能力机制</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Security.html#其它安全特性" class="sidebar-link">其它安全特性</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/Security.html#总结" class="sidebar-link">总结</a></li></ul></li><li><a href="/cloud/Docker/underly.html" class="sidebar-link">底层实现</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/underly.html#基本架构" class="sidebar-link">基本架构</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/underly.html#命名空间" class="sidebar-link">命名空间</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/underly.html#控制组" class="sidebar-link">控制组</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/underly.html#联合文件系统" class="sidebar-link">联合文件系统</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/underly.html#容器格式" class="sidebar-link">容器格式</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/underly.html#docker-网络实现" class="sidebar-link">Docker 网络实现</a></li></ul></li><li><a href="/cloud/Docker/etcd.html" class="sidebar-link">Etcd 项目</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/etcd.html#什么是-etcd" class="sidebar-link">什么是 etcd</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/etcd.html#安装" class="sidebar-link">安装</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/etcd.html#etcd-集群" class="sidebar-link">etcd 集群</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/etcd.html#使用-etcdctl" class="sidebar-link">使用 etcdctl</a></li></ul></li><li><a href="/cloud/Docker/coreos.html" class="sidebar-link">CoreOS 项目</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/coreos.html#coreos-介绍" class="sidebar-link">CoreOS 介绍</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/coreos.html#coreos-特性" class="sidebar-link">CoreOS 特性</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/coreos.html#coreos-工具介绍" class="sidebar-link">CoreOS 工具介绍</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/coreos.html#快速搭建-coreos-集群" class="sidebar-link">快速搭建 CoreOS 集群</a></li></ul></li><li><a href="/cloud/Docker/kubernetes.html" class="sidebar-link">Kubernetes</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/kubernetes.html#项目简介" class="sidebar-link">项目简介</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/kubernetes.html#快速上手" class="sidebar-link">快速上手</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/kubernetes.html#基本概念" class="sidebar-link">基本概念</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/kubernetes.html#kubectl-使用" class="sidebar-link">kubectl 使用</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/kubernetes.html#基本架构" class="sidebar-link">基本架构</a></li></ul></li><li><a href="/cloud/Docker/mesos.html" class="sidebar-link">Mesos - 优秀的集群资源调度平台</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/mesos.html#简介" class="sidebar-link">简介</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/mesos.html#mesos-安装与使用" class="sidebar-link">Mesos 安装与使用</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/mesos.html#原理与架构" class="sidebar-link">原理与架构</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/mesos.html#mesos-配置项解析" class="sidebar-link">Mesos 配置项解析</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/mesos.html#日志与监控" class="sidebar-link">日志与监控</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/mesos.html#常见应用框架" class="sidebar-link">常见应用框架</a></li></ul></li><li><a href="/cloud/Docker/cases_os.html" class="sidebar-link">实战-操作系统</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/cases_os.html#busybox" class="sidebar-link">Busybox</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/cases_os.html#alpine" class="sidebar-link">Alpine</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/cases_os.html#debian-ubuntu" class="sidebar-link">Debian/Ubuntu</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/cases_os.html#centos-fedora" class="sidebar-link">CentOS/Fedora</a></li></ul></li><li><a href="/cloud/Docker/cases_cicd.html" class="sidebar-link">实战-CI/CD</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/cases_cicd.html#drone" class="sidebar-link">Drone</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/cases_cicd.html#参考链接" class="sidebar-link">参考链接</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/cases_cicd.html#在-travis-ci-中使用-docker" class="sidebar-link">在 Travis CI 中使用 Docker</a></li></ul></li><li><a href="/cloud/Docker/opensource.html" class="sidebar-link">Docker 开源项目</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/opensource.html#linuxkit" class="sidebar-link">LinuxKit</a></li></ul></li><li><a href="/cloud/Docker/appendix.1.html" class="sidebar-link">附录一：常见问题总结</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.1.html#镜像相关" class="sidebar-link">镜像相关</a></li></ul></li><li><a href="/cloud/Docker/appendix.2.html" class="sidebar-link">附录二：热门镜像介绍</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.2.html#ubuntu" class="sidebar-link">Ubuntu</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.2.html#centos" class="sidebar-link">CentOS</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.2.html#nginx" class="sidebar-link">Nginx</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.2.html#mysql" class="sidebar-link">MySQL</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.2.html#mongodb" class="sidebar-link">MongoDB</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.2.html#redis" class="sidebar-link">Redis</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.2.html#node-js" class="sidebar-link">Node.js</a></li></ul></li><li><a href="/cloud/Docker/appendix.3.html" class="sidebar-link">附录三：Docker 命令查询</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.3.html#基本语法" class="sidebar-link">基本语法</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.3.html#客户端命令选项" class="sidebar-link">客户端命令选项</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.3.html#dockerd-命令选项" class="sidebar-link">dockerd 命令选项</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.3.html#客户端命令" class="sidebar-link">客户端命令</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.3.html#一张图总结-docker-的命令" class="sidebar-link">一张图总结 Docker 的命令</a></li></ul></li><li><a href="/cloud/Docker/appendix.4.html" class="sidebar-link">附录四：Dockerfile 最佳实践</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.4.html#一般性的指南和建议" class="sidebar-link">一般性的指南和建议</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.4.html#dockerfile-指令" class="sidebar-link">Dockerfile 指令</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.4.html#官方镜像示例" class="sidebar-link">官方镜像示例</a></li></ul></li><li><a href="/cloud/Docker/appendix.5.html" class="sidebar-link">附录五：如何调试 Docker</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.5.html#开启-debug-模式" class="sidebar-link">开启 Debug 模式</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.5.html#检查内核日志" class="sidebar-link">检查内核日志</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.5.html#docker-不响应时处理" class="sidebar-link">Docker 不响应时处理</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.5.html#重置-docker-本地数据" class="sidebar-link">重置 Docker 本地数据</a></li></ul></li><li><a href="/cloud/Docker/appendix.6.html" class="sidebar-link">附录六：资源链接</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.6.html#官方网站" class="sidebar-link">官方网站</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.6.html#实践参考" class="sidebar-link">实践参考</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.6.html#技术交流" class="sidebar-link">技术交流</a></li><li class="sidebar-sub-header"><a href="/cloud/Docker/appendix.6.html#其它" class="sidebar-link">其它</a></li></ul></li></ul> </div> <div class="page"> <div class="content"><h1 id="高级网络配置"><a href="#高级网络配置" aria-hidden="true" class="header-anchor">#</a> 高级网络配置</h1> <blockquote><p>注意：本章属于 <code>Docker</code> 高级配置，如果您是初学者，您可以暂时跳过本章节，直接学习 <a href="https://yeasy.gitbooks.io/docker_practice/compose" target="_blank" rel="noopener noreferrer">Docker Compose<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 一节。</p></blockquote> <p>本章将介绍 Docker 的一些高级网络配置和选项。</p> <p>当 Docker 启动时，会自动在主机上创建一个 <code>docker0</code> 虚拟网桥，实际上是 Linux 的一个 bridge，可以理解为一个软件交换机。它会在挂载到它的网口之间进行转发。</p> <p>同时，Docker 随机分配一个本地未占用的私有网段（在 <a href="https://tools.ietf.org/html/rfc1918" target="_blank" rel="noopener noreferrer">RFC1918<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 中定义）中的一个地址给 <code>docker0</code> 接口。比如典型的 <code>172.17.42.1</code>，掩码为 <code>255.255.0.0</code>。此后启动的容器内的网口也会自动分配一个同一网段（<code>172.17.0.0/16</code>）的地址。</p> <p>当创建一个 Docker 容器的时候，同时会创建了一对 <code>veth pair</code> 接口（当数据包发送到一个接口时，另外一个接口也可以收到相同的数据包）。这对接口一端在容器内，即 <code>eth0</code>；另一端在本地并被挂载到 <code>docker0</code> 网桥，名称以 <code>veth</code> 开头（例如 <code>vethAQI2QT</code>）。通过这种方式，主机可以跟容器通信，容器之间也可以相互通信。Docker 就创建了在主机和所有容器之间一个虚拟共享网络。</p> <p><img src="https://yeasy.gitbooks.io/docker_practice/advanced_network/_images/network.png" alt="Docker 网络">图 1.12.1 - Docker 网络</p> <p>接下来的部分将介绍在一些场景中，Docker 所有的网络定制配置。以及通过 Linux 命令来调整、补充、甚至替换 Docker 默认的网络配置。</p> <h2 id="快速配置指南"><a href="#快速配置指南" aria-hidden="true" class="header-anchor">#</a> 快速配置指南</h2> <p>下面是一个跟 Docker 网络相关的命令列表。</p> <p>其中有些命令选项只有在 Docker 服务启动的时候才能配置，而且不能马上生效。</p> <ul><li><code>-b BRIDGE</code> 或 <code>--bridge=BRIDGE</code> 指定容器挂载的网桥</li> <li><code>--bip=CIDR</code> 定制 docker0 的掩码</li> <li><code>-H SOCKET...</code> 或 <code>--host=SOCKET...</code> Docker 服务端接收命令的通道</li> <li><code>--icc=true|false</code> 是否支持容器之间进行通信</li> <li><code>--ip-forward=true|false</code> 请看下文容器之间的通信</li> <li><code>--iptables=true|false</code> 是否允许 Docker 添加 iptables 规则</li> <li><code>--mtu=BYTES</code> 容器网络中的 MTU</li></ul> <p>下面2个命令选项既可以在启动服务时指定，也可以在启动容器时指定。在 Docker 服务启动的时候指定则会成为默认值，后面执行 <code>docker run</code> 时可以覆盖设置的默认值。</p> <ul><li><code>--dns=IP_ADDRESS...</code> 使用指定的DNS服务器</li> <li><code>--dns-search=DOMAIN...</code> 指定DNS搜索域</li></ul> <p>最后这些选项只有在 <code>docker run</code> 执行时使用，因为它是针对容器的特性内容。</p> <ul><li><code>-h HOSTNAME</code> 或 <code>--hostname=HOSTNAME</code> 配置容器主机名</li> <li><code>--link=CONTAINER_NAME:ALIAS</code> 添加到另一个容器的连接</li> <li><code>--net=bridge|none|container:NAME_or_ID|host</code> 配置容器的桥接模式</li> <li><code>-p SPEC</code> 或 <code>--publish=SPEC</code> 映射容器端口到宿主主机</li> <li><code>-P or --publish-all=true|false</code> 映射容器所有端口到宿主主机</li></ul> <h2 id="容器访问控制"><a href="#容器访问控制" aria-hidden="true" class="header-anchor">#</a> 容器访问控制</h2> <p>容器的访问控制，主要通过 Linux 上的 <code>iptables</code> 防火墙来进行管理和实现。<code>iptables</code> 是 Linux 上默认的防火墙软件，在大部分发行版中都自带。</p> <h3 id="容器访问外部网络"><a href="#容器访问外部网络" aria-hidden="true" class="header-anchor">#</a> 容器访问外部网络</h3> <p>容器要想访问外部网络，需要本地系统的转发支持。在Linux 系统中，检查转发是否打开。</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token variable">$sysctl</span> net.ipv4.ip_forward
net.ipv4.ip_forward <span class="token operator">=</span> 1
</code></pre></div><p>如果为 0，说明没有开启转发，则需要手动打开。</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token variable">$sysctl</span> -w net.ipv4.ip_forward<span class="token operator">=</span>1
</code></pre></div><p>如果在启动 Docker 服务的时候设定 <code>--ip-forward=true</code>, Docker 就会自动设定系统的 <code>ip_forward</code> 参数为 1。</p> <h3 id="容器之间访问"><a href="#容器之间访问" aria-hidden="true" class="header-anchor">#</a> 容器之间访问</h3> <p>容器之间相互访问，需要两方面的支持。</p> <ul><li>容器的网络拓扑是否已经互联。默认情况下，所有容器都会被连接到 <code>docker0</code> 网桥上。</li> <li>本地系统的防火墙软件 -- <code>iptables</code> 是否允许通过。</li></ul> <h4 id="访问所有端口"><a href="#访问所有端口" aria-hidden="true" class="header-anchor">#</a> 访问所有端口</h4> <p>当启动 Docker 服务（即 dockerd）的时候，默认会添加一条转发策略到本地主机 iptables 的 FORWARD 链上。策略为通过（<code>ACCEPT</code>）还是禁止（<code>DROP</code>）取决于配置<code>--icc=true</code>（缺省值）还是 <code>--icc=false</code>。当然，如果手动指定 <code>--iptables=false</code> 则不会添加 <code>iptables</code> 规则。</p> <p>可见，默认情况下，不同容器之间是允许网络互通的。如果为了安全考虑，可以在 <code>/etc/docker/daemon.json</code> 文件中配置 <code>{&quot;icc&quot;: false}</code> 来禁止它（Ubuntu 14.04 等使用 upstart 的系统在文件 <code>/etc/default/docker</code> 中配置 <code>DOCKER_OPTS=--icc=false</code>）。</p> <h4 id="访问指定端口"><a href="#访问指定端口" aria-hidden="true" class="header-anchor">#</a> 访问指定端口</h4> <p>在通过 <code>-icc=false</code> 关闭网络访问后，还可以通过 <code>--link=CONTAINER_NAME:ALIAS</code> 选项来访问容器的开放端口。</p> <p>例如，在启动 Docker 服务时，可以同时使用 <code>icc=false --iptables=true</code> 参数来关闭允许相互的网络访问，并让 Docker 可以修改系统中的 <code>iptables</code> 规则。</p> <p>此时，系统中的 <code>iptables</code> 规则可能是类似</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">sudo</span> iptables -nL
<span class="token punctuation">..</span>.
Chain FORWARD <span class="token punctuation">(</span>policy ACCEPT<span class="token punctuation">)</span>
target     prot opt <span class="token function">source</span>               destination
DROP       all  --  0.0.0.0/0            0.0.0.0/0
<span class="token punctuation">..</span>.
</code></pre></div><p>之后，启动容器（<code>docker run</code>）时使用 <code>--link=CONTAINER_NAME:ALIAS</code> 选项。Docker 会在 <code>iptable</code> 中为 两个容器分别添加一条 <code>ACCEPT</code> 规则，允许相互访问开放的端口（取决于 <code>Dockerfile</code> 中的 <code>EXPOSE</code> 指令）。</p> <p>当添加了 <code>--link=CONTAINER_NAME:ALIAS</code> 选项后，添加了 <code>iptables</code> 规则。</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">sudo</span> iptables -nL
<span class="token punctuation">..</span>.
Chain FORWARD <span class="token punctuation">(</span>policy ACCEPT<span class="token punctuation">)</span>
target     prot opt <span class="token function">source</span>               destination
ACCEPT     tcp  --  172.17.0.2           172.17.0.3           tcp spt:80
ACCEPT     tcp  --  172.17.0.3           172.17.0.2           tcp dpt:80
DROP       all  --  0.0.0.0/0            0.0.0.0/0
</code></pre></div><p>注意：<code>--link=CONTAINER_NAME:ALIAS</code> 中的 <code>CONTAINER_NAME</code> 目前必须是 Docker 分配的名字，或使用 <code>--name</code> 参数指定的名字。主机名则不会被识别。</p> <h2 id="映射容器端口到宿主主机的实现"><a href="#映射容器端口到宿主主机的实现" aria-hidden="true" class="header-anchor">#</a> 映射容器端口到宿主主机的实现</h2> <p>默认情况下，容器可以主动访问到外部网络的连接，但是外部网络无法访问到容器。</p> <h3 id="容器访问外部实现"><a href="#容器访问外部实现" aria-hidden="true" class="header-anchor">#</a> 容器访问外部实现</h3> <p>容器所有到外部网络的连接，源地址都会被 NAT 成本地系统的 IP 地址。这是使用 <code>iptables</code> 的源地址伪装操作实现的。</p> <p>查看主机的 NAT 规则。</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">sudo</span> iptables -t nat -nL
<span class="token punctuation">..</span>.
Chain POSTROUTING <span class="token punctuation">(</span>policy ACCEPT<span class="token punctuation">)</span>
target     prot opt <span class="token function">source</span>               destination
MASQUERADE  all  --  172.17.0.0/16       <span class="token operator">!</span>172.17.0.0/16
<span class="token punctuation">..</span>.
</code></pre></div><p>其中，上述规则将所有源地址在 <code>172.17.0.0/16</code> 网段，目标地址为其他网段（外部网络）的流量动态伪装为从系统网卡发出。MASQUERADE 跟传统 SNAT 的好处是它能动态从网卡获取地址。</p> <h3 id="外部访问容器实现"><a href="#外部访问容器实现" aria-hidden="true" class="header-anchor">#</a> 外部访问容器实现</h3> <p>容器允许外部访问，可以在 <code>docker run</code> 时候通过 <code>-p</code> 或 <code>-P</code> 参数来启用。</p> <p>不管用那种办法，其实也是在本地的 <code>iptable</code> 的 nat 表中添加相应的规则。</p> <p>使用 <code>-P</code> 时：</p> <div class="language-shell extra-class"><pre class="language-shell"><code>iptables -t nat -nL
<span class="token punctuation">..</span>.
Chain DOCKER <span class="token punctuation">(</span>2 references<span class="token punctuation">)</span>
target     prot opt <span class="token function">source</span>               destination
DNAT       tcp  --  0.0.0.0/0            0.0.0.0/0            tcp dpt:49153 to:172.17.0.2:80
</code></pre></div><p>使用 <code>-p 80:80</code> 时：</p> <div class="language-shell extra-class"><pre class="language-shell"><code>iptables -t nat -nL
Chain DOCKER <span class="token punctuation">(</span>2 references<span class="token punctuation">)</span>
target     prot opt <span class="token function">source</span>               destination
DNAT       tcp  --  0.0.0.0/0            0.0.0.0/0            tcp dpt:80 to:172.17.0.2:80
</code></pre></div><p>注意：</p> <ul><li>这里的规则映射了 <code>0.0.0.0</code>，意味着将接受主机来自所有接口的流量。用户可以通过 <code>-p IP:host_port:container_port</code> 或 <code>-p IP::port</code> 来指定允许访问容器的主机上的 IP、接口等，以制定更严格的规则。</li> <li>如果希望永久绑定到某个固定的 IP 地址，可以在 Docker 配置文件 <code>/etc/docker/daemon.json</code> 中添加如下内容。</li></ul> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;ip&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0.0.0.0&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="配置-docker0-网桥"><a href="#配置-docker0-网桥" aria-hidden="true" class="header-anchor">#</a> 配置 docker0 网桥</h2> <p>Docker 服务默认会创建一个 <code>docker0</code> 网桥（其上有一个 <code>docker0</code> 内部接口），它在内核层连通了其他的物理或虚拟网卡，这就将所有容器和本地主机都放到同一个物理网络。</p> <p>Docker 默认指定了 <code>docker0</code> 接口 的 IP 地址和子网掩码，让主机和容器之间可以通过网桥相互通信，它还给出了 MTU（接口允许接收的最大传输单元），通常是 1500 Bytes，或宿主主机网络路由上支持的默认值。这些值都可以在服务启动的时候进行配置。</p> <ul><li><code>--bip=CIDR</code> IP 地址加掩码格式，例如 192.168.1.5/24</li> <li><code>--mtu=BYTES</code> 覆盖默认的 Docker mtu 配置</li></ul> <p>也可以在配置文件中配置 DOCKER_OPTS，然后重启服务。</p> <p>由于目前 Docker 网桥是 Linux 网桥，用户可以使用 <code>brctl show</code> 来查看网桥和端口连接信息。</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">sudo</span> brctl show
bridge name     bridge <span class="token function">id</span>               STP enabled     interfaces
docker0         8000.3a1d7362b4ee       no              veth65f9
                                             vethdda6
</code></pre></div><p>*注：<code>brctl</code> 命令在 Debian、Ubuntu 中可以使用 <code>sudo apt-get install bridge-utils</code> 来安装。</p> <p>每次创建一个新容器的时候，Docker 从可用的地址段中选择一个空闲的 IP 地址分配给容器的 eth0 端口。使用本地主机上 <code>docker0</code> 接口的 IP 作为所有容器的默认网关。</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">sudo</span> docker run -i -t --rm base /bin/bash
ip addr show eth0
24: eth0: <span class="token operator">&lt;</span>BROADCAST,UP,LOWER_UP<span class="token operator">&gt;</span> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
    link/ether 32:6f:e0:35:57:91 brd ff:ff:ff:ff:ff:ff
    inet 172.17.0.3/16 scope global eth0
       valid_lft forever preferred_lft forever
    inet6 fe80::306f:e0ff:fe35:5791/64 scope <span class="token function">link</span>
       valid_lft forever preferred_lft forever
ip route
default via 172.17.42.1 dev eth0
172.17.0.0/16 dev eth0  proto kernel  scope <span class="token function">link</span>  src 172.17.0.3
</code></pre></div><h2 id="自定义网桥"><a href="#自定义网桥" aria-hidden="true" class="header-anchor">#</a> 自定义网桥</h2> <p>除了默认的 <code>docker0</code> 网桥，用户也可以指定网桥来连接各个容器。</p> <p>在启动 Docker 服务的时候，使用 <code>-b BRIDGE</code>或<code>--bridge=BRIDGE</code> 来指定使用的网桥。</p> <p>如果服务已经运行，那需要先停止服务，并删除旧的网桥。</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">sudo</span> systemctl stop docker
<span class="token function">sudo</span> ip <span class="token function">link</span> <span class="token keyword">set</span> dev docker0 down
<span class="token function">sudo</span> brctl delbr docker0
</code></pre></div><p>然后创建一个网桥 <code>bridge0</code>。</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">sudo</span> brctl addbr bridge0
<span class="token function">sudo</span> ip addr add 192.168.5.1/24 dev bridge0
<span class="token function">sudo</span> ip <span class="token function">link</span> <span class="token keyword">set</span> dev bridge0 up
</code></pre></div><p>查看确认网桥创建并启动。</p> <div class="language-shell extra-class"><pre class="language-shell"><code>ip addr show bridge0
4: bridge0: <span class="token operator">&lt;</span>BROADCAST,MULTICAST<span class="token operator">&gt;</span> mtu 1500 qdisc noop state UP group default
    link/ether 66:38:d0:0d:76:18 brd ff:ff:ff:ff:ff:ff
    inet 192.168.5.1/24 scope global bridge0
       valid_lft forever preferred_lft forever
</code></pre></div><p>在 Docker 配置文件 <code>/etc/docker/daemon.json</code> 中添加如下内容，即可将 Docker 默认桥接到创建的网桥上。</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;bridge&quot;</span><span class="token operator">:</span> <span class="token string">&quot;bridge0&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>启动 Docker 服务。</p> <p>新建一个容器，可以看到它已经桥接到了 <code>bridge0</code> 上。</p> <p>可以继续用 <code>brctl show</code> 命令查看桥接的信息。另外，在容器中可以使用 <code>ip addr</code> 和 <code>ip route</code> 命令来查看 IP 地址配置和路由信息。</p> <h2 id="工具和示例"><a href="#工具和示例" aria-hidden="true" class="header-anchor">#</a> 工具和示例</h2> <p>在介绍自定义网络拓扑之前，你可能会对一些外部工具和例子感兴趣：</p> <h3 id="pipework"><a href="#pipework" aria-hidden="true" class="header-anchor">#</a> pipework</h3> <p>Jérôme Petazzoni 编写了一个叫 <a href="https://github.com/jpetazzo/pipework" target="_blank" rel="noopener noreferrer">pipework<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 的 shell 脚本，可以帮助用户在比较复杂的场景中完成容器的连接。</p> <h3 id="playground"><a href="#playground" aria-hidden="true" class="header-anchor">#</a> playground</h3> <p>Brandon Rhodes 创建了一个提供完整的 Docker 容器网络拓扑管理的 <a href="https://github.com/brandon-rhodes/fopnp/tree/m/playground" target="_blank" rel="noopener noreferrer">Python库<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，包括路由、NAT 防火墙；以及一些提供 HTTP, SMTP, POP, IMAP, Telnet, SSH, FTP 的服务器。</p> <h2 id="编辑网络配置文件"><a href="#编辑网络配置文件" aria-hidden="true" class="header-anchor">#</a> 编辑网络配置文件</h2> <p>Docker 1.2.0 开始支持在运行中的容器里编辑 <code>/etc/hosts</code>, <code>/etc/hostname</code> 和 <code>/etc/resolv.conf</code> 文件。</p> <p>但是这些修改是临时的，只在运行的容器中保留，容器终止或重启后并不会被保存下来，也不会被 <code>docker commit</code> 提交。</p> <h2 id="示例：创建一个点到点连接"><a href="#示例：创建一个点到点连接" aria-hidden="true" class="header-anchor">#</a> 示例：创建一个点到点连接</h2> <p>默认情况下，Docker 会将所有容器连接到由 <code>docker0</code> 提供的虚拟子网中。</p> <p>用户有时候需要两个容器之间可以直连通信，而不用通过主机网桥进行桥接。</p> <p>解决办法很简单：创建一对 <code>peer</code> 接口，分别放到两个容器中，配置成点到点链路类型即可。</p> <p>首先启动 2 个容器：</p> <div class="language-shell extra-class"><pre class="language-shell"><code>docker run -i -t --rm --net<span class="token operator">=</span>none base /bin/bash
root@1f1f4c1f931a:/<span class="token comment">#</span>
docker run -i -t --rm --net<span class="token operator">=</span>none base /bin/bash
root@12e343489d2f:/<span class="token comment">#</span>
</code></pre></div><p>找到进程号，然后创建网络命名空间的跟踪文件。</p> <div class="language-shell extra-class"><pre class="language-shell"><code>docker inspect -f <span class="token string">'{{.State.Pid}}'</span> 1f1f4c1f931a
2989
docker inspect -f <span class="token string">'{{.State.Pid}}'</span> 12e343489d2f
3004
<span class="token function">sudo</span> <span class="token function">mkdir</span> -p /var/run/netns
<span class="token function">sudo</span> <span class="token function">ln</span> -s /proc/2989/ns/net /var/run/netns/2989
<span class="token function">sudo</span> <span class="token function">ln</span> -s /proc/3004/ns/net /var/run/netns/3004
</code></pre></div><p>创建一对 <code>peer</code> 接口，然后配置路由</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">sudo</span> ip <span class="token function">link</span> add A <span class="token function">type</span> veth peer name B

<span class="token function">sudo</span> ip <span class="token function">link</span> <span class="token keyword">set</span> A netns 2989
<span class="token function">sudo</span> ip netns <span class="token function">exec</span> 2989 ip addr add 10.1.1.1/32 dev A
<span class="token function">sudo</span> ip netns <span class="token function">exec</span> 2989 ip <span class="token function">link</span> <span class="token keyword">set</span> A up
<span class="token function">sudo</span> ip netns <span class="token function">exec</span> 2989 ip route add 10.1.1.2/32 dev A

<span class="token function">sudo</span> ip <span class="token function">link</span> <span class="token keyword">set</span> B netns 3004
<span class="token function">sudo</span> ip netns <span class="token function">exec</span> 3004 ip addr add 10.1.1.2/32 dev B
<span class="token function">sudo</span> ip netns <span class="token function">exec</span> 3004 ip <span class="token function">link</span> <span class="token keyword">set</span> B up
<span class="token function">sudo</span> ip netns <span class="token function">exec</span> 3004 ip route add 10.1.1.1/32 dev B
</code></pre></div><p>现在这 2 个容器就可以相互 ping 通，并成功建立连接。点到点链路不需要子网和子网掩码。</p> <p>此外，也可以不指定 <code>--net=none</code> 来创建点到点链路。这样容器还可以通过原先的网络来通信。</p> <p>利用类似的办法，可以创建一个只跟主机通信的容器。但是一般情况下，更推荐使用 <code>--icc=false</code> 来关闭容器之间的通信。</p></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/cloud/Docker/Network.html" class="prev">
          Docker 中的网络功能介绍
        </a></span> <span class="next"><a href="/cloud/Docker/compose.html">
          Docker 三剑客之 Docker Compose
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/app.365f7fea.js" defer></script><script src="/assets/js/23.ee7c5e7e.js" defer></script>
  </body>
</html>
