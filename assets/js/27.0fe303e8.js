(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{176:function(t,s,e){"use strict";e.r(s);var a=e(0),r=Object(a.a)({},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"content"},[t._m(0),t._v(" "),t._m(1),t._v(" "),t._m(2),t._v(" "),e("p",[t._v("大部分时候，并不需要严格区分这两者的概念。")]),t._v(" "),t._m(3),t._v(" "),e("p",[t._v("目前 Docker 官方维护了一个公共仓库 "),e("a",{attrs:{href:"https://hub.docker.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Docker Hub"),e("OutboundLink")],1),t._v("，其中已经包括了数量超过 15,000 的镜像。大部分需求都可以通过在 Docker Hub 中直接下载镜像来实现。")]),t._v(" "),t._m(4),t._v(" "),e("p",[t._v("你可以在 "),e("a",{attrs:{href:"https://hub.docker.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://hub.docker.com"),e("OutboundLink")],1),t._v(" 免费注册一个 Docker 账号。")]),t._v(" "),t._m(5),t._v(" "),t._m(6),t._v(" "),t._m(7),t._v(" "),t._m(8),t._v(" "),t._m(9),t._v(" "),t._m(10),t._v(" "),t._m(11),e("p",[t._v("可以看到返回了很多包含关键字的镜像，其中包括镜像名字、描述、收藏数（表示该镜像的受关注程度）、是否官方创建、是否自动创建。")]),t._v(" "),e("p",[t._v("官方的镜像说明是官方项目组创建和维护的，automated 资源允许用户验证镜像的来源和内容。")]),t._v(" "),e("p",[t._v("根据是否是官方提供，可将镜像资源分为两类。")]),t._v(" "),t._m(12),t._v(" "),t._m(13),t._v(" "),t._m(14),t._v(" "),t._m(15),t._v(" "),t._m(16),t._m(17),t._v(" "),t._m(18),t._v(" "),t._m(19),t._v(" "),t._m(20),t._m(21),t._v(" "),e("p",[t._v("自动创建（Automated Builds）功能对于需要经常升级镜像内程序来说，十分方便。")]),t._v(" "),e("p",[t._v("有时候，用户创建了镜像，安装了某个软件，如果软件发布新版本则需要手动更新镜像。")]),t._v(" "),e("p",[t._v("而自动创建允许用户通过 Docker Hub 指定跟踪一个目标网站（目前支持 "),e("a",{attrs:{href:"https://github.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("GitHub"),e("OutboundLink")],1),t._v(" 或 "),e("a",{attrs:{href:"https://bitbucket.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("BitBucket"),e("OutboundLink")],1),t._v("）上的项目，一旦项目发生新的提交或者创建新的标签（tag），Docker Hub 会自动构建镜像并推送到 Docker Hub 中。")]),t._v(" "),e("p",[t._v("要配置自动创建，包括如下的步骤：")]),t._v(" "),e("ul",[e("li",[t._v("创建并登录 Docker Hub，以及目标网站；")]),t._v(" "),e("li",[t._v("在目标网站中连接帐户到 Docker Hub；")]),t._v(" "),e("li",[t._v("在 Docker Hub 中 "),e("a",{attrs:{href:"https://registry.hub.docker.com/builds/add/",target:"_blank",rel:"noopener noreferrer"}},[t._v("配置一个自动创建"),e("OutboundLink")],1),t._v("；")]),t._v(" "),t._m(22),t._v(" "),t._m(23)]),t._v(" "),e("p",[t._v("之后，可以在 Docker Hub 的 "),e("a",{attrs:{href:"https://registry.hub.docker.com/builds/",target:"_blank",rel:"noopener noreferrer"}},[t._v("自动创建页面"),e("OutboundLink")],1),t._v(" 中跟踪每次创建的状态。")]),t._v(" "),t._m(24),t._v(" "),e("p",[t._v("有时候使用 Docker Hub 这样的公共仓库可能不方便，用户可以创建一个本地仓库供私人使用。")]),t._v(" "),e("p",[t._v("本节介绍如何使用本地仓库。")]),t._v(" "),e("p",[e("a",{attrs:{href:"https://docs.docker.com/registry/",target:"_blank",rel:"noopener noreferrer"}},[e("code",[t._v("docker-registry")]),e("OutboundLink")],1),t._v(" 是官方提供的工具，可以用于构建私有的镜像仓库。本文内容基于 "),e("a",{attrs:{href:"https://github.com/docker/distribution",target:"_blank",rel:"noopener noreferrer"}},[e("code",[t._v("docker-registry")]),e("OutboundLink")],1),t._v("v2.x 版本。")]),t._v(" "),t._m(25),t._v(" "),t._m(26),t._v(" "),t._m(27),t._v(" "),t._m(28),t._m(29),t._v(" "),t._m(30),t._m(31),t._v(" "),t._m(32),t._v(" "),e("p",[t._v("先在本机查看已有的镜像。")]),t._v(" "),t._m(33),t._m(34),t._v(" "),t._m(35),t._v(" "),t._m(36),t._m(37),t._v(" "),t._m(38),t._m(39),t._v(" "),t._m(40),t._m(41),t._v(" "),e("p",[t._v("先删除已有镜像，再尝试从私有仓库中下载这个镜像。")]),t._v(" "),t._m(42),t._m(43),t._v(" "),t._m(44),t._v(" "),t._m(45),t._v(" "),t._m(46),t._v(" "),t._m(47),t._v(" "),t._m(48),e("p",[t._v("重新启动服务。")]),t._v(" "),t._m(49),t._m(50),t._v(" "),t._m(51),t._v(" "),t._m(52),t._m(53),t._v(" "),t._m(54),t._v(" "),t._m(55),t._v(" "),t._m(56),t._v(" "),t._m(57),t._v(" "),e("p",[t._v("新建一个文件夹，以下步骤均在该文件夹中进行。")]),t._v(" "),t._m(58),t._v(" "),t._m(59),t._v(" "),t._m(60),t._v(" "),t._m(61),t._v(" "),t._m(62),t._m(63),t._v(" "),t._m(64),t._m(65),t._v(" "),t._m(66),t._v(" "),t._m(67),e("p",[t._v("第四步签发根证书。")]),t._v(" "),t._m(68),t._m(69),t._v(" "),t._m(70),e("p",[t._v("第六步使用私钥生成证书请求文件。")]),t._v(" "),t._m(71),t._m(72),t._v(" "),t._m(73),t._m(74),t._v(" "),t._m(75),t._m(76),t._v(" "),t._m(77),t._v(" "),t._m(78),t._v(" "),t._m(79),t._v(" "),t._m(80),t._m(81),t._v(" "),t._m(82),t._m(83),t._v(" "),t._m(84),t._v(" "),t._m(85),t._m(86),t._v(" "),t._m(87),t._v(" "),t._m(88),t._m(89),t._v(" "),t._m(90),e("p",[t._v("这样我们就搭建好了一个具有权限认证、TLS 的私有仓库，接下来我们测试其功能是否正常。")]),t._v(" "),t._m(91),t._v(" "),t._m(92),t._v(" "),t._m(93),e("p",[t._v("登录到私有仓库。")]),t._v(" "),t._m(94),e("p",[t._v("尝试推送、拉取镜像。")]),t._v(" "),t._m(95),e("p",[t._v("如果我们退出登录，尝试推送镜像。")]),t._v(" "),t._m(96),e("p",[t._v("发现会提示没有登录，不能将镜像推送到私有仓库中。")]),t._v(" "),t._m(97),t._v(" "),e("p",[t._v("如果你本机占用了 "),e("code",[t._v("443")]),t._v(" 端口，你可以配置 "),e("a",{attrs:{href:"https://docs.docker.com/registry/recipes/nginx/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Nginx 代理"),e("OutboundLink")],1),t._v("，这里不再赘述。")]),t._v(" "),t._m(98),t._v(" "),e("p",[t._v("使用 Docker 官方的 Registry 创建的仓库面临一些维护问题。比如某些镜像删除以后空间默认是不会回收的，需要一些命令去回收空间然后重启 Registry 程序。在企业中把内部的一些工具包放入 Nexus 中是比较常见的做法，最新版本 "),e("code",[t._v("Nexus3.x")]),t._v(" 全面支持 Docker 的私有镜像。所以使用 "),e("a",{attrs:{href:"https://www.sonatype.com/download-oss-sonatype/",target:"_blank",rel:"noopener noreferrer"}},[e("code",[t._v("Nexus3.x")]),e("OutboundLink")],1),t._v(" 一个软件来管理 "),e("code",[t._v("Docker")]),t._v(" , "),e("code",[t._v("Maven")]),t._v(" , "),e("code",[t._v("Yum")]),t._v(" , "),e("code",[t._v("PyPI")]),t._v(" 等是一个明智的选择。")]),t._v(" "),t._m(99),t._v(" "),t._m(100),t._m(101),t._v(" "),t._m(102),t._v(" "),t._m(103),t._v(" "),t._m(104),t._v(" "),t._m(105),t._v(" "),e("p",[t._v("其它的仓库创建方法请各位自己摸索，还可以创建一个 docker (proxy) 类型的仓库链接到 DockerHub 上。再创建一个 docker (group) 类型的仓库把刚才的 hosted 与 proxy 添加在一起。主机在访问的时候默认下载私有仓库中的镜像，如果没有将链接到 DockerHub 中下载并缓存到 Nexus 中。")]),t._v(" "),t._m(106),t._v(" "),t._m(107),t._v(" "),t._m(108),t._v(" "),t._m(109),t._v(" "),t._m(110),t._v(" "),e("p",[t._v("证书的生成请参见 "),e("a",{attrs:{href:"https://yeasy.gitbooks.io/docker_practice/repository/registry_auth.html",target:"_blank",rel:"noopener noreferrer"}},[e("code",[t._v("私有仓库高级配置")]),e("OutboundLink")],1),t._v(" 里面证书生成一节。")]),t._v(" "),e("p",[t._v("NGINX 示例配置如下")]),t._v(" "),t._m(111),t._m(112),t._v(" "),e("p",[t._v("如果不启用 SSL 加密可以通过前面章节的方法添加信任地址到 Docker 的配置文件中然后重启 Docker")]),t._v(" "),e("p",[t._v("使用 SSL 加密以后程序需要访问就不能采用修改配置的访问了。具体方法如下：")]),t._v(" "),t._m(113),t._m(114)])},[function(){var t=this.$createElement,s=this._self._c||t;return s("h1",{attrs:{id:"访问仓库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#访问仓库","aria-hidden":"true"}},[this._v("#")]),this._v(" 访问仓库")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("仓库（"),s("code",[this._v("Repository")]),this._v("）是集中存放镜像的地方。")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("p",[t._v("一个容易混淆的概念是注册服务器（"),e("code",[t._v("Registry")]),t._v("）。实际上注册服务器是管理仓库的具体服务器，每个服务器上可以有多个仓库，而每个仓库下面有多个镜像。从这方面来说，仓库可以被认为是一个具体的项目或目录。例如对于仓库地址 "),e("code",[t._v("dl.dockerpool.com/ubuntu")]),t._v(" 来说，"),e("code",[t._v("dl.dockerpool.com")]),t._v(" 是注册服务器地址，"),e("code",[t._v("ubuntu")]),t._v(" 是仓库名。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"docker-hub"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker-hub","aria-hidden":"true"}},[this._v("#")]),this._v(" Docker Hub")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"注册"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#注册","aria-hidden":"true"}},[this._v("#")]),this._v(" 注册")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"登录"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#登录","aria-hidden":"true"}},[this._v("#")]),this._v(" 登录")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("可以通过执行 "),s("code",[this._v("docker login")]),this._v(" 命令交互式的输入用户名及密码来完成在命令行界面登录 Docker Hub。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("你可以通过 "),s("code",[this._v("docker logout")]),this._v(" 退出登录。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"拉取镜像"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#拉取镜像","aria-hidden":"true"}},[this._v("#")]),this._v(" 拉取镜像")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("你可以通过 "),s("code",[this._v("docker search")]),this._v(" 命令来查找官方仓库中的镜像，并利用 "),s("code",[this._v("docker pull")]),this._v(" 命令来将它下载到本地。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("例如以 "),s("code",[this._v("centos")]),this._v(" 为关键词进行搜索：")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("docker search centos\nNAME                                            DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED\ncentos                                          The official build of CentOS.                   465       "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("OK"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\ntianon/centos                                   CentOS 5 and 6, created using rinse instea"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".   28\nblalor/centos                                   Bare-bones base CentOS 6.5 image                6                    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("OK"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nsaltstack/centos-6-minimal                                                                      6                    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("OK"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\ntutum/centos-6.4                                DEPRECATED. Use tutum/centos:6.4 instead. "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".   5                    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("OK"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("一种是类似 "),s("code",[this._v("centos")]),this._v(" 这样的镜像，被称为基础镜像或根镜像。这些基础镜像由 Docker 公司创建、验证、支持、提供。这样的镜像往往使用单个单词作为名字。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("还有一种类型，比如 "),s("code",[this._v("tianon/centos")]),this._v(" 镜像，它是由 Docker 的用户创建并维护的，往往带有用户名称前缀。可以通过前缀 "),s("code",[this._v("username/")]),this._v(" 来指定使用某个用户提供的镜像，比如 tianon 用户。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("另外，在查找的时候通过 "),s("code",[this._v("--filter=stars=N")]),this._v(" 参数可以指定仅显示收藏数量为 "),s("code",[this._v("N")]),this._v(" 以上的镜像。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("下载官方 "),s("code",[this._v("centos")]),this._v(" 镜像到本地。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[this._v("docker pull centos\nPulling repository centos\n0b443ba03958: Download complete\n539c0211cd76: Download complete\n511136ea3c5a: Download complete\n7064731afe90: Download complete\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"推送镜像"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#推送镜像","aria-hidden":"true"}},[this._v("#")]),this._v(" 推送镜像")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("用户也可以在登录后通过 "),s("code",[this._v("docker push")]),this._v(" 命令来将自己的镜像推送到 Docker Hub。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("以下命令中的 "),s("code",[this._v("username")]),this._v(" 请替换为你的 Docker 账号用户名。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[this._v("docker tag ubuntu:18.04 username/ubuntu:18.04\n\ndocker image "),s("span",{pre:!0,attrs:{class:"token function"}},[this._v("ls")]),this._v("\n\nREPOSITORY                                               TAG                    IMAGE ID            CREATED             SIZE\nubuntu                                                   18.04                  275d79972a86        6 days ago          94.6MB\nusername/ubuntu                                          18.04                  275d79972a86        6 days ago          94.6MB\n\ndocker push username/ubuntu:18.04\n\ndocker search username\n\nNAME                      DESCRIPTION                                     STARS               OFFICIAL            AUTOMATED\nusername/ubuntu\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"自动创建"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#自动创建","aria-hidden":"true"}},[this._v("#")]),this._v(" 自动创建")])},function(){var t=this.$createElement,s=this._self._c||t;return s("li",[this._v("选取一个目标网站中的项目（需要含 "),s("code",[this._v("Dockerfile")]),this._v("）和分支；")])},function(){var t=this.$createElement,s=this._self._c||t;return s("li",[this._v("指定 "),s("code",[this._v("Dockerfile")]),this._v(" 的位置，并提交创建。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"私有仓库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#私有仓库","aria-hidden":"true"}},[this._v("#")]),this._v(" 私有仓库")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"安装运行-docker-registry"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装运行-docker-registry","aria-hidden":"true"}},[this._v("#")]),this._v(" 安装运行 docker-registry")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"容器运行"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#容器运行","aria-hidden":"true"}},[this._v("#")]),this._v(" 容器运行")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("你可以通过获取官方 "),s("code",[this._v("registry")]),this._v(" 镜像来运行。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[this._v("docker run -d -p 5000:5000 --restart"),s("span",{pre:!0,attrs:{class:"token operator"}},[this._v("=")]),this._v("always --name registry registry\n")])])])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("p",[t._v("这将使用官方的 "),e("code",[t._v("registry")]),t._v(" 镜像来启动私有仓库。默认情况下，仓库会被创建在容器的 "),e("code",[t._v("/var/lib/registry")]),t._v(" 目录下。你可以通过 "),e("code",[t._v("-v")]),t._v(" 参数来将镜像文件存放在本地的指定路径。例如下面的例子将上传的镜像放到本地的 "),e("code",[t._v("/opt/data/registry")]),t._v(" 目录。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[this._v("docker run -d \\\n    -p 5000:5000 \\\n    -v /opt/data/registry:/var/lib/registry \\\n    registry\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"在私有仓库上传、搜索、下载镜像"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#在私有仓库上传、搜索、下载镜像","aria-hidden":"true"}},[this._v("#")]),this._v(" 在私有仓库上传、搜索、下载镜像")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("创建好私有仓库之后，就可以使用 "),s("code",[this._v("docker tag")]),this._v(" 来标记一个镜像，然后推送它到仓库。例如私有仓库地址为 "),s("code",[this._v("127.0.0.1:5000")]),this._v("。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[this._v("docker image "),s("span",{pre:!0,attrs:{class:"token function"}},[this._v("ls")]),this._v("\nREPOSITORY                        TAG                 IMAGE ID            CREATED             VIRTUAL SIZE\nubuntu                            latest              ba5877dc9bec        6 weeks ago         192.7 MB\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("使用 "),s("code",[this._v("docker tag")]),this._v(" 将 "),s("code",[this._v("ubuntu:latest")]),this._v(" 这个镜像标记为 "),s("code",[this._v("127.0.0.1:5000/ubuntu:latest")]),this._v("。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("格式为 "),s("code",[this._v("docker tag IMAGE[:TAG] [REGISTRY_HOST[:REGISTRY_PORT]/]REPOSITORY[:TAG]")]),this._v("。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[this._v("docker tag ubuntu:latest 127.0.0.1:5000/ubuntu:latest\ndocker image "),s("span",{pre:!0,attrs:{class:"token function"}},[this._v("ls")]),this._v("\nREPOSITORY                        TAG                 IMAGE ID            CREATED             VIRTUAL SIZE\nubuntu                            latest              ba5877dc9bec        6 weeks ago         192.7 MB\n127.0.0.1:5000/ubuntu:latest      latest              ba5877dc9bec        6 weeks ago         192.7 MB\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("使用 "),s("code",[this._v("docker push")]),this._v(" 上传标记的镜像。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[this._v("docker push 127.0.0.1:5000/ubuntu:latest\nThe push refers to repository "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[this._v("[")]),this._v("127.0.0.1:5000/ubuntu"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[this._v("]")]),this._v("\n373a30c24545: Pushed\na9148f5200b0: Pushed\ncdd3de0940ab: Pushed\nfc56279bbb33: Pushed\nb38367233d37: Pushed\n2aebd096e0e2: Pushed\nlatest: digest: sha256:fe4277621f10b5026266932ddf760f5a756d2facd505a94d2da12f4f52f71f5a size: 1568\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("用 "),s("code",[this._v("curl")]),this._v(" 查看仓库中的镜像。")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" 127.0.0.1:5000/v2/_catalog\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"repositories"')]),t._v(":"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ubuntu"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("这里可以看到 "),s("code",[this._v('{"repositories":["ubuntu"]}')]),this._v("，表明镜像已经被成功上传了。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[this._v("docker image "),s("span",{pre:!0,attrs:{class:"token function"}},[this._v("rm")]),this._v(" 127.0.0.1:5000/ubuntu:latest\n\ndocker pull 127.0.0.1:5000/ubuntu:latest\nPulling repository 127.0.0.1:5000/ubuntu:latest\nba5877dc9bec: Download complete\n511136ea3c5a: Download complete\n9bad880da3d2: Download complete\n25f11f5fb0cb: Download complete\nebc34468f71d: Download complete\n2318d26665ef: Download complete\n\ndocker image "),s("span",{pre:!0,attrs:{class:"token function"}},[this._v("ls")]),this._v("\nREPOSITORY                         TAG                 IMAGE ID            CREATED             VIRTUAL SIZE\n127.0.0.1:5000/ubuntu:latest       latest              ba5877dc9bec        6 weeks ago         192.7 MB\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"注意事项"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#注意事项","aria-hidden":"true"}},[this._v("#")]),this._v(" 注意事项")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("如果你不想使用 "),s("code",[this._v("127.0.0.1:5000")]),this._v(" 作为仓库地址，比如想让本网段的其他主机也能把镜像推送到私有仓库。你就得把例如 "),s("code",[this._v("192.168.199.100:5000")]),this._v(" 这样的内网地址作为私有仓库地址，这时你会发现无法成功推送镜像。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("这是因为 Docker 默认不允许非 "),s("code",[this._v("HTTPS")]),this._v(" 方式推送镜像。我们可以通过 Docker 的配置选项来取消这个限制，或者查看下一节配置能够通过 "),s("code",[this._v("HTTPS")]),this._v(" 访问的私有仓库。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"ubuntu-14-04-debian-7-wheezy"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ubuntu-14-04-debian-7-wheezy","aria-hidden":"true"}},[this._v("#")]),this._v(" Ubuntu 14.04, Debian 7 Wheezy")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("对于使用 "),s("code",[this._v("upstart")]),this._v(" 的系统而言，编辑 "),s("code",[this._v("/etc/default/docker")]),this._v(" 文件，在其中的 "),s("code",[this._v("DOCKER_OPTS")]),this._v(" 中增加如下内容：")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[this._v("DOCKER_OPTS"),s("span",{pre:!0,attrs:{class:"token operator"}},[this._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[this._v('"--registry-mirror=https://registry.docker-cn.com --insecure-registries=192.168.199.100:5000"')]),this._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[this._v("sudo")]),this._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[this._v("service")]),this._v(" docker restart\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"ubuntu-16-04-debian-8-centos-7"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ubuntu-16-04-debian-8-centos-7","aria-hidden":"true"}},[this._v("#")]),this._v(" Ubuntu 16.04+, Debian 8+, centos 7")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("对于使用 "),s("code",[this._v("systemd")]),this._v(" 的系统，请在 "),s("code",[this._v("/etc/docker/daemon.json")]),this._v(" 中写入如下内容（如果文件不存在请新建该文件）")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-json extra-class"},[e("pre",{pre:!0,attrs:{class:"language-json"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"registry-mirror"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://registry.docker-cn.com"')]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"insecure-registries"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"192.168.199.100:5000"')]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("blockquote",[s("p",[this._v("注意：该文件必须符合 "),s("code",[this._v("json")]),this._v(" 规范，否则 Docker 将不能启动。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"其他"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#其他","aria-hidden":"true"}},[this._v("#")]),this._v(" 其他")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("对于 Docker for Windows 、 Docker for Mac 在设置中编辑 "),s("code",[this._v("daemon.json")]),this._v(" 增加和上边一样的字符串即可。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"私有仓库高级配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#私有仓库高级配置","aria-hidden":"true"}},[this._v("#")]),this._v(" 私有仓库高级配置")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("上一节我们搭建了一个具有基础功能的私有仓库，本小节我们来使用 "),s("code",[this._v("Docker Compose")]),this._v(" 搭建一个拥有权限认证、TLS 的私有仓库。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"准备站点证书"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#准备站点证书","aria-hidden":"true"}},[this._v("#")]),this._v(" 准备站点证书")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("如果你拥有一个域名，国内各大云服务商均提供免费的站点证书。你也可以使用 "),s("code",[this._v("openssl")]),this._v(" 自行签发证书。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("这里假设我们将要搭建的私有仓库地址为 "),s("code",[this._v("docker.domain.com")]),this._v("，下面我们介绍使用 "),s("code",[this._v("openssl")]),this._v(" 自行签发 "),s("code",[this._v("docker.domain.com")]),this._v(" 的站点 SSL 证书。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("第一步创建 "),s("code",[this._v("CA")]),this._v(" 私钥。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[this._v("openssl genrsa -out "),s("span",{pre:!0,attrs:{class:"token string"}},[this._v('"root-ca.key"')]),this._v(" 4096\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("第二步利用私钥创建 "),s("code",[this._v("CA")]),this._v(" 根证书请求文件。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[this._v("openssl req \\\n          -new -key "),s("span",{pre:!0,attrs:{class:"token string"}},[this._v('"root-ca.key"')]),this._v(" \\\n          -out "),s("span",{pre:!0,attrs:{class:"token string"}},[this._v('"root-ca.csr"')]),this._v(" -sha256 \\\n          -subj "),s("span",{pre:!0,attrs:{class:"token string"}},[this._v("'/C=CN/ST=Shanxi/L=Datong/O=Your Company Name/CN=Your Company Name Docker Registry CA'")]),this._v("\n")])])])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("blockquote",[e("p",[t._v("以上命令中 "),e("code",[t._v("-subj")]),t._v(" 参数里的 "),e("code",[t._v("/C")]),t._v(" 表示国家，如 "),e("code",[t._v("CN")]),t._v("；"),e("code",[t._v("/ST")]),t._v(" 表示省；"),e("code",[t._v("/L")]),t._v(" 表示城市或者地区；"),e("code",[t._v("/O")]),t._v(" 表示组织名；"),e("code",[t._v("/CN")]),t._v(" 通用名称。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("第三步配置 "),s("code",[this._v("CA")]),this._v(" 根证书，新建 "),s("code",[this._v("root-ca.cnf")]),this._v("。")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root_ca"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nbasicConstraints "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" critical,CA:TRUE,pathlen:1\nkeyUsage "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" critical, nonRepudiation, cRLSign, keyCertSign\nsubjectKeyIdentifier"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("hash\n")])])])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("openssl x509 -req  -days 3650  -in "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"root-ca.csr"')]),t._v(" \\\n               -signkey "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"root-ca.key"')]),t._v(" -sha256 -out "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"root-ca.crt"')]),t._v(" \\\n               -extfile "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"root-ca.cnf"')]),t._v(" -extensions \\\n               root_ca\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("第五步生成站点 "),s("code",[this._v("SSL")]),this._v(" 私钥。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[this._v("openssl genrsa -out "),s("span",{pre:!0,attrs:{class:"token string"}},[this._v('"docker.domain.com.key"')]),this._v(" 4096\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[this._v("openssl req -new -key "),s("span",{pre:!0,attrs:{class:"token string"}},[this._v('"docker.domain.com.key"')]),this._v(" -out "),s("span",{pre:!0,attrs:{class:"token string"}},[this._v('"site.csr"')]),this._v(" -sha256 \\\n          -subj "),s("span",{pre:!0,attrs:{class:"token string"}},[this._v("'/C=CN/ST=Shanxi/L=Datong/O=Your Company Name/CN=docker.domain.com'")]),this._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("第七步配置证书，新建 "),s("code",[this._v("site.cnf")]),this._v(" 文件。")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("server"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nauthorityKeyIdentifier"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("keyid,issuer\nbasicConstraints "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" critical,CA:FALSE\nextendedKeyUsage"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("serverAuth\nkeyUsage "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" critical, digitalSignature, keyEncipherment\nsubjectAltName "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" DNS:docker.domain.com, IP:127.0.0.1\nsubjectKeyIdentifier"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("hash\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("第八步签署站点 "),s("code",[this._v("SSL")]),this._v(" 证书。")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("openssl x509 -req -days 750 -in "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"site.csr"')]),t._v(" -sha256 \\\n    -CA "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"root-ca.crt"')]),t._v(" -CAkey "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"root-ca.key"')]),t._v("  -CAcreateserial \\\n    -out "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"docker.domain.com.crt"')]),t._v(" -extfile "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"site.cnf"')]),t._v(" -extensions server\n")])])])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("p",[t._v("这样已经拥有了 "),e("code",[t._v("docker.domain.com")]),t._v(" 的网站 SSL 私钥 "),e("code",[t._v("docker.domain.com.key")]),t._v(" 和 SSL 证书 "),e("code",[t._v("docker.domain.com.crt")]),t._v(" 及 CA 根证书 "),e("code",[t._v("root-ca.crt")]),t._v("。")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("p",[t._v("新建 "),e("code",[t._v("ssl")]),t._v(" 文件夹并将 "),e("code",[t._v("docker.domain.com.key")]),t._v(" "),e("code",[t._v("docker.domain.com.crt")]),t._v(" "),e("code",[t._v("root-ca.crt")]),t._v(" 这三个文件移入，删除其他文件。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"配置私有仓库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置私有仓库","aria-hidden":"true"}},[this._v("#")]),this._v(" 配置私有仓库")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("私有仓库默认的配置文件位于 "),s("code",[this._v("/etc/docker/registry/config.yml")]),this._v("，我们先在本地编辑 "),s("code",[this._v("config.yml")]),this._v("，之后挂载到容器中。")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-yaml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.1")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("log")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("accesslog")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("disabled")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("level")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" debug\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("formatter")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" text\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("fields")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("service")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" registry\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" staging\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("storage")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("delete")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enabled")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cache")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("blobdescriptor")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" inmemory\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("filesystem")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("rootdirectory")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /var/lib/registry\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("auth")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("htpasswd")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("realm")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" basic"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("realm\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("path")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /etc/docker/registry/auth/nginx.htpasswd\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("http")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("addr")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" https"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//docker.domain.com\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("headers")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("X-Content-Type-Options")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("nosniff"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("http2")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("disabled")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("false")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tls")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("certificate")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /etc/docker/registry/ssl/docker.domain.com.crt\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("key")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /etc/docker/registry/ssl/docker.domain.com.key\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("health")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("storagedriver")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enabled")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("interval")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 10s\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("threshold")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"生成-http-认证文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#生成-http-认证文件","aria-hidden":"true"}},[this._v("#")]),this._v(" 生成 http 认证文件")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[this._v("mkdir")]),this._v(" auth\n\ndocker run --rm \\\n    --entrypoint htpasswd \\\n    registry \\\n    -Bbn username password "),s("span",{pre:!0,attrs:{class:"token operator"}},[this._v(">")]),this._v(" auth/nginx.htpasswd\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("blockquote",[s("p",[this._v("将上面的 "),s("code",[this._v("username")]),this._v(" "),s("code",[this._v("password")]),this._v(" 替换为你自己的用户名和密码。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"编辑-docker-compose-yml"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#编辑-docker-compose-yml","aria-hidden":"true"}},[this._v("#")]),this._v(" 编辑 "),s("code",[this._v("docker-compose.yml")])])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-yaml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'3'")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("registry")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" registry\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"443:443"')]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/etc/docker/registry\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" registry"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("data"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/var/lib/registry\n\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("registry-data")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"修改-hosts"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#修改-hosts","aria-hidden":"true"}},[this._v("#")]),this._v(" 修改 hosts")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("编辑 "),s("code",[this._v("/etc/hosts")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[this._v("127.0.0.1 docker.domain.com\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"启动"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#启动","aria-hidden":"true"}},[this._v("#")]),this._v(" 启动")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[this._v("docker-compose up -d\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"测试私有仓库功能"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#测试私有仓库功能","aria-hidden":"true"}},[this._v("#")]),this._v(" 测试私有仓库功能")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("由于自行签发的 CA 根证书不被系统信任，所以我们需要将 CA 根证书 "),s("code",[this._v("ssl/root-ca.crt")]),this._v(" 移入 "),s("code",[this._v("/etc/docker/certs.d/docker.domain.com")]),this._v(" 文件夹中。")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" -p /etc/docker/certs.d/docker.domain.com\n\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" ssl/root-ca.crt /etc/docker/certs.d/docker.domain.com/ca.crt\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[this._v("docker login docker.domain.com\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[this._v("docker pull ubuntu:18.04\n\ndocker tag ubuntu:18.04 docker.domain.com/username/ubuntu:18.04\n\ndocker push docker.domain.com/username/ubuntu:18.04\n\ndocker image "),s("span",{pre:!0,attrs:{class:"token function"}},[this._v("rm")]),this._v(" docker.domain.com/username/ubuntu:18.04\n\ndocker pull docker.domain.com/username/ubuntu:18.04\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[this._v("docker "),s("span",{pre:!0,attrs:{class:"token function"}},[this._v("logout")]),this._v(" docker.domain.com\n\ndocker push docker.domain.com/username/ubuntu:18.04\n\nno basic auth credentials\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"注意事项-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#注意事项-2","aria-hidden":"true"}},[this._v("#")]),this._v(" 注意事项")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"nexus3-x-的私有仓库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nexus3-x-的私有仓库","aria-hidden":"true"}},[this._v("#")]),this._v(" Nexus3.x 的私有仓库")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"启动-nexus-容器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#启动-nexus-容器","aria-hidden":"true"}},[this._v("#")]),this._v(" 启动 Nexus 容器")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[this._v("docker run -d --name nexus3 --restart"),s("span",{pre:!0,attrs:{class:"token operator"}},[this._v("=")]),this._v("always \\\n    -p 8081:8081 \\\n    --mount src"),s("span",{pre:!0,attrs:{class:"token operator"}},[this._v("=")]),this._v("nexus-data,target"),s("span",{pre:!0,attrs:{class:"token operator"}},[this._v("=")]),this._v("/nexus-data \\\n    sonatype/nexus3\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("等待 3-5 分钟，如果 "),s("code",[this._v("nexus3")]),this._v(" 容器没有异常退出，那么你可以使用浏览器打开 "),s("code",[this._v("http://YourIP:8081")]),this._v(" 访问 Nexus 了。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("第一次启动 Nexus 的默认帐号是 "),s("code",[this._v("admin")]),this._v(" 密码是 "),s("code",[this._v("admin123")]),this._v(" 登录以后点击页面上方的齿轮按钮进行设置。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"创建仓库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建仓库","aria-hidden":"true"}},[this._v("#")]),this._v(" 创建仓库")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("创建一个私有仓库的方法： "),s("code",[this._v("Repository->Repositories")]),this._v(" 点击右边菜单 "),s("code",[this._v("Create repository")]),this._v(" 选择 "),s("code",[this._v("docker (hosted)")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("Name: 仓库的名称")]),this._v(" "),s("li",[this._v("HTTP: 仓库单独的访问端口")]),this._v(" "),s("li",[this._v("Enable Docker V1 API: 如果需要同时支持 V1 版本请勾选此项（不建议勾选）。")]),this._v(" "),s("li",[this._v("Hosted -> Deployment pollcy: 请选择 Allow redeploy 否则无法上传 Docker 镜像。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"添加访问权限"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#添加访问权限","aria-hidden":"true"}},[this._v("#")]),this._v(" 添加访问权限")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("菜单 "),s("code",[this._v("Security->Realms")]),this._v(" 把 Docker Bearer Token Realm 移到右边的框中保存。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("添加用户规则：菜单 "),s("code",[this._v("Security->Roles")]),this._v("->"),s("code",[this._v("Create role")]),this._v(" 在 "),s("code",[this._v("Privlleges")]),this._v(" 选项搜索 docker 把相应的规则移动到右边的框中然后保存。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("添加用户：菜单 "),s("code",[this._v("Security->Users")]),this._v("->"),s("code",[this._v("Create local user")]),this._v(" 在 "),s("code",[this._v("Roles")]),this._v(" 选项中选中刚才创建的规则移动到右边的窗口保存。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"nginx-加密代理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nginx-加密代理","aria-hidden":"true"}},[this._v("#")]),this._v(" NGINX 加密代理")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-nginx extra-class"},[e("pre",{pre:!0,attrs:{class:"language-nginx"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("upstream")]),t._v(" register\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"YourHostName OR IP"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("5001")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#端口为上面添加的私有镜像仓库是设置的 HTTP 选项的端口号")]),t._v("\n    check interval"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),t._v(" rise"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" fall"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("timeout")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v(" type"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("http")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    check_http_send "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"HEAD / HTTP/1.0\\r\\n\\r\\n"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    check_http_expect_alive http_4xx"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server_name")]),t._v(" YourDomainName"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#如果没有 DNS 服务器做解析，请删除此选项使用本机 IP 地址访问")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("listen")]),t._v("       "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ssl")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ssl_certificate")]),t._v(" key"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("example"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("crt"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ssl_certificate_key")]),t._v(" key"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("example"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("key"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ssl_session_timeout")]),t._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("m"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ssl_protocols")]),t._v(" TLSv1 TLSv1"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" TLSv1"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ssl_ciphers")]),t._v("  HIGH"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("aNULL"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("MD5"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ssl_prefer_server_ciphers")]),t._v("   on"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("large_client_header_buffers")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("32")]),t._v("k"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("client_max_body_size")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("300")]),t._v("m"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("client_body_buffer_size")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("512")]),t._v("k"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_connect_timeout")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("600")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_read_timeout")]),t._v("   "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("600")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_send_timeout")]),t._v("   "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("600")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_buffer_size")]),t._v("    "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("128")]),t._v("k"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_buffers")]),t._v("       "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),t._v("k"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_busy_buffers_size")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("128")]),t._v("k"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_temp_file_write_size")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("512")]),t._v("k"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_set_header")]),t._v(" Host "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$host")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_set_header")]),t._v(" X"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Forwarded"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Proto "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$scheme")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_set_header")]),t._v(" X"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Forwarded"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Port "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$server_port")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_set_header")]),t._v(" X"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Forwarded"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("For "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$proxy_add_x_forwarded_for")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_http_version")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_set_header")]),t._v(" Upgrade "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$http_upgrade")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_set_header")]),t._v(" Connection "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$connection_upgrade")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_redirect")]),t._v(" off"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_set_header")]),t._v(" X"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Real"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("IP "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$remote_addr")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_pass")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("http")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("register"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_read_timeout")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("900")]),t._v("s"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("error_page")]),t._v("   "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("500")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("502")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("504")]),t._v("  "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),t._v("x"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"docker-主机访问镜像仓库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker-主机访问镜像仓库","aria-hidden":"true"}},[this._v("#")]),this._v(" Docker 主机访问镜像仓库")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("openssl s_client -showcerts -connect YourDomainName OR HostIP:443 "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("/dev/null 2"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("/dev/null"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("openssl x509 -outform PEM "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("ca.crt\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" ca.crt "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("tee")]),t._v(" -a /etc/ssl/certs/ca-certificates.crt\nsystemctl restart docker\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("使用 "),s("code",[this._v("docker login YourDomainName OR HostIP")]),this._v(" 进行测试，用户名密码填写上面 Nexus 中生成的。")])}],!1,null,null,null);r.options.__file="InterviewRegistry.md";s.default=r.exports}}]);