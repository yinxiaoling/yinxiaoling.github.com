(window.webpackJsonp=window.webpackJsonp||[]).push([[39],{188:function(t,e,s){"use strict";s.r(e);var n=s(0),a=Object(n.a)({},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"content"},[t._m(0),t._v(" "),s("p",[t._v("持续集成(Continuous integration)是一种软件开发实践，每次集成都通过自动化的构建（包括编译，发布，自动化测试）来验证，从而尽早地发现集成错误。")]),t._v(" "),s("p",[t._v("持续部署（continuous deployment）是通过自动化的构建、测试和部署循环来快速交付高质量的产品。")]),t._v(" "),t._m(1),t._v(" "),t._m(2),t._v(" "),t._m(3),t._v(" "),t._m(4),t._v(" "),t._m(5),t._v(" "),t._m(6),t._v(" "),t._m(7),t._v(" "),t._m(8),t._v(" "),s("p",[t._v("登录 GitHub，在 "),s("a",{attrs:{href:"https://github.com/settings/applications/new",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/settings/applications/new"),s("OutboundLink")],1),t._v(" 新建一个应用。")]),t._v(" "),t._m(9),t._v(" "),t._m(10),t._v(" "),t._m(11),t._v(" "),t._m(12),t._v(" "),t._m(13),t._m(14),t._v(" "),t._m(15),t._v(" "),t._m(16),t._v(" "),t._m(17),t._v(" "),t._m(18),t._v(" "),t._m(19),t._v(" "),t._m(20),t._v(" "),t._m(21),t._m(22),t._v(" "),t._m(23),t._v(" "),t._m(24),t._v(" "),t._m(25),t._v(" "),s("p",[t._v("在本机初始化一个 git 仓库")]),t._v(" "),t._m(26),t._m(27),t._v(" "),t._m(28),t._v(" "),t._m(29),t._m(30),t._v(" "),t._m(31),t._m(32),t._v(" "),t._m(33),t._v(" "),s("p",[t._v("现在目录结构如下")]),t._v(" "),t._m(34),t._m(35),t._v(" "),t._m(36),t._m(37),t._v(" "),t._m(38),t._v(" "),t._m(39),t._v(" "),s("p",[t._v("当然我们也可以把构建结果上传到 GitHub，Docker Registry，云服务商提供的对象存储，或者生产环境中。")]),t._v(" "),s("p",[t._v("本书 GitBook 也使用 Drone 进行 CI/CD，具体配置信息请查看本书根目录 "),s("a",{attrs:{href:"https://github.com/yeasy/docker_practice/blob/master/.drone.yml",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v(".drone.yml")]),s("OutboundLink")],1),t._v(" 文件。")]),t._v(" "),t._m(40),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://github.com/drone/drone",target:"_blank",rel:"noopener noreferrer"}},[t._v("Drone Github"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"http://docs.drone.io/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Drone 文档"),s("OutboundLink")],1)])]),t._v(" "),t._m(41),t._v(" "),s("p",[t._v("当代码提交到 GitHub 时，"),s("a",{attrs:{href:"https://travis-ci.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Travis CI"),s("OutboundLink")],1),t._v(" 会根据项目根目录 "),s("code",[t._v(".travis.yml")]),t._v(" 文件设置的指令，执行一系列操作。")]),t._v(" "),s("p",[t._v("本小节介绍如何在 Travis CI 中使用 Docker 进行持续集成/持续部署（CI/CD）。这里以当代码提交到 GitHub 时自动构建 Docker 镜像并推送到 Docker Hub 为例进行介绍。")]),t._v(" "),t._m(42),t._v(" "),s("p",[t._v("首先登录 "),s("a",{attrs:{href:"https://travis-ci.com/account/repositories",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://travis-ci.com/account/repositories"),s("OutboundLink")],1),t._v(" 选择 GitHub 仓库，按照指引安装 GitHub App 来启用 GitHub 仓库构建。")]),t._v(" "),t._m(43),t._v(" "),t._m(44),t._m(45),t._v(" "),t._m(46),t._m(47),t._v(" "),t._m(48),t._v(" "),s("p",[t._v("将项目推送到 GitHub, 登录 "),s("a",{attrs:{href:"https://travis-ci.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Travis CI"),s("OutboundLink")],1),t._v(" 查看构建详情。")])])},[function(){var t=this.$createElement,e=this._self._c||t;return e("h1",{attrs:{id:"实战-ci-cd"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#实战-ci-cd","aria-hidden":"true"}},[this._v("#")]),this._v(" 实战-CI/CD")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("与 "),e("code",[this._v("Jenkins")]),this._v(" 不同的是，基于 Docker 的 CI/CD 每一步都运行在 Docker 镜像中，所以理论上支持所有的编程语言。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"drone"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#drone","aria-hidden":"true"}},[this._v("#")]),this._v(" Drone")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[t._v("基于 "),s("code",[t._v("Docker")]),t._v(" 的 "),s("code",[t._v("CI/CD")]),t._v(" 工具 "),s("code",[t._v("Drone")]),t._v(" 所有编译、测试的流程都在 "),s("code",[t._v("Docker")]),t._v(" 容器中进行。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("开发者只需在项目中包含 "),e("code",[this._v(".drone.yml")]),this._v(" 文件，将代码推送到 git 仓库，"),e("code",[this._v("Drone")]),this._v(" 就能够自动化的进行编译、测试、发布。")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[t._v("本小节以 "),s("code",[t._v("GitHub")]),t._v(" + "),s("code",[t._v("Drone")]),t._v(" 来演示 "),s("code",[t._v("Drone")]),t._v(" 的工作流程。当然在实际开发过程中，你的代码也许不在 GitHub 托管，那么你可以尝试使用 "),s("code",[t._v("Gogs")]),t._v(" + "),s("code",[t._v("Drone")]),t._v(" 来进行 "),s("code",[t._v("CI/CD")]),t._v("。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"要求"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#要求","aria-hidden":"true"}},[this._v("#")]),this._v(" 要求")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ul",[s("li",[t._v("拥有公网 IP、域名 (如果你不满足要求，可以尝试在本地使用 Gogs + Drone)")]),t._v(" "),s("li",[t._v("域名 SSL 证书 (目前国内有很多云服务商提供免费证书)")]),t._v(" "),s("li",[t._v("熟悉 "),s("code",[t._v("Docker")]),t._v(" 以及 "),s("code",[t._v("Docker Compose")])]),t._v(" "),s("li",[t._v("熟悉 "),s("code",[t._v("Git")]),t._v(" 基本命令")]),t._v(" "),s("li",[t._v("对 "),s("code",[t._v("CI/CD")]),t._v(" 有一定了解")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"新建-github-应用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#新建-github-应用","aria-hidden":"true"}},[this._v("#")]),this._v(" 新建 GitHub 应用")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("img",{attrs:{src:"https://yeasy.gitbooks.io/docker_practice/cases/.image/drone-github.png",alt:"img"}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("接下来查看这个应用的详情，记录 "),e("code",[this._v("Client ID")]),this._v(" 和 "),e("code",[this._v("Client Secret")]),this._v("，之后配置 Drone 会用到。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"配置-drone"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置-drone","aria-hidden":"true"}},[this._v("#")]),this._v(" 配置 Drone")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("我们通过使用 "),e("code",[this._v("Docker Compose")]),this._v(" 来启动 "),e("code",[this._v("Drone")]),this._v("，编写 "),e("code",[this._v("docker-compose.yml")]),this._v(" 文件。")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'3'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("drone-server")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" drone/drone"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("0.8"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("alpine\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 443"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# - "${PRO_PUBLIC_IP}:8000:8000"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" drone"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/var/lib/drone/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("rw\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("SSL_PATH"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/etc/certs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("rw\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" DRONE_SECRET=drone\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" DRONE_OPEN=false\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" DRONE_ADMIN=$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("GITHUB_SERNAME"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" DRONE_HOST=$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("DRONE_HOST"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" DRONE_GITHUB=true\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" DRONE_GITHUB_CLIENT=$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("DRONE_GITHUB_CLIENT"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" DRONE_GITHUB_SECRET=$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("DRONE_GITHUB_SECRET"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" DRONE_SERVER_CERT=/etc/certs/drone.domain.com.crt\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" DRONE_SERVER_KEY=/etc/certs/drone.domain.com.key\n\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("drone-agent")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" drone/agent"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("0.8"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("alpine\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("depends_on")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" drone"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("server\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /var/run/docker.sock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/var/run/docker.sock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("rw\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" DRONE_SECRET=drone\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" DRONE_SERVER=drone"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("server"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("9000")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dns")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 114.114.114.114\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("drone-data")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("替换 "),e("code",[this._v("${SSL_PATH}")]),this._v(" 为你网站的 SSL 证书路径。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("替换 "),e("code",[this._v("${GITHUB_SERNAME}")]),this._v(" 为你 GitHub 的用户名，该用户将成为 Drone 的管理员。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("替换 "),e("code",[this._v("${DRONE_HOST}")]),this._v(" 为你部署 Drone 的域名。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("替换 "),e("code",[this._v("${DRONE_GITHUB_CLIENT}")]),this._v(" 为你 GitHub 应用的 "),e("code",[this._v("Client ID")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("替换 "),e("code",[this._v("${DRONE_GITHUB_SECRET}")]),this._v(" 为你 GitHub 应用的 "),e("code",[this._v("Client Secret")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("em",[this._v("注意：")]),this._v(" 如果你的服务器占用了 "),e("code",[this._v("443")]),this._v(" 端口，请配置 Nginx 代理，这里不再赘述。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"启动-drone"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#启动-drone","aria-hidden":"true"}},[this._v("#")]),this._v(" 启动 Drone")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("docker-compose up -d\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"drone-关联项目"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#drone-关联项目","aria-hidden":"true"}},[this._v("#")]),this._v(" Drone 关联项目")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("在 Github 新建一个名为 "),e("code",[this._v("drone-demo")]),this._v(" 的仓库。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("打开我们已经部署好的 Drone 网站，使用 GitHub 账号登录，在界面中关联刚刚新建的 "),e("code",[this._v("drone-demo")]),this._v(" 仓库。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"编写项目源代码"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#编写项目源代码","aria-hidden":"true"}},[this._v("#")]),this._v(" 编写项目源代码")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("mkdir drone-demo\n\ncd drone-demo\n\ngit init\n\ngit remote add origin git@github.com:username/drone-demo.git\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("这里以一个简单的 "),e("code",[this._v("Go")]),this._v(" 程序为例，该程序输出 "),e("code",[this._v("Hello World!")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("编写 "),e("code",[this._v("app.go")]),this._v(" 文件")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-go extra-class"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" main\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"fmt"')]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  \n    fmt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Printf")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Hello World!"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("编写 "),e("code",[this._v(".drone.yml")]),this._v(" 文件")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("workspace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("base")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /srv/drone"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("demo\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("path")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" .\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("pipeline")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("build")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n     "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" golang"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("alpine\n     "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# pull: true")]),t._v("\n     "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n       "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" KEY=VALUE\n     "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("secrets")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("key1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" key2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n     "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("commands")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n       "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" echo $$KEY\n       "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" pwd\n       "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ls\n       "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" CGO_ENABLED=0 GOOS=linux go build "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("a "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("installsuffix cgo "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("o app .\n       "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./app\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("code",[this._v("workspace")]),this._v(" 指明 git 源代码克隆的目标路径，本例中 git 源代码将被克隆到 golang 容器中的 "),e("code",[this._v("/srv/drone-demo")]),this._v(" 目录中。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("code",[this._v("pipeline")]),this._v(" 指明构建所需的 Docker 镜像，环境变量，编译指令等。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v(".\n├── .drone.yml\n└── app.go\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"推送项目源代码到-github"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#推送项目源代码到-github","aria-hidden":"true"}},[this._v("#")]),this._v(" 推送项目源代码到 GitHub")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('git add .\n\ngit commit -m "test drone ci"\n\ngit push origin master\n')])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"查看项目构建过程及结果"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#查看项目构建过程及结果","aria-hidden":"true"}},[this._v("#")]),this._v(" 查看项目构建过程及结果")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("打开我们部署好的 "),e("code",[this._v("Drone")]),this._v(" 网站，即可看到构建结果。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("img",{attrs:{src:"https://yeasy.gitbooks.io/docker_practice/cases/.image/drone-build.png",alt:"img"}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"参考链接"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#参考链接","aria-hidden":"true"}},[this._v("#")]),this._v(" 参考链接")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"在-travis-ci-中使用-docker"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#在-travis-ci-中使用-docker","aria-hidden":"true"}},[this._v("#")]),this._v(" 在 Travis CI 中使用 Docker")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"准备"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#准备","aria-hidden":"true"}},[this._v("#")]),this._v(" 准备")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("在项目根目录新建一个 "),e("code",[this._v("Dockerfile")]),this._v(" 文件。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-dockerfile extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('FROM alpine\n\nRUN echo "Hello World"\n')])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("新建 Travis CI 配置文件 "),e("code",[this._v(".travis.yml")]),this._v(" 文件。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-yml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('language: bash\n\ndist: xenial\n\nservices:\n  - docker\n\nbefore_script:\n  # 登录到 docker hub\n  - echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin\n\nscript:\n  # 这里编写测试代码的命令\n  - echo "test code"\n\nafter_success:\n  # 当代码测试通过后执行的命令\n  - docker build -t username/alpine .\n  - docker push username/alpine\n')])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("blockquote",[e("p",[this._v("请提前在 Travis CI 仓库设置页面配置 "),e("code",[this._v("DOCKER_PASSWORD")]),this._v(" "),e("code",[this._v("DOCKER_USERNAME")]),this._v(" 变量")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"查看结果"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#查看结果","aria-hidden":"true"}},[this._v("#")]),this._v(" 查看结果")])}],!1,null,null,null);a.options.__file="cases_cicd.md";e.default=a.exports}}]);