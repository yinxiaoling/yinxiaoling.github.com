<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>玩转 EFK 之小试牛刀 | Hsiao Lin</title>
    <meta name="description" content="Programer &amp; WOWER">
    <link rel="icon" href="/pig32.png">
    
    <link rel="preload" href="/assets/css/0.styles.bd66f28f.css" as="style"><link rel="preload" href="/assets/js/app.1a189f9b.js" as="script"><link rel="preload" href="/assets/js/25.6f73f685.js" as="script"><link rel="prefetch" href="/assets/js/10.a8ef3ac2.js"><link rel="prefetch" href="/assets/js/11.379bda39.js"><link rel="prefetch" href="/assets/js/12.106a9a6b.js"><link rel="prefetch" href="/assets/js/13.4fb277f1.js"><link rel="prefetch" href="/assets/js/14.f2978933.js"><link rel="prefetch" href="/assets/js/15.be1594c7.js"><link rel="prefetch" href="/assets/js/16.b6b9634a.js"><link rel="prefetch" href="/assets/js/17.78e3b59b.js"><link rel="prefetch" href="/assets/js/18.bb68b1a8.js"><link rel="prefetch" href="/assets/js/19.1e4150a2.js"><link rel="prefetch" href="/assets/js/2.7d83e6da.js"><link rel="prefetch" href="/assets/js/20.13a27359.js"><link rel="prefetch" href="/assets/js/21.c8f030ae.js"><link rel="prefetch" href="/assets/js/22.9e3d700f.js"><link rel="prefetch" href="/assets/js/23.712927c5.js"><link rel="prefetch" href="/assets/js/24.33909c0e.js"><link rel="prefetch" href="/assets/js/26.96cd572a.js"><link rel="prefetch" href="/assets/js/27.91bca9f3.js"><link rel="prefetch" href="/assets/js/28.9ca57cdb.js"><link rel="prefetch" href="/assets/js/29.d32c4c18.js"><link rel="prefetch" href="/assets/js/3.68587e58.js"><link rel="prefetch" href="/assets/js/30.ead369ef.js"><link rel="prefetch" href="/assets/js/31.9d24fd8c.js"><link rel="prefetch" href="/assets/js/32.6a5772eb.js"><link rel="prefetch" href="/assets/js/33.1b27e831.js"><link rel="prefetch" href="/assets/js/34.bb883bcb.js"><link rel="prefetch" href="/assets/js/35.21686f54.js"><link rel="prefetch" href="/assets/js/36.8db83cfd.js"><link rel="prefetch" href="/assets/js/37.53cac4bd.js"><link rel="prefetch" href="/assets/js/38.9f22b544.js"><link rel="prefetch" href="/assets/js/39.dbd3a14b.js"><link rel="prefetch" href="/assets/js/4.e5ec2def.js"><link rel="prefetch" href="/assets/js/40.adf441c5.js"><link rel="prefetch" href="/assets/js/41.901a511e.js"><link rel="prefetch" href="/assets/js/42.0b2440cf.js"><link rel="prefetch" href="/assets/js/43.cf739133.js"><link rel="prefetch" href="/assets/js/44.49b04312.js"><link rel="prefetch" href="/assets/js/45.e3b1a882.js"><link rel="prefetch" href="/assets/js/46.be2fb679.js"><link rel="prefetch" href="/assets/js/47.c02f4fd1.js"><link rel="prefetch" href="/assets/js/48.ceb59c23.js"><link rel="prefetch" href="/assets/js/49.9746f461.js"><link rel="prefetch" href="/assets/js/5.dd2f6f9c.js"><link rel="prefetch" href="/assets/js/50.fc1cb19d.js"><link rel="prefetch" href="/assets/js/51.acd881e2.js"><link rel="prefetch" href="/assets/js/52.19b3f7f1.js"><link rel="prefetch" href="/assets/js/53.17e3e6c1.js"><link rel="prefetch" href="/assets/js/54.8d473c1a.js"><link rel="prefetch" href="/assets/js/55.a84e2e7c.js"><link rel="prefetch" href="/assets/js/56.e4acdc1e.js"><link rel="prefetch" href="/assets/js/57.73533e06.js"><link rel="prefetch" href="/assets/js/58.c78f8f9d.js"><link rel="prefetch" href="/assets/js/59.0971af8c.js"><link rel="prefetch" href="/assets/js/6.b9d02d3e.js"><link rel="prefetch" href="/assets/js/60.1ea806f9.js"><link rel="prefetch" href="/assets/js/7.1aa9d725.js"><link rel="prefetch" href="/assets/js/8.5b7b0524.js"><link rel="prefetch" href="/assets/js/9.811fba5c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.bd66f28f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Hsiao Lin</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Architect</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/architect/OAuth2/" class="nav-link">OAuth2</a></li><li class="dropdown-item"><!----> <a href="/architect/ELK/" class="nav-link router-link-exact-active router-link-active">ELK</a></li></ul></div></div><div class="nav-item"><a href="/algorithm/" class="nav-link">Algorithm</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Java/Java/" class="nav-link">Java</a></li><li class="dropdown-item"><!----> <a href="/Java/Spring/" class="nav-link">Spring</a></li><li class="dropdown-item"><!----> <a href="/Java/SpringBoot/" class="nav-link">SpringBoot</a></li><li class="dropdown-item"><!----> <a href="/Java/SpringCloud/" class="nav-link">SpringCloud</a></li><li class="dropdown-item"><!----> <a href="/Java/MyBatis/" class="nav-link">MyBatis</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">JavaScript</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/JavaScript/Vue/" class="nav-link">Vue</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/React/" class="nav-link">React</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/Angular/" class="nav-link">Angular</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/Nodejs/" class="nav-link">Node.js</a></li><li class="dropdown-item"><h4>JavaScript</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/JavaScript/JavaScript/ES5/" class="nav-link">ES5</a></li><li class="dropdown-subitem"><a href="/JavaScript/JavaScript/ES6/" class="nav-link">ES6</a></li></ul></li><li class="dropdown-item"><!----> <a href="/JavaScript/TypeScript/" class="nav-link">TypeScript</a></li></ul></div></div><div class="nav-item"><a href="/BigData/" class="nav-link">BigData</a></div><div class="nav-item"><a href="/AI/" class="nav-link">AI</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Cloud</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/cloud/Docker/" class="nav-link">Docker</a></li><li class="dropdown-item"><!----> <a href="/cloud/Kubernetes/" class="nav-link">Kubernetes</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Cosmosource</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Cosmosource/fwp/" class="nav-link">自由网页</a></li><li class="dropdown-item"><!----> <a href="/Cosmosource/bpm/" class="nav-link">业务协同</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/yinxiaoling" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Architect</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/architect/OAuth2/" class="nav-link">OAuth2</a></li><li class="dropdown-item"><!----> <a href="/architect/ELK/" class="nav-link router-link-exact-active router-link-active">ELK</a></li></ul></div></div><div class="nav-item"><a href="/algorithm/" class="nav-link">Algorithm</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Java/Java/" class="nav-link">Java</a></li><li class="dropdown-item"><!----> <a href="/Java/Spring/" class="nav-link">Spring</a></li><li class="dropdown-item"><!----> <a href="/Java/SpringBoot/" class="nav-link">SpringBoot</a></li><li class="dropdown-item"><!----> <a href="/Java/SpringCloud/" class="nav-link">SpringCloud</a></li><li class="dropdown-item"><!----> <a href="/Java/MyBatis/" class="nav-link">MyBatis</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">JavaScript</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/JavaScript/Vue/" class="nav-link">Vue</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/React/" class="nav-link">React</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/Angular/" class="nav-link">Angular</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/Nodejs/" class="nav-link">Node.js</a></li><li class="dropdown-item"><h4>JavaScript</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/JavaScript/JavaScript/ES5/" class="nav-link">ES5</a></li><li class="dropdown-subitem"><a href="/JavaScript/JavaScript/ES6/" class="nav-link">ES6</a></li></ul></li><li class="dropdown-item"><!----> <a href="/JavaScript/TypeScript/" class="nav-link">TypeScript</a></li></ul></div></div><div class="nav-item"><a href="/BigData/" class="nav-link">BigData</a></div><div class="nav-item"><a href="/AI/" class="nav-link">AI</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Cloud</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/cloud/Docker/" class="nav-link">Docker</a></li><li class="dropdown-item"><!----> <a href="/cloud/Kubernetes/" class="nav-link">Kubernetes</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Cosmosource</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Cosmosource/fwp/" class="nav-link">自由网页</a></li><li class="dropdown-item"><!----> <a href="/Cosmosource/bpm/" class="nav-link">业务协同</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/yinxiaoling" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/architect/ELK/" class="active sidebar-link">玩转 EFK 之小试牛刀</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/architect/ELK/#环境" class="sidebar-link">环境</a></li><li class="sidebar-sub-header"><a href="/architect/ELK/#elasticsearch" class="sidebar-link">Elasticsearch</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/architect/ELK/#用户" class="sidebar-link">用户</a></li><li class="sidebar-sub-header"><a href="/architect/ELK/#解压" class="sidebar-link">解压</a></li><li class="sidebar-sub-header"><a href="/architect/ELK/#授权" class="sidebar-link">授权</a></li><li class="sidebar-sub-header"><a href="/architect/ELK/#配置" class="sidebar-link">配置</a></li><li class="sidebar-sub-header"><a href="/architect/ELK/#运行" class="sidebar-link">运行</a></li><li class="sidebar-sub-header"><a href="/architect/ELK/#访问" class="sidebar-link">访问</a></li></ul></li><li class="sidebar-sub-header"><a href="/architect/ELK/#kibana" class="sidebar-link">Kibana</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/architect/ELK/#解压-2" class="sidebar-link">解压</a></li><li class="sidebar-sub-header"><a href="/architect/ELK/#配置-2" class="sidebar-link">配置</a></li><li class="sidebar-sub-header"><a href="/architect/ELK/#启动" class="sidebar-link">启动</a></li></ul></li><li class="sidebar-sub-header"><a href="/architect/ELK/#kafka" class="sidebar-link">Kafka</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/architect/ELK/#解压-3" class="sidebar-link">解压</a></li><li class="sidebar-sub-header"><a href="/architect/ELK/#配置zookeeper-集群" class="sidebar-link">配置Zookeeper 集群</a></li><li class="sidebar-sub-header"><a href="/architect/ELK/#启动-zookeeper-集群" class="sidebar-link">启动 Zookeeper 集群</a></li><li class="sidebar-sub-header"><a href="/architect/ELK/#配置-kafka-集群" class="sidebar-link">配置 Kafka 集群</a></li><li class="sidebar-sub-header"><a href="/architect/ELK/#启动-kafka-集群" class="sidebar-link">启动 Kafka 集群</a></li></ul></li><li class="sidebar-sub-header"><a href="/architect/ELK/#logstash" class="sidebar-link">Logstash</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/architect/ELK/#解压-4" class="sidebar-link">解压</a></li><li class="sidebar-sub-header"><a href="/architect/ELK/#配置-3" class="sidebar-link">配置</a></li><li class="sidebar-sub-header"><a href="/architect/ELK/#启动-2" class="sidebar-link">启动</a></li></ul></li><li class="sidebar-sub-header"><a href="/architect/ELK/#filebeat" class="sidebar-link">FileBeat</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/architect/ELK/#解压-5" class="sidebar-link">解压</a></li><li class="sidebar-sub-header"><a href="/architect/ELK/#配置-4" class="sidebar-link">配置</a></li><li class="sidebar-sub-header"><a href="/architect/ELK/#启动-3" class="sidebar-link">启动</a></li></ul></li><li class="sidebar-sub-header"><a href="/architect/ELK/#优化" class="sidebar-link">优化</a></li></ul></li><li><a href="/architect/ELK/elk-efk.html" class="sidebar-link">从 ELK 到 EFK 演进</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/architect/ELK/elk-efk.html#背景" class="sidebar-link">背景</a></li><li class="sidebar-sub-header"><a href="/architect/ELK/elk-efk.html#为什么做日志系统" class="sidebar-link">为什么做日志系统</a></li><li class="sidebar-sub-header"><a href="/architect/ELK/elk-efk.html#简单版架构" class="sidebar-link">简单版架构</a></li><li class="sidebar-sub-header"><a href="/architect/ELK/elk-efk.html#集群版架构" class="sidebar-link">集群版架构</a></li><li class="sidebar-sub-header"><a href="/architect/ELK/elk-efk.html#引入消息队列" class="sidebar-link">引入消息队列</a></li><li class="sidebar-sub-header"><a href="/architect/ELK/elk-efk.html#多机房部署" class="sidebar-link">多机房部署</a></li><li class="sidebar-sub-header"><a href="/architect/ELK/elk-efk.html#引入filebeat" class="sidebar-link">引入Filebeat</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/architect/ELK/elk-efk.html#压测环境" class="sidebar-link">压测环境</a></li><li class="sidebar-sub-header"><a href="/architect/ELK/elk-efk.html#压测方案" class="sidebar-link">压测方案</a></li><li class="sidebar-sub-header"><a href="/architect/ELK/elk-efk.html#压测结果" class="sidebar-link">压测结果</a></li></ul></li><li class="sidebar-sub-header"><a href="/architect/ELK/elk-efk.html#总结" class="sidebar-link">总结</a></li><li class="sidebar-sub-header"><a href="/architect/ELK/elk-efk.html#参考资料" class="sidebar-link">参考资料</a></li></ul></li><li><a href="/architect/ELK/practice.html" class="sidebar-link">亿级 ELK 日志平台构建实践</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/architect/ELK/practice.html#整体架构" class="sidebar-link">整体架构</a></li><li class="sidebar-sub-header"><a href="/architect/ELK/practice.html#版本说明" class="sidebar-link">版本说明</a></li><li class="sidebar-sub-header"><a href="/architect/ELK/practice.html#具体实践" class="sidebar-link">具体实践</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/architect/ELK/practice.html#filebeat" class="sidebar-link">Filebeat</a></li><li class="sidebar-sub-header"><a href="/architect/ELK/practice.html#kafka" class="sidebar-link">Kafka</a></li><li class="sidebar-sub-header"><a href="/architect/ELK/practice.html#logstash" class="sidebar-link">Logstash</a></li><li class="sidebar-sub-header"><a href="/architect/ELK/practice.html#elasticsearch" class="sidebar-link">Elasticsearch</a></li><li class="sidebar-sub-header"><a href="/architect/ELK/practice.html#kibana" class="sidebar-link">kibana</a></li></ul></li><li class="sidebar-sub-header"><a href="/architect/ELK/practice.html#总结" class="sidebar-link">总结</a></li></ul></li></ul> </div> <div class="page"> <div class="content"><h1 id="玩转-efk-之小试牛刀"><a href="#玩转-efk-之小试牛刀" aria-hidden="true" class="header-anchor">#</a> 玩转 EFK 之小试牛刀</h1> <p>原创文章，转载请注明出处，违者必追究其法律责任。</p> <p>本文只是最初级的安装，不涉及任何安全策略和高级应用，后续会添加关于最后优化部分的详细配置以及生产级的日志配置。</p> <h2 id="环境"><a href="#环境" aria-hidden="true" class="header-anchor">#</a> 环境</h2> <p>从<a href="https://www.elastic.co/cn/downloads" target="_blank" rel="noopener noreferrer">Elastic公司官网<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>下载安装包，安装遇到问题以及配置详情参考官网文档,：</p> <div class="language-shell extra-class"><pre class="language-text"><code># 安装包准备
elasticsearch-6.5.4.tar.gz                # Elasticsearch
filebeat-6.5.4-linux-x86_64.tar.gz        # Filebeat
kibana-6.5.4-linux-x86_64.tar.gz          # Kibana
logstash-6.5.4.tar.gz                     # Logstash

jdk-8u191-linux-x64.tar.gz                # ES、Losstash、Kibana依赖
kafka_2.11-2.0.0.tgz                      # kafka
zookeeper-3.4.13.tar.gz                   # kafka依赖注册中心

# 服务器列表
192.168.0.188  CentOS7.5   4C    8G    
192.168.0.189  CentOS7.5   4C    4G
192.168.0.191  CentOS7.5   4C    4G
</code></pre></div><h2 id="elasticsearch"><a href="#elasticsearch" aria-hidden="true" class="header-anchor">#</a> Elasticsearch</h2> <h3 id="用户"><a href="#用户" aria-hidden="true" class="header-anchor">#</a> 用户</h3> <div class="language-shell extra-class"><pre class="language-text"><code>groupadd es          # 添加用户组
useradd -g es es     # 添加用户到指定用户组
passwd es            # 为指定用户设置密码
</code></pre></div><h3 id="解压"><a href="#解压" aria-hidden="true" class="header-anchor">#</a> 解压</h3> <p><code>tar zxvf elasticsearch-2.3.4.tar.gz -C /opt</code></p> <h3 id="授权"><a href="#授权" aria-hidden="true" class="header-anchor">#</a> 授权</h3> <div class="language-shell extra-class"><pre class="language-text"><code># 把文件夹赋予给es用户
[root@vm-centos75-0188 opt]# chown -R es:es /opt/elasticsearch-6.5.4
[root@vm-centos75-0188 opt]# chown -R es:es /opt/data/es
# 把文件夹设置所有用户可读写
[root@vm-centos75-0188 opt]# chown -R 777 /opt/data
</code></pre></div><h3 id="配置"><a href="#配置" aria-hidden="true" class="header-anchor">#</a> 配置</h3> <p><code>vim /opt/elasticsearch-6.5.4/config/elasticsearch.yml</code></p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token comment"># ======================== Elasticsearch Configuration =========================</span>
<span class="token comment">#</span>
<span class="token comment"># NOTE: Elasticsearch comes with reasonable defaults for most settings.</span>
<span class="token comment">#       Before you set out to tweak and tune the configuration, make sure you</span>
<span class="token comment">#       understand what are you trying to accomplish and the consequences.</span>
<span class="token comment">#</span>
<span class="token comment"># The primary way of configuring a node is via this file. This template lists</span>
<span class="token comment"># the most important settings you may want to configure for a production cluster.</span>
<span class="token comment">#</span>
<span class="token comment"># Please consult the documentation for further information on configuration options:</span>
<span class="token comment"># https://www.elastic.co/guide/en/elasticsearch/reference/index.html</span>
<span class="token comment">#</span>
<span class="token comment"># ---------------------------------- Cluster -----------------------------------</span>
<span class="token comment">#</span>
<span class="token comment"># Use a descriptive name for your cluster:</span>
<span class="token comment">#</span>
<span class="token key atrule">cluster.name</span><span class="token punctuation">:</span> cosmo<span class="token punctuation">-</span>efk
<span class="token comment">#</span>
<span class="token comment"># ------------------------------------ Node ------------------------------------</span>
<span class="token comment">#</span>
<span class="token comment"># Use a descriptive name for the node:</span>
<span class="token comment">#</span>
<span class="token key atrule">node.name</span><span class="token punctuation">:</span> cosmo<span class="token punctuation">-</span>node<span class="token punctuation">-</span><span class="token number">188</span>
<span class="token comment">#</span>
<span class="token comment"># Add custom attributes to the node:</span>
<span class="token comment">#</span>
<span class="token key atrule">node.attr.rack</span><span class="token punctuation">:</span> r1
<span class="token comment">#</span>
<span class="token comment"># ----------------------------------- Memory -----------------------------------</span>
<span class="token comment">#</span>
<span class="token comment"># Lock the memory on startup:</span>
<span class="token comment">#</span>
<span class="token comment">#bootstrap.memory_lock: true</span>
<span class="token comment">#</span>
<span class="token comment"># Make sure that the heap size is set to about half the memory available</span>
<span class="token comment"># on the system and that the owner of the process is allowed to use this</span>
<span class="token comment"># limit.</span>
<span class="token comment">#</span>
<span class="token comment"># Elasticsearch performs poorly when the system is swapping the memory.</span>
<span class="token comment">#</span>
<span class="token comment"># ----------------------------------- Paths ------------------------------------</span>
<span class="token comment">#</span>
<span class="token comment"># Path to directory where to store the data (separate multiple locations by comma):</span>
<span class="token comment">#</span>
<span class="token key atrule">path.data</span><span class="token punctuation">:</span> /opt/data/es/data
<span class="token comment">#</span>
<span class="token comment"># Path to log files:</span>
<span class="token comment">#</span>
<span class="token key atrule">path.logs</span><span class="token punctuation">:</span> /opt/data/es/logs
<span class="token comment">#</span>
<span class="token comment"># ----------------------------------- Memory -----------------------------------</span>
<span class="token comment">#</span>
<span class="token comment"># Lock the memory on startup:</span>
<span class="token comment">#</span>
<span class="token comment">#bootstrap.memory_lock: true</span>
<span class="token comment">#</span>
<span class="token comment"># Make sure that the heap size is set to about half the memory available</span>
<span class="token comment"># on the system and that the owner of the process is allowed to use this</span>
<span class="token comment"># limit.</span>
<span class="token comment">#</span>
<span class="token comment"># Elasticsearch performs poorly when the system is swapping the memory.</span>
<span class="token comment">#</span>
<span class="token comment"># ---------------------------------- Network -----------------------------------</span>
<span class="token comment">#</span>
<span class="token comment"># Set the bind address to a specific IP (IPv4 or IPv6):</span>
<span class="token comment">#</span>
<span class="token key atrule">network.host</span><span class="token punctuation">:</span> 192.168.0.188
<span class="token comment">#</span>
<span class="token comment"># Set a custom port for HTTP:</span>
<span class="token comment">#</span>
<span class="token key atrule">http.port</span><span class="token punctuation">:</span> <span class="token number">9200</span>
<span class="token comment">#</span>
<span class="token comment"># For more information, consult the network module documentation.</span>
<span class="token comment">#</span>
<span class="token comment"># --------------------------------- Discovery ----------------------------------</span>
<span class="token comment">#</span>
<span class="token comment"># Pass an initial list of hosts to perform discovery when new node is started:</span>
<span class="token comment"># The default list of hosts is [&quot;127.0.0.1&quot;, &quot;[::1]&quot;]</span>
<span class="token comment">#</span>
<span class="token comment">#discovery.zen.ping.unicast.hosts: [&quot;192.168.0.188&quot;, &quot;192.168.0.189&quot;, &quot;192.168.0.190&quot;]</span>
<span class="token comment">#</span>
<span class="token comment"># Prevent the &quot;split brain&quot; by configuring the majority of nodes (total number of master-eligible nodes / 2 + 1):</span>
<span class="token comment">#</span>
<span class="token comment">#discovery.zen.minimum_master_nodes:</span>
<span class="token comment">#</span>
<span class="token comment"># For more information, consult the zen discovery module documentation.</span>
<span class="token comment">#</span>
<span class="token comment"># ---------------------------------- Gateway -----------------------------------</span>
<span class="token comment">#</span>
<span class="token comment"># Block initial recovery after a full cluster restart until N nodes are started:</span>
<span class="token comment">#</span>
<span class="token comment">#gateway.recover_after_nodes: 3</span>
<span class="token comment">#</span>
<span class="token comment"># For more information, consult the gateway module documentation.</span>
<span class="token comment">#</span>
<span class="token comment"># ---------------------------------- Various -----------------------------------</span>
<span class="token comment">#</span>
<span class="token comment"># Require explicit names when deleting indices:</span>
<span class="token comment">#</span>
<span class="token comment">#action.destructive_requires_name: true</span>
</code></pre></div><p>另外启动遇到了几个错误，需要修改如下文件：</p> <div class="language-powershell extra-class"><pre class="language-powershell"><code><span class="token comment"># ERROR: max file descriptors [4096] for elasticsearch process likely too low, increase to at least [65536]</span>
vi <span class="token operator">/</span>etc<span class="token operator">/</span>security<span class="token operator">/</span>limits<span class="token punctuation">.</span>conf 

<span class="token comment"># 添加如下内容:</span>

<span class="token operator">*</span> soft nofile 65536

<span class="token operator">*</span> hard nofile 131072

<span class="token operator">*</span> soft nproc 2048

<span class="token operator">*</span> hard nproc 4096


<span class="token comment"># ERROR:max number of threads [2048] for user [lish] likely too low, increase to at least [4096]</span>
vi <span class="token operator">/</span>etc<span class="token operator">/</span>security<span class="token operator">/</span>limits<span class="token punctuation">.</span>d<span class="token operator">/</span>90<span class="token operator">-</span>nproc<span class="token punctuation">.</span>conf 

<span class="token comment"># 修改如下内容：</span>
<span class="token operator">*</span> soft nproc 1024

<span class="token comment"># 修改为</span>
<span class="token operator">*</span> soft nproc 4096


<span class="token comment"># ERROR:max virtual memory areas vm.max_map_count [65530] likely too low, increase to at least [262144]</span>

vi <span class="token operator">/</span>etc<span class="token operator">/</span>sysctl<span class="token punctuation">.</span>conf 
<span class="token comment"># 添加下面配置：</span>
vm<span class="token punctuation">.</span>max_map_count=655360

<span class="token comment"># 并执行命令：</span>
sysctl <span class="token operator">-</span>p
</code></pre></div><h3 id="运行"><a href="#运行" aria-hidden="true" class="header-anchor">#</a> 运行</h3> <div class="language-shell extra-class"><pre class="language-text"><code># 安装Java环境（一般服务器自带openjdk需先卸载，openjdk和oracle jdk有何区别自行百度）
[root@vm-centos75-0188 packages]# /opt/elasticsearch-6.5.4/bin/elasticsearch
which: no java in (/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin)
could not find java; set JAVA_HOME or ensure java is in PATH

[root@vm-centos75-0188 packages]# java -version
-bash: java: 未找到命令

# 查看JDK版本
[root@vm-centos75-0188 packages]# java -version
-bash: java: 未找到命令

# 查看包含java字符串的文件，其中删除类似下面这四个文件（不一定是四个）
[root@vm-centos75-0188 packages]# rpm -qa | grep java
java-1.7.0-openjdk-1.7.0.111-2.6.7.8.el7.x86_64
java-1.8.0-openjdk-1.8.0.102-4.b14.el7.x86_64
java-1.8.0-openjdk-headless-1.8.0.102-4.b14.el7.x86_64
java-1.7.0-openjdk-headless-1.7.0.111-2.6.7.8.el7.x86_64

# 包含noarch的文件不必删除，如下：
python-javapackages-3.4.1-11.el7.noarch
tzdata-java-2016g-2.el7.noarch
javapackages-tools-3.4.1-11.el7.noarch

# 查询出来带openjdk的全部使用下面的命令卸载
[root@vm-centos75-0188 packages]# yum -y remove java java-x.x.x-gcj-compat-x.x.x.x-xxjpp.xxx
[root@vm-centos75-0188 packages]# yum -y remove java java-x.x.x-openjdk-x.x.x.x-x.x.bxx.exx

# 文件最后添加如下内容
[root@vm-centos75-0188 opt]# vi /etc/profile
export JAVA_HOME=/opt/jdk1.8.0_191
export CLASSPATH=.:$JAVA_HOME/jre/lib/rt.jar:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar
export PATH=$PATH:$JAVA_HOME/bin

# 生效环境变量
[root@vm-centos75-0188 opt]# source /etc/profile

# 检查是否配置成功
[root@vm-centos75-0188 opt]# java -version
java version &quot;1.8.0_191&quot;
Java(TM) SE Runtime Environment (build 1.8.0_191-b12)
Java HotSpot(TM) 64-Bit Server VM (build 25.191-b12, mixed mode)

# 切换到es用户然后运行下面的命令
# 直接运行会打印log日志在控制台，关闭服务即刻关闭
$ /opt/elasticsearch-6.5.4/bin/elasticsearch
# 加-d参数后台启动
$ /opt/elasticsearch-6.5.4/bin/elasticsearch -d
</code></pre></div><h3 id="访问"><a href="#访问" aria-hidden="true" class="header-anchor">#</a> 访问</h3> <p><code>http://192.168.0.188:9200/</code>返回如下内容表示安装成功</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;cosmo-node-188&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;cluster_name&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;cosmo-efk&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;cluster_uuid&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;UgyoS_kMQjKJCxsVUmh-Rw&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;version&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;number&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;6.5.4&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;build_flavor&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;default&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;build_type&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;tar&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;build_hash&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;d2ef93d&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;build_date&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;2018-12-17T21:17:40.758843Z&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;build_snapshot&quot;</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token property">&quot;lucene_version&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;7.5.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;minimum_wire_compatibility_version&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;5.6.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;minimum_index_compatibility_version&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;5.0.0&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;tagline&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;You Know, for Search&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="kibana"><a href="#kibana" aria-hidden="true" class="header-anchor">#</a> Kibana</h2> <h3 id="解压-2"><a href="#解压-2" aria-hidden="true" class="header-anchor">#</a> 解压</h3> <div class="language-powershell extra-class"><pre class="language-powershell"><code><span class="token namespace">[root@vm-centos75-0189 opt]</span><span class="token comment"># tar zxvf kibana-6.5.4-linux-x86_64.tar.gz -C /opt</span>
<span class="token namespace">[root@vm-centos75-0189 opt]</span><span class="token comment"># mv /opt/kibana-6.5.4-linux-x86_64 /opt/kibana</span>
</code></pre></div><h3 id="配置-2"><a href="#配置-2" aria-hidden="true" class="header-anchor">#</a> 配置</h3> <div class="language-shell extra-class"><pre class="language-text"><code>[root@vm-centos75-0189 opt]# vi kibana/config/kibana.yml 
# Kibana is served by a back end server. This setting specifies the port to use.
server.port: 5601

# Specifies the address to which the Kibana server will bind. IP addresses and host names are both valid values.
# The default is 'localhost', which usually means remote machines will not be able to connect.
# To allow connections from remote users, set this parameter to a non-loopback address.
server.host: &quot;192.168.0.189&quot;

# Enables you to specify a path to mount Kibana at if you are running behind a proxy.
# Use the `server.rewriteBasePath` setting to tell Kibana if it should remove the basePath
# from requests it receives, and to prevent a deprecation warning at startup.
# This setting cannot end in a slash.
#server.basePath: &quot;&quot;

# Specifies whether Kibana should rewrite requests that are prefixed with
# `server.basePath` or require that they are rewritten by your reverse proxy.
# This setting was effectively always `false` before Kibana 6.3 and will
# default to `true` starting in Kibana 7.0.
#server.rewriteBasePath: false

# The maximum payload size in bytes for incoming server requests.
#server.maxPayloadBytes: 1048576

# The Kibana server's name.  This is used for display purposes.
server.name: &quot;cosmo-kibana-189&quot;

# The URL of the Elasticsearch instance to use for all your queries.
elasticsearch.url: &quot;http://192.168.0.188:9200&quot;
</code></pre></div><h3 id="启动"><a href="#启动" aria-hidden="true" class="header-anchor">#</a> 启动</h3> <div class="language-shell extra-class"><pre class="language-text"><code># 直接启动
$ /opt/kibana/bin/kibana
# 后台启动
$ /opt/kibana/bin/kibana -d
# 浏览器访问下面地址
http://192.168.0.189:5601
</code></pre></div><h2 id="kafka"><a href="#kafka" aria-hidden="true" class="header-anchor">#</a> Kafka</h2> <p>生产环境中 Kafka 集群中节点数量建议为（2N + 1 ）个，这边就以 3 个节点举例</p> <h3 id="解压-3"><a href="#解压-3" aria-hidden="true" class="header-anchor">#</a> 解压</h3> <div class="language- extra-class"><pre class="language-text"><code>tar -zxvf kafka_2.11-1.0.0.tgz
mv kafka_2.11-1.0.0 kafka
tar -zxvf zookeeper-3.4.13.tar.gz -C /opt
mv zookeeper-3.4.13 zookeeper
</code></pre></div><h3 id="配置zookeeper-集群"><a href="#配置zookeeper-集群" aria-hidden="true" class="header-anchor">#</a> 配置Zookeeper 集群</h3> <p>修改 Zookeeper 配置，搭建 Zookeeper 集群，数量 ( 2N + 1 ) 个,复制下面的配置文件到另外2台服务器</p> <div class="language-shell extra-class"><pre class="language-text"><code>$ cd /opt/zookeeper/conf &amp;&amp; cp zoo_sample.cfg zoo.cfg &amp;&amp; vi zoo.cfg
$ cat zoo.cfg

# The number of milliseconds of each tick
tickTime=2000
# The number of ticks that the initial 
# synchronization phase can take
initLimit=10
# The number of ticks that can pass between 
# sending a request and getting an acknowledgement
syncLimit=5
# the directory where the snapshot is stored.
# do not use /tmp for storage, /tmp here is just 
# example sakes.
dataDir=/opt/data/zookeeper/data
dataLogDir=/opt/data/zookeeper/logs
# the port at which the clients will connect
clientPort=2181
# the maximum number of client connections.
# increase this if you need to handle more clients
maxClientCnxns=60
#
# Be sure to read the maintenance section of the 
# administrator guide before turning on autopurge.
#
# http://zookeeper.apache.org/doc/current/zookeeperAdmin.html#sc_maintenance
#
# The number of snapshots to retain in dataDir
#autopurge.snapRetainCount=3
# Purge task interval in hours
# Set to &quot;0&quot; to disable auto purge feature
#autopurge.purgeInterval=1
server.1=192.168.0.188:2888:3888
server.2=192.168.0.189:2888:3888
server.3=192.168.0.191:2888:3888
</code></pre></div><p>Zookeeper data 目录下面添加 myid 文件，内容为代表 Zooekeeper 节点 id （1，2，3），并保证不重复</p> <div class="language-shell extra-class"><pre class="language-text"><code>$ echo &quot;1&quot; &gt; /opt/data/zookeeper/data/myid         # 192.168.0.188
$ echo &quot;2&quot; &gt; /opt/data/zookeeper/data/myid         # 192.168.0.189
$ echo &quot;3&quot; &gt; /opt/data/zookeeper/data/myid         # 192.168.0.191
</code></pre></div><h3 id="启动-zookeeper-集群"><a href="#启动-zookeeper-集群" aria-hidden="true" class="header-anchor">#</a> 启动 Zookeeper 集群</h3> <p>分别启动 3 台 Zookeeper 节点，保证集群的高可用</p> <div class="language-shell extra-class"><pre class="language-text"><code>$ ./zkServer.sh -start        # 启动
$ ./zkServer.sh -stop         # 停止
$ ./zkServer.sh -status       # 状态
</code></pre></div><h3 id="配置-kafka-集群"><a href="#配置-kafka-集群" aria-hidden="true" class="header-anchor">#</a> 配置 Kafka 集群</h3> <p>kafka 集群这边搭建为 3 台，可以逐个修改 Kafka 配置，需要注意其中 broker.id 分别 （1，2，3）</p> <div class="language-shell extra-class"><pre class="language-text"><code>$ vi /opt/kafka/config/server.properties
# Licensed to the Apache Software Foundation (ASF) under one or more
# contributor license agreements.  See the NOTICE file distributed with
# this work for additional information regarding copyright ownership.
# The ASF licenses this file to You under the Apache License, Version 2.0
# (the &quot;License&quot;); you may not use this file except in compliance with
# the License.  You may obtain a copy of the License at
#
#    http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

# see kafka.server.KafkaConfig for additional details and defaults

############################# Server Basics #############################

# The id of the broker. This must be set to a unique integer for each broker.
broker.id=188

############################# Socket Server Settings #############################

# The address the socket server listens on. It will get the value returned from 
# java.net.InetAddress.getCanonicalHostName() if not configured.
#   FORMAT:
#     listeners = listener_name://host_name:port
#   EXAMPLE:
#     listeners = PLAINTEXT://your.host.name:9092
listeners=PLAINTEXT://192.168.0.188:9092

# Hostname and port the broker will advertise to producers and consumers. If not set, 
# it uses the value for &quot;listeners&quot; if configured.  Otherwise, it will use the value
# returned from java.net.InetAddress.getCanonicalHostName().
advertised.listeners=PLAINTEXT://192.168.0.188:9092

# Maps listener names to security protocols, the default is for them to be the same. See the config documentation for more details
#listener.security.protocol.map=PLAINTEXT:PLAINTEXT,SSL:SSL,SASL_PLAINTEXT:SASL_PLAINTEXT,SASL_SSL:SASL_SSL

# The number of threads that the server uses for receiving requests from the network and sending responses to the network
num.network.threads=8

# The number of threads that the server uses for processing requests, which may include disk I/O
num.io.threads=8

# The send buffer (SO_SNDBUF) used by the socket server
socket.send.buffer.bytes=102400

# The receive buffer (SO_RCVBUF) used by the socket server
socket.receive.buffer.bytes=102400

# The maximum size of a request that the socket server will accept (protection against OOM)
socket.request.max.bytes=104857600


############################# Log Basics #############################

# A comma separated list of directories under which to store log files
log.dirs=/opt/data/kafka/logs

# The default number of log partitions per topic. More partitions allow greater
# parallelism for consumption, but this will also result in more files across
# the brokers.
num.partitions=3

# The number of threads per data directory to be used for log recovery at startup and flushing at shutdown.
# This value is recommended to be increased for installations with data dirs located in RAID array.
num.recovery.threads.per.data.dir=1

############################# Internal Topic Settings  #############################
# The replication factor for the group metadata internal topics &quot;__consumer_offsets&quot; and &quot;__transaction_state&quot;
# For anything other than development testing, a value greater than 1 is recommended for to ensure availability such as 3.
offsets.topic.replication.factor=1
transaction.state.log.replication.factor=1
transaction.state.log.min.isr=1

############################# Log Flush Policy #############################

# Messages are immediately written to the filesystem but by default we only fsync() to sync
# the OS cache lazily. The following configurations control the flush of data to disk.
# There are a few important trade-offs here:
#    1. Durability: Unflushed data may be lost if you are not using replication.
#    2. Latency: Very large flush intervals may lead to latency spikes when the flush does occur as there will be a lot of data to flush.
#    3. Throughput: The flush is generally the most expensive operation, and a small flush interval may lead to excessive seeks.
# The settings below allow one to configure the flush policy to flush data after a period of time or
# every N messages (or both). This can be done globally and overridden on a per-topic basis.

# The number of messages to accept before forcing a flush of data to disk
#log.flush.interval.messages=10000

# The maximum amount of time a message can sit in a log before we force a flush
#log.flush.interval.ms=1000

############################# Log Retention Policy #############################

# The following configurations control the disposal of log segments. The policy can
# be set to delete segments after a period of time, or after a given size has accumulated.
# A segment will be deleted whenever *either* of these criteria are met. Deletion always happens
# from the end of the log.

# The minimum age of a log file to be eligible for deletion due to age
log.retention.hours=168

# A size-based retention policy for logs. Segments are pruned from the log unless the remaining
# segments drop below log.retention.bytes. Functions independently of log.retention.hours.
#log.retention.bytes=1073741824

# The maximum size of a log segment file. When this size is reached a new log segment will be created.
log.segment.bytes=1073741824

# The interval at which log segments are checked to see if they can be deleted according
# to the retention policies
log.retention.check.interval.ms=300000

############################# Zookeeper #############################

# Zookeeper connection string (see zookeeper docs for details).
# This is a comma separated host:port pairs, each corresponding to a zk
# server. e.g. &quot;127.0.0.1:3000,127.0.0.1:3001,127.0.0.1:3002&quot;.
# You can also append an optional chroot string to the urls to specify the
# root directory for all kafka znodes.
zookeeper.connect=192.168.0.188:2181,192.168.0.189:2181,192.168.0.191:2181

# Timeout in ms for connecting to zookeeper
zookeeper.connection.timeout.ms=6000

############################# Group Coordinator Settings #############################

# The following configuration specifies the time, in milliseconds, that the GroupCoordinator will delay the initial consumer rebalance.
# The rebalance will be further delayed by the value of group.initial.rebalance.delay.ms as new members join the group, up to a maximum of max.poll.interval.ms.
# The default value for this is 3 seconds.
# We override this to 0 here as it makes for a better out-of-the-box experience for development and testing.
# However, in production environments the default value of 3 seconds is more suitable as this will help to avoid unnecessary, and potentially expensive, rebalances during application startup.
group.initial.rebalance.delay.ms=0
</code></pre></div><h3 id="启动-kafka-集群"><a href="#启动-kafka-集群" aria-hidden="true" class="header-anchor">#</a> 启动 Kafka 集群</h3> <p>分别启动 3 台 Kafka 节点，保证集群的高可用</p> <div class="language-shell extra-class"><pre class="language-text"><code># 启动
$ /opt/kafka/bin/kafka-server-start.sh -daemon /opt/kafka/config/server.properties
# 查看 topic 是否创建成功
$ /opt/kafka/bin/kafka-topics.sh --list --zookeeper 192.168.0.188:2181
</code></pre></div><h2 id="logstash"><a href="#logstash" aria-hidden="true" class="header-anchor">#</a> Logstash</h2> <h3 id="解压-4"><a href="#解压-4" aria-hidden="true" class="header-anchor">#</a> 解压</h3> <div class="language-shell extra-class"><pre class="language-text"><code>[root@vm-centos75-0191 opt]# tar zxvf logstash-6.5.4.tar.gz -C /opt
[root@vm-centos75-0191 opt]# mv /opt/logstash-6.5.4 /opt/logstash
</code></pre></div><h3 id="配置-3"><a href="#配置-3" aria-hidden="true" class="header-anchor">#</a> 配置</h3> <div class="language-shell extra-class"><pre class="language-text"><code>[root@vm-centos75-0191 config]# cd /opt/logstash/config
[root@vm-centos75-0191 config]# cp logstash-sample.conf logstash.conf
[root@vm-centos75-0191 config]# vi logstash.conf 
[root@vm-centos75-0191 config]# cat logstash.conf 
input {
  kafka {
    bootstrap_servers =&gt; &quot;192.168.0.188:9092&quot;
    topics =&gt; &quot;idp-bpm&quot;
    #topics_pattern =&gt; &quot;^idp\\-.*&quot;
  }
}

output {
  elasticsearch {
    hosts =&gt; [&quot;http://192.168.0.188:9200&quot;]
    index =&gt; &quot;idp-%{+YYYY.MM.dd}&quot;
    #user =&gt; &quot;elastic&quot;
    #password =&gt; &quot;changeme&quot;
  }
}
</code></pre></div><h3 id="启动-2"><a href="#启动-2" aria-hidden="true" class="header-anchor">#</a> 启动</h3> <div class="language-shell extra-class"><pre class="language-text"><code># 直接启动
[root@vm-centos75-0191 bin]# ./logstash -f ../config/logstash.conf
# 后台启动
[root@vm-centos75-0191 bin]# cd /opt/logstash/
[root@vm-centos75-0191 logstash]# nohup bin/logstash -f config/logstash.conf --config.reload.automatic &gt;&amp; /opt/data/logstash/logs/logstash &amp;
</code></pre></div><h2 id="filebeat"><a href="#filebeat" aria-hidden="true" class="header-anchor">#</a> FileBeat</h2> <h3 id="解压-5"><a href="#解压-5" aria-hidden="true" class="header-anchor">#</a> 解压</h3> <div class="language-shell extra-class"><pre class="language-text"><code>[root@vm-centos75-0191 opt]# tar zxvf filebeat-6.5.4-linux-x86_64.tar.gz -C /opt
[root@vm-centos75-0191 opt]# mv /opt/filebeat-6.5.4-linux-x86_64 /opt/filebeat
</code></pre></div><h3 id="配置-4"><a href="#配置-4" aria-hidden="true" class="header-anchor">#</a> 配置</h3> <p><code>vi /opt/filebeat/filebeat.yml</code></p> <div class="language-shell extra-class"><pre class="language-text"><code>###################### Filebeat Configuration Example #########################

# This file is an example configuration file highlighting only the most common
# options. The filebeat.reference.yml file from the same directory contains all the
# supported options with more comments. You can use it as a reference.
#
# You can find the full configuration reference here:
# https://www.elastic.co/guide/en/beats/filebeat/index.html

# For more available modules and options, please see the filebeat.reference.yml sample
# configuration file.

#=========================== Filebeat inputs =============================

filebeat.inputs:

# Each - is an input. Most options can be set at the input level, so
# you can use different inputs for various configurations.
# Below are the input specific configurations.

- type: log

  # Change to true to enable this input configuration.
  enabled: true

  # Paths that should be crawled and fetched. Glob based paths.
  paths:
    #- /var/log/*.log
    - E:\idp\logs\bpm\bpm.log

  # Exclude lines. A list of regular expressions to match. It drops the lines that are
  # matching any regular expression from the list.
  #exclude_lines: ['^DBG']

  # Include lines. A list of regular expressions to match. It exports the lines that are
  # matching any regular expression from the list.
  #include_lines: ['^ERR', '^WARN']

  # Exclude files. A list of regular expressions to match. Filebeat drops the files that
  # are matching any regular expression from the list. By default, no files are dropped.
  #exclude_files: ['.gz$']

  # Optional additional fields. These fields can be freely picked
  # to add additional information to the crawled log files for filtering
  #fields:
  #  level: debug
  #  review: 1

  ### Multiline options

  # Multiline can be used for log messages spanning multiple lines. This is common
  # for Java Stack Traces or C-Line Continuation

  # The regexp Pattern that has to be matched. The example pattern matches all lines starting with [
  #multiline.pattern: ^\[

  # Defines if the pattern set under pattern should be negated or not. Default is false.
  #multiline.negate: false

  # Match can be set to &quot;after&quot; or &quot;before&quot;. It is used to define if lines should be append to a pattern
  # that was (not) matched before or after or as long as a pattern is not matched based on negate.
  # Note: After is the equivalent to previous and before is the equivalent to to next in Logstash
  #multiline.match: after


#============================= Filebeat modules ===============================

filebeat.config.modules:
  # Glob pattern for configuration loading
  path: ${path.config}/modules.d/*.yml

  # Set to true to enable config reloading
  reload.enabled: false

  # Period on which files under path should be checked for changes
  #reload.period: 10s

#==================== Elasticsearch template setting ==========================

setup.template.settings:
  index.number_of_shards: 3
  #index.codec: best_compression
  #_source.enabled: false

#================================ General =====================================

# The name of the shipper that publishes the network data. It can be used to group
# all the transactions sent by a single shipper in the web interface.
#name:

# The tags of the shipper are included in their own field with each
# transaction published.
#tags: [&quot;service-X&quot;, &quot;web-tier&quot;]

# Optional fields that you can specify to add additional information to the
# output.
#fields:
#  env: staging


#============================== Dashboards =====================================
# These settings control loading the sample dashboards to the Kibana index. Loading
# the dashboards is disabled by default and can be enabled either by setting the
# options here, or by using the `-setup` CLI flag or the `setup` command.
#setup.dashboards.enabled: false

# The URL from where to download the dashboards archive. By default this URL
# has a value which is computed based on the Beat name and version. For released
# versions, this URL points to the dashboard archive on the artifacts.elastic.co
# website.
#setup.dashboards.url:

#============================== Kibana =====================================

# Starting with Beats version 6.0.0, the dashboards are loaded via the Kibana API.
# This requires a Kibana endpoint configuration.
setup.kibana:

  # Kibana Host
  # Scheme and port can be left out and will be set to the default (http and 5601)
  # In case you specify and additional path, the scheme is required: http://localhost:5601/path
  # IPv6 addresses should always be defined as: https://[2001:db8::1]:5601
  #host: &quot;localhost:5601&quot;

  # Kibana Space ID
  # ID of the Kibana Space into which the dashboards should be loaded. By default,
  # the Default Space will be used.
  #space.id:

#============================= Elastic Cloud ==================================

# These settings simplify using filebeat with the Elastic Cloud (https://cloud.elastic.co/).

# The cloud.id setting overwrites the `output.elasticsearch.hosts` and
# `setup.kibana.host` options.
# You can find the `cloud.id` in the Elastic Cloud web UI.
#cloud.id:

# The cloud.auth setting overwrites the `output.elasticsearch.username` and
# `output.elasticsearch.password` settings. The format is `&lt;user&gt;:&lt;pass&gt;`.
#cloud.auth:

#================================ Outputs =====================================

# Configure what output to use when sending the data collected by the beat.


#------------------------------ Kafka output ----------------------------------
output.kafka:   
  hosts: [&quot;192.168.0.188:9092&quot;]
  topic: idp-bpm
  required_acks: 1

#-------------------------- Elasticsearch output ------------------------------
#output.elasticsearch:
  # Array of hosts to connect to.
  #hosts: [&quot;localhost:9200&quot;]

  # Optional protocol and basic auth credentials.
  #protocol: &quot;https&quot;
  #username: &quot;elastic&quot;
  #password: &quot;changeme&quot;

#----------------------------- Logstash output --------------------------------
#output.logstash:
  # The Logstash hosts
  #hosts: [&quot;localhost:5044&quot;]

  # Optional SSL. By default is off.
  # List of root certificates for HTTPS server verifications
  #ssl.certificate_authorities: [&quot;/etc/pki/root/ca.pem&quot;]

  # Certificate for SSL client authentication
  #ssl.certificate: &quot;/etc/pki/client/cert.pem&quot;

  # Client Certificate Key
  #ssl.key: &quot;/etc/pki/client/cert.key&quot;

#================================ Procesors =====================================

# Configure processors to enhance or manipulate events generated by the beat.

processors:
  - add_host_metadata: ~
  - add_cloud_metadata: ~

#================================ Logging =====================================

# Sets log level. The default log level is info.
# Available log levels are: error, warning, info, debug
#logging.level: debug

# At debug level, you can selectively enable logging only for some components.
# To enable all selectors use [&quot;*&quot;]. Examples of other selectors are &quot;beat&quot;,
# &quot;publish&quot;, &quot;service&quot;.
#logging.selectors: [&quot;*&quot;]

#============================== Xpack Monitoring ===============================
# filebeat can export internal metrics to a central Elasticsearch monitoring
# cluster.  This requires xpack monitoring to be enabled in Elasticsearch.  The
# reporting is disabled by default.

# Set to true to enable the monitoring reporter.
#xpack.monitoring.enabled: false

# Uncomment to send the metrics to Elasticsearch. Most settings from the
# Elasticsearch output are accepted here as well. Any setting that is not set is
# automatically inherited from the Elasticsearch output configuration, so if you
# have the Elasticsearch output configured, you can simply uncomment the
# following line.
#xpack.monitoring.elasticsearch:

</code></pre></div><h3 id="启动-3"><a href="#启动-3" aria-hidden="true" class="header-anchor">#</a> 启动</h3> <p>Windows  设置为服务启动</p> <p>Linux         设置为服务启动</p> <h2 id="优化"><a href="#优化" aria-hidden="true" class="header-anchor">#</a> 优化</h2> <ul><li>所有组件作为服务启动</li> <li>所有组件集群一键启动、停止、查看状态</li> <li>所有组件监控插件、第三方程序的研究</li> <li>所有组件一键安装配置的研究</li> <li>所有组件安全设置的研究</li> <li>所有组件高级设置的研究</li> <li>Logstash 输入、输出、过滤以及消费kafka topic正则表达式设置的研究</li> <li>Kibana 图表、仪表、各项目指标归纳设置的研究</li> <li>用户足迹、业务日志、系统日志分类等归纳设置的研究</li></ul></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新：: </span> <span class="time">1/24/2019, 5:23:05 PM</span></div></div> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/architect/ELK/elk-efk.html">
          从 ELK 到 EFK 演进
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/app.1a189f9b.js" defer></script><script src="/assets/js/25.6f73f685.js" defer></script>
  </body>
</html>
