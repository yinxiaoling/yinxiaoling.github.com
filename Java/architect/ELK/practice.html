<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>亿级 ELK 日志平台构建实践 | Hsiao Lin</title>
    <meta name="description" content="Programer &amp; WOWER">
    <link rel="icon" href="/pig32.png">
    
    <link rel="preload" href="/assets/css/0.styles.78c36931.css" as="style"><link rel="preload" href="/assets/js/app.5747588d.js" as="script"><link rel="preload" href="/assets/js/35.d267a990.js" as="script"><link rel="prefetch" href="/assets/js/10.ddf3c1e1.js"><link rel="prefetch" href="/assets/js/11.4a613803.js"><link rel="prefetch" href="/assets/js/12.2150fbf6.js"><link rel="prefetch" href="/assets/js/13.bae1cdb7.js"><link rel="prefetch" href="/assets/js/14.22570454.js"><link rel="prefetch" href="/assets/js/15.b3a92972.js"><link rel="prefetch" href="/assets/js/16.bc6a56f4.js"><link rel="prefetch" href="/assets/js/17.45830d2d.js"><link rel="prefetch" href="/assets/js/18.f118e123.js"><link rel="prefetch" href="/assets/js/19.55870ab2.js"><link rel="prefetch" href="/assets/js/2.1740a20d.js"><link rel="prefetch" href="/assets/js/20.faf1b2ca.js"><link rel="prefetch" href="/assets/js/21.6438e59f.js"><link rel="prefetch" href="/assets/js/22.e5783bce.js"><link rel="prefetch" href="/assets/js/23.0416ab32.js"><link rel="prefetch" href="/assets/js/24.8b80babf.js"><link rel="prefetch" href="/assets/js/25.0976f645.js"><link rel="prefetch" href="/assets/js/26.70348fe6.js"><link rel="prefetch" href="/assets/js/27.a4332e0f.js"><link rel="prefetch" href="/assets/js/28.2651aa73.js"><link rel="prefetch" href="/assets/js/29.eeec3390.js"><link rel="prefetch" href="/assets/js/3.9c895735.js"><link rel="prefetch" href="/assets/js/30.65fcfd10.js"><link rel="prefetch" href="/assets/js/31.34031f2d.js"><link rel="prefetch" href="/assets/js/32.7baa1b9b.js"><link rel="prefetch" href="/assets/js/33.f04b3a0b.js"><link rel="prefetch" href="/assets/js/34.f31687b6.js"><link rel="prefetch" href="/assets/js/36.28868b70.js"><link rel="prefetch" href="/assets/js/37.3994c10b.js"><link rel="prefetch" href="/assets/js/38.6c84a9cd.js"><link rel="prefetch" href="/assets/js/39.6d6010ec.js"><link rel="prefetch" href="/assets/js/4.f828ee46.js"><link rel="prefetch" href="/assets/js/40.c8ac4272.js"><link rel="prefetch" href="/assets/js/41.697306cd.js"><link rel="prefetch" href="/assets/js/42.931e7371.js"><link rel="prefetch" href="/assets/js/43.6c7f8cb9.js"><link rel="prefetch" href="/assets/js/44.8cd62ac9.js"><link rel="prefetch" href="/assets/js/45.a12aac7e.js"><link rel="prefetch" href="/assets/js/46.41c7dd1e.js"><link rel="prefetch" href="/assets/js/47.a082ea8c.js"><link rel="prefetch" href="/assets/js/48.f9b08363.js"><link rel="prefetch" href="/assets/js/49.514396bc.js"><link rel="prefetch" href="/assets/js/5.8d4fff67.js"><link rel="prefetch" href="/assets/js/50.2cd1eb92.js"><link rel="prefetch" href="/assets/js/51.941ff4ba.js"><link rel="prefetch" href="/assets/js/52.bce8dc3c.js"><link rel="prefetch" href="/assets/js/53.558d03e9.js"><link rel="prefetch" href="/assets/js/54.aa838e71.js"><link rel="prefetch" href="/assets/js/55.6911947c.js"><link rel="prefetch" href="/assets/js/56.dd8ebcab.js"><link rel="prefetch" href="/assets/js/57.5c6a288d.js"><link rel="prefetch" href="/assets/js/58.fa4865de.js"><link rel="prefetch" href="/assets/js/59.f0ec1ba6.js"><link rel="prefetch" href="/assets/js/6.56e05218.js"><link rel="prefetch" href="/assets/js/60.e1e88011.js"><link rel="prefetch" href="/assets/js/61.e085e697.js"><link rel="prefetch" href="/assets/js/62.ff1bfc45.js"><link rel="prefetch" href="/assets/js/63.4987100b.js"><link rel="prefetch" href="/assets/js/64.d9662951.js"><link rel="prefetch" href="/assets/js/65.fc4e4a80.js"><link rel="prefetch" href="/assets/js/66.e25fee29.js"><link rel="prefetch" href="/assets/js/67.f2dd7002.js"><link rel="prefetch" href="/assets/js/68.5bfcc86c.js"><link rel="prefetch" href="/assets/js/69.3cce463a.js"><link rel="prefetch" href="/assets/js/7.7fc02c55.js"><link rel="prefetch" href="/assets/js/8.6b4dfd4a.js"><link rel="prefetch" href="/assets/js/9.41b03f35.js">
    <link rel="stylesheet" href="/assets/css/0.styles.78c36931.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Hsiao Lin</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Architect</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Java/architect/ELK/" class="nav-link router-link-active">ELK</a></li><li class="dropdown-subitem"><a href="/Java/architect/OAuth2/" class="nav-link">OAuth2</a></li></ul></li><li class="dropdown-item"><h4>Algorithm</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Java/algorithm/" class="nav-link">河内之塔（汉诺塔）</a></li><li class="dropdown-subitem"><a href="/Java/algorithm/" class="nav-link">费式数列</a></li></ul></li><li class="dropdown-item"><h4>Java</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Java/Java/" class="nav-link">Data Structure</a></li><li class="dropdown-subitem"><a href="/Java/Java/" class="nav-link">Java Base</a></li></ul></li><li class="dropdown-item"><h4>Spring</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Java/Spring/" class="nav-link">DI</a></li><li class="dropdown-subitem"><a href="/Java/Spring/" class="nav-link">AOP</a></li></ul></li><li class="dropdown-item"><h4>SpringBoot</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Java/SpringBoot/" class="nav-link">DataSource</a></li><li class="dropdown-subitem"><a href="/Java/SpringBoot/" class="nav-link">LOG</a></li></ul></li><li class="dropdown-item"><h4>SpringCloud</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Java/SpringCloud/" class="nav-link">Nacos</a></li><li class="dropdown-subitem"><a href="/Java/SpringCloud/" class="nav-link">RocketMQ</a></li></ul></li><li class="dropdown-item"><h4>MyBatis</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Java/MyBatis/" class="nav-link">MyBatis</a></li><li class="dropdown-subitem"><a href="/Java/MyBatis/" class="nav-link">MyBatis-Plus</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">JavaScript</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Fromework</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/JavaScript/React/" class="nav-link">React</a></li><li class="dropdown-subitem"><a href="/JavaScript/Vue/" class="nav-link">Vue</a></li><li class="dropdown-subitem"><a href="/JavaScript/Angular/" class="nav-link">Angular</a></li></ul></li><li class="dropdown-item"><h4>JavaScript</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/JavaScript/JavaScript/ES5/" class="nav-link">ES5</a></li><li class="dropdown-subitem"><a href="/JavaScript/JavaScript/ES6/" class="nav-link">ES6</a></li></ul></li><li class="dropdown-item"><h4>Superset</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/JavaScript/TypeScript/" class="nav-link">TypeScript</a></li></ul></li><li class="dropdown-item"><h4>Platform</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/JavaScript/Nodejs/" class="nav-link">Node.js</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Popular Technique</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/cloud/Docker/" class="nav-link">Docker</a></li><li class="dropdown-item"><!----> <a href="/cloud/Kubernetes/" class="nav-link">Kubernetes</a></li><li class="dropdown-item"><!----> <a href="/BigData/" class="nav-link">BigData</a></li><li class="dropdown-item"><!----> <a href="/Ceph/" class="nav-link">Ceph</a></li><li class="dropdown-item"><!----> <a href="/AI/" class="nav-link">AI</a></li><li class="dropdown-item"><!----> <a href="/AI/" class="nav-link">区块链</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Book Club</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/cloud/Docker/" class="nav-link">从 0 到 1</a></li><li class="dropdown-item"><!----> <a href="/cloud/Docker/" class="nav-link">统计学</a></li><li class="dropdown-item"><!----> <a href="/cloud/Docker/" class="nav-link">区块链</a></li><li class="dropdown-item"><!----> <a href="/cloud/Docker/" class="nav-link">曾国藩家书</a></li><li class="dropdown-item"><!----> <a href="/cloud/Docker/" class="nav-link">四书五经</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Cosmosource</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>公司产品</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Cosmosource/Component/fwp/" class="nav-link">自由网页</a></li><li class="dropdown-subitem"><a href="/Cosmosource/Component/glm/" class="nav-link">逻辑建模</a></li><li class="dropdown-subitem"><a href="/Cosmosource/Component/bpm/" class="nav-link">业务协同</a></li><li class="dropdown-subitem"><a href="/Cosmosource/Component/cmc/" class="nav-link">消息中心</a></li><li class="dropdown-subitem"><a href="/Cosmosource/Component/mmc/" class="nav-link">监控中心</a></li><li class="dropdown-subitem"><a href="/Cosmosource/Component/lmc/" class="nav-link">日志中心</a></li></ul></li><li class="dropdown-item"><h4>创研中心</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Cosmosource/Manager/build/" class="nav-link">部门建设</a></li><li class="dropdown-subitem"><a href="/Cosmosource/Manager/efficiency/" class="nav-link">团队效能</a></li><li class="dropdown-subitem"><a href="/Cosmosource/Manager/kpi/" class="nav-link">目标量化</a></li><li class="dropdown-subitem"><a href="/Cosmosource/Manager/CodeStyle/" class="nav-link">代码规范</a></li></ul></li></ul></div></div><div class="nav-item"><a href="https://github.com/yinxiaoling" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Architect</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Java/architect/ELK/" class="nav-link router-link-active">ELK</a></li><li class="dropdown-subitem"><a href="/Java/architect/OAuth2/" class="nav-link">OAuth2</a></li></ul></li><li class="dropdown-item"><h4>Algorithm</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Java/algorithm/" class="nav-link">河内之塔（汉诺塔）</a></li><li class="dropdown-subitem"><a href="/Java/algorithm/" class="nav-link">费式数列</a></li></ul></li><li class="dropdown-item"><h4>Java</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Java/Java/" class="nav-link">Data Structure</a></li><li class="dropdown-subitem"><a href="/Java/Java/" class="nav-link">Java Base</a></li></ul></li><li class="dropdown-item"><h4>Spring</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Java/Spring/" class="nav-link">DI</a></li><li class="dropdown-subitem"><a href="/Java/Spring/" class="nav-link">AOP</a></li></ul></li><li class="dropdown-item"><h4>SpringBoot</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Java/SpringBoot/" class="nav-link">DataSource</a></li><li class="dropdown-subitem"><a href="/Java/SpringBoot/" class="nav-link">LOG</a></li></ul></li><li class="dropdown-item"><h4>SpringCloud</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Java/SpringCloud/" class="nav-link">Nacos</a></li><li class="dropdown-subitem"><a href="/Java/SpringCloud/" class="nav-link">RocketMQ</a></li></ul></li><li class="dropdown-item"><h4>MyBatis</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Java/MyBatis/" class="nav-link">MyBatis</a></li><li class="dropdown-subitem"><a href="/Java/MyBatis/" class="nav-link">MyBatis-Plus</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">JavaScript</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Fromework</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/JavaScript/React/" class="nav-link">React</a></li><li class="dropdown-subitem"><a href="/JavaScript/Vue/" class="nav-link">Vue</a></li><li class="dropdown-subitem"><a href="/JavaScript/Angular/" class="nav-link">Angular</a></li></ul></li><li class="dropdown-item"><h4>JavaScript</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/JavaScript/JavaScript/ES5/" class="nav-link">ES5</a></li><li class="dropdown-subitem"><a href="/JavaScript/JavaScript/ES6/" class="nav-link">ES6</a></li></ul></li><li class="dropdown-item"><h4>Superset</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/JavaScript/TypeScript/" class="nav-link">TypeScript</a></li></ul></li><li class="dropdown-item"><h4>Platform</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/JavaScript/Nodejs/" class="nav-link">Node.js</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Popular Technique</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/cloud/Docker/" class="nav-link">Docker</a></li><li class="dropdown-item"><!----> <a href="/cloud/Kubernetes/" class="nav-link">Kubernetes</a></li><li class="dropdown-item"><!----> <a href="/BigData/" class="nav-link">BigData</a></li><li class="dropdown-item"><!----> <a href="/Ceph/" class="nav-link">Ceph</a></li><li class="dropdown-item"><!----> <a href="/AI/" class="nav-link">AI</a></li><li class="dropdown-item"><!----> <a href="/AI/" class="nav-link">区块链</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Book Club</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/cloud/Docker/" class="nav-link">从 0 到 1</a></li><li class="dropdown-item"><!----> <a href="/cloud/Docker/" class="nav-link">统计学</a></li><li class="dropdown-item"><!----> <a href="/cloud/Docker/" class="nav-link">区块链</a></li><li class="dropdown-item"><!----> <a href="/cloud/Docker/" class="nav-link">曾国藩家书</a></li><li class="dropdown-item"><!----> <a href="/cloud/Docker/" class="nav-link">四书五经</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Cosmosource</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>公司产品</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Cosmosource/Component/fwp/" class="nav-link">自由网页</a></li><li class="dropdown-subitem"><a href="/Cosmosource/Component/glm/" class="nav-link">逻辑建模</a></li><li class="dropdown-subitem"><a href="/Cosmosource/Component/bpm/" class="nav-link">业务协同</a></li><li class="dropdown-subitem"><a href="/Cosmosource/Component/cmc/" class="nav-link">消息中心</a></li><li class="dropdown-subitem"><a href="/Cosmosource/Component/mmc/" class="nav-link">监控中心</a></li><li class="dropdown-subitem"><a href="/Cosmosource/Component/lmc/" class="nav-link">日志中心</a></li></ul></li><li class="dropdown-item"><h4>创研中心</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Cosmosource/Manager/build/" class="nav-link">部门建设</a></li><li class="dropdown-subitem"><a href="/Cosmosource/Manager/efficiency/" class="nav-link">团队效能</a></li><li class="dropdown-subitem"><a href="/Cosmosource/Manager/kpi/" class="nav-link">目标量化</a></li><li class="dropdown-subitem"><a href="/Cosmosource/Manager/CodeStyle/" class="nav-link">代码规范</a></li></ul></li></ul></div></div><div class="nav-item"><a href="https://github.com/yinxiaoling" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/Java/architect/ELK/" class="sidebar-link">玩转 EFK 之小试牛刀</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Java/architect/ELK/#环境" class="sidebar-link">环境</a></li><li class="sidebar-sub-header"><a href="/Java/architect/ELK/#elasticsearch" class="sidebar-link">Elasticsearch</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Java/architect/ELK/#用户" class="sidebar-link">用户</a></li><li class="sidebar-sub-header"><a href="/Java/architect/ELK/#解压" class="sidebar-link">解压</a></li><li class="sidebar-sub-header"><a href="/Java/architect/ELK/#授权" class="sidebar-link">授权</a></li><li class="sidebar-sub-header"><a href="/Java/architect/ELK/#配置" class="sidebar-link">配置</a></li><li class="sidebar-sub-header"><a href="/Java/architect/ELK/#运行" class="sidebar-link">运行</a></li><li class="sidebar-sub-header"><a href="/Java/architect/ELK/#访问" class="sidebar-link">访问</a></li></ul></li><li class="sidebar-sub-header"><a href="/Java/architect/ELK/#kibana" class="sidebar-link">Kibana</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Java/architect/ELK/#解压-2" class="sidebar-link">解压</a></li><li class="sidebar-sub-header"><a href="/Java/architect/ELK/#配置-2" class="sidebar-link">配置</a></li><li class="sidebar-sub-header"><a href="/Java/architect/ELK/#启动" class="sidebar-link">启动</a></li></ul></li><li class="sidebar-sub-header"><a href="/Java/architect/ELK/#kafka" class="sidebar-link">Kafka</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Java/architect/ELK/#解压-3" class="sidebar-link">解压</a></li><li class="sidebar-sub-header"><a href="/Java/architect/ELK/#配置zookeeper-集群" class="sidebar-link">配置Zookeeper 集群</a></li><li class="sidebar-sub-header"><a href="/Java/architect/ELK/#启动-zookeeper-集群" class="sidebar-link">启动 Zookeeper 集群</a></li><li class="sidebar-sub-header"><a href="/Java/architect/ELK/#配置-kafka-集群" class="sidebar-link">配置 Kafka 集群</a></li><li class="sidebar-sub-header"><a href="/Java/architect/ELK/#启动-kafka-集群" class="sidebar-link">启动 Kafka 集群</a></li></ul></li><li class="sidebar-sub-header"><a href="/Java/architect/ELK/#logstash" class="sidebar-link">Logstash</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Java/architect/ELK/#解压-4" class="sidebar-link">解压</a></li><li class="sidebar-sub-header"><a href="/Java/architect/ELK/#配置-3" class="sidebar-link">配置</a></li><li class="sidebar-sub-header"><a href="/Java/architect/ELK/#启动-2" class="sidebar-link">启动</a></li></ul></li><li class="sidebar-sub-header"><a href="/Java/architect/ELK/#filebeat" class="sidebar-link">FileBeat</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Java/architect/ELK/#解压-5" class="sidebar-link">解压</a></li><li class="sidebar-sub-header"><a href="/Java/architect/ELK/#配置-4" class="sidebar-link">配置</a></li><li class="sidebar-sub-header"><a href="/Java/architect/ELK/#启动-3" class="sidebar-link">启动</a></li></ul></li><li class="sidebar-sub-header"><a href="/Java/architect/ELK/#优化" class="sidebar-link">优化</a></li></ul></li><li><a href="/Java/architect/ELK/elk-efk.html" class="sidebar-link">从 ELK 到 EFK 演进</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Java/architect/ELK/elk-efk.html#背景" class="sidebar-link">背景</a></li><li class="sidebar-sub-header"><a href="/Java/architect/ELK/elk-efk.html#为什么做日志系统" class="sidebar-link">为什么做日志系统</a></li><li class="sidebar-sub-header"><a href="/Java/architect/ELK/elk-efk.html#简单版架构" class="sidebar-link">简单版架构</a></li><li class="sidebar-sub-header"><a href="/Java/architect/ELK/elk-efk.html#集群版架构" class="sidebar-link">集群版架构</a></li><li class="sidebar-sub-header"><a href="/Java/architect/ELK/elk-efk.html#引入消息队列" class="sidebar-link">引入消息队列</a></li><li class="sidebar-sub-header"><a href="/Java/architect/ELK/elk-efk.html#多机房部署" class="sidebar-link">多机房部署</a></li><li class="sidebar-sub-header"><a href="/Java/architect/ELK/elk-efk.html#引入filebeat" class="sidebar-link">引入Filebeat</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Java/architect/ELK/elk-efk.html#压测环境" class="sidebar-link">压测环境</a></li><li class="sidebar-sub-header"><a href="/Java/architect/ELK/elk-efk.html#压测方案" class="sidebar-link">压测方案</a></li><li class="sidebar-sub-header"><a href="/Java/architect/ELK/elk-efk.html#压测结果" class="sidebar-link">压测结果</a></li></ul></li><li class="sidebar-sub-header"><a href="/Java/architect/ELK/elk-efk.html#总结" class="sidebar-link">总结</a></li><li class="sidebar-sub-header"><a href="/Java/architect/ELK/elk-efk.html#参考资料" class="sidebar-link">参考资料</a></li></ul></li><li><a href="/Java/architect/ELK/practice.html" class="active sidebar-link">亿级 ELK 日志平台构建实践</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Java/architect/ELK/practice.html#整体架构" class="sidebar-link">整体架构</a></li><li class="sidebar-sub-header"><a href="/Java/architect/ELK/practice.html#版本说明" class="sidebar-link">版本说明</a></li><li class="sidebar-sub-header"><a href="/Java/architect/ELK/practice.html#具体实践" class="sidebar-link">具体实践</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Java/architect/ELK/practice.html#filebeat" class="sidebar-link">Filebeat</a></li><li class="sidebar-sub-header"><a href="/Java/architect/ELK/practice.html#kafka" class="sidebar-link">Kafka</a></li><li class="sidebar-sub-header"><a href="/Java/architect/ELK/practice.html#logstash" class="sidebar-link">Logstash</a></li><li class="sidebar-sub-header"><a href="/Java/architect/ELK/practice.html#elasticsearch" class="sidebar-link">Elasticsearch</a></li><li class="sidebar-sub-header"><a href="/Java/architect/ELK/practice.html#kibana" class="sidebar-link">kibana</a></li></ul></li><li class="sidebar-sub-header"><a href="/Java/architect/ELK/practice.html#总结" class="sidebar-link">总结</a></li></ul></li></ul> </div> <div class="page"> <div class="content"><h1 id="亿级-elk-日志平台构建实践"><a href="#亿级-elk-日志平台构建实践" aria-hidden="true" class="header-anchor">#</a> 亿级 ELK 日志平台构建实践</h1> <p>本文由曹林华先生的<a href="http://blog.51cto.com/13527416/2051506" target="_blank" rel="noopener noreferrer">ELK系列文章<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>搬运而来，旨在在搬运过程中学习ELK，仅为个人学习手册使用。</p> <p><img src="http://i2.51cto.com/images/blog/201805/16/68f806fc3e16bc209a3e9662cd2ebef9.png?x-oss-process=image/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_100,g_se,x_10,y_10,shadow_90,type_ZmFuZ3poZW5naGVpdGk=" alt="亿级 ELK 日志平台构建实践"></p> <p>本篇主要讲工作中的真实经历，我们怎么打造亿级日志平台，同时手把手教大家建立起这样一套亿级 ELK 系统。日志平台具体发展历程可以参考上篇「从 ELK 到 EFK 演进」</p> <p>废话不多说，老司机们座好了，我们准备发车了~~~</p> <h2 id="整体架构"><a href="#整体架构" aria-hidden="true" class="header-anchor">#</a> 整体架构</h2> <p><img src="http://i2.51cto.com/images/blog/201805/16/fdfd8706744a67866b2e34368da3f2f2.png?x-oss-process=image/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_100,g_se,x_10,y_10,shadow_90,type_ZmFuZ3poZW5naGVpdGk=" alt="亿级 ELK 日志平台构建实践"></p> <p>整体架构主要分为 4 个模块，分别提供不同的功能</p> <p><strong>Filebeat</strong>：轻量级数据收集引擎。基于原先 Logstash-fowarder 的源码改造出来。换句话说：Filebeat就是新版的 Logstash-fowarder，也会是 ELK Stack 在 Agent 的第一选择。</p> <p><strong>Kafka</strong>: 数据缓冲队列。作为消息队列解耦了处理过程，同时提高了可扩展性。具有峰值处理能力，使用消息队列能够使关键组件顶住突发的访问压力，而不会因为突发的超负荷的请求而完全崩溃。</p> <p><strong>Logstash</strong> ：数据收集处理引擎。支持动态的从各种数据源搜集数据，并对数据进行过滤、分析、丰富、统一格式等操作，然后存储以供后续使用。</p> <p><strong>Elasticsearch</strong> ：分布式搜索引擎。具有高可伸缩、高可靠、易管理等特点。可以用于全文检索、结构化检索和分析，并能将这三者结合起来。Elasticsearch 基于 Lucene 开发，现在使用最广的开源搜索引擎之一，Wikipedia 、StackOverflow、Github 等都基于它来构建自己的搜索引擎。</p> <p><strong>Kibana</strong> ：可视化化平台。它能够搜索、展示存储在 Elasticsearch 中索引数据。使用它可以很方便的用图表、表格、地图展示和分析数据。</p> <h2 id="版本说明"><a href="#版本说明" aria-hidden="true" class="header-anchor">#</a> 版本说明</h2> <div class="language- extra-class"><pre class="language-text"><code>Filebeat: 6.2.4
Kafka: 2.11-1
Logstash: 6.2.4
Elasticsearch: 6.2.4
Kibana: 6.2.4

相应的版本最好下载对应的插件
</code></pre></div><h2 id="具体实践"><a href="#具体实践" aria-hidden="true" class="header-anchor">#</a> 具体实践</h2> <p>我们就以比较常见的 Nginx 日志来举例说明下，日志内容是 JSON 格式</p> <div class="language- extra-class"><pre class="language-text"><code>{&quot;@timestamp&quot;:&quot;2017-12-27T16:38:17+08:00&quot;,&quot;host&quot;:&quot;192.168.56.11&quot;,&quot;clientip&quot;:&quot;192.168.56.11&quot;,&quot;size&quot;:26,&quot;responsetime&quot;:0.000,&quot;upstreamtime&quot;:&quot;-&quot;,&quot;upstreamhost&quot;:&quot;-&quot;,&quot;http_host&quot;:&quot;192.168.56.11&quot;,&quot;url&quot;:&quot;/nginxweb/index.html&quot;,&quot;domain&quot;:&quot;192.168.56.11&quot;,&quot;xff&quot;:&quot;-&quot;,&quot;referer&quot;:&quot;-&quot;,&quot;status&quot;:&quot;200&quot;}
{&quot;@timestamp&quot;:&quot;2017-12-27T16:38:17+08:00&quot;,&quot;host&quot;:&quot;192.168.56.11&quot;,&quot;clientip&quot;:&quot;192.168.56.11&quot;,&quot;size&quot;:26,&quot;responsetime&quot;:0.000,&quot;upstreamtime&quot;:&quot;-&quot;,&quot;upstreamhost&quot;:&quot;-&quot;,&quot;http_host&quot;:&quot;192.168.56.11&quot;,&quot;url&quot;:&quot;/nginxweb/index.html&quot;,&quot;domain&quot;:&quot;192.168.56.11&quot;,&quot;xff&quot;:&quot;-&quot;,&quot;referer&quot;:&quot;-&quot;,&quot;status&quot;:&quot;200&quot;}
{&quot;@timestamp&quot;:&quot;2017-12-27T16:38:17+08:00&quot;,&quot;host&quot;:&quot;192.168.56.11&quot;,&quot;clientip&quot;:&quot;192.168.56.11&quot;,&quot;size&quot;:26,&quot;responsetime&quot;:0.000,&quot;upstreamtime&quot;:&quot;-&quot;,&quot;upstreamhost&quot;:&quot;-&quot;,&quot;http_host&quot;:&quot;192.168.56.11&quot;,&quot;url&quot;:&quot;/nginxweb/index.html&quot;,&quot;domain&quot;:&quot;192.168.56.11&quot;,&quot;xff&quot;:&quot;-&quot;,&quot;referer&quot;:&quot;-&quot;,&quot;status&quot;:&quot;200&quot;}
{&quot;@timestamp&quot;:&quot;2017-12-27T16:38:17+08:00&quot;,&quot;host&quot;:&quot;192.168.56.11&quot;,&quot;clientip&quot;:&quot;192.168.56.11&quot;,&quot;size&quot;:26,&quot;responsetime&quot;:0.000,&quot;upstreamtime&quot;:&quot;-&quot;,&quot;upstreamhost&quot;:&quot;-&quot;,&quot;http_host&quot;:&quot;192.168.56.11&quot;,&quot;url&quot;:&quot;/nginxweb/index.html&quot;,&quot;domain&quot;:&quot;192.168.56.11&quot;,&quot;xff&quot;:&quot;-&quot;,&quot;referer&quot;:&quot;-&quot;,&quot;status&quot;:&quot;200&quot;}
{&quot;@timestamp&quot;:&quot;2017-12-27T16:38:17+08:00&quot;,&quot;host&quot;:&quot;192.168.56.11&quot;,&quot;clientip&quot;:&quot;192.168.56.11&quot;,&quot;size&quot;:26,&quot;responsetime&quot;:0.000,&quot;upstreamtime&quot;:&quot;-&quot;,&quot;upstreamhost&quot;:&quot;-&quot;,&quot;http_host&quot;:&quot;192.168.56.11&quot;,&quot;url&quot;:&quot;/nginxweb/index.html&quot;,&quot;domain&quot;:&quot;192.168.56.11&quot;,&quot;xff&quot;:&quot;-&quot;,&quot;referer&quot;:&quot;-&quot;,&quot;status&quot;:&quot;200&quot;}
</code></pre></div><h3 id="filebeat"><a href="#filebeat" aria-hidden="true" class="header-anchor">#</a> Filebeat</h3> <blockquote><p>为什么用 Filebeat ，而不用原来的 Logstash 呢？</p></blockquote> <p>原因很简单，资源消耗比较大。</p> <p>由于 Logstash 是跑在 JVM 上面，资源消耗比较大，后来作者用 GO 写了一个功能较少但是资源消耗也小的轻量级的 Agent 叫 Logstash-forwarder。</p> <p>后来作者加入 elastic.co 公司， Logstash-forwarder 的开发工作给公司内部 GO 团队来搞，最后命名为 Filebeat。</p> <p>Filebeat 需要部署在每台应用服务器上，可以通过 Salt 来推送并安装配置。</p> <h4 id="下载"><a href="#下载" aria-hidden="true" class="header-anchor">#</a> 下载</h4> <div class="language- extra-class"><pre class="language-text"><code>$ wget https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-6.2.4-darwin-x86_64.tar.gz
</code></pre></div><h4 id="解压"><a href="#解压" aria-hidden="true" class="header-anchor">#</a> 解压</h4> <div class="language- extra-class"><pre class="language-text"><code>tar -zxvf filebeat-6.2.4-darwin-x86_64.tar.gz
mv filebeat-6.2.4-darwin-x86_64 filebeat
cd filebeat
</code></pre></div><h4 id="修改配置"><a href="#修改配置" aria-hidden="true" class="header-anchor">#</a> 修改配置</h4> <p>修改 Filebeat 配置，支持收集本地目录日志，并输出日志到 Kafka 集群中</p> <div class="language- extra-class"><pre class="language-text"><code>$ vim fileat.yml
filebeat.prospectors:
- input_type: log
  paths:
    -  /opt/logs/server/nginx.log
  json.keys_under_root: true
  json.add_error_key: true
  json.message_key: log

output.kafka:   
  hosts: [&quot;192.168.0.1:9092，192.168.0.2:9092，192.168.0.3:9092&quot;]
  topic: 'nginx'
</code></pre></div><p>Filebeat 6.0 之后一些配置参数变动比较大，比如 document_type 就不支持，需要用 fields 来代替等等。</p> <h4 id="启动"><a href="#启动" aria-hidden="true" class="header-anchor">#</a> 启动</h4> <div class="language- extra-class"><pre class="language-text"><code>$ ./filebeat -e -c filebeat.yml
</code></pre></div><h3 id="kafka"><a href="#kafka" aria-hidden="true" class="header-anchor">#</a> Kafka</h3> <p>生产环境中 Kafka 集群中节点数量建议为（2N + 1 ）个，这边就以 3 个节点举例</p> <h4 id="下载-2"><a href="#下载-2" aria-hidden="true" class="header-anchor">#</a> 下载</h4> <p>直接到官网下载 Kafka</p> <div class="language- extra-class"><pre class="language-text"><code>$ wget http://mirror.bit.edu.cn/apache/kafka/1.0.0/kafka_2.11-1.0.0.tgz
</code></pre></div><h4 id="解压-2"><a href="#解压-2" aria-hidden="true" class="header-anchor">#</a> 解压</h4> <div class="language- extra-class"><pre class="language-text"><code>tar -zxvf kafka_2.11-1.0.0.tgz
mv kafka_2.11-1.0.0 kafka
cd kafka
</code></pre></div><h4 id="修改-zookeeper-配置"><a href="#修改-zookeeper-配置" aria-hidden="true" class="header-anchor">#</a> 修改 Zookeeper 配置</h4> <p>修改 Zookeeper 配置，搭建 Zookeeper 集群，数量 ( 2N + 1 ) 个</p> <p>ZK 集群建议采用 Kafka 自带，减少网络相关的因素干扰</p> <div class="language- extra-class"><pre class="language-text"><code>$ vim zookeeper.properties

tickTime=2000
dataDir=/opt/zookeeper
clientPort=2181
maxClientCnxns=50
initLimit=10
syncLimit=5

server.1=192.168.0.1:2888:3888
server.2=192.168.0.2:2888:3888
server.3=192.168.0.3:2888:3888
</code></pre></div><p>Zookeeper data 目录下面添加 myid 文件，内容为代表 Zooekeeper 节点 id （1，2，3），并保证不重复</p> <div class="language- extra-class"><pre class="language-text"><code>$ vim /opt/zookeeper/myid
1
</code></pre></div><h4 id="启动-zookeeper-节点"><a href="#启动-zookeeper-节点" aria-hidden="true" class="header-anchor">#</a> 启动 Zookeeper 节点</h4> <p>分别启动 3 台 Zookeeper 节点，保证集群的高可用</p> <div class="language- extra-class"><pre class="language-text"><code>$ ./zookeeper-server-start.sh -daemon ./config/zookeeper.properties
</code></pre></div><h4 id="修改-kafka-配置"><a href="#修改-kafka-配置" aria-hidden="true" class="header-anchor">#</a> 修改 Kafka 配置</h4> <p>kafka 集群这边搭建为 3 台，可以逐个修改 Kafka 配置，需要注意其中 broker.id 分别 （1，2，3）</p> <div class="language- extra-class"><pre class="language-text"><code>$ vim ./config/server.properties
broker.id=1
port=9092
host.name=192.168.0.1
num.replica.fetchers=1
log.dirs=/opt/kafka_logs
num.partitions=3
zookeeper.connect=192.168.0.1: 192.168.0.2: 192.168.0.3:2181
zookeeper.connection.timeout.ms=6000
zookeeper.sync.time.ms=2000
num.io.threads=8
num.network.threads=8
queued.max.requests=16
fetch.purgatory.purge.interval.requests=100
producer.purgatory.purge.interval.requests=100
delete.topic.enable=true
</code></pre></div><h4 id="启动-kafka-集群"><a href="#启动-kafka-集群" aria-hidden="true" class="header-anchor">#</a> 启动 Kafka 集群</h4> <p>分别启动 3 台 Kafka 节点，保证集群的高可用</p> <div class="language- extra-class"><pre class="language-text"><code>$ ./bin/kafka-server-start.sh -daemon ./config/server.properties
</code></pre></div><p>查看 topic 是否创建成功</p> <div class="language- extra-class"><pre class="language-text"><code>$ bin/kafka-topics.sh --list --zookeeper localhost:2181

nginx
</code></pre></div><h4 id="监控-kafka-manager"><a href="#监控-kafka-manager" aria-hidden="true" class="header-anchor">#</a> 监控 Kafka Manager</h4> <p>Kafka-manager 是 Yahoo 公司开源的集群管理工具。</p> <p>可以在 Github 上下载安装：<a href="https://github.com/yahoo/kafka-manager" target="_blank" rel="noopener noreferrer">https://github.com/yahoo/kafka-manager<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><img src="http://i2.51cto.com/images/blog/201805/16/6b6ad3a704339702cfc754ff71567278.png?x-oss-process=image/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_100,g_se,x_10,y_10,shadow_90,type_ZmFuZ3poZW5naGVpdGk=" alt="亿级 ELK 日志平台构建实践"></p> <p>如果遇到 Kafka 消费不及时的话，可以通过到具体 cluster 页面上，增加 partition。Kafka 通过 partition 分区来提高并发消费速度</p> <p><img src="http://i2.51cto.com/images/blog/201805/16/8cff5030271fe5dd99c945089de083ed.png?x-oss-process=image/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_100,g_se,x_10,y_10,shadow_90,type_ZmFuZ3poZW5naGVpdGk=" alt="亿级 ELK 日志平台构建实践"></p> <h3 id="logstash"><a href="#logstash" aria-hidden="true" class="header-anchor">#</a> Logstash</h3> <p>Logstash 提供三大功能</p> <ul><li>INPUT 进入</li> <li>FILTER 过滤功能</li> <li>OUTPUT 出去</li></ul> <p>如果使用 Filter 功能的话，强烈推荐大家使用 <a href="https://grokdebug.herokuapp.com/" target="_blank" rel="noopener noreferrer">Grok debugger<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 来预先解析日志格式。</p> <p><img src="http://i2.51cto.com/images/blog/201805/16/7a72bbadf135f76bb01976f07ea19f84.png?x-oss-process=image/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_100,g_se,x_10,y_10,shadow_90,type_ZmFuZ3poZW5naGVpdGk=" alt="亿级 ELK 日志平台构建实践"></p> <h4 id="下载-3"><a href="#下载-3" aria-hidden="true" class="header-anchor">#</a> 下载</h4> <div class="language- extra-class"><pre class="language-text"><code>$ wget https://artifacts.elastic.co/downloads/logstash/logstash-6.2.4.tar.gz
</code></pre></div><h4 id="解压重命名"><a href="#解压重命名" aria-hidden="true" class="header-anchor">#</a> 解压重命名</h4> <div class="language- extra-class"><pre class="language-text"><code>$ tar -zxvf logstash-6.2.4.tar.gz
$ mv logstash-6.2.4 logstash
</code></pre></div><h4 id="修改-logstash-配置"><a href="#修改-logstash-配置" aria-hidden="true" class="header-anchor">#</a> 修改 Logstash 配置</h4> <p>修改 Logstash 配置，使之提供 indexer 的功能，将数据插入到 Elasticsearch 集群中</p> <div class="language- extra-class"><pre class="language-text"><code>$ vim nginx.conf

input {
  kafka {
    type =&gt; &quot;kafka&quot;
    bootstrap_servers =&gt; &quot;192.168.0.1:2181,192.168.0.2:2181,192.168.0.3:2181&quot;
    topics =&gt; &quot;nginx&quot;
    group_id =&gt; &quot;logstash&quot;
    consumer_threads =&gt; 2
  }
}

output {
  elasticsearch {
    host =&gt; [&quot;192.168.0.1&quot;,&quot;192.168.0.2&quot;，&quot;192.168.0.3&quot;]
    port =&gt; &quot;9300&quot;
    index =&gt; &quot;nginx-%{+YYYY.MM.dd}&quot;
  }
}
</code></pre></div><h4 id="启动-logstash"><a href="#启动-logstash" aria-hidden="true" class="header-anchor">#</a> 启动 Logstash</h4> <div class="language- extra-class"><pre class="language-text"><code>$ ./bin/logstash -f nginx.conf
</code></pre></div><h3 id="elasticsearch"><a href="#elasticsearch" aria-hidden="true" class="header-anchor">#</a> Elasticsearch</h3> <h4 id="下载-4"><a href="#下载-4" aria-hidden="true" class="header-anchor">#</a> 下载</h4> <div class="language- extra-class"><pre class="language-text"><code>$ wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-6.2.4.tar.gz
</code></pre></div><h4 id="解压-3"><a href="#解压-3" aria-hidden="true" class="header-anchor">#</a> 解压</h4> <div class="language- extra-class"><pre class="language-text"><code>$ tar -zxvf elasticsearch-6.2.4.tar.gz
$ mv elasticsearch-6.2.4.tar.gz elasticsearch
</code></pre></div><h4 id="修改配置-2"><a href="#修改配置-2" aria-hidden="true" class="header-anchor">#</a> 修改配置</h4> <div class="language- extra-class"><pre class="language-text"><code>$ vim config/elasticsearch.yml

cluster.name: es 
node.name: es-node1
network.host: 192.168.0.1
discovery.zen.ping.unicast.hosts: [&quot;192.168.0.1&quot;]
discovery.zen.minimum_master_nodes: 1
</code></pre></div><h4 id="启动-2"><a href="#启动-2" aria-hidden="true" class="header-anchor">#</a> 启动</h4> <p>通过 -d 来后台启动</p> <div class="language- extra-class"><pre class="language-text"><code>$ ./bin/elasticsearch -d
</code></pre></div><p>打开网页 <a href="http://192.168.0.1:9200/" target="_blank" rel="noopener noreferrer">http://192.168.0.1:9200/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, 如果出现下面信息说明配置成功</p> <div class="language- extra-class"><pre class="language-text"><code>{
    name: &quot;es-node1&quot;,
    cluster_name: &quot;es&quot;,
    cluster_uuid: &quot;XvoyA_NYTSSV8pJg0Xb23A&quot;,
    version: {
        number: &quot;6.2.4&quot;,
        build_hash: &quot;ccec39f&quot;,
        build_date: &quot;2018-04-12T20:37:28.497551Z&quot;,
        build_snapshot: false,
        lucene_version: &quot;7.2.1&quot;,
        minimum_wire_compatibility_version: &quot;5.6.0&quot;,
        minimum_index_compatibility_version: &quot;5.0.0&quot;
    },
    tagline: &quot;You Know, for Search&quot;
}
</code></pre></div><h4 id="控制台"><a href="#控制台" aria-hidden="true" class="header-anchor">#</a> 控制台</h4> <p>Cerebro 这个名字大家可能觉得很陌生，其实过去它的名字叫 kopf ！因为 Elasticsearch 5.0 不再支持 site plugin，所以 kopf 作者放弃了原项目，另起炉灶搞了 cerebro，以独立的单页应用形式，继续支持新版本下 Elasticsearch 的管理工作。</p> <p><img src="http://i2.51cto.com/images/blog/201805/16/c479964db186c35455fe3c68d1f5be76.png?x-oss-process=image/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_100,g_se,x_10,y_10,shadow_90,type_ZmFuZ3poZW5naGVpdGk=" alt="亿级 ELK 日志平台构建实践"></p> <h4 id="注意点"><a href="#注意点" aria-hidden="true" class="header-anchor">#</a> 注意点</h4> <ol><li>Master 与 Data 节点分离，当 Data 节点大于 3 个的时候，建议责任分离，减轻压力</li> <li>Data Node 内存不超过 32G ，建议设置成 31 G ，具体原因可以看上一篇文章</li> <li>discovery.zen.minimum_master_nodes 设置成 （ total / 2 + 1 ），避免脑裂情况</li> <li>最重要的一点，不要将 ES 暴露在公网中，建议都安装 X-PACK ，来加强其安全性</li></ol> <h3 id="kibana"><a href="#kibana" aria-hidden="true" class="header-anchor">#</a> kibana</h3> <h4 id="下载-5"><a href="#下载-5" aria-hidden="true" class="header-anchor">#</a> 下载</h4> <div class="language- extra-class"><pre class="language-text"><code>$ wget https://artifacts.elastic.co/downloads/kibana/kibana-6.2.4-darwin-x86_64.tar.gz
</code></pre></div><h4 id="解压-4"><a href="#解压-4" aria-hidden="true" class="header-anchor">#</a> 解压</h4> <div class="language- extra-class"><pre class="language-text"><code>$ tar -zxvf kibana-6.2.4-darwin-x86_64.tar.gz
$ mv kibana-6.2.4-darwin-x86_64.tar.gz kibana
</code></pre></div><h4 id="修改配置-3"><a href="#修改配置-3" aria-hidden="true" class="header-anchor">#</a> 修改配置</h4> <div class="language- extra-class"><pre class="language-text"><code>$ vim config/kibana.yml

server.port: 5601
server.host: &quot;192.168.0.1&quot;
elasticsearch.url: &quot;http://192.168.0.1:9200&quot;
</code></pre></div><h4 id="启动-kibana"><a href="#启动-kibana" aria-hidden="true" class="header-anchor">#</a> 启动 Kibana</h4> <div class="language- extra-class"><pre class="language-text"><code>$ nohup ./bin/kibana &amp;
</code></pre></div><h4 id="界面展示"><a href="#界面展示" aria-hidden="true" class="header-anchor">#</a> 界面展示</h4> <p>创建索引页面需要到 <strong>Management -&gt; Index Patterns</strong> 中通过前缀来指定</p> <p><img src="http://i2.51cto.com/images/blog/201805/16/ab0e5ac0e05b40e96bd9263a90f3a66f.png?x-oss-process=image/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_100,g_se,x_10,y_10,shadow_90,type_ZmFuZ3poZW5naGVpdGk=" alt="亿级 ELK 日志平台构建实践"></p> <h4 id="最终效果展示"><a href="#最终效果展示" aria-hidden="true" class="header-anchor">#</a> 最终效果展示</h4> <p><img src="http://i2.51cto.com/images/blog/201805/16/d7eaeadce1355bbc3533d32aee98edbc.png?x-oss-process=image/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_100,g_se,x_10,y_10,shadow_90,type_ZmFuZ3poZW5naGVpdGk=" alt="亿级 ELK 日志平台构建实践"></p> <h2 id="总结"><a href="#总结" aria-hidden="true" class="header-anchor">#</a> 总结</h2> <p>综上，通过上面部署命令来实现 ELK 的整套组件，包含了日志收集、过滤、索引和可视化的全部流程，基于这套系统实现分析日志功能。同时，通过水平扩展 Kafka、Elasticsearch 集群，可以实现日均亿级的日志实时处理。</p></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/Java/architect/ELK/elk-efk.html" class="prev">
          从 ELK 到 EFK 演进
        </a></span> <!----></p></div> </div> <!----></div></div>
    <script src="/assets/js/app.5747588d.js" defer></script><script src="/assets/js/35.d267a990.js" defer></script>
  </body>
</html>
