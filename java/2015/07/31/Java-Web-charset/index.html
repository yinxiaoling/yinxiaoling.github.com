<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Java — Web开发中的字符集 &middot; 尹枭凌
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/naringu.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/form.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <!-- Icons -->
  <link rel="shortcut icon" href="./public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
  <link rel="alternate" type="application/rss+xml" title="Mozilla RSS" href="feed.category.xml">
  </head>

  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-48740529-1', 'auto');
  ga('send', 'pageview');

</script>


<body class="theme-6dd">

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
      <img width="200" height="180" alt="A photo of ariestiyansyah" src="/images/head.jpeg">
    <p align="center">If I know what love is, <br />it is because of you.</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">首页</a>

    

    
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/about/">关于我</a>
        
      
    
      
    
      
        
          <a class="sidebar-nav-item" href="/categories/">分类</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="/contact/">联系方式</a>
        
      
    
      
    
      
        
      
    
      
        
      
    
      
        
      
    

    <a class="sidebar-nav-item" href="https://github.com/yinxiaoling">GitHub project</a>
  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2015. All rights reserved.
    </p>
  </div>
</div>


    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">尹枭凌</a>
            <small>—因为有了因为，所以有了所以，既然已成既然，何必再问何必。</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="post">
  <h1 class="post-title">Java — Web开发中的字符集</h1>
  <span class="post-date">31 Jul 2015</span>
  <p>在Java语言中，涉及修改编码的地方大概总结包括以下这几部分：</p>

<blockquote>
<p>浏览器、服务器、数据库、操作系统</p>
</blockquote>

<p>浏览器：
如果使用模板语言，html需要设置显示的字符集。这个适用于浏览器判断什么编码显示。</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">&lt;metahttp-equiv=&quot;Content-Type&quot;content=&quot;text/html; charset=utf-8&quot;/&gt;
</code></pre></div>
<p>扩展，浏览器识别编码的顺序：</p>

<p>1.如果HTTP头部申明了charset，则会使用HTTP头部的，</p>

<p>2.让HTTP头部没有设置，则会去解析meta标签的，</p>

<p>3.如果meta也没有的话，浏览器会根据是否设置了auto detect来进行编码识别，</p>

<p>4.否则会使用本地UI的字符编码。</p>

<hr>

<p>服务器：
对于JSP等动态语言，需要在jsp头部设置编码格式，J2EE服务器解析JSP时才会把整个页面编码为UTF-8输出，不然就按照系统默认编码格式ISO-8859-1输出了。</p>

<p>JSP设置格式如下：</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">&lt;%@ page language= &quot;java&quot; contentType = &quot;text/html; charset=UTF-8&quot; pageEncoding =&quot;UTF-8&quot; %&gt;
</code></pre></div>
<p>大家都知道，JSP对应的就是servlet。servlet的编码对应如下设置：</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">publicvoid service(HttpServletRequest request, HttpServletResponse response) throws ServletException,IOException{
     response.setContentType(&quot;text/html;charset=utf-8&quot;);    
}
</code></pre></div>
<hr>

<p>还有不要漏掉大家常用的spring工具类，编码转换filter，很实用。在你用struts、spring mvc时这个过滤器帮你转换没有设置的编码过滤。如下设置：</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">&lt;filter&gt;    
&lt;filter-name&gt; Set Character Encoding&lt;/filter-name&gt;    
&lt;filter-class&gt;    
     org.springframework.web.filter.CharacterEncodingFilter    
&lt;/filter-class&gt;    
&lt;init-param&gt;    
&lt;param-name&gt;encoding&lt;/param-name&gt;    
&lt;param-value&gt;UTF-8&lt;/param-value&gt;    
&lt;/init-param&gt;    
&lt;/filter&gt;    
</code></pre></div>
<hr>

<p>万一还有乱码怎么办呢？doGet方式的参数传递肯定会有乱码问题。只需要在tomcat的监听器里设置编码字符集如下（文件一般存储在 /tomcat安装目录/conf/server.xml ）：</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">&lt;Connectorport=&quot;80&quot;protocol=&quot;HTTP/1.1&quot; connectionTimeout=&quot;20000&quot;    redirectPort=&quot;8443&quot;URIEncoding=&quot;utf-8&quot;/&gt;    
</code></pre></div>
<p>大家在开发的时候别忘了java文件本身也是有编码格式的。在类文件右键查看属性。</p>

<p>如果开发时忘记更改文件的编码格式，windows默认是GBK的，后来又要一直到utf8编码的linux怎么办。文件巨多，总不能一个一个去更改吧。其实很简单，只需要在java命令的环境参数设置 -Dfile.encoding=GBK 解决。</p>

<p>编译java代码时，如果使用ant需要在javac里设置编译的字符集。这样打印的log输出到文件或者控制台上就不会乱码了。</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">&lt;javacdebuglevel= &quot;source,lines&quot;source= &quot;1.6&quot;encoding= &quot;utf-8&quot;&gt;    
</code></pre></div>
<p>maven编译时设置的字符集：</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">&lt;artifactId&gt; maven-compiler-plugin &lt;/artifactId&gt;    
&lt;version&gt; 2.5 &lt;/version&gt;    

&lt;configuration&gt;    
&lt;optimize&gt; true &lt;/optimize&gt;    
&lt;showDeprecation&gt; false &lt;/showDeprecation&gt;    
&lt;debuglevel&gt; lines,source &lt;/debuglevel&gt;    
&lt;source&gt; 1.6 &lt;/source&gt;    
&lt;target&gt; 1.6 &lt;/target&gt;    
&lt;encoding&gt; UTF-8 &lt;/encoding&gt;    
&lt;meminitial&gt; 128m &lt;/meminitial&gt;    
&lt;maxmem&gt; 768m &lt;/maxmem&gt;    

&lt;/configuration&gt;    
</code></pre></div>
<p>sqlmap的sql xml，sping的xml 也是需要设置的，因为涉及到跨平台。 顶上添加：</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">&lt;!--?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?--&gt;    
</code></pre></div>
<p>数据库：
这里列出大家用的最多的Mysql字符集设置。打开mysql的配置文件( linux 一般在 /etc/my.cnf ，windows在mysql的安装目录 my.ini)。设置如下：</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">[mysqld]    
default-character-set = utf8    

[ mysql]    
character_set_server = utf8    
</code></pre></div>
<p>jdbc需要设置</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">jdbc : mysql://192.168.0.237:3306/dzh_db?useUnicode=true&amp;characterEncoding=UTF-8
</code></pre></div>
<p>这些都设置了一般的中文是不会有问题的。
不过最近出现了一个问题很搞怪。以前以为所有的字符只要设置好了所有数据都可以录入数据库，结果有些字符就不行，比如●■★这类型的。后来把这些字符变成字节码，居然不是三位utf8的，我擦，大汗淋漓。后来查询可以通过过滤utf8 特殊字符的方式处理。</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">publicstaticString Utf2String (byte buf[]){    
    int len = buf.length;    
    StringBuffer sb =newStringBuffer(len /2);    
    for(int i =0; i &amp;lt; len; i++){    

        if(by2int(buf[i])&amp;lt;= 0x7F)    
            sb.append((char) buf[i]);    
        elseif(by2int(buf[i])&amp;lt;= 0xDF &amp;amp;&amp;amp; by2int(buf[i])&amp;gt;= 0xC0){    
            int bh = by2int(buf[i]&amp;amp; 0x1F);    
            int bl = by2int(buf[++i]&amp;amp; 0x3F);    

            bl = by2int(bh &amp;lt;&amp;lt;6| bl); bh = by2int(bh &amp;gt;&amp;gt;2);    
            int c = bh &amp;lt;&amp;lt;8| bl;    
            sb.append((char) c);    
        }elseif(by2int(buf[i])&amp;lt;= 0xEF &amp;amp;&amp;amp; by2int(buf[i])&amp;gt;= 0xE0){    
            int bh = by2int(buf[i]&amp;amp; 0x0F);    
            int bl = by2int(buf[++i]&amp;amp; 0x3F);    
            int bll = by2int(buf[++i]&amp;amp; 0x3F);    

            bh = by2int(bh &amp;lt;&amp;lt;4| bl &amp;gt;&amp;gt;2);    
            bl = by2int(bl &amp;lt;&amp;lt;6| bll);    

            int c = bh &amp;lt;&amp;lt;8| bl;    
            // 空格转换为半角    
            if(c ==58865){    
                    c =32;    
            }    
            sb.append((char) c);    

        }    
    }    
    return sb.toString();    
}    
</code></pre></div>
<p>或者把mysql的字符集改为 utf8mb4 ，记得这个只有mysql55支持.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">[mysqld]    
default-character-set =utf8mb4    

[ mysql]    
character_set_server = utf8mb4    
</code></pre></div>
<p>操作系统：
windows默认是gbk，一般不需要变动。不过大家又想每个文件都要建立为utf8格式怎么办，不可能我们每个文件建立后都去用属性改变一下？太麻烦！直接在eclipse设置后，同种类型的文件建立都会是utf8格式。</p>

<p>linux，可以有两个地方修改基本就足够了：</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">vi /etc/sysconfig/i18n
</code></pre></div>
<p>修改</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">LANG=&quot;zh_CN.GB3212&quot;    
LANGUAGE=&quot;zh_CN.GB18030:zh_CN.GB2312:zh_CN&quot;    
SUPPORTED=&quot;zh_CN.GB18030:zh_CN:zh:en_US.UTF-8:en_US:en&quot;    

vi /etc/profile    
export LC_ALL=&quot;zh_CN.GB2312&quot;    
export LANG=&quot;zh_CN.GB2312&quot;    
</code></pre></div>
</div>

<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/git/2015/08/06/Git-Git-command/">
            Git — Git常用命令速查表
            <small>06 Aug 2015</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/others/2015/08/01/other-qizongzui/">
            Others — 让你此生难成大器的七宗罪
            <small>01 Aug 2015</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/java/2015/08/01/other-PG-10jineng/">
            Java — Java程序员应该掌握的十项技能
            <small>01 Aug 2015</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>

<div class="comments">
    <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'testnaringu';
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'testnaringu';
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>

</div>

      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>
    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>

    <div align="center" class="footer">
        Copyright © 2015 <br>
    </div>
  </body>
</html>

