<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Java — 事务 &middot; 尹枭凌
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/naringu.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/form.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <!-- Icons -->
  <link rel="shortcut icon" href="./public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
  <link rel="alternate" type="application/rss+xml" title="Mozilla RSS" href="feed.category.xml">
  </head>

  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-48740529-1', 'auto');
  ga('send', 'pageview');

</script>


<body class="theme-6dd">

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
      <img width="200" height="180" alt="A photo of ariestiyansyah" src="/images/head.jpeg">
    <p align="center">If I know what love is, <br />it is because of you.</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">首页</a>

    

    
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/about/">关于我</a>
        
      
    
      
    
      
        
          <a class="sidebar-nav-item" href="/categories/">分类</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="/contact/">联系方式</a>
        
      
    
      
    
      
        
      
    
      
        
      
    
      
        
      
    

    <a class="sidebar-nav-item" href="https://github.com/yinxiaoling">GitHub project</a>
  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2015. All rights reserved.
    </p>
  </div>
</div>


    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">尹枭凌</a>
            <small>—因为有了因为，所以有了所以，既然已成既然，何必再问何必。</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="post">
  <h1 class="post-title">Java — 事务</h1>
  <span class="post-date">31 Jul 2015</span>
  <h4>什么是事务?</h4>

<p>通常的观念，事务（transaction）只与数据库有关。</p>

<p>事务（transaction）必须服从ISO/IEC所制定的ACID原则。</p>

<p>ACID是原子性（atomicity）、一致性（consistency）、隔离性（isolation）、持久性（durability）的缩写。</p>

<ol>
<li><p><strong>事务的原子性（atomicity）</strong>表示事务执行过程中的任何失败都将导致事务所做的任何更改失效。<br>
原子性是指事务是一个不可分割的工作单位，事务中的操作要么全部成功，要么全部失败。比如在同一个事务中的SQL语句，要么全部执行成功，要么全部执行失败。</p></li>
<li><p><strong>事务的一致性（consistency）</strong>表示当事务执行失败时，所有被该事务影响的数据都应该恢复到事务执行前的状态。<br>
一致性的概念是：事务必须使数据库从一个一致性状态变换到另外一个一致性状态。以转账为例子，A向B转账，假设转账之前这两个用户的钱加起来总共是2000，那么A向B转账之后，不管这两个账户怎么转，A用户的钱和B用户的钱加起来的总额还是2000，这个就是事务的一致性。</p></li>
<li><p><strong>事务的隔离性（isolation）</strong>表示在事务执行过程中对数据的修改，在事务提交之前对其他事务不可见。<br>
隔离性是多个用户并发访问数据库时，数据库为每一个用户开启的事务，不能被其他事务的操作数据所干扰，多个并发事务之间要相互隔离。</p></li>
<li><p><strong>事务的持久性（durability）</strong>表示已经提交的数据在事务执行失败时，数据的状态都应该正确。<br>
持久性是指一个事务一旦被提交，它对数据库中数据的改变就是永久性的，接下来即使数据库发生故障也不应该对其有任何影响</p></li>
</ol>

<h4>事务的概念从数据库而来，那么Java的事务是什么呢?他们之间有什么关联呢?</h4>

<p>实际上，Java应用系统如果要操作数据库是通过JDBC来实现，CRUD都是通过相应方法间接的来实现的，事务的控制也相应的转移到了Java程序代码中来，因此，数据库操作的事务习惯上就称为Java事务。</p>

<h4>为什么需要事务?</h4>

<p>事务是为了解决数据安全操作提出的，事务控制实际上就是控制数据的安全访问。</p>

<p>例子：</p>

<p>银行转账业务，账户A要将自己账户上的1000元转到B账户下面，首先A账户余额减1000元，然后B账户余额加1000元。<br>
假如在中间网络出现了问题，A账户减1000元操作已经完成，而B账户加1000元操作因为网络中断而操作失败，那么整<br>
个业务失败，必须做出控制，让A账户的转账业务撤销。这样才能保证业务的正确性，完成这个操作就需要事务，将A<br>
账户减1000元操作和B账户加1000元操作放到一个事务里面，要么全部执行成功，要么操作全部撤销，这样就保证了数<br>
据的安全性。</p>

<h4>事务的隔离级别</h4>

<p>多个线程开启各自事务操作数据库中数据时，数据库系统要负责隔离操作，以保证各个线程在获取数据时的准确性。</p>

<p>如果事务不考虑隔离性可能引发的问题：</p>

<p>1.<strong>脏读：</strong><em><strong>一个事务读取了另外一个事务未提交的数据。</strong></em></p>

<p>这是非常危险的，假设Ａ向Ｂ转帐100元，对应sql语句如下所示:
    1.update account set money=money+100 where name=&#39;B&#39;;<br>
    2.update account set money=money-100  where name=&#39;A&#39;;
当第1条sql执行完，第2条还没执行(A未提交时)，如果此时Ｂ查询自己的帐户，就会发现自己多了100元钱。如果A等B走后再回滚，B就会损失100元。</p>

<p>2.<strong>不可重复读：</strong><em><strong>不可重复读是指在一个事物内读取表中某一行数据，多次读取结果不同。</strong></em></p>

<p>例如银行想查询A帐户余额，第一次查询A帐户为200元，此时A向帐户内存了100元并提交了，银行接着又进行了一次查询，此时A帐户为300元了。银行两次查询不一致，可能就会很困惑，不知道哪次查询是准的。</p>

<p><em><strong>不可重复读和脏读的区别是，脏读是读取前一事务未提交的脏数据，不可重复读是重新读取了前一事务已提交的数据。</strong></em></p>

<p>很多人认为这种情况就对了，无须困惑，当然是后面的为准。我们可以考虑这样一种情况，比如银行程序需要将查询结果分别输出到电脑屏幕和写到文件中，结果在一个事务中针对输出的目的地，进行的两次查询不一致，导致文件和屏幕中的结果不一致，银行工作人员就不知道以哪个为准了。</p>

<p>3.<strong>虚读(幻读):</strong><em><strong>虚读(幻读)是指在一个事务内读取到了别的事务插入的数据，导致前后读取不一致。</strong></em></p>

<p>如丙存款100元未提交，这时银行做报表统计account表中所有用户的总额为500元，然后丙提交了，这时银行再统计发现帐户为600元了，造成虚读同样会使银行不知所措，到底以哪个为准。</p>

</div>

<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/git/2015/08/06/Git-Git-command/">
            Git — Git常用命令速查表
            <small>06 Aug 2015</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/others/2015/08/01/other-qizongzui/">
            Others — 让你此生难成大器的七宗罪
            <small>01 Aug 2015</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/java/2015/08/01/other-PG-10jineng/">
            Java — Java程序员应该掌握的十项技能
            <small>01 Aug 2015</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>

<div class="comments">
    <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'testnaringu';
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'testnaringu';
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>

</div>

      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>
    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>

    <div align="center" class="footer">
        Copyright © 2015 <br>
    </div>
  </body>
</html>

